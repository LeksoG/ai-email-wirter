<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InkMind - AI Email Writer</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg,
                #e0e7ff 0%,
                #f3e8ff 25%,
                #ddd6fe 50%,
                #e0e7ff 75%,
                #f0f9ff 100%
            );
            background-size: 400% 400%;
            animation: subtle-shift 20s ease infinite;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            padding-top: 100px; /* Space for sticky header */
        }

        body.dark-mode {
            background: linear-gradient(135deg,
                #000000 0%,
                #0a0a0a 25%,
                #1a1a1a 50%,
                #0a0a0a 75%,
                #000000 100%
            );
        }

        body.dark-mode .glass-effect {
            background: rgba(20, 20, 20, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .glass-dark {
            background: rgba(30, 30, 30, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .text-gray-800,
        body.dark-mode .text-gray-700 {
            color: #e5e5e5 !important;
        }

        body.dark-mode .text-gray-600,
        body.dark-mode .text-gray-500 {
            color: #a0a0a0 !important;
        }

        body.dark-mode .custom-textarea {
            background: rgba(30, 30, 30, 0.8);
            color: #e5e5e5;
        }

        body.dark-mode .sticky-header {
            background: transparent;
        }

        body.dark-mode .action-btn {
            background: rgba(40, 40, 40, 0.9);
            border: 1px solid rgba(99, 102, 241, 0.4);
            color: #e5e5e5;
        }

        body.dark-mode .action-btn:hover {
            background: rgba(60, 60, 60, 1);
            border-color: rgba(99, 102, 241, 0.6);
        }

        @keyframes subtle-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* AI Grid Pattern Overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(99, 102, 241, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(99, 102, 241, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        /* Page Load Blur-in Animation */
        .page-container {
            animation: blur-in 1.2s ease-out;
        }

        @keyframes blur-in {
            0% {
                opacity: 0;
                filter: blur(20px);
                transform: scale(0.95);
            }
            100% {
                opacity: 1;
                filter: blur(0);
                transform: scale(1);
            }
        }

        .glass-effect {
            background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.9) 0%,
                rgba(249, 250, 251, 0.85) 100%
            );
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.12),
                        0 2px 8px rgba(99, 102, 241, 0.08),
                        inset 0 1px 0 rgba(255, 255, 255, 0.8);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-effect:hover {
            box-shadow: 0 12px 48px rgba(99, 102, 241, 0.15),
                        0 4px 12px rgba(99, 102, 241, 0.1),
                        inset 0 1px 0 rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
        }

        .glass-dark {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.85);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.05);
        }

        .gradient-text {
            background: #3B82F6;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .ai-glow {
            box-shadow: 0 0 40px rgba(99, 102, 241, 0.2),
                        0 0 80px rgba(139, 92, 246, 0.15),
                        0 0 120px rgba(167, 139, 250, 0.1);
            animation: ai-pulse 4s ease-in-out infinite;
        }

        @keyframes ai-pulse {
            0%, 100% {
                box-shadow: 0 0 40px rgba(99, 102, 241, 0.2),
                           0 0 80px rgba(139, 92, 246, 0.15),
                           0 0 120px rgba(167, 139, 250, 0.1);
            }
            50% {
                box-shadow: 0 0 60px rgba(99, 102, 241, 0.3),
                           0 0 100px rgba(139, 92, 246, 0.2),
                           0 0 140px rgba(167, 139, 250, 0.15);
            }
        }

        @keyframes pulse-glow {
            0%, 100% {
                box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);
                transform: scale(1.02);
            }
        }

        .fade-in {
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .slide-in {
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .oval-button {
            border-radius: 50px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .oval-button:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.2);
        }

        /* Animated white outline for buttons */
        .unified-button {
            position: relative;
            border: 2px solid white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
            overflow: visible;
        }

        /* Navigation Button Glow Animation */
        @keyframes nav-button-glow {
            0% {
                box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
            }
            50% {
                box-shadow: 0 0 30px rgba(99, 102, 241, 0.6),
                           0 0 60px rgba(139, 92, 246, 0.4);
            }
            100% {
                box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
            }
        }

        .nav-button-glow-once {
            animation: nav-button-glow 1s ease-in-out;
        }

        /* Navigation Blur Transition */
        .nav-blur-out {
            animation: blur-out 0.4s ease-out forwards;
        }

        .nav-blur-in {
            animation: blur-in 0.4s ease-out forwards;
        }

        @keyframes blur-out {
            0% {
                opacity: 1;
                filter: blur(0);
            }
            100% {
                opacity: 0;
                filter: blur(10px);
            }
        }

        @keyframes blur-in {
            0% {
                opacity: 0;
                filter: blur(10px);
            }
            100% {
                opacity: 1;
                filter: blur(0);
            }
        }

        /* Splash Animation for Inbox Container */
        .splash-container {
            animation: container-fade-in 0.8s ease-out;
        }

        @keyframes container-fade-in {
            0% {
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }

        .splash-card {
            animation: card-slide-up 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) backwards;
        }

        @keyframes card-slide-up {
            0% {
                opacity: 0;
                transform: translateY(50px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Smooth blur reveal effect for greeting */
        .blur-reveal-text {
            animation: blur-reveal 1.2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            white-space: nowrap;
        }

        @keyframes blur-reveal {
            0% {
                opacity: 0;
                filter: blur(20px);
                transform: scale(0.9);
            }
            50% {
                opacity: 0.7;
                filter: blur(8px);
                transform: scale(0.98);
            }
            100% {
                opacity: 1;
                filter: blur(0);
                transform: scale(1);
            }
        }

        .blur-reveal-out {
            animation: blur-reveal-out 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes blur-reveal-out {
            0% {
                opacity: 1;
                filter: blur(0);
                transform: scale(1);
            }
            100% {
                opacity: 0;
                filter: blur(15px);
                transform: scale(0.95);
            }
        }

        .greeting-container {
            margin: 0 auto 20px auto;
            text-align: center;
            z-index: 10;
            transition: opacity 0.3s ease, min-height 0.3s ease, margin 0.3s ease;
            width: 100%;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .greeting-container.hidden {
            opacity: 0;
            pointer-events: none;
            min-height: 0;
            margin: 0;
        }

        .greeting-oval {
            padding: 10px 24px;
            border-radius: 50px;
            background: transparent;
            display: inline-block;
            max-width: 100%;
            width: auto;
            min-width: fit-content;
        }

        /* Word-by-word blur reveal for greeting */
        .greeting-word {
            display: inline-block;
            opacity: 0;
            filter: blur(12px);
            transform: translateY(8px) scale(0.95);
            animation: greeting-word-reveal 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes greeting-word-reveal {
            0% {
                opacity: 0;
                filter: blur(12px);
                transform: translateY(8px) scale(0.95);
            }
            60% {
                opacity: 0.8;
                filter: blur(4px);
                transform: translateY(-2px) scale(1.02);
            }
            100% {
                opacity: 1;
                filter: blur(0);
                transform: translateY(0) scale(1);
            }
        }

        .greeting-word-out {
            animation: greeting-word-out 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes greeting-word-out {
            0% {
                opacity: 1;
                filter: blur(0);
                transform: scale(1);
            }
            100% {
                opacity: 0;
                filter: blur(10px);
                transform: scale(0.9);
            }
        }

        /* Prompt Suggestions Container - Blur Background */
        .prompt-suggestions-container {
            position: absolute;
            bottom: calc(100% + 12px);
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1.5px solid rgba(99, 102, 241, 0.2);
            border-radius: 20px;
            padding: 16px 20px;
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.15), 0 4px 16px rgba(0, 0, 0, 0.08);
            animation: suggestions-appear 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 100;
            min-width: 280px;
            max-width: 400px;
        }

        body.dark-mode .prompt-suggestions-container {
            background: rgba(30, 30, 35, 0.85);
            border-color: rgba(99, 102, 241, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 4px 16px rgba(99, 102, 241, 0.1);
        }

        @keyframes suggestions-appear {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(10px) scale(0.95);
                filter: blur(8px);
            }
            100% {
                opacity: 1;
                transform: translateX(-50%) translateY(0) scale(1);
                filter: blur(0);
            }
        }

        .prompt-suggestions-container .suggestion-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #6b7280;
            margin-bottom: 10px;
        }

        body.dark-mode .prompt-suggestions-container .suggestion-title {
            color: #9ca3af;
        }

        .prompt-suggestions-container .suggestion-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .prompt-suggestions-container .suggestion-pill {
            padding: 8px 14px;
            border-radius: 50px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            border: 1px solid rgba(99, 102, 241, 0.2);
            font-size: 12px;
            font-weight: 500;
            color: #4f46e5;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: pill-appear 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) backwards;
        }

        .prompt-suggestions-container .suggestion-pill:nth-child(1) { animation-delay: 0.05s; }
        .prompt-suggestions-container .suggestion-pill:nth-child(2) { animation-delay: 0.1s; }
        .prompt-suggestions-container .suggestion-pill:nth-child(3) { animation-delay: 0.15s; }
        .prompt-suggestions-container .suggestion-pill:nth-child(4) { animation-delay: 0.2s; }
        .prompt-suggestions-container .suggestion-pill:nth-child(5) { animation-delay: 0.25s; }
        .prompt-suggestions-container .suggestion-pill:nth-child(6) { animation-delay: 0.3s; }

        @keyframes pill-appear {
            0% {
                opacity: 0;
                transform: translateY(8px) scale(0.9);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .prompt-suggestions-container .suggestion-pill:hover {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
            border-color: rgba(99, 102, 241, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
        }

        body.dark-mode .prompt-suggestions-container .suggestion-pill {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
            border-color: rgba(99, 102, 241, 0.3);
            color: #a5b4fc;
        }

        /* Ladder animation for cards */
        .ladder-item {
            animation: ladder-slide 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) backwards;
        }

        @keyframes ladder-slide {
            0% {
                opacity: 0;
                transform: translateX(-100px) rotate(-5deg);
            }
            100% {
                opacity: 1;
                transform: translateX(0) rotate(0deg);
            }
        }

        /* Profile Customization Popup */
        .profile-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .profile-popup {
            background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.95) 0%,
                rgba(249, 250, 251, 0.9) 100%);
            backdrop-filter: blur(30px);
            border: 2px solid rgba(255, 255, 255, 0.8);
            border-radius: 24px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: popup-scale 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        body.dark-mode .profile-popup {
            background: linear-gradient(135deg,
                rgba(30, 30, 35, 0.95) 0%,
                rgba(20, 20, 25, 0.9) 100%);
            border-color: rgba(255, 255, 255, 0.1);
        }

        @keyframes popup-scale {
            0% {
                opacity: 0;
                transform: scale(0.8) translateY(20px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .profile-color-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .profile-color-option {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 12px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .profile-color-option:hover {
            transform: scale(1.15);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .profile-color-option.selected {
            border-color: white;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.5);
            transform: scale(1.1);
        }

        .profile-image-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .profile-texture-option {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 12px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            background-size: 200% 200%;
            animation: texture-shift 8s ease infinite;
            position: relative;
            overflow: hidden;
        }

        @keyframes texture-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .profile-texture-option::before {
            content: '';
            position: absolute;
            inset: 0;
            background: inherit;
            filter: brightness(1.2);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .profile-texture-option:hover::before {
            opacity: 0.5;
        }

        .profile-texture-option:hover {
            transform: scale(1.15);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .profile-texture-option.selected {
            border-color: white;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.5);
            transform: scale(1.1);
        }

        /* Animated texture patterns */
        .texture-gradient-wave {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #667eea 75%, #764ba2 100%) !important;
        }

        .texture-ocean {
            background: linear-gradient(45deg, #2193b0 0%, #6dd5ed 25%, #2193b0 50%, #6dd5ed 75%, #2193b0 100%) !important;
        }

        .texture-sunset {
            background: linear-gradient(45deg, #ff6b6b 0%, #feca57 25%, #ee5a6f 50%, #ff6b6b 75%, #feca57 100%) !important;
        }

        .texture-forest {
            background: linear-gradient(45deg, #134e5e 0%, #71b280 25%, #134e5e 50%, #71b280 75%, #134e5e 100%) !important;
        }

        .texture-cosmic {
            background: linear-gradient(45deg, #360033 0%, #0b8793 25%, #360033 50%, #0b8793 75%, #360033 100%) !important;
        }

        .texture-aurora {
            background: linear-gradient(45deg, #00c9ff 0%, #92fe9d 25%, #00c9ff 50%, #92fe9d 75%, #00c9ff 100%) !important;
        }

        .texture-fire {
            background: linear-gradient(45deg, #f12711 0%, #f5af19 25%, #f12711 50%, #f5af19 75%, #f12711 100%) !important;
        }

        .texture-neon {
            background: linear-gradient(45deg, #fa709a 0%, #fee140 25%, #fa709a 50%, #fee140 75%, #fa709a 100%) !important;
        }

        /* Profile ring with animated texture */
        .account-profile-icon.with-texture {
            background-size: 200% 200% !important;
            animation: texture-shift 8s ease infinite !important;
        }

        .profile-popup-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .profile-popup-btn {
            flex: 1;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid white;
        }

        /* Navigation tab with underline glow */
        .nav-tab {
            position: relative;
            padding-bottom: 8px;
        }

        .nav-tab::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 3px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 2px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.6),
                        0 0 40px rgba(0, 0, 0, 0.4),
                        0 0 60px rgba(0, 0, 0, 0.2);
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body.dark-mode .nav-tab::after {
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.8),
                        0 0 40px rgba(255, 255, 255, 0.5),
                        0 0 60px rgba(255, 255, 255, 0.3);
        }

        .nav-tab.active::after {
            width: 80%;
            animation: glow-pulse 2s ease-in-out infinite;
        }

        @keyframes glow-pulse {
            0%, 100% {
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.6),
                           0 0 40px rgba(0, 0, 0, 0.4),
                           0 0 60px rgba(0, 0, 0, 0.2);
            }
            50% {
                box-shadow: 0 0 30px rgba(0, 0, 0, 0.8),
                           0 0 60px rgba(0, 0, 0, 0.6),
                           0 0 90px rgba(0, 0, 0, 0.4);
            }
        }

        body.dark-mode .nav-tab.active::after {
            animation: glow-pulse-dark 2s ease-in-out infinite;
        }

        @keyframes glow-pulse-dark {
            0%, 100% {
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.8),
                           0 0 40px rgba(255, 255, 255, 0.5),
                           0 0 60px rgba(255, 255, 255, 0.3);
            }
            50% {
                box-shadow: 0 0 30px rgba(255, 255, 255, 1),
                           0 0 60px rgba(255, 255, 255, 0.7),
                           0 0 90px rgba(255, 255, 255, 0.5);
            }
        }

        /* Glassy Nav Container */
        .nav-container {
            background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.7) 0%,
                rgba(249, 250, 251, 0.6) 100%
            );
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.8);
            border-radius: 50px;
            padding: 8px 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1),
                        inset 0 1px 0 rgba(255, 255, 255, 0.9);
            display: inline-flex;
            gap: 8px;
        }

        body.dark-mode .nav-container {
            background: linear-gradient(135deg,
                rgba(20, 20, 20, 0.7) 0%,
                rgba(30, 30, 30, 0.6) 100%
            );
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5),
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        /* Inactive nav tab styling - light grey/white in dark mode */
        .nav-tab-inactive {
            background: rgba(255, 255, 255, 0.15);
        }

        body.dark-mode .nav-tab-inactive {
            background: rgba(100, 100, 100, 0.4);
            color: #e5e5e5 !important;
        }

        body.dark-mode .nav-tab-inactive:hover {
            background: rgba(120, 120, 120, 0.5);
        }

        /* Custom Language Dropdown */
        .custom-dropdown-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .custom-language-select {
            width: 100%;
            padding: 14px 40px 14px 16px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(249, 250, 251, 0.8));
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            color: #374151;
            font-size: 14px;
            font-weight: 600;
            outline: none;
            cursor: pointer;
            appearance: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.1);
        }

        .custom-language-select:hover {
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
            transform: translateY(-1px);
        }

        .custom-language-select:focus {
            border-color: rgba(99, 102, 241, 0.6);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1),
                        0 4px 12px rgba(99, 102, 241, 0.2);
        }

        body.dark-mode .custom-language-select {
            background: linear-gradient(135deg, rgba(60, 60, 60, 0.8), rgba(40, 40, 40, 0.7));
            border-color: rgba(99, 102, 241, 0.4);
            color: #e5e5e5;
        }

        body.dark-mode .custom-language-select:hover {
            background: linear-gradient(135deg, rgba(70, 70, 70, 0.9), rgba(50, 50, 50, 0.8));
            border-color: rgba(99, 102, 241, 0.6);
        }

        .custom-dropdown-arrow {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            color: rgba(99, 102, 241, 0.7);
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .custom-language-select:focus + .custom-dropdown-arrow {
            transform: translateY(-50%) rotate(180deg);
        }

        body.dark-mode .custom-dropdown-arrow {
            color: rgba(167, 139, 250, 0.8);
        }

        /* Dropdown options styling */
        .custom-language-select option {
            background: white;
            color: #374151;
            padding: 12px;
        }

        body.dark-mode .custom-language-select option {
            background: rgba(40, 40, 40, 0.95);
            color: #e5e5e5;
        }

        /* Smooth dropdown animation */
        @keyframes dropdown-slide {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .custom-language-select:focus {
            animation: dropdown-slide 0.3s ease-out;
        }

        /* Authentication Popup */
        .auth-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        .auth-popup-container {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(249, 250, 251, 0.9));
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            max-width: 480px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.8);
            animation: popup-appear 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        body.dark-mode .auth-popup-container {
            background: linear-gradient(135deg, rgba(30, 30, 30, 0.95), rgba(20, 20, 20, 0.9));
            border-color: rgba(255, 255, 255, 0.1);
        }

        @keyframes popup-appear {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .auth-popup-icon {
            font-size: 60px;
            text-align: center;
            margin-bottom: 20px;
        }

        .auth-popup-title {
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            color: #374151;
            margin-bottom: 12px;
        }

        body.dark-mode .auth-popup-title {
            color: #e5e5e5;
        }

        .auth-popup-message {
            font-size: 15px;
            text-align: center;
            color: #6b7280;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        body.dark-mode .auth-popup-message {
            color: #a0a0a0;
        }

        .auth-popup-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .auth-popup-button {
            flex: 1;
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            outline: none;
        }

        .auth-popup-button-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .auth-popup-button-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4);
        }

        .auth-popup-button-secondary {
            background: rgba(255, 255, 255, 0.8);
            color: #374151;
            border: 2px solid rgba(99, 102, 241, 0.3);
        }

        .auth-popup-button-secondary:hover {
            background: rgba(255, 255, 255, 1);
            border-color: rgba(99, 102, 241, 0.5);
        }

        body.dark-mode .auth-popup-button-secondary {
            background: rgba(60, 60, 60, 0.8);
            color: #e5e5e5;
            border-color: rgba(99, 102, 241, 0.4);
        }

        body.dark-mode .auth-popup-button-secondary:hover {
            background: rgba(70, 70, 70, 0.9);
        }

        /* Account Details Section */
        .account-details-section {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(249, 250, 251, 0.8));
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px 24px;
            margin-bottom: 24px;
            border: 2px solid rgba(99, 102, 241, 0.2);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.1);
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: 16px;
            animation: slideIn 0.4s ease-out;
        }

        body.dark-mode .account-details-section {
            background: linear-gradient(135deg, rgba(40, 40, 40, 0.9), rgba(30, 30, 30, 0.8));
            border-color: rgba(99, 102, 241, 0.3);
        }

        /* Mobile responsive for account details */
        @media (max-width: 768px) {
            .account-details-section {
                grid-template-columns: auto 1fr;
                grid-template-rows: auto auto;
                gap: 12px;
            }

            .account-logout-btn {
                grid-column: 1 / -1;
                justify-self: center;
                width: 100%;
            }
        }

        .account-profile-icon {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            color: white;
            border: 3px solid rgba(99, 102, 241, 0.3);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .account-info {
            flex: 1;
        }

        .account-name {
            font-size: 18px;
            font-weight: 700;
            color: #374151;
            margin-bottom: 4px;
        }

        body.dark-mode .account-name {
            color: #e5e5e5;
        }

        .account-email {
            font-size: 13px;
            color: #6b7280;
        }

        body.dark-mode .account-email {
            color: #a0a0a0;
        }

        .account-logout-btn {
            padding: 8px 16px;
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            color: #ef4444;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .account-logout-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.5);
        }

        /* Unified Account Details Section */
        .account-details-section-unified {
            background: linear-gradient(135deg, rgba(30, 30, 35, 0.95), rgba(20, 20, 25, 0.9));
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 28px;
            margin-bottom: 24px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.4s ease-out;
        }

        body.dark-mode .account-details-section-unified {
            background: linear-gradient(135deg, rgba(30, 30, 35, 0.95), rgba(20, 20, 25, 0.9));
            border-color: rgba(255, 255, 255, 0.1);
        }

        .account-header {
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        @media (max-width: 768px) {
            .account-details-section-unified {
                padding: 20px;
                margin-left: -12px;
                margin-right: -12px;
                width: calc(100% + 24px);
                border-radius: 16px;
            }

            .account-header {
                grid-template-columns: auto 1fr;
                grid-template-rows: auto auto;
                gap: 12px;
            }

            .account-logout-btn {
                grid-column: 1 / -1;
                justify-self: center;
                width: 100%;
            }
        }

        /* Email Connections Section in Account */
        .account-connections-unified {
            padding-top: 20px;
            border-top: 2px solid rgba(255, 255, 255, 0.1);
        }

        .connection-label {
            font-size: 12px;
            font-weight: 700;
            color: #9ca3af;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .connection-buttons-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        @media (max-width: 768px) {
            .connection-buttons-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }

        /* Connection Buttons - Unified Dark Theme */
        .connection-btn-unified {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 14px 20px;
            border-radius: 50px;
            border: 2px solid rgba(255, 255, 255, 0.15);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(40, 40, 45, 0.5);
            backdrop-filter: blur(10px);
        }

        .connection-btn-unified:hover {
            border-color: rgba(255, 255, 255, 0.3);
            background: rgba(50, 50, 55, 0.7);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .gmail-btn-unified {
            color: #4285F4;
        }

        .gmail-btn-unified:hover {
            box-shadow: 0 8px 20px rgba(66, 133, 244, 0.3);
        }

        .outlook-btn-unified {
            color: #0078D4;
        }

        .outlook-btn-unified:hover {
            box-shadow: 0 8px 20px rgba(0, 120, 212, 0.3);
        }

        .connected-unified {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 20px;
            border-radius: 50px;
            border: 2px solid rgba(255, 255, 255, 0.15);
            background: rgba(40, 40, 45, 0.5);
            backdrop-filter: blur(10px);
        }

        .gmail-connected-unified {
            color: #4285F4;
            border-color: rgba(66, 133, 244, 0.3);
        }

        .outlook-connected-unified {
            color: #0078D4;
            border-color: rgba(0, 120, 212, 0.3);
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .connection-icon-unified {
            width: 22px;
            height: 22px;
            flex-shrink: 0;
        }

        .connection-text {
            font-size: 14px;
            font-weight: 600;
        }

        /* Disconnect Button - Oval with White Outline */
        .disconnect-btn-unified {
            padding: 6px 16px;
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            color: #e5e5e5;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .disconnect-btn-unified:hover {
            background: rgba(239, 68, 68, 0.15);
            border-color: rgba(255, 255, 255, 0.4);
            color: #fff;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }

        /* Connection Animation Popup */
        .connection-animation-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease-out;
        }

        .connection-animation-container {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(249, 250, 251, 0.9));
            border-radius: 24px;
            padding: 48px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: scaleIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        body.dark-mode .connection-animation-container {
            background: linear-gradient(135deg, rgba(40, 40, 40, 0.95), rgba(30, 30, 30, 0.9));
        }

        .connection-animation-content {
            display: flex;
            align-items: center;
            gap: 48px;
        }

        .connection-account-logo,
        .connection-provider-logo {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .account-circle,
        .provider-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 700;
            color: white;
            animation: pulse 2s ease-in-out infinite;
        }

        .account-circle {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border: 4px solid rgba(99, 102, 241, 0.3);
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.4);
        }

        .provider-circle {
            border: 4px solid;
        }

        .gmail-circle {
            background: linear-gradient(135deg, #4285F4 0%, #34a853 100%);
            border-color: rgba(66, 133, 244, 0.3);
            box-shadow: 0 0 30px rgba(66, 133, 244, 0.4);
        }

        .outlook-circle {
            background: linear-gradient(135deg, #0078D4 0%, #005a9e 100%);
            border-color: rgba(0, 120, 212, 0.3);
            box-shadow: 0 0 30px rgba(0, 120, 212, 0.4);
        }

        .provider-circle svg {
            width: 36px;
            height: 36px;
        }

        .account-label,
        .provider-label {
            font-size: 14px;
            font-weight: 600;
            color: #6b7280;
        }

        body.dark-mode .account-label,
        body.dark-mode .provider-label {
            color: #9ca3af;
        }

        .connection-line-container {
            position: relative;
            width: 120px;
            height: 4px;
        }

        .connection-line {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            border-radius: 2px;
            animation: lineGrow 2s ease-in-out infinite;
        }

        .connection-pulse {
            position: absolute;
            top: 50%;
            left: 0;
            width: 12px;
            height: 12px;
            background: #8b5cf6;
            border-radius: 50%;
            transform: translateY(-50%);
            box-shadow: 0 0 20px #8b5cf6;
            animation: pulseMoveRight 2s ease-in-out infinite;
        }

        .connection-status-text {
            margin-top: 24px;
            text-align: center;
            font-size: 16px;
            font-weight: 600;
            color: #374151;
            animation: fadeInOut 2s ease-in-out infinite;
        }

        body.dark-mode .connection-status-text {
            color: #e5e5e5;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        @keyframes lineGrow {
            0% {
                width: 0;
                opacity: 0.5;
            }
            50% {
                width: 100%;
                opacity: 1;
            }
            100% {
                width: 0;
                opacity: 0.5;
            }
        }

        @keyframes pulseMoveRight {
            0% {
                left: 0;
                opacity: 0;
            }
            50% {
                left: 50%;
                opacity: 1;
            }
            100% {
                left: 100%;
                opacity: 0;
            }
        }

        @keyframes fadeInOut {
            0%, 100% {
                opacity: 0.6;
            }
            50% {
                opacity: 1;
            }
        }

        /* Shake animation for error messages */
        @keyframes shake {
            0%, 100% {
                transform: translateX(0);
            }
            10%, 30%, 50%, 70%, 90% {
                transform: translateX(-5px);
            }
            20%, 40%, 60%, 80% {
                transform: translateX(5px);
            }
        }

        /* Search Bar Transform */
        .nav-search-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 8px 16px;
            opacity: 0;
            transform: translateX(-100%);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }

        .nav-search-bar.active {
            opacity: 1;
            transform: translateX(0);
            pointer-events: all;
        }

        .nav-search-input {
            width: 100%;
            padding: 10px 20px;
            border: 2px solid white;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        body.dark-mode .nav-search-input {
            background: rgba(40, 40, 40, 0.9);
            color: #e5e5e5;
        }

        .nav-search-suggestions {
            position: absolute;
            top: 100%;
            left: 16px;
            right: 16px;
            margin-top: 8px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid white;
            border-radius: 16px;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        }

        body.dark-mode .nav-search-suggestions {
            background: rgba(30, 30, 30, 0.95);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .search-suggestion-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .search-suggestion-item:last-child {
            border-bottom: none;
        }

        .search-suggestion-item:hover {
            background: rgba(59, 130, 246, 0.1);
            padding-left: 20px;
        }

        body.dark-mode .search-suggestion-item {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .search-suggestion-item:hover {
            background: rgba(100, 100, 100, 0.3);
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .sticky-header {
                padding-top: 8px;
            }

            .nav-container {
                padding: 6px 12px;
                gap: 6px;
                max-width: 95%;
                margin: 0 auto;
            }

            .nav-tab {
                font-size: 13px;
                padding: 6px 12px;
            }

            .modern-email-item,
            .priority-email-stacked {
                margin: 8px 12px;
                padding: 12px;
            }

            .email-hover-buttons {
                position: static;
                display: flex;
                margin-top: 8px;
                justify-content: flex-end;
            }

            .glass-effect,
            .glass-dark {
                margin: 8px 12px;
                padding: 16px;
            }

            .custom-textarea {
                font-size: 14px;
                padding: 12px 16px;
            }

            /* Settings toggles */
            .settings-panel {
                padding: 12px;
            }

            .setting-preview-container {
                padding: 12px;
            }

            /* Make toggles fit perfectly */
            input[type="checkbox"] {
                transform: scale(1.2);
            }

            /* Better visibility for toggle switches on mobile */
            .settings-panel button[class*="inline-flex"][class*="items-center"][class*="rounded-full"] {
                height: 32px !important;
                width: 56px !important;
                min-width: 56px;
            }

            .settings-panel button[class*="inline-flex"] span[class*="rounded-full"] {
                height: 24px !important;
                width: 24px !important;
            }

            .settings-panel button[class*="inline-flex"] span[class*="translate-x-6"] {
                transform: translateX(28px) !important;
            }

            .settings-panel button[class*="inline-flex"] span[class*="translate-x-1"] {
                transform: translateX(4px) !important;
            }

            /* Mobile search bar */
            .nav-search-bar {
                padding: 6px 12px;
            }

            .nav-search-input {
                font-size: 13px;
                padding: 8px 16px;
            }

            /* Welcome text smaller on mobile */
            .welcome-text {
                font-size: 1.3rem;
            }

            /* Smaller buttons on mobile */
            .oval-button {
                font-size: 13px;
                padding: 8px 16px !important;
            }

            /* Email content */
            .email-content-formatted {
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            .nav-tab {
                font-size: 11px;
                padding: 5px 10px;
            }

            .sticky-header {
                padding-top: 6px;
            }

            .welcome-text {
                font-size: 1.1rem;
            }

            .page-container {
                padding: 12px 8px;
            }
        }

        .tool-card {
            transition: all 0.3s ease;
        }

        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(99, 102, 241, 0.15);
        }

        /* Email delete animation */
        .email-deleting {
            animation: slide-fade-out 0.4s ease-out forwards;
        }

        @keyframes slide-fade-out {
            0% {
                opacity: 1;
                transform: translateX(0);
                max-height: 200px;
            }
            50% {
                opacity: 0.5;
                transform: translateX(-30px);
            }
            100% {
                opacity: 0;
                transform: translateX(-100%);
                max-height: 0;
                padding-top: 0;
                padding-bottom: 0;
                margin-top: 0;
                margin-bottom: 0;
            }
        }

        /* Refresh button animation */
        .refresh-spinning {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        textarea:focus, input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .custom-textarea {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid rgba(99, 102, 241, 0.25);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 15px;
            line-height: 1.6;
        }

        .custom-textarea:focus {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(99, 102, 241, 0.5);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1),
                        0 8px 24px rgba(99, 102, 241, 0.15);
            transform: translateY(-2px);
        }

        .tab-container {
            position: relative;
            display: inline-flex;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50px;
            padding: 6px;
            margin-bottom: 24px;
        }

        .tab-slider {
            position: absolute;
            background: transparent;
            border-radius: 50px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 0;
            border-bottom: 3px solid rgba(0, 0, 0, 0.8);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.6),
                        0 8px 40px rgba(0, 0, 0, 0.4);
        }

        body.dark-mode .tab-slider {
            border-bottom: 3px solid rgba(255, 255, 255, 0.9);
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.8),
                        0 8px 40px rgba(255, 255, 255, 0.5);
        }

        /* Loading Lines Animation - Gemini Style */
        .loading-lines {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 100%;
            padding: 20px 0;
        }

        .loading-line {
            height: 12px;
            background: linear-gradient(90deg,
                rgba(99, 102, 241, 0.1) 0%,
                rgba(139, 92, 246, 0.6) 50%,
                rgba(99, 102, 241, 0.1) 100%
            );
            background-size: 200% 100%;
            border-radius: 20px;
            animation: loading-wave 2s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        .loading-line::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(255, 255, 255, 0.4) 50%,
                transparent 100%
            );
            animation: loading-shine 2s ease-in-out infinite;
        }

        .loading-line:nth-child(1) {
            animation-delay: 0s;
            width: 95%;
        }
        .loading-line:nth-child(2) {
            animation-delay: 0.15s;
            width: 88%;
        }
        .loading-line:nth-child(3) {
            animation-delay: 0.3s;
            width: 92%;
        }
        .loading-line:nth-child(4) {
            animation-delay: 0.45s;
            width: 85%;
        }
        .loading-line:nth-child(5) {
            animation-delay: 0.6s;
            width: 90%;
        }
        .loading-line:nth-child(6) {
            animation-delay: 0.75s;
            width: 80%;
        }

        @keyframes loading-wave {
            0%, 100% {
                background-position: -200% 0;
                transform: scaleX(0.98);
                opacity: 0.7;
            }
            50% {
                background-position: 200% 0;
                transform: scaleX(1);
                opacity: 1;
            }
        }

        @keyframes loading-shine {
            0% {
                left: -100%;
            }
            100% {
                left: 100%;
            }
        }

        /* Smooth Blurry Typing Reveal Animation */
        .wave-char {
            display: inline-block;
            opacity: 0;
            filter: blur(12px);
            transform: translateY(8px) scale(0.95);
            animation: wave-typing-reveal 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards;
        }

        @keyframes wave-appear {
            0% {
                opacity: 0;
                filter: blur(12px);
                transform: translateY(8px) scale(0.95);
            }
            30% {
                opacity: 0.4;
                filter: blur(8px);
                transform: translateY(4px) scale(0.97);
            }
            60% {
                opacity: 0.8;
                filter: blur(3px);
                transform: translateY(1px) scale(0.99);
            }
            100% {
                opacity: 1;
                filter: blur(0);
                transform: translateY(0) scale(1);
            }
        }

        .result-container {
            position: relative;
            min-height: 300px;
        }

        .settings-panel {
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .email-item {
            transition: all 0.2s ease;
            position: relative;
        }

        .email-item:hover {
            background: rgba(99, 102, 241, 0.1);
            transform: translateX(5px);
        }

        .email-hover-buttons {
            position: absolute;
            top: 12px;
            right: 16px;
            display: none;
            gap: 8px;
            z-index: 10;
        }

        .email-item:hover .email-hover-buttons {
            display: flex;
        }

        .modern-email-item:hover .email-hover-buttons {
            display: flex;
        }

        .priority-email-stacked:hover .email-hover-buttons {
            display: flex;
        }

        .email-hover-btn {
            padding: 4px 12px;
            font-size: 11px;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .email-hover-btn:hover {
            background: rgba(99, 102, 241, 0.1);
            border-color: rgba(99, 102, 241, 0.5);
        }

        /* Summarize Popup */
        .summary-popup {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 12px;
            background: white;
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            z-index: 50;
            animation: popup-slide-down 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        body.dark-mode .summary-popup {
            background: rgba(30, 30, 30, 0.95);
            border-color: rgba(99, 102, 241, 0.5);
        }

        @keyframes popup-slide-down {
            from {
                opacity: 0;
                transform: translateY(-10px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Send Button - Floating */
        .send-button-float {
            position: absolute;
            bottom: 16px;
            right: 16px;
            padding: 12px 20px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            transition: all 0.3s ease;
            animation: float-in 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 10;
        }

        .send-button-float:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
        }

        /* Mobile: Make send button smaller */
        @media (max-width: 768px) {
            .send-button-float {
                padding: 10px 16px;
                font-size: 13px;
                bottom: 12px;
                right: 12px;
                gap: 6px;
            }
        }

        @keyframes float-in {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* AI Transform Container */
        .ai-transform-container {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
        }

        .ai-transform-input {
            width: 100%;
            padding: 12px 140px 12px 20px;
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 50px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s;
        }

        .ai-transform-input:focus {
            outline: none;
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        body.dark-mode .ai-transform-input {
            background: rgba(30, 30, 30, 0.8);
            color: #e5e5e5;
        }

        .ai-transform-button {
            position: absolute;
            right: 6px;
            top: 50%;
            transform: translateY(-50%);
            padding: 8px 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(249, 250, 251, 0.85) 100%);
            color: #1f2937;
            border: 2px solid white;
            border-radius: 50px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .ai-transform-button {
            background: linear-gradient(135deg, rgba(60, 60, 60, 0.9) 0%, rgba(50, 50, 50, 0.85) 100%);
            color: #e5e5e5;
        }

        .ai-transform-button:hover {
            opacity: 0.9;
        }

        .ai-transform-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Wave Animation - Smooth Blurry Typing Reveal */
        .wave-char {
            display: inline-block;
            opacity: 0;
            filter: blur(12px);
            transform: translateY(8px) scale(0.95);
            animation: wave-typing-reveal 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards;
        }

        @keyframes wave-typing-reveal {
            0% {
                opacity: 0;
                filter: blur(12px);
                transform: translateY(8px) scale(0.95);
            }
            30% {
                opacity: 0.4;
                filter: blur(8px);
                transform: translateY(4px) scale(0.97);
            }
            60% {
                opacity: 0.8;
                filter: blur(3px);
                transform: translateY(1px) scale(0.99);
            }
            100% {
                opacity: 1;
                filter: blur(0);
                transform: translateY(0) scale(1);
            }
        }

        /* Full-page email viewer - iOS style */
        .email-viewer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: overlay-fade-in 0.3s ease-out;
        }

        @keyframes overlay-fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .email-viewer-container {
            width: 90%;
            max-width: 900px;
            height: 90vh;
            background: white;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: viewer-slide-up 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            flex-direction: column;
        }

        body.dark-mode .email-viewer-container {
            background: rgba(20, 20, 20, 0.95);
        }

        @keyframes viewer-slide-up {
            from {
                transform: translateY(100px) scale(0.95);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        /* Filter Dropdown */
        .filter-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            min-width: 200px;
            max-width: 300px;
            z-index: 50;
            animation: dropdown-appear 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes dropdown-appear {
            from {
                opacity: 0;
                transform: translateY(-10px) scale(0.95);
                filter: blur(4px);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
                filter: blur(0);
            }
        }

        /* Suggestions blur animation */
        .suggestions-container {
            animation: blur-slide-in 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes blur-slide-in {
            from {
                opacity: 0;
                transform: translateX(-20px);
                filter: blur(8px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
                filter: blur(0);
            }
        }

        @keyframes blurFadeIn {
            from {
                opacity: 0;
                filter: blur(10px);
                transform: translateY(10px) scale(0.95);
            }
            to {
                opacity: 1;
                filter: blur(0);
                transform: translateY(0) scale(1);
            }
        }

        @keyframes slideDownFade {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInFromLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* New Suggestion Carousel Design - Professional AI Style */
        .suggestion-carousel-container {
            position: relative;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            margin-left: -60px; /* Move to the left */
        }

        .suggestion-carousel {
            flex: 1;
            overflow: hidden;
            position: relative;
            border-radius: 50px;
            background: linear-gradient(135deg,
                rgba(99, 102, 241, 0.08) 0%,
                rgba(139, 92, 246, 0.05) 100%);
            padding: 6px 12px;
            border: 1px solid rgba(99, 102, 241, 0.15);
            backdrop-filter: blur(10px);
        }

        .suggestion-carousel-track {
            display: flex;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .suggestion-carousel-item {
            min-width: 100%;
            padding: 10px 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            letter-spacing: 0.3px;
            color: #4f46e5;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.95) 0%,
                rgba(249, 250, 251, 0.9) 100%);
            border-radius: 50px;
            border: 1.5px solid rgba(99, 102, 241, 0.25);
            box-shadow: 0 2px 6px rgba(99, 102, 241, 0.08),
                        inset 0 1px 0 rgba(255, 255, 255, 0.9);
        }

        .suggestion-carousel-item:hover {
            border-color: rgba(99, 102, 241, 0.5);
            transform: translateY(-1px) scale(1.01);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2),
                        0 8px 24px rgba(99, 102, 241, 0.1),
                        inset 0 1px 0 rgba(255, 255, 255, 1);
            background: linear-gradient(135deg,
                rgba(255, 255, 255, 1) 0%,
                rgba(249, 250, 251, 0.95) 100%);
        }

        body.dark-mode .suggestion-carousel {
            background: linear-gradient(135deg,
                rgba(99, 102, 241, 0.12) 0%,
                rgba(139, 92, 246, 0.08) 100%);
            border-color: rgba(99, 102, 241, 0.3);
        }

        body.dark-mode .suggestion-carousel-item {
            background: linear-gradient(135deg,
                rgba(55, 55, 65, 0.95) 0%,
                rgba(45, 45, 55, 0.9) 100%);
            color: #a5b4fc;
            border-color: rgba(99, 102, 241, 0.4);
            box-shadow: 0 2px 6px rgba(99, 102, 241, 0.15),
                        inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        body.dark-mode .suggestion-carousel-item:hover {
            background: linear-gradient(135deg,
                rgba(65, 65, 75, 1) 0%,
                rgba(55, 55, 65, 0.95) 100%);
            border-color: rgba(99, 102, 241, 0.6);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25),
                        0 8px 24px rgba(99, 102, 241, 0.15),
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        /* Suggestion Indicator - Hidden */
        .suggestion-indicator {
            display: none; /* Remove scroll indicator */
            position: absolute;
            top: -32px;
            right: 0;
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
            animation: indicator-bounce 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), indicator-fade-out 0.5s ease-in-out 4.5s forwards;
            border: 2px solid white;
        }

        @keyframes indicator-bounce {
            0% {
                opacity: 0;
                transform: translateY(-10px) scale(0.9);
            }
            60% {
                transform: translateY(2px) scale(1.05);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes indicator-fade-out {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-10px);
            }
        }

        .suggestion-indicator-icon {
            animation: indicator-pulse 1.5s ease-in-out infinite;
        }

        @keyframes indicator-pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
        }

        /* Tab container styling */
        .tab-button-container {
            background: rgba(255, 255, 255, 0.6);
            border: 2px solid rgba(99, 102, 241, 0.2);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.1);
        }

        /* Ensure tabs are visible on mobile */
        @media (max-width: 768px) {
            .tab-container {
                width: 100%;
                max-width: 100%;
                display: flex;
                justify-content: center;
            }

            .tab-container button {
                flex: 1;
                white-space: nowrap;
                font-size: 14px;
                padding: 10px 16px !important;
            }

            .ai-writer-container {
                padding: 12px !important;
                max-width: 100vw;
                overflow-x: hidden;
            }

            /* Mobile: Model switcher at top, language switcher at bottom */
            .ai-writer-container .space-y-6 {
                display: flex;
                flex-direction: column;
            }

            /* Model switcher on mobile - show at top left */
            .mobile-model-switcher {
                display: flex !important;
                justify-content: flex-start;
                margin-bottom: 12px;
                order: 1;
                position: relative;
            }

            /* Tool indicator */
            .ai-writer-container .space-y-6 > div:nth-child(2) {
                order: 2;
            }

            /* Email writing area */
            .email-writing-area-wrapper {
                order: 3;
            }

            /* Language selector - move to bottom on mobile */
            .language-selector-mobile {
                order: 5 !important;
                justify-content: center !important;
                margin-top: 16px;
            }

            /* Custom transformation section */
            .custom-transformation-section {
                order: 4;
            }

            /* Custom prompt container - centered on mobile */
            .ai-prompt-container {
                padding-left: 0 !important;
                max-width: 100%;
            }

            /* Hide desktop model switcher at bottom on mobile */
            .ai-prompt-container > div:first-child {
                display: none !important;
            }

            /* Email textarea sizing for mobile */
            .custom-textarea {
                height: 280px !important;
                font-size: 14px !important;
                padding: 16px !important;
            }

            /* Mobile send button */
            .mobile-send-button {
                position: fixed;
                bottom: 100px;
                right: 20px;
                width: 56px;
                height: 56px;
                border-radius: 50%;
                background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
                border: 3px solid white;
                box-shadow: 0 4px 20px rgba(99, 102, 241, 0.5), 0 8px 40px rgba(99, 102, 241, 0.3);
                display: none;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                z-index: 1000;
                color: white;
                font-size: 24px;
                opacity: 0;
                transform: scale(0);
                transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
                pointer-events: none;
            }

            .mobile-send-button.show {
                opacity: 1;
                transform: scale(1);
                pointer-events: all;
            }

            .mobile-send-button:active {
                transform: scale(0.85);
            }

            /* Container width fixes */
            .email-writing-container,
            .ai-prompt-container {
                max-width: 100%;
            }
        }

        /* Email Tools Tab Bar */
        .email-tools-bar {
            display: flex;
            gap: 8px;
            padding: 10px 16px;
            background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.85) 0%,
                rgba(249, 250, 251, 0.8) 100%);
            border-bottom: 1px solid rgba(99, 102, 241, 0.15);
            border-radius: 16px 16px 0 0;
            backdrop-filter: blur(10px);
        }

        body.dark-mode .email-tools-bar {
            background: linear-gradient(135deg,
                rgba(40, 40, 40, 0.85) 0%,
                rgba(30, 30, 30, 0.8) 100%);
            border-bottom-color: rgba(99, 102, 241, 0.3);
        }

        .email-tool-btn {
            padding: 6px 16px;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.3px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg,
                rgba(99, 102, 241, 0.08) 0%,
                rgba(139, 92, 246, 0.05) 100%);
            border: 1.5px solid rgba(99, 102, 241, 0.2);
            color: #4f46e5;
            box-shadow: 0 1px 3px rgba(99, 102, 241, 0.08);
        }

        .email-tool-btn:hover {
            background: linear-gradient(135deg,
                rgba(99, 102, 241, 0.15) 0%,
                rgba(139, 92, 246, 0.1) 100%);
            border-color: rgba(99, 102, 241, 0.4);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.15);
        }

        body.dark-mode .email-tool-btn {
            background: linear-gradient(135deg,
                rgba(99, 102, 241, 0.15) 0%,
                rgba(139, 92, 246, 0.1) 100%);
            border-color: rgba(99, 102, 241, 0.3);
            color: #a5b4fc;
        }

        body.dark-mode .email-tool-btn:hover {
            background: linear-gradient(135deg,
                rgba(99, 102, 241, 0.25) 0%,
                rgba(139, 92, 246, 0.15) 100%);
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.25);
        }

        .email-writing-container {
            border-radius: 16px;
            overflow: hidden;
            border: 2px solid white;
        }

        body.dark-mode .email-writing-container {
            border-color: rgba(99, 102, 241, 0.3);
        }

        /* Stats Section */
        .stats-section {
            margin-top: 40px;
            padding: 32px;
            background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.9) 0%,
                rgba(249, 250, 251, 0.85) 100%);
            border-radius: 24px;
            border: 2px solid rgba(99, 102, 241, 0.2);
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.12);
        }

        body.dark-mode .stats-section {
            background: linear-gradient(135deg,
                rgba(30, 30, 30, 0.9) 0%,
                rgba(20, 20, 20, 0.85) 100%);
            border-color: rgba(99, 102, 241, 0.3);
        }

        .stats-header {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 24px;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        body.dark-mode .stats-header {
            color: #e5e5e5;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            padding: 20px;
            background: linear-gradient(135deg,
                rgba(99, 102, 241, 0.08) 0%,
                rgba(139, 92, 246, 0.05) 100%);
            border-radius: 16px;
            border: 1.5px solid rgba(99, 102, 241, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.4);
        }

        body.dark-mode .stat-card {
            background: linear-gradient(135deg,
                rgba(99, 102, 241, 0.15) 0%,
                rgba(139, 92, 246, 0.1) 100%);
            border-color: rgba(99, 102, 241, 0.3);
        }

        body.dark-mode .stat-card:hover {
            border-color: rgba(99, 102, 241, 0.5);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #4f46e5;
            margin-bottom: 8px;
        }

        body.dark-mode .stat-value {
            color: #a5b4fc;
        }

        .stat-label {
            font-size: 14px;
            font-weight: 600;
            color: #6b7280;
        }

        body.dark-mode .stat-label {
            color: #9ca3af;
        }

        .priority-list {
            margin-top: 24px;
        }

        .priority-list-header {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        body.dark-mode .priority-list-header {
            color: #e5e5e5;
        }

        .priority-item {
            padding: 16px;
            background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.95) 0%,
                rgba(249, 250, 251, 0.9) 100%);
            border-radius: 12px;
            border: 1.5px solid rgba(99, 102, 241, 0.15);
            margin-bottom: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .priority-item:hover {
            border-color: rgba(99, 102, 241, 0.4);
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.12);
        }

        body.dark-mode .priority-item {
            background: linear-gradient(135deg,
                rgba(40, 40, 40, 0.95) 0%,
                rgba(30, 30, 30, 0.9) 100%);
            border-color: rgba(99, 102, 241, 0.25);
        }

        body.dark-mode .priority-item:hover {
            border-color: rgba(99, 102, 241, 0.5);
        }

        .priority-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .priority-high {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .priority-medium {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .priority-low {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }

        /* File Viewer Modal */
        .file-viewer-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: modal-appear 0.3s ease-out;
        }

        @keyframes modal-appear {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .file-viewer-content {
            background: white;
            border-radius: 24px;
            max-width: 800px;
            max-height: 80vh;
            width: 90%;
            overflow: hidden;
            animation: modal-slide-up 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .file-viewer-content {
            background: rgba(30, 30, 30, 0.98);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
        }

        @keyframes modal-slide-up {
            from {
                transform: translateY(50px) scale(0.95);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Sticky Header */
        .sticky-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 50;
            background: transparent;
            animation: header-slide-down 0.3s ease-out;
            padding-top: 12px;
        }

        @keyframes header-slide-down {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Action Buttons (Copy/Retry) */
        .action-buttons {
            display: flex;
            gap: 8px;
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
        }

        .action-btn {
            padding: 6px 16px;
            font-size: 12px;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 1);
            border-color: rgba(99, 102, 241, 0.5);
            transform: translateY(-1px);
        }

        /* Floating AI particles */
        .ai-particle {
            position: fixed;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.4), transparent);
            border-radius: 50%;
            pointer-events: none;
            animation: float-particle 15s infinite ease-in-out;
        }

        @keyframes float-particle {
            0%, 100% {
                transform: translate(0, 0) scale(1);
                opacity: 0.3;
            }
            25% {
                transform: translate(30px, -40px) scale(1.5);
                opacity: 0.6;
            }
            50% {
                transform: translate(-20px, -80px) scale(1);
                opacity: 0.4;
            }
            75% {
                transform: translate(-50px, -40px) scale(1.2);
                opacity: 0.5;
            }
        }

        /* Delete Animation */
        .email-delete-fade {
            animation: delete-slide-out 0.5s cubic-bezier(0.4, 0, 1, 1) forwards;
        }

        @keyframes delete-slide-out {
            0% {
                opacity: 1;
                transform: translateX(0) scale(1);
                max-height: 200px;
            }
            30% {
                opacity: 0.7;
                transform: translateX(-30px) scale(0.98);
            }
            60% {
                opacity: 0.3;
                transform: translateX(-80px) scale(0.95);
            }
            100% {
                opacity: 0;
                transform: translateX(-120px) scale(0.9);
                max-height: 0;
                padding-top: 0;
                padding-bottom: 0;
                margin-top: 0;
                margin-bottom: 0;
                overflow: hidden;
            }
        }

        /* Undo Delete Button */
        .undo-delete-button {
            position: fixed;
            bottom: 32px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            background: rgba(20, 20, 20, 0.95);
            color: white;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            animation: undo-slide-up 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .undo-delete-button:hover {
            background: rgba(40, 40, 40, 0.95);
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }

        @keyframes undo-slide-up {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(60px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* Prioritize Email Animation */
        .prioritize-wave {
            max-width: 400px;
            margin: 0 auto;
            padding: 16px 32px;
            background: linear-gradient(135deg,
                rgba(99, 102, 241, 0.15) 0%,
                rgba(139, 92, 246, 0.25) 50%,
                rgba(167, 139, 250, 0.15) 100%
            );
            background-size: 200% 200%;
            animation: prioritize-glow 2s ease-in-out infinite;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-weight: 600;
            font-size: 0.95rem;
            color: #6366f1;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(99, 102, 241, 0.2);
            box-shadow: 0 4px 24px rgba(99, 102, 241, 0.1),
                        inset 0 1px 0 rgba(255, 255, 255, 0.5);
            transform: translateY(0);
            transition: all 0.3s ease;
        }

        body.dark-mode .prioritize-wave {
            background: linear-gradient(135deg,
                rgba(99, 102, 241, 0.2) 0%,
                rgba(139, 92, 246, 0.3) 50%,
                rgba(167, 139, 250, 0.2) 100%
            );
            border-color: rgba(99, 102, 241, 0.4);
            color: #a5b4fc;
        }

        @keyframes prioritize-glow {
            0%, 100% {
                background-position: 0% 50%;
                box-shadow: 0 4px 24px rgba(99, 102, 241, 0.1),
                           inset 0 1px 0 rgba(255, 255, 255, 0.5);
            }
            50% {
                background-position: 100% 50%;
                box-shadow: 0 8px 32px rgba(99, 102, 241, 0.25),
                           inset 0 1px 0 rgba(255, 255, 255, 0.6);
            }
        }

        /* Prioritizing Glow Container */
        .prioritizing-glow-container {
            display: flex;
            justify-content: center;
            margin: 12px 0;
            animation: fadeInScale 0.3s ease-out;
        }

        .prioritizing-glow-oval {
            padding: 10px 24px;
            background: linear-gradient(135deg,
                rgba(99, 102, 241, 0.2) 0%,
                rgba(139, 92, 246, 0.3) 50%,
                rgba(167, 139, 250, 0.2) 100%
            );
            background-size: 200% 200%;
            animation: prioritize-glow 2s ease-in-out infinite;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 0.9rem;
            color: #6366f1;
            backdrop-filter: blur(20px);
            border: 2px solid rgba(99, 102, 241, 0.3);
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3),
                        inset 0 1px 0 rgba(255, 255, 255, 0.4);
        }

        body.dark-mode .prioritizing-glow-oval {
            background: linear-gradient(135deg,
                rgba(99, 102, 241, 0.25) 0%,
                rgba(139, 92, 246, 0.35) 50%,
                rgba(167, 139, 250, 0.25) 100%
            );
            border-color: rgba(99, 102, 241, 0.5);
            color: #a5b4fc;
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4),
                        inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .prioritizing-icon {
            font-size: 1.2rem;
            animation: pulse-icon 1.5s ease-in-out infinite;
        }

        @keyframes pulse-icon {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .email-slide-up {
            animation: email-priority-slide 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes email-priority-slide {
            0% {
                opacity: 0.5;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Gmail Icon Styles */
        .gmail-icon {
            width: 20px;
            height: 20px;
            display: inline-block;
        }

        .gmail-connecting {
            animation: gmail-pulse 1.5s ease-in-out infinite;
        }

        @keyframes gmail-pulse {
            0%, 100% {
                opacity: 0.6;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.1);
            }
        }

        .gmail-connected {
            position: relative;
        }

        .gmail-connected::after {
            content: '';
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 10px;
            height: 10px;
            background: #10b981;
            border-radius: 50%;
            color: white;
            font-size: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
        }

        /* Email Selection Checkbox */
        .email-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(99, 102, 241, 0.5);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .email-checkbox.checked {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(249, 250, 251, 0.85) 100%);
            border-color: #10b981;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }

        body.dark-mode .email-checkbox.checked {
            background: linear-gradient(135deg, rgba(60, 60, 60, 0.9) 0%, rgba(50, 50, 50, 0.85) 100%);
        }

        .email-checkbox:hover {
            border-color: #6366f1;
            transform: scale(1.1);
        }

        /* Improved Email Content Display */
        .email-content-formatted {
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.6;
            font-size: 14px;
        }

        .email-content-formatted p {
            margin-bottom: 12px;
        }

        /* Priority Email Stacking */
        .priority-container {
            position: relative;
            margin-bottom: 24px;
        }

        .priority-header {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(249, 250, 251, 0.85) 100%);
            color: #1f2937;
            padding: 16px 24px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            position: relative;
            z-index: 10;
            border: 2px solid white;
        }

        body.dark-mode .priority-header {
            background: linear-gradient(135deg, rgba(40, 40, 40, 0.9) 0%, rgba(30, 30, 30, 0.85) 100%);
            color: #e5e5e5;
        }

        .priority-header:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);
        }

        .priority-stack {
            position: relative;
            margin-top: -12px;
        }

        .priority-email-stacked {
            position: absolute;
            width: calc(100% - 16px);
            left: 8px;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 16px;
            padding: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            animation: stack-appear-glow 1.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        body.dark-mode .priority-email-stacked {
            background: rgba(40, 40, 40, 0.95);
            border-color: rgba(99, 102, 241, 0.5);
            color: #e5e5e5;
        }

        @keyframes stack-appear-glow {
            0% {
                opacity: 0;
                transform: translateY(-20px) scale(0.9);
                box-shadow: 0 0 0 rgba(99, 102, 241, 0), inset 0 0 0 rgba(99, 102, 241, 0);
            }
            30% {
                box-shadow: 0 0 35px rgba(99, 102, 241, 0.8), 0 0 70px rgba(139, 92, 246, 0.6),
                           inset -200px 0 100px -50px rgba(99, 102, 241, 0.4);
            }
            60% {
                box-shadow: 0 0 35px rgba(99, 102, 241, 0.8), 0 0 70px rgba(139, 92, 246, 0.6),
                           inset 0 0 100px -50px rgba(99, 102, 241, 0.4);
            }
            85% {
                box-shadow: 0 0 35px rgba(99, 102, 241, 0.8), 0 0 70px rgba(139, 92, 246, 0.6),
                           inset 200px 0 100px -50px rgba(99, 102, 241, 0.4);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1), inset 0 0 0 rgba(99, 102, 241, 0);
            }
        }

        @keyframes stack-appear {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .priority-email-stacked:nth-child(1) {
            top: 8px;
            z-index: 3;
            transform: scale(0.98);
            animation: stack-glow 2s ease-in-out infinite;
        }

        .priority-email-stacked:nth-child(2) {
            top: 12px;
            z-index: 2;
            transform: scale(0.96);
            opacity: 0.7;
            animation-delay: 0.1s;
        }

        .priority-email-stacked:nth-child(3) {
            top: 16px;
            z-index: 1;
            transform: scale(0.94);
            opacity: 0.5;
            animation-delay: 0.2s;
        }

        .priority-email-stacked:nth-child(n+4) {
            display: none;
        }

        @keyframes stack-glow {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1), 0 0 0 rgba(99, 102, 241, 0);
            }
            50% {
                box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3), 0 0 20px rgba(99, 102, 241, 0.2);
            }
        }

        .priority-stack {
            position: relative;
            margin-top: -12px;
            min-height: 80px;
            transition: min-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .priority-stack-expanded {
            position: relative;
            margin-top: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .priority-stack-expanded .priority-email-stacked {
            position: relative;
            width: 100%;
            left: 0;
            margin-bottom: 12px;
            opacity: 1;
            transform: scale(1);
            animation: priority-expand 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        .priority-stack-expanded .priority-email-stacked:nth-child(n+4) {
            display: block;
        }

        @keyframes priority-expand {
            from {
                opacity: 0;
                transform: translateY(-10px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Collapse animation */
        .priority-stack .priority-email-stacked {
            animation: priority-collapse 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes priority-collapse {
            from {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            to {
                opacity: 0.5;
                transform: translateY(-5px) scale(0.94);
            }
        }

        .priority-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        /* Auto-Prioritize Setting */
        .setting-preview-container {
            margin-top: 12px;
            padding: 16px;
            background: rgba(99, 102, 241, 0.05);
            border: 2px solid rgba(99, 102, 241, 0.2);
            border-radius: 16px;
            animation: setting-preview-appear 0.3s ease-out;
        }

        @keyframes setting-preview-appear {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .preview-animation {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 12px;
        }

        .preview-email-item {
            padding: 12px;
            background: white;
            border-radius: 12px;
            border: 2px solid rgba(99, 102, 241, 0.2);
            font-size: 12px;
            animation: preview-slide 2s ease-in-out infinite;
        }

        .preview-email-item:nth-child(1) {
            animation-delay: 0s;
        }

        .preview-email-item:nth-child(2) {
            animation-delay: 0.3s;
        }

        .preview-email-item:nth-child(3) {
            animation-delay: 0.6s;
        }

        @keyframes preview-slide {
            0%, 100% {
                transform: translateX(0);
                opacity: 0.7;
            }
            50% {
                transform: translateX(10px);
                opacity: 1;
            }
        }

        /* Dark mode support for preview */
        body.dark-mode .setting-preview-container {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.4);
        }

        body.dark-mode .preview-email-item {
            background: rgba(40, 40, 40, 0.9);
            border-color: rgba(99, 102, 241, 0.4);
            color: #e5e5e5;
        }

        /* Send Button States */
        .send-button-sending {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            opacity: 0.7;
            cursor: not-allowed;
        }

        .send-button-sending:hover {
            transform: translateY(0);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        /* Envelope Flying Animation */
        .envelope-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            z-index: 10001;
            animation: envelope-fly-center 1.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        /* Envelope blur overlay */
        .envelope-blur-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(12px);
            z-index: 10000;
            animation: envelope-blur-fade 1.8s ease forwards;
        }

        @keyframes envelope-blur-fade {
            0% {
                opacity: 0;
                backdrop-filter: blur(0px);
            }
            20% {
                opacity: 1;
                backdrop-filter: blur(12px);
            }
            80% {
                opacity: 1;
                backdrop-filter: blur(12px);
            }
            100% {
                opacity: 0;
                backdrop-filter: blur(0px);
            }
        }

        @keyframes envelope-fly-center {
            0% {
                transform: translate(-50%, -50%) scale(0.5) rotate(0deg);
                opacity: 0;
            }
            20% {
                transform: translate(-50%, -50%) scale(1.3) rotate(0deg);
                opacity: 1;
            }
            40% {
                transform: translate(-50%, -50%) scale(1.1) rotate(-5deg);
                opacity: 1;
            }
            60% {
                transform: translate(-50%, -50%) scale(1.2) rotate(5deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -180%) scale(0.2) rotate(25deg);
                opacity: 0;
            }
        }

        /* Priority Fade Glow */
        .priority-fade-glow {
            animation: priority-glow-fade 2s ease-out forwards;
        }

        @keyframes priority-glow-fade {
            0% {
                box-shadow: 0 0 0 rgba(99, 102, 241, 0.6);
            }
            50% {
                box-shadow: 0 0 40px rgba(99, 102, 241, 0.8), 0 0 80px rgba(139, 92, 246, 0.6);
            }
            100% {
                box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            }
        }

        /* Enhanced Email Container */
.modern-email-item {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(249, 250, 251, 0.95) 100%);
    border: 2px solid rgba(255, 255, 255, 0.9);
    border-radius: 20px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(99, 102, 241, 0.08),
                0 1px 3px rgba(0, 0, 0, 0.05);
    backdrop-filter: blur(10px);
}

.modern-email-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);
    transition: left 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.modern-email-item:hover::before {
    left: 100%;
}

.modern-email-item:hover {
    transform: translateY(-4px) scale(1.01);
    box-shadow: 0 12px 32px rgba(99, 102, 241, 0.18),
                0 4px 12px rgba(99, 102, 241, 0.12),
                inset 0 1px 0 rgba(255, 255, 255, 1);
    border-color: rgba(99, 102, 241, 0.4);
}

body.dark-mode .modern-email-item {
    background: linear-gradient(135deg, rgba(40, 40, 45, 0.98) 0%, rgba(30, 30, 35, 0.95) 100%);
    border-color: rgba(99, 102, 241, 0.3);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3),
                0 1px 3px rgba(0, 0, 0, 0.2);
}

body.dark-mode .modern-email-item:hover {
    box-shadow: 0 12px 32px rgba(99, 102, 241, 0.3),
                0 4px 12px rgba(99, 102, 241, 0.2);
    border-color: rgba(99, 102, 241, 0.6);
}

/* Ladder Animation */
.modern-email-item {
    animation: emailLadderAppear 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) backwards;
}

.modern-email-item:nth-child(1) { animation-delay: 0s; }
.modern-email-item:nth-child(2) { animation-delay: 0.08s; }
.modern-email-item:nth-child(3) { animation-delay: 0.16s; }
.modern-email-item:nth-child(4) { animation-delay: 0.24s; }
.modern-email-item:nth-child(5) { animation-delay: 0.32s; }
.modern-email-item:nth-child(n+6) { animation-delay: 0.4s; }

@keyframes emailLadderAppear {
    0% {
        opacity: 0;
        transform: translateX(-40px) translateY(20px) scale(0.9);
        filter: blur(8px);
    }
    60% {
        transform: translateX(5px) translateY(-5px) scale(1.02);
    }
    100% {
        opacity: 1;
        transform: translateX(0) translateY(0) scale(1);
        filter: blur(0);
    }
}

        /* Priority Preview Containers */
        .priority-preview-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 16px;
        }

        .priority-preview-card {
            padding: 16px;
            border-radius: 16px;
            border: 2px solid white;
            transition: all 0.3s;
            position: relative;
            cursor: pointer;
        }

        .priority-preview-card::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: inherit;
            padding: 2px;
            background: linear-gradient(90deg,
                white,
                rgba(255, 255, 255, 0.3),
                rgba(255, 255, 255, 0.1),
                rgba(255, 255, 255, 0.3),
                white
            );
            background-size: 200% 100%;
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .priority-preview-card:hover::before {
            opacity: 1;
            animation: outline-sweep 0.6s ease-in-out;
        }

        .priority-preview-off {
            background: rgba(200, 200, 200, 0.1);
            border-color: rgba(150, 150, 150, 0.3);
        }

        .priority-preview-on {
            background: rgba(99, 102, 241, 0.05);
            border-color: rgba(99, 102, 241, 0.3);
        }

        .priority-mode-active {
            border-width: 3px;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.3);
            transform: scale(1.02);
        }

        .priority-mode-inactive {
            opacity: 0.7;
        }

        .priority-mode-inactive:hover {
            opacity: 1;
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .mode-checkmark {
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            animation: checkmark-appear 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes checkmark-appear {
            from {
                opacity: 0;
                transform: scale(0.5) rotate(-10deg);
            }
            to {
                opacity: 1;
                transform: scale(1) rotate(0);
            }
        }

        body.dark-mode .priority-preview-off {
            background: rgba(60, 60, 60, 0.3);
            border-color: rgba(120, 120, 120, 0.4);
        }

        body.dark-mode .priority-preview-on {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.5);
        }

        .preview-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            padding: 4px 10px;
            border-radius: 8px;
            display: inline-block;
        }

        .preview-label-off {
            background: rgba(150, 150, 150, 0.2);
            color: #666;
        }

        .preview-label-on {
            background: rgba(99, 102, 241, 0.2);
            color: #6366f1;
        }

        body.dark-mode .preview-label-off {
            background: rgba(120, 120, 120, 0.3);
            color: #aaa;
        }

        body.dark-mode .preview-label-on {
            background: rgba(99, 102, 241, 0.3);
            color: #a5b4fc;
        }

        /* New Email Indicator */
        .new-email-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            font-size: 11px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 20px;
            text-align: center;
            animation: badge-pulse 1.5s ease-in-out infinite;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.5);
        }

        @keyframes badge-pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 2px 8px rgba(239, 68, 68, 0.5);
            }
            50% {
                transform: scale(1.1);
                box-shadow: 0 4px 12px rgba(239, 68, 68, 0.7);
            }
        }

        /* Unread Email Label */
        .unread-label {
            position: absolute;
            top: 12px;
            right: 16px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            font-size: 11px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 12px;
            animation: unread-appear 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 5;
        }

        @keyframes unread-appear {
            from {
                opacity: 0;
                transform: scale(0.5) translateY(-10px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .unread-email {
            border-left: 4px solid #ef4444;
        }

        /* Inbox Button Expansion Animation */
        .inbox-button-expanded {
            min-width: 180px !important;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important;
            border-color: #ef4444 !important;
            animation: inbox-expand-glow 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
        }

        /* Welcome Text Animation */
        .welcome-text-container {
            text-align: center;
            margin-bottom: 2rem;
            margin-top: 1rem;
            opacity: 1;
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .welcome-text-container.fade-out {
            opacity: 0;
            transform: translateY(-10px);
            pointer-events: none;
        }

        .welcome-text {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #4f46e5, #9333ea, #db2777);
            background-size: 200% 200%;
            animation: gradient-shift 3s ease infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: #4f46e5; /* Fallback color for browsers without gradient support */
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 0.4rem;
        }

        body.dark-mode .welcome-text {
            background: linear-gradient(135deg, #a5b4fc, #d8b4fe, #fbcfe8);
            background-size: 200% 200%;
            animation: gradient-shift 3s ease infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: #a5b4fc; /* Fallback color */
        }

        @keyframes gradient-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .welcome-text span {
            display: inline-block;
            animation: typing-fade 0.5s ease forwards;
            opacity: 0;
            transform: translateY(10px);
        }

        @keyframes typing-fade {
            0% {
                opacity: 0;
                transform: translateY(10px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Typing cursor effect */
        .typing-cursor {
            display: inline-block;
            width: 3px;
            height: 1.8rem;
            background: linear-gradient(135deg, #4f46e5, #9333ea);
            margin-left: 4px;
            animation: blink 0.8s infinite;
        }

        body.dark-mode .typing-cursor {
            background: linear-gradient(135deg, #a5b4fc, #d8b4fe);
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        @keyframes inbox-expand-glow {
            0% {
                min-width: 100px;
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
            50% {
                box-shadow: 0 0 30px 10px rgba(239, 68, 68, 0.6);
            }
            100% {
                min-width: 180px;
                box-shadow: 0 0 20px 5px rgba(239, 68, 68, 0.4);
            }
        }

        .inbox-text-transition {
            display: inline-block;
            animation: text-fade-switch 3s ease-in-out forwards;
        }

        @keyframes text-fade-switch {
            0%, 100% {
                opacity: 1;
            }
            45%, 55% {
                opacity: 0;
            }
        }

        /* Email List Ladder Animation */
        .email-ladder-animation {
            animation: ladder-slide-in 0.4s ease-out backwards;
        }

        @keyframes ladder-slide-in {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* New Sidebar Layout */
        .desktop-inbox-layout {
            display: flex;
            gap: 20px;
            height: calc(100vh - 80px);
            position: relative;
            margin-left: -120px;
            align-items: center;
        }

        .inbox-sidebar {
            width: 480px;
            height: calc(100vh - 120px);
            flex-shrink: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.9) 0%,
                rgba(249, 250, 251, 0.85) 100%
            );
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.12),
                        0 2px 8px rgba(99, 102, 241, 0.08),
                        inset 0 1px 0 rgba(255, 255, 255, 0.8);
            border-radius: 24px;
            padding: 20px;
            opacity: 1;
            transform: translateX(0);
            transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1),
                        transform 0.5s cubic-bezier(0.4, 0, 0.2, 1),
                        width 0.5s cubic-bezier(0.4, 0, 0.2, 1),
                        min-width 0.5s cubic-bezier(0.4, 0, 0.2, 1),
                        padding 0.5s cubic-bezier(0.4, 0, 0.2, 1),
                        margin 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body.dark-mode .inbox-sidebar {
            background: rgba(20, 20, 20, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .inbox-scroll-area {
            flex: 1;
            overflow-y: auto;
            margin: 0 -10px;
            padding: 0 10px;
            mask-image: linear-gradient(to bottom, black calc(100% - 60px), transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black calc(100% - 60px), transparent 100%);
        }

        .inbox-scroll-area::-webkit-scrollbar {
            width: 8px;
        }

        .inbox-scroll-area::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }

        .inbox-scroll-area::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.3);
            border-radius: 10px;
        }

        .inbox-scroll-area::-webkit-scrollbar-thumb:hover {
            background: rgba(99, 102, 241, 0.5);
        }

        .email-content-area {
            flex: 1;
            overflow-y: auto;
            background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.9) 0%,
                rgba(249, 250, 251, 0.85) 100%
            );
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.12),
                        0 2px 8px rgba(99, 102, 241, 0.08),
                        inset 0 1px 0 rgba(255, 255, 255, 0.8);
            border-radius: 24px;
            padding: 24px;
            opacity: 1;
            transform: translateX(0);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            scroll-behavior: smooth;
        }

        body.dark-mode .email-content-area {
            background: linear-gradient(135deg,
                rgba(10, 10, 10, 0.95) 0%,
                rgba(20, 20, 20, 0.9) 100%
            );
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5),
                        0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .email-content-area.viewing-email {
            opacity: 1;
            transform: translateX(0);
        }

        .email-content-area::-webkit-scrollbar {
            width: 8px;
        }

        .email-content-area::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }

        .email-content-area::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.3);
            border-radius: 10px;
        }

        .email-content-area::-webkit-scrollbar-thumb:hover {
            background: rgba(99, 102, 241, 0.5);
        }

        .email-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            color: #9ca3af;
        }

        .email-placeholder-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .email-placeholder-text {
            font-size: 18px;
            font-weight: 500;
        }

        /* Compact email item for sidebar */
        .sidebar-email-item {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            border-radius: 16px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        body.dark-mode .sidebar-email-item {
            background: rgba(30, 30, 30, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-email-item:hover {
            background: rgba(99, 102, 241, 0.1);
            transform: translateX(5px);
        }

        .sidebar-email-item.active {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.4);
        }

        body.dark-mode .sidebar-email-item.active {
            background: rgba(99, 102, 241, 0.2);
            border-color: rgba(99, 102, 241, 0.5);
        }

        /* Mobile: Stack layout */
        @media (max-width: 1024px) {
            .desktop-inbox-layout {
                flex-direction: column;
                height: auto;
            }

            .inbox-sidebar {
                width: 100%;
                max-height: 50vh;
            }

            .email-content-area {
                width: 100%;
                min-height: 50vh;
            }

            .email-content-area.active {
                transform: translateY(0);
            }
        }

        /* Email viewer header in sidebar layout */
        .email-viewer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 16px;
            padding-top: 0;
            border-bottom: 2px solid rgba(99, 102, 241, 0.2);
            margin-bottom: 20px;
            position: sticky;
            top: -24px;
            background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.95) 0%,
                rgba(249, 250, 251, 0.9) 100%
            );
            backdrop-filter: blur(20px);
            z-index: 10;
            margin-left: -24px;
            margin-right: -24px;
            margin-top: -24px;
            padding-left: 24px;
            padding-right: 24px;
            padding-top: 24px;
        }

        body.dark-mode .email-viewer-header {
            background: linear-gradient(135deg,
                rgba(10, 10, 10, 0.95) 0%,
                rgba(20, 20, 20, 0.9) 100%
            );
            border-bottom: 2px solid rgba(99, 102, 241, 0.3);
        }

        .email-action-buttons {
            display: flex;
            gap: 8px;
        }

        /* iOS-style Priority Email Stacking */
        .priority-stack-container {
            margin-bottom: 16px;
            position: relative;
        }

        .priority-stack {
            position: relative;
            cursor: pointer;
        }

        .priority-stack-item {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 16px;
            padding: 12px;
            position: absolute;
            width: 100%;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .priority-stack-item:nth-child(1) {
            position: relative;
            z-index: 3;
            top: 0;
        }

        .priority-stack-item:nth-child(2) {
            z-index: 2;
            top: 4px;
            transform: scale(0.98);
            opacity: 0.7;
        }

        .priority-stack-item:nth-child(3) {
            z-index: 1;
            top: 8px;
            transform: scale(0.96);
            opacity: 0.5;
        }

        .priority-stack.expanded .priority-stack-item {
            position: relative;
            top: 0 !important;
            transform: scale(1) !important;
            opacity: 1 !important;
            margin-bottom: 8px;
        }

        /* Provider Tabs at Bottom */
        .provider-tabs-container {
            margin-top: auto;
            padding-top: 16px;
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .provider-tab {
            flex: 1;
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.5);
            border: 2px solid rgba(99, 102, 241, 0.2);
        }

        .provider-tab.active {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.4);
        }

        .provider-tab:hover {
            background: rgba(99, 102, 241, 0.1);
        }

        /* Hide provider tabs on mobile */
        @media (max-width: 1024px) {
            .provider-tabs-container {
                display: none;
            }
        }

        /* Inbox View Toggle (Received/Sent) */
        .inbox-view-toggle-container {
            margin-top: auto;
            padding-top: 16px;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .inbox-view-toggle {
            flex: 1;
            display: flex;
            gap: 6px;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(99, 102, 241, 0.2);
            border-radius: 50px;
            padding: 4px;
            transition: all 0.3s ease;
        }

        body.dark-mode .inbox-view-toggle {
            background: rgba(30, 30, 30, 0.6);
            border-color: rgba(99, 102, 241, 0.4);
        }

        .inbox-view-toggle-btn {
            flex: 1;
            padding: 8px 12px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: transparent;
            border: none;
            color: #6b7280;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 0;
        }

        .inbox-view-toggle-btn.active {
            background: rgba(99, 102, 241, 0.15);
            color: #4f46e5;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.2);
        }

        body.dark-mode .inbox-view-toggle-btn.active {
            background: rgba(99, 102, 241, 0.25);
            color: #818cf8;
        }

        .inbox-back-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(99, 102, 241, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
            flex-shrink: 0;
        }

        body.dark-mode .inbox-back-btn {
            background: rgba(30, 30, 30, 0.8);
            border-color: rgba(99, 102, 241, 0.5);
        }

        .inbox-back-btn:hover {
            transform: scale(1.05);
            border-color: rgba(99, 102, 241, 0.5);
        }

        /* Inbox Search Bar */
        .inbox-search-bar {
            width: 100%;
            padding: 10px 16px;
            border-radius: 50px;
            border: 2px solid rgba(99, 102, 241, 0.3);
            background: rgba(255, 255, 255, 0.7);
            font-size: 13px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 12px;
            color: #374151;
        }

        body.dark-mode .inbox-search-bar {
            background: rgba(40, 40, 40, 0.7);
            border-color: rgba(99, 102, 241, 0.5);
            color: #e5e5e5;
        }

        body.dark-mode .inbox-search-bar::placeholder {
            color: #9ca3af;
        }

        .inbox-search-bar:focus {
            outline: none;
            border-color: rgba(99, 102, 241, 0.5);
            background: rgba(255, 255, 255, 0.9);
            transform: scale(1.02);
        }

        body.dark-mode .inbox-search-bar:focus {
            background: rgba(50, 50, 50, 0.9);
            border-color: rgba(99, 102, 241, 0.7);
        }

        /* Smooth expand animation for search container */
        .inbox-search-container {
    position: relative;
    margin-bottom: 12px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 150; /* Added z-index */
}

.inbox-search-container.expanded {
    transform: scale(1.02);
    z-index: 200; /* Higher when expanded */
}

        .inbox-search-suggestions {
    position: absolute;
    left: 0;
    right: 0;
    top: 100%;
    margin-top: 8px;
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(30px);
    -webkit-backdrop-filter: blur(30px);
    border: 2px solid white;
    border-radius: 16px;
    max-height: 0;
    overflow: hidden;
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.25), 
                0 0 0 1px rgba(255, 255, 255, 0.8) inset,
                0 20px 60px rgba(99, 102, 241, 0.3);
    z-index: 200; /* Increased from 10 */
    transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease, transform 0.3s ease;
    opacity: 0;
    transform: translateY(-10px);
    /* Hide scrollbar but keep functionality */
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
}

.inbox-search-suggestions.show {
    max-height: 300px;
    overflow-y: auto;
    opacity: 1;
    transform: translateY(0);
}

.inbox-search-suggestions::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
}

body.dark-mode .inbox-search-suggestions {
    background: rgba(20, 20, 20, 0.98);
    border: 2px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.6), 
                0 0 0 1px rgba(99, 102, 241, 0.3) inset,
                0 20px 60px rgba(0, 0, 0, 0.8);
}

        .inbox-search-suggestion-item {
    padding: 12px 16px;
    cursor: pointer;
    transition: all 0.2s ease;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    background: rgba(255, 255, 255, 0.95);
    position: relative;
    z-index: 1;
}

.inbox-search-suggestion-item:last-child {
    border-bottom: none;
}

.inbox-search-suggestion-item:hover {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.1) 100%);
    padding-left: 20px;
    box-shadow: inset 4px 0 0 rgba(99, 102, 241, 0.6);
}

body.dark-mode .inbox-search-suggestion-item {
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(30, 30, 30, 0.95);
}

body.dark-mode .inbox-search-suggestion-item:hover {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.15) 100%);
    box-shadow: inset 4px 0 0 rgba(99, 102, 241, 0.8);
}

        /* Mobile optimizations for search suggestions */
        @media (max-width: 1024px) {
            .inbox-search-suggestions {
                left: 12px;
                right: 12px;
                max-height: 40vh;
                border-radius: 12px;
                font-size: 14px;
            }

            .inbox-search-suggestion-item {
                padding: 12px 14px;
            }
        }

        /* Blur inbox content when search suggestions are shown */
        .inbox-content-blur {
    filter: blur(8px);
    transition: filter 0.3s ease;
    pointer-events: none;
    position: relative;
    z-index: 1; /* Lower than suggestions */
}

.inbox-content-normal {
    filter: blur(0);
    transition: filter 0.3s ease;
    position: relative;
    z-index: 1;
}

        /* Delete Button on Hover */
        .email-delete-btn {
            position: absolute;
            right: 8px;
            top: 8px;
            padding: 4px 10px;
            border-radius: 50px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            font-size: 10px;
            font-weight: 600;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .sidebar-email-item:hover .email-delete-btn {
            opacity: 1;
            pointer-events: all;
        }

        .email-delete-btn:hover {
            background: rgba(220, 38, 38, 1);
            transform: scale(1.05);
        }

        /* Email Deleting Animation */
        .email-deleting {
            animation: slideOutLeft 0.4s cubic-bezier(0.4, 0, 1, 1) forwards;
        }

        @keyframes slideOutLeft {
            0% {
                transform: translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateX(-120%);
                opacity: 0;
            }
        }

        /* Drag and Drop Styles */
        .dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .drag-over {
            border: 2px dashed rgba(99, 102, 241, 0.5) !important;
            background: rgba(99, 102, 241, 0.05) !important;
        }

        .email-content-area.drop-zone {
            position: relative;
        }

        .email-content-area.drop-zone::after {
            content: ' Drop email here to use with AI Writer';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            font-weight: 600;
            color: rgba(99, 102, 241, 0.7);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .email-content-area.drag-over::after {
            opacity: 1;
        }

        /* Inbox Header Layout */
        .inbox-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .inbox-header-left {
            flex: 1;
        }

        .inbox-header-right {
            display: flex;
            gap: 8px;
        }

        /* Priority Stack Positioning Fix */
        .priority-stack-container {
            margin-top: 12px;
            margin-bottom: 16px;
        }

        body.dark-mode .priority-stack-item {
            background: rgba(40, 40, 40, 0.95);
            border: 1px solid rgba(99, 102, 241, 0.4);
        }

        /* Email File Attachment Display */
        .email-file-attachment {
            background: rgba(99, 102, 241, 0.1);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        body.dark-mode .email-file-attachment {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.5);
        }

        .email-file-attachment:hover {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.5);
            transform: translateY(-2px);
        }

        .email-file-icon {
            font-size: 32px;
        }

        .email-file-info {
            flex: 1;
        }

        .email-file-title {
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
        }

        body.dark-mode .email-file-title {
            color: #e5e5e5;
        }

        .email-file-subtitle {
            font-size: 13px;
            color: #6b7280;
        }

        body.dark-mode .email-file-subtitle {
            color: #9ca3af;
        }

        /* Bottom Notification */
        .bottom-notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(99, 102, 241, 0.95);
            color: white;
            padding: 16px 32px;
            border-radius: 50px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            animation: slideUpNotification 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        @keyframes slideUpNotification {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(100px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* Outlook Slide Transition */
        .outlook-slide-enter {
            animation: slideInFromRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .gmail-slide-enter {
            animation: slideInFromLeft 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideInFromRight {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInFromLeft {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .outlook-coming-soon {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            color: #9ca3af;
        }

        .outlook-coming-soon-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .outlook-coming-soon-text {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        body.dark-mode .outlook-coming-soon-text {
            color: #e5e5e5;
        }

        .outlook-coming-soon-subtitle {
            font-size: 16px;
            color: #6b7280;
        }

        body.dark-mode .outlook-coming-soon-subtitle {
            color: #9ca3af;
        }

        /* Wave animation for summary text */
        @keyframes fadeInWord {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Prioritized Emails Section */
        .prioritized-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        body.dark-mode .prioritized-section-header {
            background: rgba(99, 102, 241, 0.2);
        }

        .prioritized-section-header:hover {
            background: rgba(99, 102, 241, 0.15);
        }

        body.dark-mode .prioritized-section-header:hover {
            background: rgba(99, 102, 241, 0.25);
        }

        .prioritized-section-title {
            font-weight: 700;
            font-size: 14px;
            color: #4f46e5;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        body.dark-mode .prioritized-section-title {
            color: #818cf8;
        }

        .prioritized-collapse-icon {
            transition: transform 0.3s ease;
        }

        .prioritized-collapse-icon.collapsed {
            transform: rotate(-90deg);
        }

        /* Mobile Swipe Inbox */
        .mobile-inbox-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .mobile-inbox-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .mobile-inbox-drawer {
            position: fixed;
            top: 0;
            left: 0;
            width: 85%;
            max-width: 400px;
            height: 100%;
            background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.95) 0%,
                rgba(249, 250, 251, 0.9) 100%
            );
            backdrop-filter: blur(30px);
            z-index: 1000;
            transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            box-shadow: 4px 0 24px rgba(0, 0, 0, 0.15);
        }

        body.dark-mode .mobile-inbox-drawer {
            background: rgba(20, 20, 20, 0.95);
        }

        .mobile-inbox-drawer.active {
            transform: translateX(0);
        }

        .mobile-inbox-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .mobile-inbox-header {
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }

        .mobile-close-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s ease;
        }

        .mobile-close-btn:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        /* Replace the hamburger-btn styles with this */
.mobile-inbox-button {
    position: fixed;
    top: 60px;
    right: 24px;
    padding: 12px 24px;
    border-radius: 50px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
    backdrop-filter: blur(20px);
    border: 2px solid rgba(99, 102, 241, 0.3);
    display: none;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    z-index: 998;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 16px rgba(99, 102, 241, 0.2);
    font-weight: 600;
    font-size: 14px;
    color: #374151;
}

body.dark-mode .mobile-inbox-button {
    background: linear-gradient(135deg, rgba(40, 40, 40, 0.95), rgba(30, 30, 30, 0.85));
    border-color: rgba(99, 102, 241, 0.5);
    color: #e5e5e5;
}

.mobile-inbox-button:hover {
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 6px 20px rgba(99, 102, 241, 0.3);
    border-color: rgba(99, 102, 241, 0.5);
}

.mobile-inbox-button.has-new {
    animation: inbox-pulse 2s ease-in-out infinite;
}

@keyframes inbox-pulse {
    0%, 100% {
        box-shadow: 0 4px 16px rgba(99, 102, 241, 0.2);
    }
    50% {
        box-shadow: 0 6px 24px rgba(99, 102, 241, 0.4), 0 0 30px rgba(99, 102, 241, 0.3);
    }
}

.mobile-inbox-fullscreen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg,
        rgba(255, 255, 255, 0.98) 0%,
        rgba(249, 250, 251, 0.95) 100%
    );
    backdrop-filter: blur(30px);
    z-index: 1000;
    transform: translateY(100%);
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

body.dark-mode .mobile-inbox-fullscreen {
    background: linear-gradient(135deg,
        rgba(20, 20, 20, 0.98) 0%,
        rgba(30, 30, 30, 0.95) 100%
    );
}

.mobile-inbox-fullscreen.active {
    transform: translateY(0);
}

/* Better mobile inbox header */
.mobile-inbox-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 24px 20px;
    border-bottom: 2px solid rgba(99, 102, 241, 0.2);
}

/* Center provider tabs on mobile */
@media (max-width: 768px) {
    .provider-tabs-container {
        display: flex;
        justify-content: center;
        gap: 8px;
        padding: 4px;
    }

    .provider-tab {
        flex: 1;
        max-width: 150px;
        text-align: center;
    }

    .inbox-view-toggle {
        width: 100%;
    }

    .inbox-back-btn-tab {
        flex-shrink: 0;
    }

    /* Center email items */
    .modern-email-item {
        margin: 0 auto 12px;
        max-width: 100%;
    }

    /* Better spacing for email content */
    .mobile-inbox-fullscreen > div:last-child {
        padding: 0 16px;
    }
}

/* Mobile Email Viewer Fullscreen */
.mobile-email-viewer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(249, 250, 251, 0.95) 100%);
    backdrop-filter: blur(30px);
    z-index: 1100;
    transform: translateY(100%);
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    overflow-y: auto;
    display: flex;
    flex-direction: column;
}

body.dark-mode .mobile-email-viewer {
    background: linear-gradient(135deg, rgba(20, 20, 25, 0.98) 0%, rgba(15, 15, 20, 0.95) 100%);
}

.mobile-email-viewer.active {
    transform: translateY(0);
}

.mobile-email-header {
    position: sticky;
    top: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(249, 250, 251, 0.9) 100%);
    backdrop-filter: blur(20px);
    z-index: 10;
    padding: 16px 20px;
    border-bottom: 2px solid rgba(99, 102, 241, 0.2);
    display: flex;
    flex-direction: column;
    gap: 12px;
}

body.dark-mode .mobile-email-header {
    background: linear-gradient(135deg, rgba(20, 20, 25, 0.95) 0%, rgba(15, 15, 20, 0.9) 100%);
}

.mobile-email-close-bar {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 8px 0;
    cursor: pointer;
}

.mobile-email-close-indicator {
    width: 40px;
    height: 4px;
    background: rgba(99, 102, 241, 0.3);
    border-radius: 2px;
}

.mobile-email-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
}

.mobile-email-content {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
}

.mobile-email-subject {
    font-size: 20px;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 12px;
    line-height: 1.3;
}

body.dark-mode .mobile-email-subject {
    color: #e5e5e5;
}

.mobile-email-from {
    font-size: 14px;
    font-weight: 600;
    color: #4b5563;
    margin-bottom: 4px;
}

body.dark-mode .mobile-email-from {
    color: #9ca3af;
}

.mobile-email-date {
    font-size: 12px;
    color: #6b7280;
    margin-bottom: 20px;
}

body.dark-mode .mobile-email-date {
    color: #6b7280;
}

.mobile-email-body {
    font-size: 15px;
    line-height: 1.6;
    color: #374151;
    margin-bottom: 24px;
}

body.dark-mode .mobile-email-body {
    color: #d1d5db;
}

.mobile-email-section {
    margin-top: 24px;
    padding-top: 24px;
    border-top: 2px solid rgba(99, 102, 241, 0.1);
}

.mobile-email-section-title {
    font-size: 16px;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
}

body.dark-mode .mobile-email-section-title {
    color: #e5e5e5;
}

.mobile-ai-draft-container {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.08) 0%, rgba(139, 92, 246, 0.05) 100%);
    border: 2px solid rgba(99, 102, 241, 0.2);
    border-radius: 16px;
    padding: 16px;
    margin-top: 12px;
}

body.dark-mode .mobile-ai-draft-container {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.1) 100%);
}

.mobile-reply-textarea {
    width: 100%;
    min-height: 150px;
    padding: 12px;
    border: 2px solid rgba(99, 102, 241, 0.3);
    border-radius: 12px;
    font-size: 14px;
    resize: vertical;
    background: rgba(255, 255, 255, 0.9);
    color: #1f2937;
}

body.dark-mode .mobile-reply-textarea {
    background: rgba(30, 30, 35, 0.9);
    color: #e5e5e5;
    border-color: rgba(99, 102, 241, 0.4);
}

.mobile-quick-replies {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin: 12px 0;
}

.mobile-quick-reply-btn {
    padding: 8px 16px;
    background: rgba(99, 102, 241, 0.1);
    border: 2px solid rgba(99, 102, 241, 0.3);
    border-radius: 20px;
    color: #6366f1;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.mobile-quick-reply-btn:active {
    transform: scale(0.95);
    background: rgba(99, 102, 241, 0.2);
}

        @media (max-width: 1024px) {
    .desktop-inbox-layout {
        display: none !important;
    }

    .mobile-inbox-button {
        display: flex !important;
    }
}

@media (min-width: 1025px) {
    .mobile-inbox-button {
        display: none !important;
    }

    .mobile-inbox-fullscreen {
        display: none !important;
    }
}

.mobile-inbox-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 2px solid rgba(99, 102, 241, 0.2);
}

.mobile-close-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
    border: 2px solid rgba(239, 68, 68, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 20px;
    font-weight: bold;
    transition: all 0.3s ease;
}

.mobile-close-btn:hover {
    background: rgba(239, 68, 68, 0.2);
    transform: rotate(90deg) scale(1.1);
}

/* AI Generation Modal */
.ai-generation-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10001;
    animation: overlay-fade-in 0.5s ease-out;
}

@keyframes overlay-fade-in {
    0% {
        opacity: 0;
        backdrop-filter: blur(0px);
    }
    100% {
        opacity: 1;
        backdrop-filter: blur(16px);
    }
}

.ai-generation-container {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(249, 250, 251, 0.95) 100%);
    backdrop-filter: blur(30px);
    border: 2px solid rgba(255, 255, 255, 0.8);
    border-radius: 32px;
    padding: 48px 56px;
    max-width: 900px;
    width: 94%;
    max-height: 90vh;
    min-height: 500px;
    overflow-y: auto;
    overflow-x: hidden;
    box-shadow: 0 40px 120px rgba(99, 102, 241, 0.35), 0 0 0 1px rgba(255, 255, 255, 0.8) inset;
    animation: generation-container-lift 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.ai-generation-container::-webkit-scrollbar {
    display: none;
}

body.dark-mode .ai-generation-container {
    background: linear-gradient(135deg, rgba(30, 30, 35, 0.98) 0%, rgba(20, 20, 25, 0.95) 100%);
    border-color: rgba(99, 102, 241, 0.3);
}

@keyframes generation-container-lift {
    0% {
        opacity: 0;
        transform: scale(0.85) translateY(150px);
        box-shadow: 0 5px 20px rgba(99, 102, 241, 0.1);
        filter: blur(8px);
    }
    40% {
        opacity: 0.9;
        transform: scale(0.95) translateY(0);
        box-shadow: 0 15px 50px rgba(99, 102, 241, 0.2);
        filter: blur(2px);
    }
    70% {
        opacity: 1;
        transform: scale(1.02) translateY(-10px);
        box-shadow: 0 25px 80px rgba(99, 102, 241, 0.25);
        filter: blur(0);
    }
    100% {
        opacity: 1;
        transform: scale(1) translateY(0);
        box-shadow: 0 30px 100px rgba(99, 102, 241, 0.3);
        filter: blur(0);
    }
}

/* Close button in top right */
.ai-generation-close-btn {
    position: absolute;
    top: 16px;
    right: 16px;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: rgba(239, 68, 68, 0.1);
    border: 2px solid rgba(239, 68, 68, 0.3);
    color: #ef4444;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    z-index: 10;
}

.ai-generation-close-btn:hover {
    background: rgba(239, 68, 68, 0.2);
    transform: rotate(90deg) scale(1.1);
}

/* Grammar Button */
.grammar-button-container {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
    animation: grammar-btn-appear 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) 0.3s backwards;
}

@keyframes grammar-btn-appear {
    0% {
        opacity: 0;
        transform: translateY(-20px) scale(0.8);
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.grammar-check-btn {
    padding: 12px 28px;
    border-radius: 50px;
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%);
    border: 2px solid rgba(34, 197, 94, 0.3);
    color: #22c55e;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 8px;
}

.grammar-check-btn:hover {
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(16, 185, 129, 0.2) 100%);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(34, 197, 94, 0.25);
}

.grammar-check-btn.checking {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
    border-color: rgba(99, 102, 241, 0.3);
    color: #6366f1;
}

body.dark-mode .grammar-check-btn {
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(16, 185, 129, 0.15) 100%);
    color: #4ade80;
}

/* Wave Animation for Grammar Check - Word by Word */
.grammar-wave-container {
    position: relative;
    overflow: hidden;
}

.grammar-wave-word {
    display: inline-block;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
}

.grammar-wave-word.wave-active {
    color: #6366f1;
    text-shadow: 0 0 15px rgba(99, 102, 241, 0.6);
    transform: translateY(-3px) scale(1.02);
    filter: brightness(1.1);
}

.grammar-wave-line {
    display: block;
    transition: all 0.2s ease-out;
}

.grammar-wave-line.wave-active {
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(99, 102, 241, 0.1) 20%,
        rgba(139, 92, 246, 0.15) 50%,
        rgba(99, 102, 241, 0.1) 80%,
        transparent 100%
    );
    border-radius: 4px;
}

@keyframes wave-sweep {
    0% {
        background-position: -200% 0;
    }
    100% {
        background-position: 200% 0;
    }
}

.grammar-checking-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    border-radius: 16px;
    background: transparent;
}

@keyframes wave-vertical {
    0%, 100% {
        background-position: 0% 0%;
    }
    50% {
        background-position: 0% 100%;
    }
}

/* Word-by-word wave animation */
.ai-wave-text .grammar-word {
    display: inline-block;
    opacity: 1;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
}

.ai-wave-text .grammar-word.wave-highlight {
    color: #6366f1;
    text-shadow: 0 0 20px rgba(99, 102, 241, 0.7), 0 0 40px rgba(139, 92, 246, 0.4);
    transform: translateY(-2px);
    animation: word-pulse 0.4s ease-out;
}

@keyframes word-pulse {
    0% {
        transform: translateY(0) scale(1);
    }
    50% {
        transform: translateY(-4px) scale(1.05);
    }
    100% {
        transform: translateY(-2px) scale(1);
    }
}

/* Apple Intelligence style wave */
.ai-wave-text {
    position: relative;
}

@keyframes apple-wave {
    0% {
        background-position: 100% 0;
    }
    100% {
        background-position: -100% 0;
    }
}

/* Word-by-word wave animation for grammar check */
@keyframes word-wave {
    0%, 100% {
        color: inherit;
        transform: translateY(0);
        text-shadow: none;
    }
    15% {
        color: #6366f1;
        transform: translateY(-3px);
        text-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
    }
    30% {
        color: inherit;
        transform: translateY(0);
        text-shadow: none;
    }
}

.grammar-word {
    display: inline;
    transition: all 0.2s ease-out;
}

/* Hide scrollbar in grammar wave container */
.grammar-wave-container::-webkit-scrollbar {
    display: none;
}

.ai-generation-prompt {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
    padding: 12px 20px;
    border-radius: 50px;
    text-align: center;
    margin-bottom: 24px;
    font-size: 14px;
    font-weight: 500;
    color: #4f46e5;
    border: 1px solid rgba(99, 102, 241, 0.2);
}

body.dark-mode .ai-generation-prompt {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
    color: #a5b4fc;
}

.ai-generation-animation {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
}

/* Status List Container - 4 Oval Items */
.ai-generation-status-list {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 14px;
    margin-bottom: 28px;
    perspective: 1000px;
    min-height: 200px;
}

.ai-generation-status-item {
    padding: 14px 32px;
    border-radius: 50px;
    font-size: 15px;
    font-weight: 500;
    transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
    white-space: nowrap;
    position: relative;
}

/* Slide-in from bottom animation for new items */
.ai-generation-status-item.entering {
    animation: status-slide-in-bottom 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards;
}

@keyframes status-slide-in-bottom {
    0% {
        opacity: 0;
        transform: translateY(40px) scale(0.8);
        filter: blur(8px);
    }
    40% {
        opacity: 0.6;
        filter: blur(4px);
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1.05);
        filter: blur(0);
    }
}

/* Smooth exit animation */
.ai-generation-status-item.exiting {
    animation: status-slide-out-top 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes status-slide-out-top {
    0% {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: blur(0);
    }
    100% {
        opacity: 0;
        transform: translateY(-30px) scale(0.9);
        filter: blur(6px);
    }
}

.ai-generation-status-item.active {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.18) 0%, rgba(139, 92, 246, 0.18) 100%);
    border: 2px solid rgba(99, 102, 241, 0.5);
    color: #6366f1;
    transform: scale(1.08) translateZ(20px);
    box-shadow: 0 12px 35px rgba(99, 102, 241, 0.3);
    z-index: 4;
    animation: status-active-pulse 2s ease-in-out infinite;
}

@keyframes status-active-pulse {
    0%, 100% {
        box-shadow: 0 12px 35px rgba(99, 102, 241, 0.3);
    }
    50% {
        box-shadow: 0 15px 45px rgba(99, 102, 241, 0.4);
    }
}

.ai-generation-status-item.behind-1 {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.08) 0%, rgba(139, 92, 246, 0.08) 100%);
    border: 1.5px solid rgba(99, 102, 241, 0.2);
    color: #9ca3af;
    transform: scale(0.92) translateY(-10px) translateZ(-10px);
    opacity: 0.7;
    z-index: 3;
}

.ai-generation-status-item.behind-2 {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.04) 0%, rgba(139, 92, 246, 0.04) 100%);
    border: 1px solid rgba(99, 102, 241, 0.1);
    color: #d1d5db;
    transform: scale(0.84) translateY(-18px) translateZ(-20px);
    opacity: 0.4;
    z-index: 2;
}

.ai-generation-status-item.behind-3 {
    background: rgba(99, 102, 241, 0.02);
    border: 1px solid rgba(99, 102, 241, 0.05);
    color: #e5e7eb;
    transform: scale(0.76) translateY(-26px) translateZ(-30px);
    opacity: 0.2;
    z-index: 1;
}

.ai-generation-status-item.hidden {
    opacity: 0;
    transform: scale(0.6) translateY(30px);
    filter: blur(10px);
}

/* Smooth transition when items shift positions */
.ai-generation-status-item.shifting-up {
    animation: status-shift-up 0.5s cubic-bezier(0.23, 1, 0.32, 1) forwards;
}

@keyframes status-shift-up {
    0% {
        transform: translateY(0);
    }
    50% {
        transform: translateY(-5px);
    }
    100% {
        transform: translateY(0);
    }
}

body.dark-mode .ai-generation-status-item.active {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.25) 0%, rgba(139, 92, 246, 0.25) 100%);
    border-color: rgba(99, 102, 241, 0.6);
    color: #a5b4fc;
}

body.dark-mode .ai-generation-status-item.behind-1 {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.12) 0%, rgba(139, 92, 246, 0.12) 100%);
    border-color: rgba(99, 102, 241, 0.3);
    color: #6b7280;
}

body.dark-mode .ai-generation-status-item.behind-2 {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.06) 0%, rgba(139, 92, 246, 0.06) 100%);
    border-color: rgba(99, 102, 241, 0.15);
    color: #4b5563;
}

body.dark-mode .ai-generation-status-item.behind-3 {
    background: rgba(99, 102, 241, 0.03);
    border-color: rgba(99, 102, 241, 0.08);
    color: #374151;
}

@keyframes status-cycle {
    0% {
        transform: scale(1.05) translateZ(20px);
        opacity: 1;
    }
    100% {
        transform: scale(0.76) translateY(-24px) translateZ(-30px);
        opacity: 0.2;
    }
}

.ai-generation-status {
    font-size: 16px;
    font-weight: 500;
    color: #6b7280;
    animation: status-fade 0.5s ease-out;
}

body.dark-mode .ai-generation-status {
    color: #9ca3af;
}

@keyframes status-fade {
    0% {
        opacity: 0;
        filter: blur(5px);
    }
    100% {
        opacity: 1;
        filter: blur(0);
    }
}

.ai-generation-result {
    animation: result-reveal 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes result-reveal {
    0% {
        opacity: 0;
        filter: blur(10px);
        transform: translateY(20px);
    }
    100% {
        opacity: 1;
        filter: blur(0);
        transform: translateY(0);
    }
}

.ai-followup-container {
    margin-top: 24px;
    padding-top: 20px;
    border-top: 1px solid rgba(99, 102, 241, 0.2);
}

.ai-suggestion-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 16px;
    position: relative;
}

.ai-suggestion-chip {
    padding: 10px 18px;
    border-radius: 50px;
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
    border: 1px solid rgba(99, 102, 241, 0.2);
    font-size: 13px;
    font-weight: 500;
    color: #4f46e5;
    cursor: pointer;
    transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    animation: chip-fade-in 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) backwards;
    position: relative;
    display: flex;
    align-items: center;
    gap: 8px;
}

.ai-suggestion-chip:nth-child(1) { animation-delay: 0.08s; }
.ai-suggestion-chip:nth-child(2) { animation-delay: 0.16s; }
.ai-suggestion-chip:nth-child(3) { animation-delay: 0.24s; }
.ai-suggestion-chip:nth-child(4) { animation-delay: 0.32s; }

@keyframes chip-fade-in {
    0% {
        opacity: 0;
        transform: translateY(15px) scale(0.9);
        filter: blur(4px);
    }
    60% {
        opacity: 1;
        transform: translateY(-3px) scale(1.02);
        filter: blur(0);
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: blur(0);
    }
}

.ai-suggestion-chip:hover {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.2);
}

body.dark-mode .ai-suggestion-chip {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
    color: #a5b4fc;
}

/* Suggestion chip removal animation */
.ai-suggestion-chip.removing {
    animation: chip-remove 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes chip-remove {
    0% {
        opacity: 1;
        transform: scale(1);
        filter: blur(0);
    }
    40% {
        opacity: 0.6;
        transform: scale(0.95) translateY(-5px);
        filter: blur(2px);
    }
    100% {
        opacity: 0;
        transform: scale(0.7) translateY(-15px);
        filter: blur(8px);
        width: 0;
        padding: 0;
        margin: 0;
    }
}

/* Suggestion chip shift animation */
.ai-suggestion-chip.shifting {
    animation: chip-shift 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes chip-shift {
    0% {
        transform: translateX(30px);
        opacity: 0.7;
    }
    50% {
        transform: translateX(-5px);
        opacity: 1;
    }
    100% {
        transform: translateX(0);
        opacity: 1;
    }
}

/* Remove suggestion button (X) on chip */
.chip-remove-btn {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: rgba(239, 68, 68, 0.2);
    border: none;
    color: #ef4444;
    font-size: 10px;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    opacity: 0;
    transform: scale(0.8);
}

.ai-suggestion-chip:hover .chip-remove-btn {
    opacity: 1;
    transform: scale(1);
}

.chip-remove-btn:hover {
    background: rgba(239, 68, 68, 0.4);
    transform: scale(1.1);
}

.ai-followup-input-container {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 16px;
    border-radius: 50px;
    background: rgba(255, 255, 255, 0.9);
    border: 2px solid rgba(99, 102, 241, 0.3);
    transition: all 0.3s ease;
}

body.dark-mode .ai-followup-input-container {
    background: rgba(40, 40, 45, 0.9);
    border-color: rgba(99, 102, 241, 0.5);
}

.ai-followup-input-container:focus-within {
    border-color: rgba(99, 102, 241, 0.6);
    box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
}

.ai-followup-input {
    flex: 1;
    border: none;
    background: transparent;
    font-size: 14px;
    outline: none;
    color: #374151;
}

body.dark-mode .ai-followup-input {
    color: #e5e5e5;
}

.ai-followup-input::placeholder {
    color: rgba(107, 114, 128, 0.6);
}

/* View Full Email Popup */
.view-email-popup-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10002;
    animation: overlay-fade-in 0.3s ease-out;
}

.view-email-popup {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(249, 250, 251, 0.95) 100%);
    backdrop-filter: blur(30px);
    border: 2px solid rgba(255, 255, 255, 0.8);
    border-radius: 24px;
    padding: 0;
    max-width: 700px;
    width: 95%;
    max-height: 85vh;
    overflow: hidden;
    box-shadow: 0 25px 80px rgba(0, 0, 0, 0.2);
    animation: popup-scale 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    display: flex;
    flex-direction: column;
}

body.dark-mode .view-email-popup {
    background: linear-gradient(135deg, rgba(30, 30, 35, 0.98) 0%, rgba(20, 20, 25, 0.95) 100%);
    border-color: rgba(99, 102, 241, 0.3);
}

.view-email-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    border-bottom: 1px solid rgba(99, 102, 241, 0.15);
    background: rgba(255, 255, 255, 0.5);
}

body.dark-mode .view-email-header {
    background: rgba(30, 30, 35, 0.5);
    border-color: rgba(99, 102, 241, 0.25);
}

.view-email-close-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: rgba(239, 68, 68, 0.1);
    border: 2px solid rgba(239, 68, 68, 0.3);
    color: #ef4444;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    transition: all 0.3s ease;
}

.view-email-close-btn:hover {
    background: rgba(239, 68, 68, 0.2);
    transform: scale(1.1);
}

.view-email-content {
    padding: 24px;
    overflow-y: auto;
    flex: 1;
}

.view-email-subject {
    font-size: 20px;
    font-weight: 700;
    color: #374151;
    margin-bottom: 16px;
}

body.dark-mode .view-email-subject {
    color: #e5e5e5;
}

.view-email-meta {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin-bottom: 20px;
    padding-bottom: 16px;
    border-bottom: 1px solid rgba(99, 102, 241, 0.1);
}

.view-email-from {
    font-size: 14px;
    font-weight: 600;
    color: #4b5563;
}

.view-email-date {
    font-size: 12px;
    color: #9ca3af;
}

body.dark-mode .view-email-from {
    color: #d1d5db;
}

.view-email-body {
    font-size: 15px;
    line-height: 1.7;
    color: #4b5563;
    white-space: pre-wrap;
    word-break: break-word;
}

body.dark-mode .view-email-body {
    color: #d1d5db;
}

.view-full-email-btn {
    margin-top: 16px;
    padding: 10px 20px;
    border-radius: 50px;
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
    border: 2px solid rgba(99, 102, 241, 0.3);
    color: #4f46e5;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.view-full-email-btn:hover {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.2);
}

body.dark-mode .view-full-email-btn {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
    color: #a5b4fc;
}

/* AI Prompt Input Improvements for Mobile */
@media (max-width: 768px) {
    .mobile-inbox-button {
        display: flex;
    }

    /* AI Writer prompt area - Unified container */
    .ai-prompt-container {
        position: relative;
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 16px;
        padding: 8px 12px;
        border-radius: 50px;
        border: 2px solid rgba(99, 102, 241, 0.3);
        background: rgba(255, 255, 255, 0.9);
        transition: all 0.3s ease;
    }

    body.dark-mode .ai-prompt-container {
        background: rgba(40, 40, 40, 0.9);
        border-color: rgba(99, 102, 241, 0.5);
    }

    .ai-prompt-container:focus-within {
        border-color: rgba(99, 102, 241, 0.5);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .ai-prompt-input {
        flex: 1;
        padding: 8px 12px;
        border: none;
        background: transparent;
        font-size: 14px;
        transition: all 0.3s ease;
        color: inherit;
    }

    body.dark-mode .ai-prompt-input {
        color: #e5e5e5;
    }

    .ai-prompt-input:focus {
        outline: none;
    }

    .ai-prompt-input::placeholder {
        color: rgba(107, 114, 128, 0.6);
    }

    body.dark-mode .ai-prompt-input::placeholder {
        color: rgba(156, 163, 175, 0.6);
    }

    .ai-send-button {
        width: 36px;
        height: 36px;
        min-width: 36px;
        border-radius: 50%;
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        color: white;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
        opacity: 0;
        transform: scale(0);
        pointer-events: none;
    }

    .ai-send-button.visible {
        opacity: 1;
        transform: scale(1);
        pointer-events: all;
        animation: button-pop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    /* Inline model switcher inside prompt container */
    .inline-model-switcher {
        position: relative;
        display: flex;
        align-items: center;
    }

    .inline-model-button {
        padding: 8px 14px;
        font-size: 12px;
        font-weight: 600;
        border-radius: 50px;
        border: 2px solid white;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(249, 250, 251, 0.9) 100%);
        color: #374151;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        white-space: nowrap;
        display: flex;
        align-items: center;
        gap: 6px;
        box-shadow: 0 2px 8px rgba(99, 102, 241, 0.15);
        position: relative;
    }

    body.dark-mode .inline-model-button {
        background: linear-gradient(135deg, rgba(40, 40, 45, 0.95) 0%, rgba(35, 35, 40, 0.9) 100%);
        color: #c7d2fe;
        border: 2px solid rgba(99, 102, 241, 0.5);
    }

    .inline-model-button:hover {
        background: linear-gradient(135deg, rgba(255, 255, 255, 1) 0%, rgba(249, 250, 251, 0.95) 100%);
        border-color: white;
        transform: translateY(-2px) scale(1.02);
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);
    }

    body.dark-mode .inline-model-button:hover {
        background: linear-gradient(135deg, rgba(50, 50, 55, 1) 0%, rgba(45, 45, 50, 0.95) 100%);
        border-color: rgba(99, 102, 241, 0.6);
    }

    .inline-model-dropdown {
        position: absolute;
        bottom: calc(100% + 4px);
        left: 0;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(249, 250, 251, 0.95) 100%);
        backdrop-filter: blur(30px);
        -webkit-backdrop-filter: blur(30px);
        border: 2px solid white;
        border-radius: 16px;
        box-shadow: 0 -16px 40px rgba(99, 102, 241, 0.3),
                    0 -4px 12px rgba(99, 102, 241, 0.15),
                    inset 0 1px 0 rgba(255, 255, 255, 0.9);
        z-index: 10000;
        overflow: hidden;
        animation: slideUpFade 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
        min-width: 280px;
        max-width: 320px;
    }

    body.dark-mode .inline-model-dropdown {
        background: linear-gradient(135deg, rgba(30, 30, 35, 0.98) 0%, rgba(25, 25, 30, 0.95) 100%);
        border: 2px solid rgba(99, 102, 241, 0.5);
        box-shadow: 0 -16px 40px rgba(0, 0, 0, 0.7),
                    0 -4px 12px rgba(0, 0, 0, 0.4),
                    inset 0 1px 0 rgba(99, 102, 241, 0.3);
    }

    @keyframes slideUpFade {
        from {
            opacity: 0;
            transform: translateY(12px) scale(0.95);
            filter: blur(4px);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
            filter: blur(0);
        }
    }

    @keyframes button-pop {
        0% {
            opacity: 0;
            transform: scale(0) rotate(-180deg);
        }
        100% {
            opacity: 1;
            transform: scale(1) rotate(0deg);
        }
    }

    .ai-send-button:active {
        transform: scale(0.9);
    }

    .ai-loading-circle {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        border: 3px solid rgba(99, 102, 241, 0.2);
        border-top-color: #6366f1;
        animation: spin 1s linear infinite;
        opacity: 0;
        transform: scale(0);
        transition: all 0.3s ease;
    }

    .ai-loading-circle.visible {
        opacity: 1;
        transform: scale(1);
    }

    /* Suggestions on left side for mobile */
    .mobile-suggestions-left {
        position: fixed;
        left: -100%;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        flex-direction: column;
        gap: 8px;
        padding: 12px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 2px solid rgba(99, 102, 241, 0.3);
        border-radius: 0 20px 20px 0;
        border-left: none;
        box-shadow: 4px 0 20px rgba(99, 102, 241, 0.2);
        transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 100;
        max-width: 200px;
    }

    body.dark-mode .mobile-suggestions-left {
        background: rgba(30, 30, 30, 0.95);
        border-color: rgba(99, 102, 241, 0.5);
    }

    .mobile-suggestions-left.visible {
        left: 0;
    }

    .mobile-suggestion-item {
        padding: 10px 16px;
        background: rgba(255, 255, 255, 0.9);
        border: 2px solid rgba(99, 102, 241, 0.2);
        border-radius: 50px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        white-space: nowrap;
        animation: slide-in-left 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) backwards;
    }

    .mobile-suggestion-item:nth-child(1) { animation-delay: 0.1s; }
    .mobile-suggestion-item:nth-child(2) { animation-delay: 0.15s; }
    .mobile-suggestion-item:nth-child(3) { animation-delay: 0.2s; }
    .mobile-suggestion-item:nth-child(4) { animation-delay: 0.25s; }
    .mobile-suggestion-item:nth-child(5) { animation-delay: 0.3s; }
    .mobile-suggestion-item:nth-child(6) { animation-delay: 0.35s; }

    @keyframes slide-in-left {
        from {
            opacity: 0;
            transform: translateX(-30px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    body.dark-mode .mobile-suggestion-item {
        background: rgba(40, 40, 40, 0.9);
        border-color: rgba(99, 102, 241, 0.4);
    }

    .mobile-suggestion-item:active {
        transform: scale(0.95);
        background: rgba(99, 102, 241, 0.2);
    }
}

        /* Version Modal Styles */
.version-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(12px);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: modal-overlay-fade 0.4s ease-out;
    padding: 20px;
}

@keyframes modal-overlay-fade {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

.version-modal-container {
    background: linear-gradient(135deg,
        rgba(255, 255, 255, 0.98) 0%,
        rgba(249, 250, 251, 0.95) 100%
    );
    backdrop-filter: blur(30px);
    border: 2px solid rgba(99, 102, 241, 0.3);
    border-radius: 32px;
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3),
                0 0 100px rgba(99, 102, 241, 0.2);
    animation: modal-slide-up 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
}

body.dark-mode .version-modal-container {
    background: linear-gradient(135deg,
        rgba(20, 20, 20, 0.98) 0%,
        rgba(30, 30, 30, 0.95) 100%
    );
    border: 2px solid rgba(99, 102, 241, 0.5);
}

@keyframes modal-slide-up {
    from {
        opacity: 0;
        transform: translateY(100px) scale(0.9);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* Header */
.version-modal-header {
    padding: 32px 32px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 2px solid rgba(99, 102, 241, 0.15);
    background: linear-gradient(135deg,
        rgba(99, 102, 241, 0.1) 0%,
        rgba(139, 92, 246, 0.05) 100%
    );
}

.version-badge {
    display: flex;
    align-items: center;
    gap: 12px;
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    color: white;
    padding: 12px 24px;
    border-radius: 50px;
    font-weight: 700;
    font-size: 18px;
    box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
    animation: badge-glow 2s ease-in-out infinite;
}

@keyframes badge-glow {
    0%, 100% {
        box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
    }
    50% {
        box-shadow: 0 6px 30px rgba(99, 102, 241, 0.6);
    }
}

.version-icon {
    font-size: 24px;
    animation: rocket-float 2s ease-in-out infinite;
}

@keyframes rocket-float {
    0%, 100% {
        transform: translateY(0) rotate(-5deg);
    }
    50% {
        transform: translateY(-5px) rotate(5deg);
    }
}

.version-number {
    font-size: 16px;
}

.version-close-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.05);
    border: none;
    color: #374151;
    font-size: 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

body.dark-mode .version-close-btn {
    background: rgba(255, 255, 255, 0.1);
    color: #e5e5e5;
}

.version-close-btn:hover {
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
    transform: rotate(90deg) scale(1.1);
}

/* Content */
.version-modal-content {
    padding: 32px;
    max-height: calc(90vh - 200px);
    overflow-y: auto;
}

.version-modal-content::-webkit-scrollbar {
    width: 8px;
}

.version-modal-content::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.05);
    border-radius: 10px;
}

.version-modal-content::-webkit-scrollbar-thumb {
    background: rgba(99, 102, 241, 0.3);
    border-radius: 10px;
}

.version-modal-title {
    font-size: 32px;
    font-weight: 800;
    margin-bottom: 32px;
    background: linear-gradient(135deg, #4f46e5, #9333ea);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

body.dark-mode .version-modal-title {
    background: linear-gradient(135deg, #a5b4fc, #d8b4fe);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

/* Sections */
.version-section {
    margin-bottom: 32px;
    animation: section-fade-in 0.6s ease-out backwards;
}

.version-section.major-update {
    animation-delay: 0.2s;
}

.version-section.minor-updates {
    animation-delay: 0.4s;
}

@keyframes section-fade-in {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.version-section-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
}

.version-section-icon {
    font-size: 24px;
}

.version-section-title {
    font-size: 20px;
    font-weight: 700;
    color: #374151;
}

body.dark-mode .version-section-title {
    color: #e5e5e5;
}

/* Major Update Item */
.version-update-item {
    display: flex;
    gap: 20px;
    padding: 24px;
    background: linear-gradient(135deg,
        rgba(99, 102, 241, 0.1) 0%,
        rgba(139, 92, 246, 0.15) 100%
    );
    border: 2px solid rgba(99, 102, 241, 0.3);
    border-radius: 20px;
    transition: all 0.3s ease;
}

body.dark-mode .version-update-item {
    background: linear-gradient(135deg,
        rgba(99, 102, 241, 0.15) 0%,
        rgba(139, 92, 246, 0.2) 100%
    );
    border-color: rgba(99, 102, 241, 0.4);
}

.version-update-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 24px rgba(99, 102, 241, 0.3);
}

.update-icon {
    font-size: 48px;
    flex-shrink: 0;
    animation: icon-bounce 2s ease-in-out infinite;
}

@keyframes icon-bounce {
    0%, 100% {
        transform: translateY(0);
    }
    50% {
        transform: translateY(-10px);
    }
}

.update-content {
    flex: 1;
}

.update-title {
    font-size: 20px;
    font-weight: 700;
    color: #4f46e5;
    margin-bottom: 8px;
}

body.dark-mode .update-title {
    color: #818cf8;
}

.update-description {
    font-size: 15px;
    color: #6b7280;
    line-height: 1.6;
}

body.dark-mode .update-description {
    color: #9ca3af;
}

/* Minor Updates List */
.version-update-list {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.version-update-item-small {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    background: rgba(255, 255, 255, 0.5);
    border: 1px solid rgba(99, 102, 241, 0.15);
    border-radius: 12px;
    font-size: 15px;
    color: #374151;
    transition: all 0.3s ease;
}

body.dark-mode .version-update-item-small {
    background: rgba(40, 40, 40, 0.5);
    border-color: rgba(99, 102, 241, 0.3);
    color: #e5e5e5;
}

.version-update-item-small:hover {
    background: rgba(99, 102, 241, 0.05);
    border-color: rgba(99, 102, 241, 0.3);
    transform: translateX(5px);
}

.update-bullet {
    font-size: 20px;
    flex-shrink: 0;
}

/* Footer */
.version-modal-footer {
    padding: 24px 32px;
    border-top: 2px solid rgba(99, 102, 241, 0.15);
    background: rgba(99, 102, 241, 0.05);
}

.version-cta-btn {
    width: 100%;
    padding: 16px 32px;
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    color: white;
    border: none;
    border-radius: 50px;
    font-size: 18px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
}

.version-cta-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(99, 102, 241, 0.5);
}

.version-cta-btn:active {
    transform: translateY(0);
}

/* Mobile Responsive */
@media (max-width: 640px) {
    .version-modal-container {
        border-radius: 24px;
        max-height: 95vh;
    }

    .version-modal-header {
        padding: 24px 20px 20px;
    }

    .version-badge {
        padding: 10px 20px;
        font-size: 16px;
    }

    .version-modal-content {
        padding: 24px 20px;
    }

    .version-modal-title {
        font-size: 28px;
        margin-bottom: 24px;
    }

    .version-update-item {
        flex-direction: column;
        padding: 20px;
    }

    .update-icon {
        font-size: 40px;
    }

    .update-title {
        font-size: 18px;
    }

    .version-modal-footer {
        padding: 20px;
    }

    .version-cta-btn {
        font-size: 16px;
        padding: 14px 28px;
    }
}

        @keyframes fadeInScale {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

/* Smooth tab transitions */
.provider-tab, .inbox-view-toggle-btn {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.provider-tab.active, .inbox-view-toggle-btn.active {
    backdrop-filter: blur(20px);
}

        .inbox-back-btn-tab {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
    backdrop-filter: blur(10px);
    border: 2px solid white;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    color: #374151;
    font-weight: bold;
}

.inbox-back-btn-tab:hover {
    transform: scale(1.1) translateX(-2px);
    background: linear-gradient(135deg, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0.9));
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
}

.inbox-back-btn-tab:active {
    transform: scale(0.95);
}

/* Smooth provider/view mode transitions */
.provider-tabs-container, .inbox-view-toggle {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Smooth content transitions */
.gmail-slide-enter, .outlook-slide-enter {
    animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateX(-20px);
        filter: blur(10px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
        filter: blur(0);
    }
}

        /* Bottom Success Notification */
.bottom-notification {
    position: fixed;
    bottom: -100px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    padding: 16px 32px;
    border-radius: 50px;
    box-shadow: 0 8px 32px rgba(16, 185, 129, 0.4);
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 600;
    z-index: 10000;
    animation: slideUpNotification 0.5s ease-out forwards;
    backdrop-filter: blur(10px);
}

.bottom-notification.hide {
    animation: slideDownNotification 0.5s ease-out forwards;
}

.bottom-notification-icon {
    font-size: 24px;
    animation: bounce 0.6s ease-in-out;
}

@keyframes slideUpNotification {
    from {
        bottom: -100px;
        opacity: 0;
    }
    to {
        bottom: 32px;
        opacity: 1;
    }
}

@keyframes slideDownNotification {
    from {
        bottom: 32px;
        opacity: 1;
    }
    to {
        bottom: -100px;
        opacity: 0;
    }
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

        /* Desktop AI Prompt Container - Default Style */
.ai-prompt-container {
    display: flex;
    gap: 12px;
    align-items: center;
}

.ai-prompt-input {
    flex: 1;
    padding: 12px 20px;
    border-radius: 50px;
    border: 2px solid rgba(99, 102, 241, 0.3);
    background: rgba(255, 255, 255, 0.9);
    font-size: 15px;
    transition: all 0.3s ease;
}

body.dark-mode .ai-prompt-input {
    background: rgba(40, 40, 40, 0.9);
    color: #e5e5e5;
}

.ai-prompt-input:focus {
    outline: none;
    border-color: rgba(99, 102, 241, 0.5);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.ai-send-button {
    padding: 12px 32px;
    border-radius: 50px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
    color: #374151;
    border: 2px solid white;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
}

body.dark-mode .ai-send-button {
    background: linear-gradient(135deg, rgba(60, 60, 60, 0.9), rgba(50, 50, 50, 0.85));
    color: #e5e5e5;
}

.ai-send-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(99, 102, 241, 0.3);
}

.ai-send-button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Mobile Overrides */
@media (max-width: 768px) {
    .ai-prompt-container {
        position: relative;
        display: flex;
        align-items: center;
        gap: 12px;
        margin-top: 16px;
    }

    .ai-prompt-input {
        flex: 1;
        padding: 14px 20px;
        font-size: 14px;
    }

    .ai-send-button {
        width: 48px;
        height: 48px;
        padding: 0;
        border-radius: 50%;
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        opacity: 0;
        transform: scale(0);
        pointer-events: none;
    }

    .ai-send-button.visible {
        opacity: 1;
        transform: scale(1);
        pointer-events: all;
        animation: button-pop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
}

/* Default state */
.desktop-inbox-layout {
    display: none;
}

.ai-writer-container {
    display: block;
}

/* Desktop (>1024px) */
@media (min-width: 1025px) {
    /* Show desktop inbox when it exists */
    .desktop-inbox-layout {
        display: flex !important;
    }

    /* Hide AI writer on desktop only when desktop-inbox-layout is present */
    /* This way, when not connected (no desktop-inbox-layout), ai-writer still shows on desktop */
    .page-container:has(.desktop-inbox-layout) .ai-writer-container {
        display: none !important;
    }

    /* Fallback for browsers without :has() support - hide ai-writer if desktop-inbox exists as sibling */
    .desktop-inbox-layout ~ .ai-writer-container {
        display: none !important;
    }
}

/* Mobile (<=1024px) - Always show AI writer, hide desktop inbox */
@media (max-width: 1024px) {
    .desktop-inbox-layout {
        display: none !important;
    }

    .ai-writer-container {
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
        min-height: 400px;
        background: rgba(255, 255, 255, 0.05);
    }

    .mobile-inbox-button {
        display: flex !important;
    }
}

/* ===== CENTERED AI WRITER MODE ===== */
/* When generating, the inbox slides left and fades, container centers */

/* Smooth transition for generating mode layout */
.desktop-inbox-layout.generating-mode {
    justify-content: center;
}

/* Class to hide inbox during generation - uses transitions from base .inbox-sidebar */
.inbox-sidebar.generating-hidden {
    opacity: 0;
    transform: translateX(-100%);
    pointer-events: none;
    width: 0 !important;
    min-width: 0 !important;
    padding: 0 !important;
    margin: 0 !important;
    margin-right: -20px !important;
    overflow: hidden;
}

/* Email content area centers when inbox is hidden */
.email-content-area.generating-centered {
    flex: none !important;
    width: 100% !important;
    max-width: 900px !important;
    margin: 0 auto !important;
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

/* Hide back button during generation */
.email-viewer-header .back-button-generating-hidden {
    opacity: 0;
    pointer-events: none;
    transform: translateX(-20px);
    transition: all 0.3s ease;
}

/* Centered AI Writer Container Styles - Inline mode (not popup) */
.ai-writer-centered-mode {
    position: relative;
    width: 100%;
    max-width: 100%;
    background: transparent;
    backdrop-filter: none;
    border: none;
    border-radius: 0;
    padding: 32px;
    overflow-y: auto;
    overflow-x: hidden;
    box-shadow: none;
    margin: 0 auto;
    animation: fade-in-content 0.4s ease-out;
    box-sizing: border-box;
}

body.dark-mode .ai-writer-centered-mode {
    background: transparent;
}

@keyframes fade-in-content {
    0% {
        opacity: 0;
        transform: translateY(10px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes inline-container-appear {
    0% {
        opacity: 0;
        transform: scale(0.95);
        filter: blur(8px);
    }
    100% {
        opacity: 1;
        transform: scale(1);
        filter: blur(0);
    }
}

/* Hide the overlay when in inline mode */
.centered-mode-overlay {
    display: none;
}

@keyframes overlay-fade {
    0% { opacity: 0; }
    100% { opacity: 1; }
}

/* Wave animation for AI response words */
.ai-response-word {
    display: inline;
    opacity: 0;
    animation: word-wave-in 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes word-wave-in {
    0% {
        opacity: 0;
        transform: translateY(8px);
        filter: blur(4px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
        filter: blur(0);
    }
}

/* Action Buttons - Fixed positioning in centered mode */
.centered-mode-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 16px;
    border-bottom: 1px solid rgba(99, 102, 241, 0.1);
    position: relative;
}

.centered-mode-actions {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
    justify-content: center;
    z-index: 10;
}

.centered-mode-close {
    margin-left: auto;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(239, 68, 68, 0.1);
    border: 2px solid rgba(239, 68, 68, 0.3);
    color: #ef4444;
    font-size: 18px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    flex-shrink: 0;
}

.centered-mode-btn {
    padding: 12px 24px;
    border-radius: 50px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid white;
    display: flex;
    align-items: center;
    gap: 8px;
    white-space: nowrap;
}

/* Ensure buttons stay centered even with close button */
.centered-mode-header::before {
    content: '';
    width: 40px;
    height: 40px;
    visibility: hidden;
}

.centered-mode-btn.primary {
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
}

.centered-mode-btn.primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
}

.centered-mode-btn.secondary {
    background: rgba(255, 255, 255, 0.9);
    color: #4f46e5;
    border-color: rgba(99, 102, 241, 0.3);
}

body.dark-mode .centered-mode-btn.secondary {
    background: rgba(40, 40, 45, 0.9);
    color: #a5b4fc;
}

.centered-mode-btn.secondary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
}

/* Centered mode prompt display */
.centered-mode-prompt {
    text-align: center;
    font-size: 18px;
    font-weight: 600;
    color: #6b7280;
    margin-bottom: 24px;
    font-style: italic;
}

body.dark-mode .centered-mode-prompt {
    color: #9ca3af;
}

/* Centered mode result area */
.centered-mode-result {
    padding: 24px;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 20px;
    min-height: 200px;
    max-height: 400px;
    overflow-y: auto;
    font-size: 15px;
    line-height: 1.8;
    color: #374151;
    white-space: pre-wrap;
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.centered-mode-result::-webkit-scrollbar {
    display: none;
}

body.dark-mode .centered-mode-result {
    background: rgba(30, 30, 30, 0.5);
    color: #e5e5e5;
}

/* Generating animation in centered mode */
.centered-generating-animation {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 20px;
}

.centered-status-list {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
}

.centered-status-item {
    font-size: 18px;
    font-weight: 600;
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0.3;
    transform: translateY(0) scale(0.95);
    color: #9ca3af;
}

.centered-status-item.active {
    opacity: 1;
    transform: translateY(0) scale(1.1);
    color: #6366f1;
    text-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
}

body.dark-mode .centered-status-item.active {
    color: #a5b4fc;
}

/* ===== AI WRITER FOCUSED MODE - Smooth Layout Transitions ===== */
/* This replaces the popup approach with in-place layout animation */

/* Header slide up animation when in AI writing mode */
.sticky-header.ai-mode-hidden {
    animation: header-slide-up 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes header-slide-up {
    0% {
        opacity: 1;
        transform: translateY(0);
    }
    100% {
        opacity: 0;
        transform: translateY(-100%);
        pointer-events: none;
    }
}

.sticky-header.ai-mode-visible {
    animation: header-slide-down 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes header-slide-down {
    0% {
        opacity: 0;
        transform: translateY(-100%);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
        pointer-events: all;
    }
}

/* Inbox sidebar slide out animation */
.inbox-sidebar.ai-mode-hidden {
    animation: inbox-slide-out 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes inbox-slide-out {
    0% {
        opacity: 1;
        transform: translateX(0) scale(1);
    }
    100% {
        opacity: 0;
        transform: translateX(-100%) scale(0.9);
        pointer-events: none;
        width: 0;
        padding: 0;
        margin: 0;
    }
}

.inbox-sidebar.ai-mode-visible {
    animation: inbox-slide-in 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

@keyframes inbox-slide-in {
    0% {
        opacity: 0;
        transform: translateX(-100%) scale(0.9);
        width: 0;
    }
    100% {
        opacity: 1;
        transform: translateX(0) scale(1);
        width: 480px;
        pointer-events: all;
    }
}

/* Email content area center animation */
.email-content-area.ai-mode-centered {
    animation: content-slide-center 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes content-slide-center {
    0% {
        margin-left: 0;
    }
    100% {
        margin-left: auto;
        margin-right: auto;
        max-width: 900px;
    }
}

.email-content-area.ai-mode-normal {
    animation: content-slide-back 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

@keyframes content-slide-back {
    0% {
        margin-left: auto;
        margin-right: auto;
        max-width: 900px;
    }
    100% {
        margin-left: 0;
        margin-right: 0;
        max-width: none;
    }
}

/* Desktop layout in AI writing mode */
.desktop-inbox-layout.ai-writing-mode {
    justify-content: center;
}

.desktop-inbox-layout.ai-writing-mode .inbox-sidebar {
    display: none;
}

.desktop-inbox-layout.ai-writing-mode .email-content-area {
    max-width: 900px;
    width: 100%;
    margin: 0 auto;
}

/* ===== AI Writer Prompt Container (Oval at bottom) ===== */
.ai-writer-prompt-container {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 100;
    animation: prompt-slide-up 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    animation-delay: 0.3s;
    opacity: 0;
}

@keyframes prompt-slide-up {
    0% {
        opacity: 0;
        transform: translateX(-50%) translateY(50px);
    }
    100% {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}

.ai-writer-prompt-input {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px 24px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(249, 250, 251, 0.9) 100%);
    backdrop-filter: blur(30px);
    border: 2px solid rgba(255, 255, 255, 0.8);
    border-radius: 50px;
    box-shadow: 0 10px 40px rgba(99, 102, 241, 0.2), 0 0 0 1px rgba(255, 255, 255, 0.5) inset;
    min-width: 400px;
    max-width: 600px;
}

body.dark-mode .ai-writer-prompt-input {
    background: linear-gradient(135deg, rgba(30, 30, 35, 0.95) 0%, rgba(25, 25, 30, 0.9) 100%);
    border-color: rgba(99, 102, 241, 0.3);
}

.ai-writer-prompt-input input {
    flex: 1;
    background: transparent;
    border: none;
    outline: none;
    font-size: 15px;
    color: #374151;
}

body.dark-mode .ai-writer-prompt-input input {
    color: #e5e5e5;
}

.ai-writer-prompt-input input::placeholder {
    color: #9ca3af;
}

/* ===== GRAMMAR CHECK BUTTON & HIGHLIGHT EFFECTS ===== */
.grammar-check-btn {
    position: absolute;
    top: 12px;
    right: 12px;
    padding: 8px 16px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(249, 250, 251, 0.9) 100%);
    backdrop-filter: blur(10px);
    border: 2px solid rgba(99, 102, 241, 0.3);
    border-radius: 50px;
    font-size: 12px;
    font-weight: 600;
    color: #6366f1;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 6px;
    z-index: 10;
}

body.dark-mode .grammar-check-btn {
    background: linear-gradient(135deg, rgba(40, 40, 45, 0.95) 0%, rgba(35, 35, 40, 0.9) 100%);
    border-color: rgba(99, 102, 241, 0.4);
    color: #a5b4fc;
}

.grammar-check-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    border-color: rgba(99, 102, 241, 0.5);
}

.grammar-check-btn.checking {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
    animation: grammar-pulse 1.5s ease-in-out infinite;
}

@keyframes grammar-pulse {
    0%, 100% {
        box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4);
    }
    50% {
        box-shadow: 0 0 0 8px rgba(99, 102, 241, 0);
    }
}

/* Grammar highlight overlay */
.grammar-highlight-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    z-index: 5;
    border-radius: inherit;
    overflow: hidden;
}

.grammar-checking-effect {
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(99, 102, 241, 0.1) 30%,
        rgba(139, 92, 246, 0.2) 50%,
        rgba(99, 102, 241, 0.1) 70%,
        transparent 100%
    );
    animation: grammar-scan 1.5s ease-in-out infinite;
}

@keyframes grammar-scan {
    0% {
        left: -100%;
    }
    100% {
        left: 100%;
    }
}

/* Grammar corrected word highlight */
.grammar-corrected-word {
    display: inline;
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.15) 100%);
    border-radius: 4px;
    padding: 1px 4px;
    animation: highlight-fade 3s ease-out forwards;
}

@keyframes highlight-fade {
    0% {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.4) 0%, rgba(5, 150, 105, 0.3) 100%);
        box-shadow: 0 0 10px rgba(16, 185, 129, 0.4);
    }
    70% {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.15) 100%);
    }
    100% {
        background: transparent;
        box-shadow: none;
    }
}

/* Grammar result notification */
.grammar-result-notification {
    position: absolute;
    top: 12px;
    right: 12px;
    padding: 10px 20px;
    border-radius: 50px;
    font-size: 13px;
    font-weight: 600;
    animation: notification-appear 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), notification-fade 0.5s ease-out 2.5s forwards;
    z-index: 10;
}

.grammar-result-notification.success {
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(5, 150, 105, 0.1) 100%);
    border: 2px solid rgba(16, 185, 129, 0.4);
    color: #059669;
}

.grammar-result-notification.corrected {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.1) 100%);
    border: 2px solid rgba(99, 102, 241, 0.4);
    color: #6366f1;
}

body.dark-mode .grammar-result-notification.success {
    color: #34d399;
}

body.dark-mode .grammar-result-notification.corrected {
    color: #a5b4fc;
}

@keyframes notification-appear {
    0% {
        opacity: 0;
        transform: translateY(-10px) scale(0.9);
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

@keyframes notification-fade {
    0% {
        opacity: 1;
    }
    100% {
        opacity: 0;
        transform: translateY(-10px);
    }
}

/* ===== SHOWCASE CAROUSEL FOR NO PROVIDER STATE ===== */
.showcase-carousel-container {
    position: relative;
    width: 100%;
    height: 300px;
    overflow: hidden;
    margin: 20px 0;
}

.showcase-track {
    display: flex;
    gap: 20px;
    animation: carousel-scroll 20s linear infinite;
    width: fit-content;
}

@keyframes carousel-scroll {
    0% {
        transform: translateX(0);
    }
    100% {
        transform: translateX(-50%);
    }
}

.showcase-card {
    flex-shrink: 0;
    width: 300px;
    padding: 24px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(249, 250, 251, 0.85) 100%);
    backdrop-filter: blur(20px);
    border: 2px solid rgba(255, 255, 255, 0.8);
    border-radius: 20px;
    box-shadow: 0 8px 32px rgba(99, 102, 241, 0.12);
    transition: all 0.3s ease;
}

body.dark-mode .showcase-card {
    background: linear-gradient(135deg, rgba(30, 30, 35, 0.9) 0%, rgba(25, 25, 30, 0.85) 100%);
    border-color: rgba(99, 102, 241, 0.3);
}

.showcase-card:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 12px 40px rgba(99, 102, 241, 0.2);
}

.showcase-card-icon {
    font-size: 36px;
    margin-bottom: 12px;
}

.showcase-card-title {
    font-size: 16px;
    font-weight: 700;
    color: #374151;
    margin-bottom: 8px;
}

body.dark-mode .showcase-card-title {
    color: #e5e5e5;
}

.showcase-card-example {
    font-size: 14px;
    color: #6b7280;
    font-style: italic;
    line-height: 1.5;
}

body.dark-mode .showcase-card-example {
    color: #9ca3af;
}

.showcase-card-response {
    margin-top: 12px;
    padding: 12px;
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.08) 100%);
    border-radius: 12px;
    font-size: 13px;
    color: #4f46e5;
}

body.dark-mode .showcase-card-response {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.15) 100%);
    color: #a5b4fc;
}

/* Gradient fade on edges */
.showcase-carousel-container::before,
.showcase-carousel-container::after {
    content: '';
    position: absolute;
    top: 0;
    bottom: 0;
    width: 80px;
    z-index: 2;
    pointer-events: none;
}

.showcase-carousel-container::before {
    left: 0;
    background: linear-gradient(90deg, var(--bg-color, #e0e7ff) 0%, transparent 100%);
}

.showcase-carousel-container::after {
    right: 0;
    background: linear-gradient(-90deg, var(--bg-color, #e0e7ff) 0%, transparent 100%);
}

body.dark-mode .showcase-carousel-container::before {
    background: linear-gradient(90deg, #0a0a0a 0%, transparent 100%);
}

body.dark-mode .showcase-carousel-container::after {
    background: linear-gradient(-90deg, #0a0a0a 0%, transparent 100%);
}

/* Pause carousel on hover */
.showcase-carousel-container:hover .showcase-track {
    animation-play-state: paused;
}

/* ===== CLOSE BUTTON FOR AI WRITING MODE ===== */
.ai-mode-close-btn {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(249, 250, 251, 0.9) 100%);
    backdrop-filter: blur(20px);
    border: 2px solid rgba(239, 68, 68, 0.3);
    color: #ef4444;
    font-size: 24px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    animation: close-btn-appear 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    animation-delay: 0.4s;
    opacity: 0;
    box-shadow: 0 4px 20px rgba(239, 68, 68, 0.2);
}

body.dark-mode .ai-mode-close-btn {
    background: linear-gradient(135deg, rgba(30, 30, 35, 0.95) 0%, rgba(25, 25, 30, 0.9) 100%);
    border-color: rgba(239, 68, 68, 0.4);
}

.ai-mode-close-btn:hover {
    transform: rotate(90deg) scale(1.1);
    background: rgba(239, 68, 68, 0.1);
    box-shadow: 0 6px 24px rgba(239, 68, 68, 0.3);
}

@keyframes close-btn-appear {
    0% {
        opacity: 0;
        transform: scale(0.5) rotate(-180deg);
    }
    100% {
        opacity: 1;
        transform: scale(1) rotate(0);
    }
}

/* ===== DRAG AND DROP ENHANCEMENT ===== */
.inbox-email-draggable {
    cursor: grab;
    transition: all 0.2s ease;
}

.inbox-email-draggable:active {
    cursor: grabbing;
}

.inbox-email-draggable.dragging {
    opacity: 0.5;
    transform: scale(0.98);
}

.email-content-area.drag-active {
    border: 2px dashed rgba(99, 102, 241, 0.5) !important;
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(139, 92, 246, 0.03) 100%) !important;
}

.email-content-area.drag-active::before {
    content: ' Drop email here to reply';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 18px;
    font-weight: 600;
    color: #6366f1;
    text-align: center;
    z-index: 10;
    animation: pulse 1.5s ease-in-out infinite;
}

/* Logout Confirmation Dialog */
.logout-confirm-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(8px);
    z-index: 10002;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s ease-out;
}

.logout-confirm-dialog {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(249, 250, 251, 0.95) 100%);
    backdrop-filter: blur(30px);
    border: 2px solid rgba(255, 255, 255, 0.8);
    border-radius: 24px;
    padding: 32px;
    max-width: 400px;
    width: 90%;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: popup-scale 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    text-align: center;
}

body.dark-mode .logout-confirm-dialog {
    background: linear-gradient(135deg, rgba(30, 30, 35, 0.98) 0%, rgba(20, 20, 25, 0.95) 100%);
    border-color: rgba(255, 255, 255, 0.1);
}

.logout-confirm-icon {
    font-size: 48px;
    margin-bottom: 16px;
}

.logout-confirm-title {
    font-size: 20px;
    font-weight: 700;
    color: #374151;
    margin-bottom: 8px;
}

body.dark-mode .logout-confirm-title {
    color: #e5e5e5;
}

.logout-confirm-message {
    font-size: 14px;
    color: #6b7280;
    margin-bottom: 24px;
}

body.dark-mode .logout-confirm-message {
    color: #9ca3af;
}

.logout-confirm-buttons {
    display: flex;
    gap: 12px;
    justify-content: center;
}

.logout-confirm-btn {
    padding: 12px 28px;
    border-radius: 50px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    border: none;
}

.logout-confirm-btn.cancel {
    background: rgba(255, 255, 255, 0.8);
    color: #374151;
    border: 2px solid rgba(0, 0, 0, 0.1);
}

body.dark-mode .logout-confirm-btn.cancel {
    background: rgba(60, 60, 60, 0.8);
    color: #e5e5e5;
    border-color: rgba(255, 255, 255, 0.1);
}

.logout-confirm-btn.cancel:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.logout-confirm-btn.confirm {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}

.logout-confirm-btn.confirm:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
}

/* Fix for desktop blur animation visibility */
@media (min-width: 1025px) {
    .greeting-word {
        -webkit-filter: blur(12px);
        filter: blur(12px);
        opacity: 0;
        transform: translateY(8px) scale(0.95);
        animation: greeting-word-reveal 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        -webkit-animation: greeting-word-reveal 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    @-webkit-keyframes greeting-word-reveal {
        0% {
            opacity: 0;
            -webkit-filter: blur(12px);
            filter: blur(12px);
            -webkit-transform: translateY(8px) scale(0.95);
            transform: translateY(8px) scale(0.95);
        }
        60% {
            opacity: 0.8;
            -webkit-filter: blur(4px);
            filter: blur(4px);
            -webkit-transform: translateY(-2px) scale(1.02);
            transform: translateY(-2px) scale(1.02);
        }
        100% {
            opacity: 1;
            -webkit-filter: blur(0);
            filter: blur(0);
            -webkit-transform: translateY(0) scale(1);
            transform: translateY(0) scale(1);
        }
    }
}

/* Fullscreen Email Viewer */
.fullscreen-email-viewer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(12px);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    animation: fadeIn 0.3s ease-out;
}

.fullscreen-email-container {
    width: 100%;
    max-width: 900px;
    height: 90vh;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(249, 250, 251, 0.95));
    border-radius: 24px;
    border: 2px solid white;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    animation: slideUpScale 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

body.dark-mode .fullscreen-email-container {
    background: linear-gradient(135deg, rgba(20, 20, 20, 0.98), rgba(30, 30, 30, 0.95));
    border-color: rgba(99, 102, 241, 0.3);
}

@keyframes slideUpScale {
    from {
        opacity: 0;
        transform: translateY(60px) scale(0.9);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.fullscreen-email-header {
    padding: 20px 24px;
    border-bottom: 2px solid rgba(99, 102, 241, 0.15);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.fullscreen-close-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(239, 68, 68, 0.1);
    border: 2px solid rgba(239, 68, 68, 0.3);
    color: #ef4444;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.fullscreen-close-btn:hover {
    background: rgba(239, 68, 68, 0.2);
    transform: scale(1.1);
}

.fullscreen-email-content {
    flex: 1;
    overflow-y: auto;
    padding: 24px;
}

.fullscreen-email-text {
    font-size: 16px;
    line-height: 1.8;
    color: #374151;
    white-space: pre-wrap;
    word-wrap: break-word;
    animation: smoothFadeSlide 0.5s ease-out;
}

body.dark-mode .fullscreen-email-text {
    color: #e5e5e5;
}

@keyframes smoothFadeSlide {
    from {
        opacity: 0;
        transform: translateY(20px);
        filter: blur(5px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
        filter: blur(0);
    }
}

.fullscreen-prompt-container {
    padding: 20px 24px;
    border-top: 2px solid rgba(99, 102, 241, 0.15);
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(249, 250, 251, 0.85));
}

body.dark-mode .fullscreen-prompt-container {
    background: linear-gradient(135deg, rgba(30, 30, 30, 0.9), rgba(20, 20, 20, 0.85));
}

/* Dynamic Stacked Suggestions */
.dynamic-suggestions-stack {
    position: absolute;
    bottom: 100%;
    left: 0;
    right: 0;
    margin-bottom: 12px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    animation: slideUpFade 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes slideUpFade {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.dynamic-suggestion-pill {
    padding: 12px 20px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(249, 250, 251, 0.95));
    border: 2px solid white;
    border-radius: 50px;
    font-size: 14px;
    font-weight: 600;
    color: #4f46e5;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
    animation: pillBounce 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

body.dark-mode .dynamic-suggestion-pill {
    background: linear-gradient(135deg, rgba(30, 30, 35, 0.98), rgba(25, 25, 30, 0.95));
    border-color: rgba(99, 102, 241, 0.5);
    color: #c7d2fe;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.dynamic-suggestion-pill:hover {
    transform: translateX(8px) scale(1.02);
    box-shadow: 0 6px 20px rgba(99, 102, 241, 0.25);
    border-color: rgba(99, 102, 241, 0.6);
}

body.dark-mode .dynamic-suggestion-pill:hover {
    border-color: rgba(99, 102, 241, 0.7);
    box-shadow: 0 6px 20px rgba(99, 102, 241, 0.35);
}

@keyframes pillBounce {
    0% {
        opacity: 0;
        transform: translateX(-20px) scale(0.8);
    }
    60% {
        transform: translateX(4px) scale(1.05);
    }
    100% {
        opacity: 1;
        transform: translateX(0) scale(1);
    }
}

/* Live typing animation */
.typing-line {
    opacity: 0;
    animation: typingFadeIn 0.2s ease-out forwards;
}

@keyframes typingFadeIn {
    from {
        opacity: 0;
        transform: translateX(-10px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

/* View Email Button */
.view-email-btn {
    margin-top: 16px;
    padding: 14px 28px;
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    color: white;
    border: none;
    border-radius: 50px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3);
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.view-email-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 24px rgba(99, 102, 241, 0.4);
}

/* Delete slide-left animation */
@keyframes slideOutLeft {
    from {
        opacity: 1;
        transform: translateX(0);
    }
    to {
        opacity: 0;
        transform: translateX(-100%);
    }
}

.deleting-email {
    animation: slideOutLeft 0.4s ease-out forwards;
}

        @keyframes slideUpFade {
    from {
        opacity: 0;
        transform: translateY(12px);
        filter: blur(4px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
        filter: blur(0);
    }
}


        /* Priority Email Glow Effect */
.priority-email-stacked {
    animation: stack-appear-glow 1.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

@keyframes stack-appear-glow {
    0% {
        opacity: 0;
        transform: translateY(-20px) scale(0.9);
        box-shadow: 0 0 0 rgba(99, 102, 241, 0);
    }
    30% {
        box-shadow: 0 0 40px rgba(99, 102, 241, 0.8),
                    0 0 80px rgba(139, 92, 246, 0.6),
                    0 0 120px rgba(167, 139, 250, 0.4);
    }
    60% {
        box-shadow: 0 0 40px rgba(99, 102, 241, 0.6),
                    0 0 80px rgba(139, 92, 246, 0.4);
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
}

        /* Enhanced Language Dropdown */
.custom-language-select option {
    background: white;
    color: #374151;
    padding: 16px 20px;
    font-weight: 600;
    border-bottom: 1px solid rgba(99, 102, 241, 0.1);
    transition: all 0.2s ease;
}

.custom-language-select option:hover {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%);
}

body.dark-mode .custom-language-select option {
    background: rgba(40, 40, 40, 0.98);
    color: #e5e5e5;
    border-bottom: 1px solid rgba(99, 102, 241, 0.2);
}

body.dark-mode .custom-language-select option:hover {
    background: rgba(60, 60, 70, 0.95);
}

       .mouse-follow-container::before {
    left: var(--before-left, 50%);
    top: var(--before-top, 50%);
} 

        /* Connection Animation V2 - Morphing Version */
.connection-animation-overlay-v2 {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(10px);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s ease-out;
}

.connection-animation-box-v2 {
    width: 500px;
    height: 280px;
    background: white;
    border-radius: 24px;
    padding: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: slideUp 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    overflow: hidden;
    transition: background 1s ease 1.5s;
}

.connection-animation-box-v2.active {
    background: linear-gradient(135deg, rgba(30, 30, 35, 0.98) 0%, rgba(25, 25, 30, 0.95) 100%);
}

/* User Logo - Slides from left */
.connection-user-logo-v2 {
    position: absolute;
    left: -100px;
    top: 50%;
    transform: translateY(-50%);
    animation: slideUserFromLeft 4s cubic-bezier(0.22, 0.61, 0.36, 1) forwards;
    z-index: 2;
}

.connection-user-avatar-v2 {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    font-weight: 700;
    color: white;
    box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
}

/* Provider Logo - Static on right then merges */
.connection-provider-logo-v2 {
    position: absolute;
    right: 80px;
    top: 50%;
    transform: translateY(-50%);
    animation: mergeProvider 4s cubic-bezier(0.22, 0.61, 0.36, 1) forwards;
    z-index: 1;
}

.connection-provider-avatar-v2 {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
}

.connection-provider-avatar-v2 svg {
    width: 40px;
    height: 40px;
}

.gmail-avatar-v2 {
    background: linear-gradient(135deg, #ea4335 0%, #fbbc04 100%);
}

.outlook-avatar-v2 {
    background: linear-gradient(135deg, #0078d4 0%, #00bcf2 100%);
}

/* Final Merged Logo */
.connection-merged-logo-v2 {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%) scale(0);
    opacity: 0;
    animation: showMergedLogo 4s cubic-bezier(0.22, 0.61, 0.36, 1) forwards;
    z-index: 3;
}

.connection-merged-avatar-v2 {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 40px;
    font-weight: 700;
    color: white;
    box-shadow: 0 12px 32px rgba(99, 102, 241, 0.5);
    position: relative;
}

/* Connected Badge */
.connection-badge-v2 {
    position: absolute;
    bottom: -5px;
    right: -5px;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    border: 3px solid white;
    border-radius: 20px;
    padding: 4px 12px;
    display: flex;
    align-items: center;
    gap: 4px;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
    animation: badgePop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) 3.5s backwards;
}

.badge-icon {
    font-size: 12px;
    font-weight: 700;
}

.badge-text {
    font-size: 11px;
    font-weight: 700;
    color: white;
}

/* Status Text */
.connection-status-text-v2 {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 14px;
    font-weight: 600;
    color: #6b7280;
    animation: fadeIn 0.6s ease 0.6s backwards, fadeOut 0.5s ease 3s forwards;
    transition: color 1s ease 1.5s;
}

.connection-animation-box-v2.active .connection-status-text-v2 {
    color: #9ca3af;
}

/* Animations */
@keyframes slideUserFromLeft {
    0% {
        left: -100px;
        transform: translateY(-50%) scale(1);
    }
    40% {
        left: 40%;
        transform: translateY(-50%) scale(1);
    }
    70% {
        left: 50%;
        transform: translateY(-50%) scale(1.1);
    }
    85% {
        left: 50%;
        transform: translateY(-50%) scale(0.9);
        opacity: 1;
    }
    100% {
        left: 50%;
        transform: translateY(-50%) scale(0);
        opacity: 0;
    }
}

@keyframes mergeProvider {
    0% {
        right: 80px;
        transform: translateY(-50%) scale(1);
        opacity: 1;
    }
    40% {
        right: 80px;
        transform: translateY(-50%) scale(1);
        opacity: 1;
    }
    70% {
        right: 50%;
        transform: translate(50%, -50%) scale(1.1);
        opacity: 1;
    }
    85% {
        right: 50%;
        transform: translate(50%, -50%) scale(0.9);
        opacity: 1;
    }
    100% {
        right: 50%;
        transform: translate(50%, -50%) scale(0);
        opacity: 0;
    }
}

@keyframes showMergedLogo {
    0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
    }
    70% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
    }
    85% {
        transform: translate(-50%, -50%) scale(1.2);
        opacity: 1;
    }
    100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
    }
}

@keyframes badgePop {
    0% {
        transform: scale(0);
        opacity: 0;
    }
    60% {
        transform: scale(1.3);
        opacity: 1;
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeOut {
    from {
        opacity: 1;
    }
    to {
        opacity: 0;
    }
}

        /* Hide suggestion pills during AI generation mode */
.email-content-area.generating-centered .prompt-suggestions-container,
.email-content-area.generating-centered .suggestion-carousel-container {
    display: none !important;
    opacity: 0 !important;
    pointer-events: none !important;
}

/* Ensure no floating elements during generation */
.desktop-inbox-layout.generating-mode .prompt-suggestions-container,
.desktop-inbox-layout.generating-mode .suggestion-carousel-container {
    display: none !important;
}
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [currentPage, setCurrentPage] = useState('home');
            const [activeTab, setActiveTab] = useState('email');
            const [activeView, setActiveView] = useState('writer');
            const [emailText, setEmailText] = useState('');
            const [customPrompt, setCustomPrompt] = useState('');
            const [showPromptSuggestions, setShowPromptSuggestions] = useState(false);
            const [filteredSuggestions, setFilteredSuggestions] = useState([]);
            const [promptInputFocused, setPromptInputFocused] = useState(false);
            const [result, setResult] = useState('');
            const [isProcessing, setIsProcessing] = useState(false);
            const [showSuggestions, setShowSuggestions] = useState(false);
            const [emailConnected, setEmailConnected] = useState(false);
            const [showFilterDropdown, setShowFilterDropdown] = useState(false);
            const [selectedTone, setSelectedTone] = useState(null);
            const [uploadedFile, setUploadedFile] = useState(null);
            const [savedResults, setSavedResults] = useState([]);
            const [viewingFile, setViewingFile] = useState(null);
            const [darkMode, setDarkMode] = useState(false);
            const [gmailEmails, setGmailEmails] = useState([]);
            const [sentEmails, setSentEmails] = useState([]);
            const [showSuggestionsEnabled, setShowSuggestionsEnabled] = useState(true);
            const [userEmail, setUserEmail] = useState('');
            const [viewingEmail, setViewingEmail] = useState(null);
            const [navEmailMode, setNavEmailMode] = useState(false); // Track if nav is in email view mode
            const [navTransitioning, setNavTransitioning] = useState(false); // Track navigation transition
            const [showNavGlow, setShowNavGlow] = useState(false); // Track glow animation

            // Authentication states
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [userData, setUserData] = useState(null);
            const [showAuthPopup, setShowAuthPopup] = useState(false);
            const [showAuthInSettings, setShowAuthInSettings] = useState(false);
            const [authMode, setAuthMode] = useState('signup'); // 'signup' or 'login'
            const [authError, setAuthError] = useState('');
            const [isLoggingIn, setIsLoggingIn] = useState(false);
            const [pendingConnection, setPendingConnection] = useState(null); // 'gmail' or 'outlook' - tracks which button should show "Finish Connecting"
            const [emailReply, setEmailReply] = useState('');
            const [replyPrompt, setReplyPrompt] = useState('');
            const [summarizingEmail, setSummarizingEmail] = useState(null);
            const [summaryText, setSummaryText] = useState('');
            const [isSummarizing, setIsSummarizing] = useState(false);
            const [summaryHidden, setSummaryHidden] = useState(false);
            const [userEmails, setUserEmails] = useState([
                { id: 1, from: 'john@example.com', subject: 'Meeting Tomorrow', preview: 'Hey, just wanted to confirm...', date: '2 hours ago' },
                { id: 2, from: 'sarah@company.com', subject: 'Project Update', preview: 'The latest updates on the project...', date: '5 hours ago' },
                { id: 3, from: 'mike@startup.io', subject: 'Quick Question', preview: 'Do you have a moment to discuss...', date: '1 day ago' },
            ]);

            // New state variables for enhanced features
            const [selectedEmails, setSelectedEmails] = useState([]);
            const [deletedEmail, setDeletedEmail] = useState(null);
            const [showUndoDelete, setShowUndoDelete] = useState(false);
            const [isPrioritizing, setIsPrioritizing] = useState(false);
            const [emailsPrioritized, setEmailsPrioritized] = useState(false);
            const [locallyDeletedEmailIds, setLocallyDeletedEmailIds] = useState(new Set());
            const [isRewritingReply, setIsRewritingReply] = useState(false);
            const [autoPrioritize, setAutoPrioritize] = useState(false);
            const [priorityEmails, setPriorityEmails] = useState([]);
            const [isPriorityExpanded, setIsPriorityExpanded] = useState(false);
            const [isSending, setIsSending] = useState(false);
            const [showEnvelope, setShowEnvelope] = useState(false);
            const [showPriorityGlow, setShowPriorityGlow] = useState(false);
            const [newEmailCount, setNewEmailCount] = useState(0);
            const [unreadEmails, setUnreadEmails] = useState(new Set());
            const [lastEmailCheck, setLastEmailCheck] = useState(Date.now());
            const [showInboxExpand, setShowInboxExpand] = useState(false);
            const [userName, setUserName] = useState('');
            const [showWelcomeAnimation, setShowWelcomeAnimation] = useState(true);
            const [aiLoadingState, setAiLoadingState] = useState('');
            const [currentWelcomeMessage, setCurrentWelcomeMessage] = useState(0);
            const [currentSuggestionIndex, setCurrentSuggestionIndex] = useState(0);
            const [showIndicator, setShowIndicator] = useState(false);
            const [showSearchBar, setShowSearchBar] = useState(false);
            const [searchQuery, setSearchQuery] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const [touchStartX, setTouchStartX] = useState(0);
            const [touchEndX, setTouchEndX] = useState(0);
            const [isRefreshing, setIsRefreshing] = useState(false);
            const [deletedEmails, setDeletedEmails] = useState([]);
            const [deletingEmailId, setDeletingEmailId] = useState(null);
            const [showSuccessNotification, setShowSuccessNotification] = useState(false);
            const [notificationMessage, setNotificationMessage] = useState('');

            // New state variables for enhanced features
            const [activeProvider, setActiveProvider] = useState('gmail');
            const [outlookConnected, setOutlookConnected] = useState(false);
            const [outlookEmails, setOutlookEmails] = useState([]);
            const [outlookSentEmails, setOutlookSentEmails] = useState([]);
            const [inboxSearchQuery, setInboxSearchQuery] = useState('');
            const [inboxSearchResults, setInboxSearchResults] = useState([]);
            const [showInboxSearchSuggestions, setShowInboxSearchSuggestions] = useState(false);
            const [priorityStackExpanded, setPriorityStackExpanded] = useState(false);
            const [draggedEmail, setDraggedEmail] = useState(null);
            const [isDraggingOver, setIsDraggingOver] = useState(false);
            const [droppedEmailFile, setDroppedEmailFile] = useState(null);
            const [showBottomNotification, setShowBottomNotification] = useState(false);
            const [bottomNotificationText, setBottomNotificationText] = useState('');
            const [mobileInboxOpen, setMobileInboxOpen] = useState(false);
            const [mobileEmailViewerOpen, setMobileEmailViewerOpen] = useState(false);
            const [mobileViewerStartY, setMobileViewerStartY] = useState(0);
            const [mobileViewerCurrentY, setMobileViewerCurrentY] = useState(0);
            const [prioritizedCollapsed, setPrioritizedCollapsed] = useState(false);
            const [touchCurrentX, setTouchCurrentX] = useState(0);
            const [isSwiping, setIsSwiping] = useState(false);
            const [inboxViewMode, setInboxViewMode] = useState('tabs'); // 'tabs', 'received', 'sent'

            // Connection animation states
            const [showConnectionAnimation, setShowConnectionAnimation] = useState(false);
            const [connectionProvider, setConnectionProvider] = useState(null); // 'gmail' or 'outlook'
            const [pendingSoundPlay, setPendingSoundPlay] = useState(false);

            // Profile customization states
            const [showProfilePopup, setShowProfilePopup] = useState(false);
            const [selectedProfileColor, setSelectedProfileColor] = useState(() => {
                return localStorage.getItem('profileColor') || 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)';
            });
            const [selectedProfileIcon, setSelectedProfileIcon] = useState(() => {
                return localStorage.getItem('profileIcon') || '';
            });
            const [tempProfileColor, setTempProfileColor] = useState('linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)');
            const [tempProfileIcon, setTempProfileIcon] = useState('');

            // Greeting state for blur reveal effect
            const [currentGreeting, setCurrentGreeting] = useState('');
            const [greetingIndex, setGreetingIndex] = useState(0);
            const [greetingAnimationClass, setGreetingAnimationClass] = useState('blur-reveal-text');

            // AI Generation Modal states
            const [showAiGenerationModal, setShowAiGenerationModal] = useState(false);
            const [aiGenerationPrompt, setAiGenerationPrompt] = useState('');
            const [aiGenerationStatus, setAiGenerationStatus] = useState('');
            const [aiGenerationResult, setAiGenerationResult] = useState('');
            const [isAiGenerating, setIsAiGenerating] = useState(false);
            const [aiSuggestions, setAiSuggestions] = useState([]);
            const [aiFollowupPrompt, setAiFollowupPrompt] = useState('');
            const [isModalGrammarChecking, setIsModalGrammarChecking] = useState(false);
            const [modalGrammarWaveActive, setModalGrammarWaveActive] = useState(false);
            const [modalGrammarResult, setModalGrammarResult] = useState('');
            const [removingSuggestionIndex, setRemovingSuggestionIndex] = useState(null);
            const [removedSuggestions, setRemovedSuggestions] = useState([]);

            // Centered AI Writer Mode states (replaces popup modal)
            const [showCenteredWriter, setShowCenteredWriter] = useState(false);
            const [centeredWriterPrompt, setCenteredWriterPrompt] = useState('');
            const [centeredWriterResult, setCenteredWriterResult] = useState('');
            const [isCenteredGenerating, setIsCenteredGenerating] = useState(false);
            const [centeredGenerationStatus, setCenteredGenerationStatus] = useState('');
            const [isReplyOnlyMode, setIsReplyOnlyMode] = useState(false); // For reply rewrite - no layout shift

            // Draft management states
            const [showSaveDraftModal, setShowSaveDraftModal] = useState(false);
            const [drafts, setDrafts] = useState([]);
            const [currentDraftToSave, setCurrentDraftToSave] = useState(null);

            // Logout Confirmation state
            const [showLogoutConfirm, setShowLogoutConfirm] = useState(false);

            // View Full Email Popup states
            const [showViewEmailPopup, setShowViewEmailPopup] = useState(false);
            const [viewEmailPopupData, setViewEmailPopupData] = useState(null);

            // AI Preferences states
            const [useSignature, setUseSignature] = useState(false);
            const [showQuickReplies, setShowQuickReplies] = useState(false);
            const [checkGrammar, setCheckGrammar] = useState(false);
            const [grammarErrors, setGrammarErrors] = useState([]);
            const [isCheckingGrammar, setIsCheckingGrammar] = useState(false);
            const [grammarCheckTimeout, setGrammarCheckTimeout] = useState(null);

            // Fullscreen email viewer states
            const [showFullscreenEmail, setShowFullscreenEmail] = useState(false);
            const [fullscreenEmailText, setFullscreenEmailText] = useState('');
            const [fullscreenPrompt, setFullscreenPrompt] = useState('');
            const [isEditingFullscreen, setIsEditingFullscreen] = useState(false);

            // Dynamic suggestions states
            const [dynamicSuggestions, setDynamicSuggestions] = useState([]);
            const [showDynamicSuggestions, setShowDynamicSuggestions] = useState(false)

            // Starter suggestions states
            const [showStarterSuggestions, setShowStarterSuggestions] = useState(false);
            const [currentSuggestionSet, setCurrentSuggestionSet] = useState(0);

            // AI Model state
            const [selectedModel, setSelectedModel] = useState('Ink 2.0');
            const [showModelDropdown, setShowModelDropdown] = useState(false);

            // AI Draft states
            const [aiDraft, setAiDraft] = useState('');
            const [showDraftModal, setShowDraftModal] = useState(false);
            const [isGeneratingDraft, setIsGeneratingDraft] = useState(false);
            const [hasDraft, setHasDraft] = useState(false);

            // Version modal state
            const [showVersionModal, setShowVersionModal] = useState(false);
            const CURRENT_VERSION = '3.5';

            // Language settings state
            const [selectedLanguage, setSelectedLanguage] = useState('english');
            const [showLanguageInHome, setShowLanguageInHome] = useState(false);

            // AI Writing Mode states (smooth transition instead of popup)
            const [aiWritingMode, setAiWritingMode] = useState(false);
            const [aiWritingModeClosing, setAiWritingModeClosing] = useState(false);

            // Manual Grammar Check states
            const [isManualGrammarChecking, setIsManualGrammarChecking] = useState(false);
            const [grammarCheckResult, setGrammarCheckResult] = useState(null); // 'success' | 'corrected' | null
            const [grammarCorrectedText, setGrammarCorrectedText] = useState('');
            const [showGrammarNotification, setShowGrammarNotification] = useState(false);

            // Audio references for notifications
            const audioRef = useRef(null);
            const sendAudioRef = useRef(null);
            const carouselRef = useRef(null);
            const navRef = useRef(null);
            const connectionAudioRef = useRef(null); // ADD THIS LINE

            // Extract name from email "from" field
const extractSenderName = (fromField) => {
    if (!fromField) return 'there';
    
    // Check if it's in format "Name <email@domain.com>"
    const nameMatch = fromField.match(/^(.+?)\s*</);
    if (nameMatch) {
        const name = nameMatch[1].trim();
        // Check if it looks like a company (all caps, has Inc/LLC/Ltd, etc.)
        if (/^[A-Z\s]+$/.test(name) || /\b(Inc|LLC|Ltd|Corp|Company|Team)\b/i.test(name)) {
            return name; // Return company name as-is
        }
        // Return first name for individuals
        return name.split(' ')[0];
    }
    
    // If just email, extract name from email username
    const emailMatch = fromField.match(/([^@<]+)[@<]/);
    if (emailMatch) {
        const username = emailMatch[1];
        // Convert "john.doe" to "John"
        return username.split(/[._-]/)[0].charAt(0).toUpperCase() + 
               username.split(/[._-]/)[0].slice(1).toLowerCase();
    }
    
    return 'there';
};

           // Initialize app
useEffect(() => {
   // Check for OAuth callback with tokens
const urlParams = new URLSearchParams(window.location.search);
const tokensParam = urlParams.get('tokens');
const provider = urlParams.get('provider');

if (tokensParam) {
    try {
        const tokens = JSON.parse(decodeURIComponent(tokensParam));

        // ENHANCED SOUND FUNCTION - Works after audio is unlocked on button click
        const playConnectionSound = () => {
            const attemptPlay = (audioElement) => {
                audioElement.currentTime = 0;
                audioElement.volume = 0.7;

                return audioElement.play()
                    .catch(err => {
                        if (err.name !== 'NotAllowedError') {
                            console.warn('Sound playback failed:', err.message);
                        }
                        return false;
                    });
            };

            if (connectionAudioRef.current) {
                attemptPlay(connectionAudioRef.current);
            } else {
                try {
                    const sound = new Audio('/effect-for-logo-intro-186595.mp3');
                    sound.load();
                    attemptPlay(sound);
                } catch (err) {
                    console.warn('Could not create audio element:', err.message);
                }
            }
        };

        if (provider === 'outlook') {
            // Save tokens but DON'T finalize connection yet
            localStorage.setItem('outlookTokens', JSON.stringify(tokens));
            localStorage.setItem('outlook_oauth_complete', 'true');
            localStorage.removeItem('oauth_in_progress');

            // Set state to show "Finish setting up Outlook account" button
            setPendingConnection('outlook');

            // Navigate to settings page to show the "Finish setting up" button
            setCurrentPage('settings');

        } else if (provider === 'gmail' || !provider) {
            // Save tokens but DON'T finalize connection yet
            localStorage.setItem('gmailTokens', JSON.stringify(tokens));
            localStorage.setItem('gmail_oauth_complete', 'true');
            localStorage.removeItem('oauth_in_progress');

            // Fetch user info for display purposes
            fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
                headers: {
                    Authorization: 'Bearer ' + tokens.access_token
                }
            })
            .then(function(res) { return res.json(); })
            .then(function(userInfo) {
                setUserEmail(userInfo.email);
                localStorage.setItem('userEmail', userInfo.email);

                const name = userInfo.given_name || (userInfo.name ? userInfo.name.split(' ')[0] : 'there');
                setUserName(name);
                localStorage.setItem('userName', name);
            })
            .catch(function(err) {
                console.error('Error fetching user info:', err);
            });

            // Set state to show "Finish setting up Gmail account" button
            setPendingConnection('gmail');

            console.log(' Gmail OAuth completed! Waiting for user to finish setup...');

            // Navigate to settings page to show the "Finish setting up" button
            setCurrentPage('settings');
        }

        // Clean URL - DON'T CHANGE PAGE
        window.history.replaceState({}, '', window.location.pathname);
    } catch (error) {
        console.error(' Error processing OAuth tokens:', error);
    }
}

    // Load email connection from localStorage
    const savedConnection = localStorage.getItem('emailConnected');
    const savedTokens = localStorage.getItem('gmailTokens');
    const savedUserEmail = localStorage.getItem('userEmail');
    const savedUserName = localStorage.getItem('userName');
    const savedShowSuggestions = localStorage.getItem('showSuggestions');

    if (savedUserEmail) {
        setUserEmail(savedUserEmail);
    }

    if (savedUserName) {
        setUserName(savedUserName);
    }

    if (savedShowSuggestions !== null) {
        setShowSuggestionsEnabled(savedShowSuggestions === 'true');
    }

    // Load language settings
    const savedLanguage = localStorage.getItem('selectedLanguage');
    const savedShowLanguageInHome = localStorage.getItem('showLanguageInHome');
    if (savedLanguage) {
        setSelectedLanguage(savedLanguage);
    }
    if (savedShowLanguageInHome !== null) {
        setShowLanguageInHome(savedShowLanguageInHome === 'true');
    }

    if (savedConnection === 'true' && savedTokens) {
        setEmailConnected(true);

        // Fetch emails with saved tokens
        try {
            const tokens = JSON.parse(savedTokens);
            fetchGmailEmails(tokens.access_token);
            fetchSentEmails(tokens.access_token);
        } catch (error) {
            console.error(' Error loading saved tokens:', error);
            // Clear invalid tokens
            localStorage.removeItem('gmailTokens');
            localStorage.removeItem('emailConnected');
            localStorage.removeItem('userEmail');
            setEmailConnected(false);
            setUserEmail('');
        }
    }

    // Load Outlook connection
const savedOutlookConnection = localStorage.getItem('outlookConnected');
const savedOutlookTokens = localStorage.getItem('outlookTokens');

if (savedOutlookConnection === 'true' && savedOutlookTokens) {
    setOutlookConnected(true);
    
    try {
        const tokens = JSON.parse(savedOutlookTokens);  // Parse ONCE
        console.log(' Loading saved Outlook tokens');
        console.log('Access token present:', !!tokens.access_token);
        fetchOutlookEmails(tokens.access_token);  // Use the access_token directly
        fetchOutlookSentEmails(tokens.access_token);
    } catch (error) {
        console.error(' Error loading saved Outlook tokens:', error);
        localStorage.removeItem('outlookTokens');
        localStorage.removeItem('outlookConnected');
        setOutlookConnected(false);
    }
}

    // Check for pending OAuth completions
    const gmailOAuthComplete = localStorage.getItem('gmail_oauth_complete');
    const outlookOAuthComplete = localStorage.getItem('outlook_oauth_complete');

    if (gmailOAuthComplete === 'true') {
        setPendingConnection('gmail');
    }

    if (outlookOAuthComplete === 'true') {
        setPendingConnection('outlook');
    }

    // Load dark mode preference
    const savedDarkMode = localStorage.getItem('darkMode');
    if (savedDarkMode === 'true') {
        setDarkMode(true);
        document.body.classList.add('dark-mode');
    }
}, []);

            // Update dark mode
            useEffect(() => {
                if (darkMode) {
                    document.body.classList.add('dark-mode');
                    localStorage.setItem('darkMode', 'true');
                } else {
                    document.body.classList.remove('dark-mode');
                    localStorage.setItem('darkMode', 'false');
                }
            }, [darkMode]);

            // Play connection sound on user interaction
            useEffect(() => {
                if (!pendingSoundPlay) return;

                const handleUserInteraction = () => {
                    const playSound = () => {
                        if (connectionAudioRef.current) {
                            connectionAudioRef.current.currentTime = 0;
                            connectionAudioRef.current.volume = 0.7;
                            connectionAudioRef.current.play()
                                .then(() => {
                                    // Show animation when sound plays
                                    setShowConnectionAnimation(true);
                                    setPendingSoundPlay(false);

                                    // Hide animation and show notification after 4 seconds
                                    setTimeout(() => {
                                        setShowConnectionAnimation(false);
                                        showNotification(connectionProvider === 'gmail' ? ' Gmail connected successfully!' : ' Outlook connected successfully!');
                                    }, 4000);
                                })
                                .catch(err => {
                                    console.warn('Sound playback failed:', err.message);
                                    setPendingSoundPlay(false);
                                });
                        } else {
                            try {
                                const sound = new Audio('/effect-for-logo-intro-186595.mp3');
                                sound.volume = 0.7;
                                sound.play()
                                    .then(() => {
                                        // Show animation when sound plays
                                        setShowConnectionAnimation(true);
                                        setPendingSoundPlay(false);

                                        // Hide animation and show notification after 4 seconds
                                        setTimeout(() => {
                                            setShowConnectionAnimation(false);
                                            showNotification(connectionProvider === 'gmail' ? ' Gmail connected successfully!' : ' Outlook connected successfully!');
                                        }, 4000);
                                    })
                                    .catch(err => {
                                        console.warn('Sound playback failed:', err.message);
                                        setPendingSoundPlay(false);
                                    });
                            } catch (err) {
                                console.warn('Could not create audio element:', err.message);
                                setPendingSoundPlay(false);
                            }
                        }
                    };

                    playSound();
                    // Remove listeners after playing
                    document.removeEventListener('click', handleUserInteraction);
                    document.removeEventListener('keydown', handleUserInteraction);
                };

                // Add listeners for user interactions
                document.addEventListener('click', handleUserInteraction);
                document.addEventListener('keydown', handleUserInteraction);

                // Cleanup
                return () => {
                    document.removeEventListener('click', handleUserInteraction);
                    document.removeEventListener('keydown', handleUserInteraction);
                };
            }, [pendingSoundPlay]);

            // Generate AI draft when viewing an email
            useEffect(() => {
                if (viewingEmail && isLoggedIn) {
                    // Reset draft state when switching emails
                    setAiDraft('');
                    setHasDraft(false);
                    setShowDraftModal(false);

                    // Generate AI draft for the email
                    generateAiDraft(viewingEmail);
                }
            }, [viewingEmail]);

            // Check for stored authentication data
            useEffect(() => {
                const storedUserData = localStorage.getItem('userData');
                const storedLoginStatus = localStorage.getItem('isLoggedIn');

                if (storedLoginStatus === 'true' && storedUserData) {
                    setIsLoggedIn(true);
                    setUserData(JSON.parse(storedUserData));
                }
            }, []);

            // Function to handle sign up/login
            const handleSignUp = (name, email, password) => {
                setAuthError('');

                // Check if account already exists
                const existingAccounts = JSON.parse(localStorage.getItem('userAccounts') || '[]');
                const accountExists = existingAccounts.find(acc => acc.email === email);

                if (accountExists) {
                    setAuthError('Account exists. Log in to continue.');
                    return;
                }

                // Create new account
                const newUserData = {
                    name: name,
                    email: email,
                    password: password, // In production, this should be hashed
                    joinedDate: new Date().toLocaleDateString()
                };

                // Save to accounts list
                existingAccounts.push(newUserData);
                localStorage.setItem('userAccounts', JSON.stringify(existingAccounts));

                // Log in the user
                setUserData(newUserData);
                setIsLoggedIn(true);
                setShowAuthInSettings(false);
                localStorage.setItem('userData', JSON.stringify(newUserData));
                localStorage.setItem('isLoggedIn', 'true');
                setAuthError('');
            };

            // Function to handle login
            const handleLogin = (email, password) => {
                setAuthError('');
                setIsLoggingIn(true);

                // Simulate login delay
                setTimeout(() => {
                    const existingAccounts = JSON.parse(localStorage.getItem('userAccounts') || '[]');
                    const account = existingAccounts.find(acc => acc.email === email && acc.password === password);

                    if (account) {
                        // Successful login
                        setUserData(account);
                        setIsLoggedIn(true);
                        setShowAuthInSettings(false);
                        localStorage.setItem('userData', JSON.stringify(account));
                        localStorage.setItem('isLoggedIn', 'true');
                        setAuthError('');
                    } else {
                        // Failed login
                        setAuthError('Wrong details. Enter correct or create account.');
                    }

                    setIsLoggingIn(false);
                }, 1000);
            };

            // Function to handle logout - now shows confirmation first
            const handleLogout = () => {
                setShowLogoutConfirm(true);
            };

            // Confirm logout action
            const confirmLogout = () => {
                setUserData(null);
                setIsLoggedIn(false);
                localStorage.removeItem('userData');
                localStorage.removeItem('isLoggedIn');
                setShowLogoutConfirm(false);
            };

            // Cancel logout
            const cancelLogout = () => {
                setShowLogoutConfirm(false);
            };

            // Update suggestions based on custom prompt only
            useEffect(() => {
                if (showSuggestionsEnabled && customPrompt.length > 0) {
                    setShowSuggestions(true);
                } else {
                    setShowSuggestions(false);
                }
            }, [customPrompt, showSuggestionsEnabled]);

            // Initialize audio with local files
            useEffect(() => {

                // Send email sound - whoosh (only plays when sending emails)
                sendAudioRef.current = new Audio('/whoosh-motion-405445.mp3');
                sendAudioRef.current.load();

                // CONNECTION SOUND - Add this
    connectionAudioRef.current = new Audio('/effect-for-logo-intro-186595.mp3');
    connectionAudioRef.current.load();

                // Load auto-prioritize setting
                const savedAutoPrioritize = localStorage.getItem('autoPrioritize');
                if (savedAutoPrioritize === 'true') {
                    setAutoPrioritize(true);
                }

                // Load AI preferences
                const savedUseSignature = localStorage.getItem('useSignature');
                if (savedUseSignature === 'true') {
                    setUseSignature(true);
                }
                const savedShowQuickReplies = localStorage.getItem('showQuickReplies');
                if (savedShowQuickReplies === 'true') {
                    setShowQuickReplies(true);
                }
                const savedCheckGrammar = localStorage.getItem('checkGrammar');
                if (savedCheckGrammar === 'true') {
                    setCheckGrammar(true);
                }

                // Load deleted sent emails
                const savedDeletedSentEmails = localStorage.getItem('deletedSentEmails');
                if (savedDeletedSentEmails) {
                    try {
                        const deletedIds = JSON.parse(savedDeletedSentEmails);
                        setDeletedEmails(deletedIds);
                    } catch (e) {
                        console.error('Error loading deleted sent emails:', e);
                    }
                }

                // Load drafts
                const savedDrafts = localStorage.getItem('emailDrafts');
                if (savedDrafts) {
                    try {
                        const draftsData = JSON.parse(savedDrafts);
                        setDrafts(draftsData);
                    } catch (e) {
                        console.error('Error loading drafts:', e);
                    }
                }
            }, []);

            // Auto-hide undo delete button after 5 seconds
            useEffect(() => {
                if (showUndoDelete) {
                    const timer = setTimeout(() => {
                        setShowUndoDelete(false);
                        setDeletedEmail(null);
                    }, 5000);
                    return () => clearTimeout(timer);
                }
            }, [showUndoDelete]);

            // Auto-prioritize emails when inbox loads
useEffect(() => {
    if (autoPrioritize && emailConnected && inboxViewMode === 'received' && priorityEmails.length === 0) {
        const currentEmails = activeProvider === 'outlook' ? outlookEmails : gmailEmails;
        if (currentEmails.length > 0) {
            setTimeout(() => {
                handlePrioritizeEmails();
            }, 500);
        }
    }
}, [autoPrioritize, gmailEmails.length, outlookEmails.length, currentPage, inboxViewMode, activeProvider]);

            // Blur reveal effect for greeting messages - Word by Word
useEffect(() => {
    const greetings = [
        `How can I help you${userData ? ', ' + userData.name.split(' ')[0] : ''}?`,
        `Let's write some emails${userData ? ', ' + userData.name.split(' ')[0] : ''}!`,
        'Ready to craft the perfect message?',
        'What email magic shall we create today?',
        'Your AI email assistant is ready!',
        'Time to make your emails shine!',
        'Let\'s turn your thoughts into words!'
    ];

    const message = greetings[greetingIndex % greetings.length];

    // Set the greeting with word-by-word animation
    setGreetingAnimationClass('');
    setCurrentGreeting(message);

    // After 4 seconds, start word-by-word blur-out animation, then cycle to next
    const cycleTimer = setTimeout(() => {
        setGreetingAnimationClass('out');

        // After blur-out completes, show next greeting
        setTimeout(() => {
            setGreetingIndex((prev) => prev + 1);
        }, 600);
    }, 4000);

    return () => clearTimeout(cycleTimer);
}, [greetingIndex, userData]);

            // GOOD - checks which provider
useEffect(() => {
    if (outlookConnected) {
        const tokensString = localStorage.getItem('outlookTokens');
        if (tokensString) {
            const tokens = JSON.parse(tokensString);  //  Parse once
            fetchOutlookEmails(tokens.access_token);
            fetchOutlookSentEmails(tokens.access_token);
        }
    }
}, [outlookConnected]);

            // Click outside to close inbox search
            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (showInboxSearchSuggestions) {
                        const searchContainer = document.querySelector('.inbox-search-container');
                        if (searchContainer && !searchContainer.contains(event.target)) {
                            setShowInboxSearchSuggestions(false);
                        }
                    }
                };

                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, [showInboxSearchSuggestions]);

            // Grammar check for main email text (debounced)
            useEffect(() => {
                if (checkGrammar && emailText && emailText.trim().length > 0) {
                    // Clear previous timeout
                    if (grammarCheckTimeout) {
                        clearTimeout(grammarCheckTimeout);
                    }

                    // Set new timeout to check grammar after 4 seconds of no typing (reduced API calls)
                    const timeout = setTimeout(() => {
                        checkGrammarInText(emailText, false);
                    }, 4000);

                    setGrammarCheckTimeout(timeout);

                    // Cleanup
                    return () => clearTimeout(timeout);
                }
            }, [emailText, checkGrammar]);

            // Grammar check for reply text (debounced)
            useEffect(() => {
                if (checkGrammar && emailReply && emailReply.trim().length > 0) {
                    // Clear previous timeout
                    if (grammarCheckTimeout) {
                        clearTimeout(grammarCheckTimeout);
                    }

                    // Set new timeout to check grammar after 4 seconds of no typing (reduced API calls)
                    const timeout = setTimeout(() => {
                        checkGrammarInText(emailReply, true);
                    }, 4000);

                    setGrammarCheckTimeout(timeout);

                    // Cleanup
                    return () => clearTimeout(timeout);
                }
            }, [emailReply, checkGrammar]);

            // Check for version updates
            useEffect(() => {
                const lastSeenVersion = localStorage.getItem('lastSeenVersion');
                if (lastSeenVersion !== CURRENT_VERSION) {
                    // Delay showing modal slightly for smooth experience
                    setTimeout(() => {
                        setShowVersionModal(true);
                    }, 1000);
                }
            }, []);

            // Starter suggestions delay
            useEffect(() => {
                const timer = setTimeout(() => {
                    setShowStarterSuggestions(true);
                }, 600);
                return () => clearTimeout(timer);
            }, []);

            // Rotate starter suggestions every 3.5 seconds
            useEffect(() => {
                if (!showStarterSuggestions || emailText) return;

                const rotationTimer = setInterval(() => {
                    setCurrentSuggestionSet(prev => (prev + 1) % 3);
                }, 3500);

                return () => clearInterval(rotationTimer);
            }, [showStarterSuggestions, emailText]);

            // Populate result text when switching to results view
            useEffect(() => {
                if (activeView === 'results' && result && !isProcessing) {
                    setTimeout(() => {
                        const resultElement = document.getElementById('result-text');
                        if (resultElement && resultElement.innerHTML === '') {
                            animateText(result);
                        }
                    }, 100);
                }
            }, [activeView, result, isProcessing]);

            // Reset new email count when user views inbox
            useEffect(() => {
                if (currentPage === 'inbox' && newEmailCount > 0) {
                    const timer = setTimeout(() => {
                        setNewEmailCount(0);
                    }, 2000);
                    return () => clearTimeout(timer);
                }
            }, [currentPage, newEmailCount]);


            // Rotate welcome messages
            useEffect(() => {
                if (!showWelcomeAnimation) return;

                const interval = setInterval(() => {
                    setCurrentWelcomeMessage(prev => (prev + 1) % welcomeMessages.length);
                }, 3000);

                return () => clearInterval(interval);
            }, [showWelcomeAnimation]);

            // Hide welcome text when user starts typing
            useEffect(() => {
                if ((emailText.length > 0 || customPrompt.length > 0) && showWelcomeAnimation) {
                    setShowWelcomeAnimation(false);
                }
            }, [emailText, customPrompt]);

            // Helper Functions - PUT IT HERE
    const showNotification = (message) => {
        setNotificationMessage(message);
        setShowSuccessNotification(true);
        
        // Auto-hide after 3 seconds
        setTimeout(() => {
            setShowSuccessNotification(false);
        }, 3000);
    };

            // Play notification sound
            const playNotificationSound = () => {
                if (audioRef.current) {
                    audioRef.current.currentTime = 0;
                    audioRef.current.play().catch(e => console.log('Sound play failed:', e));
                }
            };

            // Play send sound
            const playSendSound = () => {
                if (sendAudioRef.current) {
                    sendAudioRef.current.currentTime = 0;
                    sendAudioRef.current.play().catch(e => console.log('Send sound failed:', e));
                }
            };

            const handleSendEmail = async () => {
    if (!emailReply || !viewingEmail) return;

    setIsSending(true);

    try {
        // Determine which provider this email is from
        const isOutlookEmail = activeProvider === 'outlook';
        
        console.log(' Sending email reply...');
        console.log('Provider:', isOutlookEmail ? 'Outlook' : 'Gmail');
        console.log('Viewing email:', viewingEmail);

        if (isOutlookEmail) {
            // Send via Outlook
            const savedTokens = localStorage.getItem('outlookTokens');
            if (!savedTokens) {
                alert(' Not connected to Outlook. Please connect your account in Settings.');
                setIsSending(false);
                return;
            }

            const tokens = JSON.parse(savedTokens);

            // Extract email address from "Name <email@domain.com>" format or use as-is
            const extractEmail = (fromString) => {
                const match = fromString.match(/<(.+?)>/);
                return match ? match[1] : fromString;
            };

            const recipientEmail = extractEmail(viewingEmail.from);
            const originalSubject = viewingEmail.subject;
            const replySubject = originalSubject.startsWith('Re:') ? originalSubject : `Re: ${originalSubject}`;

            console.log(' Sending Outlook reply to:', recipientEmail);
            console.log('Subject:', replySubject);

            const response = await fetch('/api/outlook-send', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    accessToken: tokens.access_token,
                    to: recipientEmail,
                    subject: replySubject,
                    body: emailReply,
                    messageId: viewingEmail.id
                })
            });

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.message || 'Failed to send email');
            }

            console.log(' Outlook email sent successfully!');
            
        } else {
            // Send via Gmail
            const savedTokens = localStorage.getItem('gmailTokens');
            if (!savedTokens) {
                alert(' Not connected to Gmail. Please connect your account in Settings.');
                setIsSending(false);
                return;
            }

            const tokens = JSON.parse(savedTokens);

            // Extract email address
            const extractEmail = (fromString) => {
                const match = fromString.match(/<(.+?)>/);
                return match ? match[1] : fromString;
            };

            const recipientEmail = extractEmail(viewingEmail.from);
            const originalSubject = viewingEmail.subject;
            const replySubject = originalSubject.startsWith('Re:') ? originalSubject : `Re: ${originalSubject}`;

            console.log(' Sending Gmail reply to:', recipientEmail);
            console.log('Subject:', replySubject);

            const response = await fetch('/api/gmail-send', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    accessToken: tokens.access_token,
                    to: recipientEmail,
                    subject: replySubject,
                    body: emailReply,
                    threadId: viewingEmail.threadId,
                    messageId: viewingEmail.id
                })
            });

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.message || 'Failed to send email');
            }

            console.log(' Gmail email sent successfully!');
        }

        // Trigger AI writing mode animation
        openAiWritingMode();

        // Success! Show animations
        setShowEnvelope(true);
        playSendSound();

        // Show success message
        setTimeout(() => {
            showNotification(' Reply sent successfully!');

            // Clear fields and close AI writing mode
            setEmailReply('');
            setReplyPrompt('');

            // Close AI writing mode after a brief moment to show success
            setTimeout(() => {
                closeAiWritingMode();
                setViewingEmail(null);
            }, 1000);

            setIsSending(false);

            // Remove envelope after animation
            setTimeout(() => {
                setShowEnvelope(false);
            }, 1500);
        }, 1000);

    } catch (error) {
        console.error(' Error sending email:', error);
        showNotification(' Failed to send email: ' + error.message);
        setIsSending(false);
    }
};

            const handleCloseVersionModal = () => {
                setShowVersionModal(false);
                localStorage.setItem('lastSeenVersion', CURRENT_VERSION);
            };

            const emailStyles = [
                { id: 'professional', label: ' Professional' },
                { id: 'friendly', label: ' Friendly' },
                { id: 'concise', label: ' Concise' },
                { id: 'persuasive', label: ' Persuasive' },
                { id: 'apologetic', label: ' Apologetic' },
                { id: 'enthusiastic', label: ' Enthusiastic' }
            ];

            const generalSuggestions = [
                { id: 'longer', label: 'Make Longer', prompt: 'Expand this email with more details and context' },
                { id: 'clearer', label: 'More Clear', prompt: 'Rewrite this email to be more clear and understandable' },
                { id: 'simpler', label: 'Simplify', prompt: 'Simplify this email to be easier to understand' },
                { id: 'formal', label: 'More Formal', prompt: 'Make this email more formal and professional' },
                { id: 'action', label: 'Add Action Items', prompt: 'Add clear action items and next steps to this email' },
                { id: 'polite', label: 'More Polite', prompt: 'Make this email more polite and courteous' }
            ];

            const welcomeMessages = [
                "Turn hours of emails into seconds",
                "Transform your inbox with AI",
                "Write better emails faster",
                "Your AI email assistant"
            ];

            const tools = [
                { id: 'email', icon: '', name: 'Email Rewriter', desc: 'Transform your emails instantly' },
                { id: 'summary', icon: '', name: 'Text Summarizer', desc: 'Condense long content' },
                { id: 'grammar', icon: '', name: 'Grammar Check', desc: 'Polish your writing' },
                { id: 'translate', icon: '', name: 'Translator', desc: 'Translate to any language' },
                { id: 'ideas', icon: '', name: 'Idea Generator', desc: 'Brainstorm creative ideas' },
                { id: 'tone', icon: '', name: 'Tone Analyzer', desc: 'Understand message sentiment' }
            ];

            // Show indicator when suggestions appear
            useEffect(() => {
                if (showSuggestions && currentPage === 'home') {
                    setShowIndicator(true);
                    const timer = setTimeout(() => {
                        setShowIndicator(false);
                    }, 5000); // 5 seconds
                    return () => clearTimeout(timer);
                }
            }, [showSuggestions, currentPage]);

            // Add mouse wheel scroll for carousel
            useEffect(() => {
                const carousel = carouselRef.current;
                if (!carousel || !showSuggestions) return;

                const handleWheel = (e) => {
                    if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
                        e.preventDefault();
                        if (e.deltaY > 0) {
                            // Scroll down = next suggestion
                            setCurrentSuggestionIndex((prev) =>
                                prev < generalSuggestions.length - 1 ? prev + 1 : 0
                            );
                        } else {
                            // Scroll up = previous suggestion
                            setCurrentSuggestionIndex((prev) =>
                                prev > 0 ? prev - 1 : generalSuggestions.length - 1
                            );
                        }
                    }
                };

                carousel.addEventListener('wheel', handleWheel, { passive: false });
                return () => carousel.removeEventListener('wheel', handleWheel);
            }, [showSuggestions]);

            // Swipe gesture for search on mobile
            useEffect(() => {
                const nav = navRef.current;
                if (!nav || currentPage !== 'inbox') return;

                const handleTouchStart = (e) => {
                    setTouchStartX(e.touches[0].clientX);
                };

                const handleTouchMove = (e) => {
                    setTouchEndX(e.touches[0].clientX);
                };

                const handleTouchEnd = () => {
                    const swipeDistance = touchStartX - touchEndX;
                    const threshold = 50;

                    if (Math.abs(swipeDistance) > threshold) {
                        if (swipeDistance > 0) {
                            // Swipe left - show search
                            setShowSearchBar(true);
                        } else {
                            // Swipe right - hide search
                            setShowSearchBar(false);
                            setSearchQuery('');
                            setSearchResults([]);
                        }
                    }
                };

                nav.addEventListener('touchstart', handleTouchStart);
                nav.addEventListener('touchmove', handleTouchMove);
                nav.addEventListener('touchend', handleTouchEnd);

                return () => {
                    nav.removeEventListener('touchstart', handleTouchStart);
                    nav.removeEventListener('touchmove', handleTouchMove);
                    nav.removeEventListener('touchend', handleTouchEnd);
                };
            }, [touchStartX, touchEndX, currentPage]);

            // Search emails
            useEffect(() => {
                if (searchQuery.length === 0) {
                    setSearchResults([]);
                    return;
                }

                const results = gmailEmails.filter(email =>
                    email.subject.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    email.from.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    email.snippet.toLowerCase().includes(searchQuery.toLowerCase())
                );

                setSearchResults(results.slice(0, 5)); // Show top 5 results
            }, [searchQuery, gmailEmails]);

            const handleGmailConnect = async () => {
    // Check if OAuth was completed and we're in "Finish setting up" state
    const gmailOAuthComplete = localStorage.getItem('gmail_oauth_complete');

    if (gmailOAuthComplete === 'true') {
        // Second click: User clicked "Finish setting up Gmail account" - show animation and play sound
        console.log(' Finalizing Gmail connection with animation...');

        // Show connection animation
        setConnectionProvider('gmail');
        setShowConnectionAnimation(true);

        // Wait 1 second for animation
        await new Promise(resolve => setTimeout(resolve, 1000));

        // PLAY AUDIO after animation
        if (connectionAudioRef.current) {
            console.log(' Playing connection sound...');
            const audio = connectionAudioRef.current;
            audio.volume = 0.5;
            audio.currentTime = 0;
            audio.play()
                .then(() => {
                    console.log(' Connection sound played successfully');
                })
                .catch((err) => {
                    console.log(' Audio play failed:', err);
                });
        }

        // Finalize the connection
        localStorage.setItem('emailConnected', 'true');
        localStorage.removeItem('gmail_oauth_complete');
        setEmailConnected(true);
        setPendingConnection(null);

        // Fetch emails if not already fetched
        const savedGmailTokens = localStorage.getItem('gmailTokens');
        if (savedGmailTokens) {
            try {
                const tokens = JSON.parse(savedGmailTokens);
                fetchGmailEmails(tokens.access_token);
                fetchSentEmails(tokens.access_token);
            } catch (error) {
                console.error(' Error fetching Gmail emails:', error);
            }
        }

        // Hide animation after 4 seconds
        setTimeout(() => {
            setShowConnectionAnimation(false);
            showNotification(' Gmail connected successfully!');
        }, 4000);

        return;
    }

    // First click: Immediately initiate OAuth if logged in, otherwise show auth popup
    if (!isLoggedIn) {
        setPendingConnection('gmail');
        setShowAuthPopup(true);
        return;
    }

    // User is logged in, initiate OAuth immediately without animation/sound
    try {
        console.log(' Initiating Gmail OAuth...');

        const response = await fetch('/api/gmail-auth');

        if (!response.ok) {
            throw new Error('Failed to initiate OAuth');
        }

        const data = await response.json();
        console.log(' Redirecting to Google OAuth...');

        localStorage.setItem('oauth_in_progress', 'gmail');
        window.location.href = data.authUrl;
    } catch (error) {
        console.error(' Gmail OAuth error:', error);
        showNotification(' Failed to connect Gmail');
    }
};

           const handleOutlookConnect = async () => {
    // Check if OAuth was completed and we're in "Finish setting up" state
    const outlookOAuthComplete = localStorage.getItem('outlook_oauth_complete');

    if (outlookOAuthComplete === 'true') {
        // Second click: User clicked "Finish setting up Outlook account" - show animation and play sound
        console.log(' Finalizing Outlook connection with animation...');

        // Show connection animation
        setConnectionProvider('outlook');
        setShowConnectionAnimation(true);

        // Wait 1 second for animation
        await new Promise(resolve => setTimeout(resolve, 1000));

        // PLAY AUDIO after animation
        if (connectionAudioRef.current) {
            console.log(' Playing connection sound...');
            const audio = connectionAudioRef.current;
            audio.volume = 0.5;
            audio.currentTime = 0;
            audio.play()
                .then(() => {
                    console.log(' Connection sound played successfully');
                })
                .catch((err) => {
                    console.log(' Audio play failed:', err);
                });
        }

        // Finalize the connection
        localStorage.setItem('outlookConnected', 'true');
        localStorage.removeItem('outlook_oauth_complete');
        setOutlookConnected(true);
        setActiveProvider('outlook');
        setPendingConnection(null);

        // Fetch emails if not already fetched
        const savedOutlookTokens = localStorage.getItem('outlookTokens');
        if (savedOutlookTokens) {
            try {
                const tokens = JSON.parse(savedOutlookTokens);
                fetchOutlookEmails(tokens.access_token);
                fetchOutlookSentEmails(tokens.access_token);
            } catch (error) {
                console.error(' Error fetching Outlook emails:', error);
            }
        }

        // Hide animation after 4 seconds
        setTimeout(() => {
            setShowConnectionAnimation(false);
            showNotification(' Outlook connected successfully!');
        }, 4000);

        return;
    }

    // First click: Immediately initiate OAuth if logged in, otherwise show auth popup
    if (!isLoggedIn) {
        setPendingConnection('outlook');
        setShowAuthPopup(true);
        return;
    }

    // User is logged in, initiate OAuth immediately without animation/sound
    try {
        console.log(' Initiating Outlook OAuth...');

        const response = await fetch('/api/outlook-auth');

        if (!response.ok) {
            const errorText = await response.text();
            console.error(' Auth endpoint failed:', response.status, errorText);
            throw new Error('Failed to get auth URL: ' + response.status);
        }

        const data = await response.json();
        console.log(' Auth response:', data);

        if (!data.success || !data.authUrl) {
            throw new Error('Invalid response from auth endpoint');
        }

        console.log(' Redirect URI generated:', data.redirectUri);
        console.log(' Redirecting to Microsoft OAuth...');

        // NO CONFIRM DIALOG - Direct redirect
        localStorage.setItem('oauth_in_progress', 'outlook');
        window.location.href = data.authUrl;
    } catch (error) {
        console.error(' Outlook OAuth error:', error);
        showNotification(' Failed to connect Outlook');
    }
};
            const isTokenExpired = (expiryDate) => {
                if (!expiryDate) return true;
                // Add 5 minute buffer before actual expiry
                return Date.now() >= (expiryDate - 300000);
            };

            const refreshAccessToken = async () => {
                try {
                    const savedTokens = localStorage.getItem('gmailTokens');
                    if (!savedTokens) {
                        throw new Error('No tokens found');
                    }

                    const tokens = JSON.parse(savedTokens);
                    if (!tokens.refresh_token) {
                        throw new Error('No refresh token available');
                    }

                    console.log(' Refreshing access token...');

                    const response = await fetch('/api/gmail-refresh', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ refreshToken: tokens.refresh_token })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'Failed to refresh token');
                    }

                    const data = await response.json();
                    console.log(' Access token refreshed successfully');

                    // Update tokens in localStorage (keep refresh_token)
                    const updatedTokens = {
                        ...tokens,
                        access_token: data.access_token,
                        expiry_date: data.expiry_date
                    };
                    localStorage.setItem('gmailTokens', JSON.stringify(updatedTokens));

                    return data.access_token;
                } catch (error) {
                    console.error(' Token refresh failed:', error);
                    // Clear tokens and force re-authentication
                    localStorage.removeItem('gmailTokens');
                    localStorage.removeItem('emailConnected');
                    localStorage.removeItem('userEmail');
                    setEmailConnected(false);
                    setUserEmail('');
                    alert('Your session has expired. Please reconnect your Gmail account.');
                    throw error;
                }
            };

            // Helper function to extract email body from Gmail payload
            const extractEmailBody = (payload) => {
                let body = '';

                // Function to decode base64url encoded data
                const decodeBase64 = (data) => {
                    if (!data) return '';
                    try {
                        // Replace URL-safe characters
                        const base64 = data.replace(/-/g, '+').replace(/_/g, '/');
                        // Decode base64 to UTF-8
                        return decodeURIComponent(escape(atob(base64)));
                    } catch (e) {
                        console.warn('Error decoding base64:', e);
                        return '';
                    }
                };

                // Function to extract text from parts recursively
                const extractFromParts = (parts) => {
                    if (!parts || !Array.isArray(parts)) return '';

                    let text = '';
                    for (const part of parts) {
                        // If part has nested parts, recurse
                        if (part.parts) {
                            text += extractFromParts(part.parts);
                        }
                        // Extract text/plain or text/html
                        else if (part.body && part.body.data) {
                            if (part.mimeType === 'text/plain') {
                                text += decodeBase64(part.body.data);
                            } else if (part.mimeType === 'text/html' && !text) {
                                // Use HTML as fallback if no plain text
                                const html = decodeBase64(part.body.data);
                                // Strip HTML tags for plain text
                                text += html.replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ').trim();
                            }
                        }
                    }
                    return text;
                };

                // Check if email has parts (multipart)
                if (payload.parts) {
                    body = extractFromParts(payload.parts);
                }
                // Simple email with body directly in payload
                else if (payload.body && payload.body.data) {
                    body = decodeBase64(payload.body.data);
                }

                return body || 'No content available';
            };

            const fetchGmailEmails = async (accessToken, isRetry = false) => {
                try {
                    console.log(' Fetching Gmail inbox...');

                    // Check if token is expired before making request
                    const savedTokens = localStorage.getItem('gmailTokens');
                    if (savedTokens && !isRetry) {
                        const tokens = JSON.parse(savedTokens);
                        if (isTokenExpired(tokens.expiry_date)) {
                            console.log(' Token expired, refreshing...');
                            const newAccessToken = await refreshAccessToken();
                            return fetchGmailEmails(newAccessToken, true);
                        }
                    }

                    const response = await fetch('/api/gmail-inbox', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ accessToken })
                    });

                    const data = await response.json();

                    // Handle authentication errors by refreshing token
                    if (!response.ok) {
                        if ((response.status === 401 || response.status === 403) && !isRetry) {
                            console.log(' Authentication failed, refreshing token...');
                            const newAccessToken = await refreshAccessToken();
                            return fetchGmailEmails(newAccessToken, true);
                        }

                        console.error(' API Error Response:', data);
                        console.error('Error message:', data.message);
                        console.error('Error details:', data.details);
                        throw new Error(data.message || 'Failed to fetch emails');
                    }

                    // Transform Gmail API response to our format
                    const formattedEmails = data.emails.map(email => {
                        const headers = email.payload.headers;
                        const from = headers.find(h => h.name === 'From')?.value || 'Unknown';
                        const subject = headers.find(h => h.name === 'Subject')?.value || 'No Subject';
                        const date = headers.find(h => h.name === 'Date')?.value || '';
                        const messageId = headers.find(h => h.name === 'Message-ID')?.value || '';

                        // Extract full email body
                        const body = extractEmailBody(email.payload);

                        return {
                            id: email.id,
                            from: from,
                            subject: subject,
                            snippet: email.snippet,
                            body: body, // Full email body content
                            date: new Date(parseInt(email.internalDate)).toLocaleString(),
                            internalDate: email.internalDate,
                            threadId: email.threadId,
                            messageId: messageId
                        };
                    });

                    // Detect new emails and filter out deleted ones
                    setGmailEmails(prevEmails => {
                        // Filter out deleted emails (permanently deleted unless undone)
                        const filteredEmails = formattedEmails.filter(e => !deletedEmails.includes(e.id));

                        const prevEmailIds = new Set(prevEmails.map(e => e.id));
                        const newEmails = filteredEmails.filter(e => !prevEmailIds.has(e.id));

                        if (newEmails.length > 0 && prevEmails.length > 0) {
                            console.log(` ${newEmails.length} new email(s) detected!`);
                            setNewEmailCount(prev => prev + newEmails.length);
                            setUnreadEmails(prev => {
                                const updated = new Set(prev);
                                newEmails.forEach(e => updated.add(e.id));
                                return updated;
                            });

                            // Trigger inbox button expansion animation
                            setShowInboxExpand(true);
                            setTimeout(() => {
                                setShowInboxExpand(false);
                            }, 3000);

                            // Play notification sound
                            playNotificationSound();
                        }

                        return filteredEmails;
                    });
                    console.log(` Loaded ${formattedEmails.length} emails from inbox`);
                } catch (error) {
                    console.error(' Error fetching emails:', error);
                    console.error('Full error object:', error);
                }
            };

            const fetchSentEmails = async (accessToken, isRetry = false) => {
                try {
                    console.log(' Fetching sent emails...');

                    // Check if token is expired before making request
                    const savedTokens = localStorage.getItem('gmailTokens');
                    if (savedTokens && !isRetry) {
                        const tokens = JSON.parse(savedTokens);
                        if (isTokenExpired(tokens.expiry_date)) {
                            console.log(' Token expired, refreshing...');
                            const newAccessToken = await refreshAccessToken();
                            return fetchSentEmails(newAccessToken, true);
                        }
                    }

                    const response = await fetch('/api/gmail-sent', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ accessToken })
                    });

                    const data = await response.json();

                    // Handle authentication errors by refreshing token
                    if (!response.ok) {
                        if ((response.status === 401 || response.status === 403) && !isRetry) {
                            console.log(' Authentication failed, refreshing token...');
                            const newAccessToken = await refreshAccessToken();
                            return fetchSentEmails(newAccessToken, true);
                        }

                        console.error(' API Error Response:', data);
                        console.error('Error message:', data.message);
                        console.error('Error details:', data.details);
                        throw new Error(data.message || 'Failed to fetch sent emails');
                    }

                    // Transform Gmail API response to our format
                    const formattedEmails = data.emails.map(email => {
                        const headers = email.payload.headers;
                        const to = headers.find(h => h.name === 'To')?.value || 'Unknown';
                        const subject = headers.find(h => h.name === 'Subject')?.value || 'No Subject';
                        const date = headers.find(h => h.name === 'Date')?.value || '';

                        // Extract full email body
                        const body = extractEmailBody(email.payload);

                        return {
                            id: email.id,
                            to: to,
                            subject: subject,
                            snippet: email.snippet,
                            body: body, // Full email body content
                            date: new Date(parseInt(email.internalDate)).toLocaleString()
                        };
                    });

                    setSentEmails(formattedEmails);
                    console.log(` Loaded ${formattedEmails.length} sent emails`);
                } catch (error) {
                    console.error(' Error fetching sent emails:', error);
                    console.error('Full error object:', error);
                }
            };

const fetchOutlookEmails = async (accessToken) => {
    try {
        console.log(' ========== FETCHING OUTLOOK EMAILS ==========');
        console.log(' Access token present:', !!accessToken);
        console.log(' Access token preview:', accessToken ? accessToken.substring(0, 20) + '...' : 'MISSING');

        const response = await fetch('/api/outlook-inbox', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ accessToken })
        });

        console.log(' Outlook inbox API response status:', response.status);
        console.log(' Response OK:', response.ok);

        const data = await response.json();

        console.log(' Outlook API response data:', data);

        if (!response.ok) {
            console.error(' Outlook inbox API error');
            console.error('Status:', response.status);
            console.error('Error message:', data.message);
            console.error('Error details:', data.details);

            // Handle 401 authentication errors
            if (response.status === 401) {
                console.warn(' Authentication failed - clearing Outlook tokens');
                localStorage.removeItem('outlookTokens');
                localStorage.removeItem('outlookConnected');
                setOutlookConnected(false);
                setOutlookEmails([]);
                showNotification(' Outlook session expired. Please reconnect.');
                return;
            }

            throw new Error(data.message || 'Failed to fetch Outlook emails');
        }
        
        console.log(' Outlook emails received:', data.emails?.length || 0);
        
        if (data.emails && data.emails.length > 0) {
            console.log(' First email sample:', data.emails[0]);
        }
        
        // Format emails for display
        const formattedEmails = data.emails.map(function(email) {
            const formatted = {
                id: email.id,
                from: email.from,
                subject: email.subject,
                snippet: email.snippet,
                date: email.date,
                threadId: email.threadId,
                internalDate: new Date(email.date).getTime()
            };
            console.log(' Formatted email:', formatted);
            return formatted;
        });
        
        console.log(' Total formatted emails:', formattedEmails.length);
        console.log(' Formatted emails array:', formattedEmails);
        
        setOutlookEmails(formattedEmails);
        
        console.log(' ========== OUTLOOK EMAILS SET IN STATE ==========');
        console.log('State should now have', formattedEmails.length, 'Outlook emails');
        
    } catch (error) {
        console.error(' ========== ERROR FETCHING OUTLOOK EMAILS ==========');
        console.error('Error message:', error.message);
        console.error('Error stack:', error.stack);
        console.error('Full error:', error);
    }
};

const fetchOutlookSentEmails = async (accessToken) => {
    try {
        console.log(' ========== FETCHING OUTLOOK SENT EMAILS ==========');
        console.log(' Access token present:', !!accessToken);

        // Use Microsoft Graph API directly to fetch sent emails
        const response = await fetch('https://graph.microsoft.com/v1.0/me/mailFolders/SentItems/messages?$top=20&$select=id,subject,body,bodyPreview,toRecipients,sentDateTime,conversationId', {
            headers: {
                'Authorization': `Bearer ${accessToken}`,
                'Content-Type': 'application/json'
            }
        });

        console.log(' Outlook sent API response status:', response.status);

        if (!response.ok) {
            // Handle 401 authentication errors
            if (response.status === 401) {
                console.warn(' Authentication failed - clearing Outlook tokens');
                localStorage.removeItem('outlookTokens');
                localStorage.removeItem('outlookConnected');
                setOutlookConnected(false);
                setOutlookSentEmails([]);
                showNotification(' Outlook session expired. Please reconnect.');
                return;
            }

            console.warn(' Could not fetch Outlook sent emails');
            setOutlookSentEmails([]);
            return;
        }

        const data = await response.json();
        const emails = data.value || [];

        console.log(' Outlook sent emails received:', emails.length);

        // Format emails for display
        const formattedEmails = emails.map(function(email) {
            const toRecipients = email.toRecipients || [];
            const toAddress = toRecipients.length > 0
                ? (toRecipients[0].emailAddress?.address || toRecipients[0].emailAddress?.name || 'Unknown')
                : 'Unknown';

            // Extract body content (prefer text, fallback to HTML with tags stripped)
            let bodyContent = '';
            if (email.body) {
                if (email.body.contentType === 'text') {
                    bodyContent = email.body.content || '';
                } else if (email.body.contentType === 'html') {
                    // Strip HTML tags for plain text
                    bodyContent = (email.body.content || '').replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ').trim();
                }
            }

            return {
                id: email.id,
                to: toAddress,
                subject: email.subject || '(No subject)',
                snippet: email.bodyPreview || '',
                body: bodyContent || email.bodyPreview || 'No content available', // Full email body
                date: new Date(email.sentDateTime).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                threadId: email.conversationId,
                internalDate: new Date(email.sentDateTime).getTime()
            };
        });

        console.log(' Total formatted sent emails:', formattedEmails.length);
        setOutlookSentEmails(formattedEmails);
        console.log(' ========== OUTLOOK SENT EMAILS SET IN STATE ==========');

    } catch (error) {
        console.error(' ========== ERROR FETCHING OUTLOOK SENT EMAILS ==========');
        console.error('Error message:', error.message);
        console.error('Full error:', error);
        // Set empty array on error
        setOutlookSentEmails([]);
    }
};

            const callAIAPI = async (prompt, text) => {
                console.log(' Calling AI API...');
                console.log(' Prompt:', prompt);
                console.log(' Text length:', text.length, 'characters');

                try {
                    const response = await fetch('/api/transform', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            prompt: prompt,
                            text: text,
                            model: selectedModel
                        })
                    });

                    console.log(' API Response status:', response.status);

                    if (!response.ok) {
                        const contentType = response.headers.get('content-type');
                        let errorMessage = 'API request failed';

                        if (contentType && contentType.includes('application/json')) {
                            const errorData = await response.json();
                            errorMessage = errorData.error || errorMessage;
                        } else {
                            const errorText = await response.text();
                            console.error(' Non-JSON response:', errorText.substring(0, 200));
                            errorMessage = 'Server error: API endpoint not available. Make sure you\'ve deployed to Vercel.';
                        }

                        throw new Error(errorMessage);
                    }

                    const data = await response.json();
                    console.log(' AI Response received, length:', data.result?.length || 0);
                    return data.result;
                } catch (error) {
                    console.error(' API Error:', error.message);
                    throw error;
                }
            };

            const animateText = (text) => {
                const resultElement = document.getElementById('result-text');
                if (!resultElement) return;

                resultElement.innerHTML = '';
                const lines = text.split('\n');
                let globalWordIndex = 0;

                // Smooth sequential typing reveal with blur effect
                lines.forEach((line, lineIndex) => {
                    const words = line.split(' ');
                    words.forEach((word, wordIndex) => {
                        const wordSpan = document.createElement('span');
                        wordSpan.className = 'wave-char';
                        wordSpan.textContent = word;
                        // Sequential typing effect with smooth staggering
                        const typingDelay = globalWordIndex * 0.045;
                        wordSpan.style.animationDelay = `${typingDelay}s`;
                        resultElement.appendChild(wordSpan);
                        globalWordIndex++;

                        // Add space after word (except last word)
                        if (wordIndex < words.length - 1) {
                            const space = document.createTextNode(' ');
                            resultElement.appendChild(space);
                        }
                    });

                    // Add line break (except after last line)
                    if (lineIndex < lines.length - 1) {
                        const br = document.createElement('br');
                        resultElement.appendChild(br);
                    }
                });
            };

            // Grammar check function
            const checkGrammarInText = async (text, isReplyText = false) => {
                if (!checkGrammar || !text || text.trim().length === 0 || isCheckingGrammar) return;

                // Only check if text is long enough (at least 10 characters)
                if (text.trim().length < 10) return;

                // Limit text length to avoid rate limiting (max 500 characters)
                const textToCheck = text.trim().length > 500 ? text.trim().substring(0, 500) : text.trim();

                setIsCheckingGrammar(true);
                try {
                    const response = await fetch('/api/transform', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            prompt: 'Check this text for grammar errors and return ONLY the corrected version without any explanations or additional text. If there are no errors, return the text unchanged.',
                            text: textToCheck,
                            temperature: 0.3,
                            model: selectedModel
                        })
                    });

                    // Handle rate limiting
                    if (response.status === 429) {
                        console.log(' Rate limit reached, skipping grammar check');
                        setIsCheckingGrammar(false);
                        return;
                    }

                    if (!response.ok) {
                        console.error(' Grammar check failed:', response.status);
                        setIsCheckingGrammar(false);
                        return;
                    }

                    const data = await response.json();
                    const correctedText = data.result?.trim();

                    if (correctedText && correctedText !== textToCheck) {
                        // If we only checked first 500 chars, append the rest of the original text
                        const finalCorrectedText = text.trim().length > 500
                            ? correctedText + text.trim().substring(500)
                            : correctedText;

                        // Auto-correct the text
                        if (isReplyText) {
                            setEmailReply(finalCorrectedText);
                        } else {
                            setEmailText(finalCorrectedText);
                        }
                        showNotification(' Grammar corrected!');
                        // Note: playNotificationSound() disabled - notification sound not set
                    }

                    setIsCheckingGrammar(false);
                } catch (error) {
                    console.error(' Grammar check error:', error);
                    setIsCheckingGrammar(false);
                }
            };

            const handleStyleClick = (style) => {
                // Just set the selected tone, don't generate yet
                setSelectedTone(style);
                console.log(' Tone selected:', style);
            };

            const handleGenerate = async (useModal = false) => {
                // Ensure we have text to process
                const textToProcess = uploadedFile?.content || emailText;
                if (!textToProcess || textToProcess.trim().length === 0) {
                    alert('Please enter some text or upload a file before generating!');
                    return;
                }

                if (!selectedTone && !customPrompt) {
                    alert('Please enter a prompt or select a tone before generating!');
                    return;
                }

                // Build the prompt
                let prompt = customPrompt;

                if (selectedTone && !customPrompt) {
                    switch(selectedTone) {
                        case 'professional':
                            prompt = 'Rewrite this email in a professional, formal business tone';
                            break;
                        case 'friendly':
                            prompt = 'Rewrite this email in a warm, friendly, and approachable tone';
                            break;
                        case 'concise':
                            prompt = 'Rewrite this email to be brief and to the point';
                            break;
                        case 'persuasive':
                            prompt = 'Rewrite this email to be compelling and convincing';
                            break;
                        case 'apologetic':
                            prompt = 'Rewrite this email with a sincere and apologetic tone';
                            break;
                        case 'enthusiastic':
                            prompt = 'Rewrite this email with an energetic and enthusiastic tone';
                            break;
                        default:
                            prompt = 'Improve this email';
                    }
                } else if (selectedTone && customPrompt) {
                    // Combine tone with custom prompt
                    const toneLabel = emailStyles.find(s => s.id === selectedTone)?.label || '';
                    prompt = `${customPrompt} in a ${toneLabel} tone`;
                }

                // Add language instruction to the prompt
                const languageMap = {
                    'english': 'English',
                    'german': 'German',
                    'french': 'French',
                    'georgian': 'Georgian',
                    'spanish': 'Spanish'
                };
                const targetLanguage = languageMap[selectedLanguage] || 'English';
                if (selectedLanguage !== 'english') {
                    prompt = `${prompt}. IMPORTANT: Respond in ${targetLanguage} language.`;
                }

                // Add signature instructions based on preference
                if (useSignature) {
                    const userFirstName = userData?.name?.split(' ')[0] || userName || 'there';
                    prompt = `${prompt}. Sign the email with "Best regards,\n${userFirstName}".`;
                } else {
                    prompt = `${prompt}. End with placeholders like "Best regards,\n[Your name]".`;
                }

                // Use the AI Generation Modal for enhanced visual experience
                // Always use centered animation when custom prompt is provided
                if (useModal || customPrompt) {
                    handleAiGeneration(prompt, textToProcess);
                    return;
                }

                // Standard processing without modal
                setIsProcessing(true);
                setResult('');
                setActiveView('results');

                try {
                    const transformedText = await callAIAPI(prompt, uploadedFile?.content || emailText);
                    setResult(transformedText);

                    // Save to history
                    const newResult = {
                        id: Date.now(),
                        content: transformedText,
                        prompt: prompt,
                        originalText: uploadedFile?.content || emailText,
                        timestamp: new Date().toLocaleString(),
                        tone: selectedTone
                    };
                    setSavedResults(prev => [newResult, ...prev]);

                    setIsProcessing(false);
                    setTimeout(() => animateText(transformedText), 100);
                } catch (error) {
                    console.error('API Error:', error);
                    setResult(`Error: ${error.message}\n\nPlease check that:\n1. Your MISTRAL_API_KEY is set in Vercel\n2. Your API key is valid\n3. You have sufficient credits`);
                    setIsProcessing(false);
                }
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    const content = event.target.result;
                    setUploadedFile({
                        name: file.name,
                        content: content,
                        size: file.size
                    });
                    setEmailText(''); // Clear textarea when file is uploaded
                    console.log(' File uploaded:', file.name);
                };
                reader.readAsText(file);
            };

            const handleDeleteResult = (id) => {
                setSavedResults(prev => prev.filter(r => r.id !== id));
                console.log(' Deleted result:', id);
            };

            const handleRetry = async () => {
                if (!savedResults.length) return;

                const lastResult = savedResults[0];
                console.log(' Retrying with prompt:', lastResult.prompt);

                setIsProcessing(true);
                setResult('');

                try {
                    const transformedText = await callAIAPI(lastResult.prompt, lastResult.originalText);
                    setResult(transformedText);

                    // Save new retry result
                    const newResult = {
                        id: Date.now(),
                        content: transformedText,
                        prompt: lastResult.prompt,
                        originalText: lastResult.originalText,
                        timestamp: new Date().toLocaleString(),
                        tone: lastResult.tone
                    };
                    setSavedResults(prev => [newResult, ...prev]);

                    setIsProcessing(false);
                    setTimeout(() => animateText(transformedText), 100);
                } catch (error) {
                    console.error('Retry Error:', error);
                    setResult(`Error: ${error.message}`);
                    setIsProcessing(false);
                }
            };

            const handleToolProcess = async () => {
                setIsProcessing(true);
                setResult('');
                setActiveView('results');
                
                let prompt = '';
                switch(activeTab) {
                    case 'summary':
                        prompt = 'Summarize this text concisely';
                        break;
                    case 'grammar':
                        prompt = 'Check and correct the grammar in this text';
                        break;
                    case 'translate':
                        prompt = 'Translate this text to Spanish';
                        break;
                    case 'ideas':
                        prompt = 'Generate creative ideas based on this text';
                        break;
                    case 'tone':
                        prompt = 'Analyze the tone and sentiment of this text';
                        break;
                }

                try {
                    const output = await callAIAPI(prompt, emailText);
                    setResult(output);
                    setIsProcessing(false);
                    setTimeout(() => animateText(output), 100);
                } catch (error) {
                    console.error('API Error:', error);
                    setResult(`Error: ${error.message}\n\nPlease check that:\n1. Your MISTRAL_API_KEY is set in Vercel\n2. Your API key is valid\n3. You have sufficient credits`);
                    setIsProcessing(false);
                }
            };

            const handleSummarizeEmail = async (email) => {
                console.log(' Summarizing email:', email.subject);
                setSummarizingEmail(email.id);
                setIsSummarizing(true);
                setSummaryText('');
                setSummaryHidden(false);

                try {
                    const summary = await callAIAPI('Summarize this email concisely in 2-3 sentences', email.snippet);
                    setSummaryText(summary);
                    setIsSummarizing(false);

                    // Animate summary text with wave effect
                    setTimeout(() => {
                        const summaryElement = document.getElementById(`summary-text-${email.id}`);
                        if (summaryElement) {
                            summaryElement.innerHTML = '';
                            const words = summary.split(' ');
                            words.forEach((word, index) => {
                                const wordSpan = document.createElement('span');
                                wordSpan.className = 'wave-char';
                                wordSpan.textContent = word;
                                wordSpan.style.animationDelay = `${index * 0.02}s`;
                                summaryElement.appendChild(wordSpan);

                                if (index < words.length - 1) {
                                    const space = document.createTextNode(' ');
                                    summaryElement.appendChild(space);
                                }
                            });
                        }
                    }, 50);
                } catch (error) {
                    console.error('Error summarizing:', error);
                    setSummaryText('Failed to summarize email');
                    setIsSummarizing(false);
                }
            };

            // AI Generation Handler - Now uses centered writer mode instead of popup modal
            const handleAiGeneration = async (prompt, emailContent) => {
                // Use the new centered writer mode
                // Not reply-only mode, so layout shift will happen
                setIsReplyOnlyMode(false);
                setCenteredWriterPrompt(prompt);
                setShowCenteredWriter(true);
                setIsCenteredGenerating(true);
                setCenteredWriterResult('');
                setAiSuggestions([]);

                const statusMessages = [
                    ' Analyzing your request',
                    ' Writing the email',
                    ' Polishing content',
                    ' Finalizing'
                ];

                let statusIndex = 0;
                setCenteredGenerationStatus(statusMessages[0]);

                // Cycle through status messages
                const statusInterval = setInterval(() => {
                    statusIndex = (statusIndex + 1) % statusMessages.length;
                    setCenteredGenerationStatus(statusMessages[statusIndex]);
                }, 1000);

                try {
                    const result = await callAIAPI(prompt, emailContent);

                    // Wait at least 3 seconds for nice animation
                    await new Promise(resolve => setTimeout(resolve, Math.max(0, 3000 - (statusIndex * 1000))));

                    clearInterval(statusInterval);
                    setIsCenteredGenerating(false);
                    setCenteredWriterResult(result);

                    // Generate suggestions based on the result
                    generateAiSuggestions(result, prompt);
                } catch (error) {
                    clearInterval(statusInterval);
                    console.error('AI Generation error:', error);
                    setIsCenteredGenerating(false);
                    setCenteredWriterResult('Failed to generate email. Please try again.');
                }
            };

            // Close centered writer and return to normal layout
            const closeCenteredWriter = () => {
                setShowCenteredWriter(false);
                setCenteredWriterPrompt('');
                setCenteredWriterResult('');
                setIsCenteredGenerating(false);
                setAiSuggestions([]);
                setIsReplyOnlyMode(false);
            };

            const handleCloseCenteredWriterWithPrompt = () => {
                // If there's generated content, show save draft modal
                if (centeredWriterResult && centeredWriterResult.trim()) {
                    setCurrentDraftToSave({
                        content: centeredWriterResult,
                        prompt: centeredWriterPrompt,
                        timestamp: Date.now(),
                        provider: activeProvider
                    });
                    setShowSaveDraftModal(true);
                } else {
                    // No content, just close
                    closeCenteredWriter();
                }
            };

            const saveDraft = () => {
                if (currentDraftToSave) {
                    const newDraft = {
                        ...currentDraftToSave,
                        id: Date.now()
                    };
                    const updatedDrafts = [newDraft, ...drafts];
                    setDrafts(updatedDrafts);
                    localStorage.setItem('emailDrafts', JSON.stringify(updatedDrafts));
                    showNotification('Draft saved!');
                }
                setShowSaveDraftModal(false);
                setCurrentDraftToSave(null);
                closeCenteredWriter();
            };

            const closeDraftWithoutSaving = () => {
                setShowSaveDraftModal(false);
                setCurrentDraftToSave(null);
                closeCenteredWriter();
            };

            const deleteDraft = (draftId) => {
                const updatedDrafts = drafts.filter(d => d.id !== draftId);
                setDrafts(updatedDrafts);
                localStorage.setItem('emailDrafts', JSON.stringify(updatedDrafts));
                showNotification('Draft deleted');
            };

            // Handle follow-up in centered writer mode
            const handleCenteredFollowup = async (followupPrompt) => {
                if (!followupPrompt.trim()) return;

                setIsCenteredGenerating(true);
                setAiFollowupPrompt('');

                const statusMessages = [
                    ' Analyzing your request',
                    ' Writing the email',
                    ' Polishing content',
                    ' Finalizing'
                ];

                let statusIndex = 0;
                setCenteredGenerationStatus(statusMessages[0]);

                const statusInterval = setInterval(() => {
                    statusIndex = (statusIndex + 1) % statusMessages.length;
                    setCenteredGenerationStatus(statusMessages[statusIndex]);
                }, 800);

                try {
                    const result = await callAIAPI(
                        `${followupPrompt}. Here is the current email: ${centeredWriterResult}`,
                        ''
                    );

                    await new Promise(resolve => setTimeout(resolve, 2000));

                    clearInterval(statusInterval);
                    setIsCenteredGenerating(false);
                    setCenteredWriterResult(result);
                    generateAiSuggestions(result, followupPrompt);
                } catch (error) {
                    clearInterval(statusInterval);
                    setIsCenteredGenerating(false);
                }
            };

            // Generate contextual suggestions based on email content
            const generateAiSuggestions = (emailResult, originalPrompt) => {
                const lowerContent = (emailResult || '').toLowerCase();
                const suggestions = [];

                // Context-aware suggestions
                if (lowerContent.includes('meeting') || lowerContent.includes('schedule')) {
                    suggestions.push('Add specific time options');
                    suggestions.push('Include calendar link');
                }
                if (lowerContent.includes('thank') || lowerContent.includes('appreciate')) {
                    suggestions.push('Make it more personal');
                    suggestions.push('Add specific details');
                }
                if (lowerContent.includes('request') || lowerContent.includes('please')) {
                    suggestions.push('Make it more urgent');
                    suggestions.push('Soften the tone');
                }
                if (lowerContent.includes('follow') || lowerContent.includes('update')) {
                    suggestions.push('Add deadline');
                    suggestions.push('Include action items');
                }

                // Default suggestions
                if (suggestions.length < 3) {
                    const defaultSuggestions = [
                        'Make it shorter',
                        'Make it more formal',
                        'Make it friendlier',
                        'Add a call to action',
                        'Improve clarity'
                    ];
                    for (const sug of defaultSuggestions) {
                        if (suggestions.length < 4 && !suggestions.includes(sug)) {
                            suggestions.push(sug);
                        }
                    }
                }

                setAiSuggestions(suggestions.slice(0, 4));
            };

            // Render text with wave animation - words appear one by one
            const renderWaveText = (text) => {
                if (!text) return null;

                // Split by newlines first to preserve line breaks
                const lines = text.split('\n');
                let wordIndex = 0;

                return lines.map((line, lineIndex) => (
                    <React.Fragment key={lineIndex}>
                        {line.split(/(\s+)/).map((part, partIndex) => {
                            if (part.match(/^\s+$/)) {
                                // Just whitespace, render as-is
                                return part;
                            }
                            if (part.length === 0) return null;
                            const currentWordIndex = wordIndex++;
                            return (
                                <span
                                    key={`${lineIndex}-${partIndex}`}
                                    className="ai-response-word"
                                    style={{ animationDelay: `${currentWordIndex * 0.02}s` }}
                                >
                                    {part}
                                </span>
                            );
                        })}
                        {lineIndex < lines.length - 1 && <br />}
                    </React.Fragment>
                ));
            };

            // Generate dynamic prompt suggestions based on email content and user typing
            const generatePromptSuggestions = (emailContent, userInput) => {
                // Expanded predefined suggestions
                const allPredefinedSuggestions = [
                    'Write a professional email',
                    'Send a thank you note',
                    'Follow up on meeting',
                    'Request information',
                    'Make it more formal',
                    'Make it friendlier',
                    'Shorten this email',
                    'Add more detail',
                    'Write a response',
                    'Schedule a meeting',
                    'Ask for feedback',
                    'Send a reminder',
                    'Write an introduction',
                    'Request a call',
                    'Confirm appointment'
                ];

                let suggestions = [];

                // If there's email content, generate AI-relevant suggestions (2 short ones)
                if (emailContent && emailContent.trim().length > 20) {
                    const lowerContent = emailContent.toLowerCase();

                    // Generate 2 AI-based contextual suggestions based on email content
                    if (lowerContent.includes('meeting') || lowerContent.includes('schedule') || lowerContent.includes('appointment')) {
                        suggestions.push('Confirm the meeting');
                        suggestions.push('Suggest new time');
                    } else if (lowerContent.includes('question') || lowerContent.includes('help') || lowerContent.includes('?')) {
                        suggestions.push('Answer politely');
                        suggestions.push('Ask for clarification');
                    } else if (lowerContent.includes('thank') || lowerContent.includes('appreciate')) {
                        suggestions.push('Reply with thanks');
                        suggestions.push('Send follow-up');
                    } else if (lowerContent.includes('urgent') || lowerContent.includes('asap') || lowerContent.includes('important')) {
                        suggestions.push('Respond urgently');
                        suggestions.push('Acknowledge receipt');
                    } else if (lowerContent.includes('proposal') || lowerContent.includes('offer') || lowerContent.includes('deal')) {
                        suggestions.push('Accept offer');
                        suggestions.push('Negotiate terms');
                    } else if (lowerContent.includes('problem') || lowerContent.includes('issue') || lowerContent.includes('error')) {
                        suggestions.push('Apologize politely');
                        suggestions.push('Offer solution');
                    } else {
                        // Default AI suggestions for generic content
                        suggestions.push('Reply professionally');
                        suggestions.push('Summarize and respond');
                    }
                }

                // Filter predefined suggestions based on user input
                if (userInput && userInput.trim().length > 0) {
                    const lowerInput = userInput.toLowerCase();
                    const filtered = allPredefinedSuggestions.filter(s =>
                        s.toLowerCase().includes(lowerInput)
                    );
                    suggestions = [...suggestions, ...filtered];
                } else {
                    // Add some predefined suggestions when no input
                    suggestions = [...suggestions, ...allPredefinedSuggestions.slice(0, 4)];
                }

                // Remove duplicates and limit to 6 suggestions
                const uniqueSuggestions = [...new Set(suggestions)].slice(0, 6);
                setFilteredSuggestions(uniqueSuggestions);

                // Show suggestions if we have any and user is typing or has email content
                const shouldShow = uniqueSuggestions.length > 0 && (userInput.length > 0 || emailContent.trim().length > 20);
                setShowPromptSuggestions(shouldShow && promptInputFocused);
            };

            // Handle follow-up prompt in AI generation modal
            const handleAiFollowup = async (followupPrompt) => {
                if (!followupPrompt.trim()) return;

                setIsAiGenerating(true);
                setAiFollowupPrompt('');

                const statusMessages = [
                    ' Analyzing your request',
                    ' Writing the email',
                    ' Polishing content',
                    ' Finalizing'
                ];

                let statusIndex = 0;
                setAiGenerationStatus(statusMessages[0]);

                const statusInterval = setInterval(() => {
                    statusIndex = (statusIndex + 1) % statusMessages.length;
                    setAiGenerationStatus(statusMessages[statusIndex]);
                }, 800);

                try {
                    const result = await callAIAPI(
                        `${followupPrompt}. Here is the current email: ${aiGenerationResult}`,
                        ''
                    );

                    await new Promise(resolve => setTimeout(resolve, 2000));

                    clearInterval(statusInterval);
                    setIsAiGenerating(false);
                    setAiGenerationResult(result);
                    generateAiSuggestions(result, followupPrompt);
                } catch (error) {
                    clearInterval(statusInterval);
                    setIsAiGenerating(false);
                }
            };

            // Modal Grammar Check with Wave Animation (Apple Intelligence style)
            const handleModalGrammarCheck = async () => {
                if (!aiGenerationResult || isModalGrammarChecking) return;

                setIsModalGrammarChecking(true);
                setModalGrammarWaveActive(true);
                setModalGrammarResult('');

                // Wave animation runs for 3 seconds
                const waveTimeout = setTimeout(() => {
                    setModalGrammarWaveActive(false);
                }, 3000);

                try {
                    const response = await fetch('/api/transform', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            prompt: 'Check this text for grammar and spelling errors. Return ONLY the corrected version without any explanations. If there are no errors, return exactly: NO_ERRORS_FOUND',
                            text: aiGenerationResult,
                            temperature: 0.3,
                            model: selectedModel
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Grammar check failed');
                    }

                    const data = await response.json();
                    const correctedText = data.result?.trim();

                    // Wait for wave animation to complete
                    await new Promise(resolve => setTimeout(resolve, 3000));

                    clearTimeout(waveTimeout);
                    setModalGrammarWaveActive(false);

                    if (correctedText === 'NO_ERRORS_FOUND' || correctedText === aiGenerationResult) {
                        setModalGrammarResult('No grammar errors found!');
                        showNotification(' No grammar errors found!');
                    } else {
                        setAiGenerationResult(correctedText);
                        setModalGrammarResult('Grammar corrected!');
                        showNotification(' Grammar corrected!');
                    }

                    setIsModalGrammarChecking(false);

                    // Clear result message after 3 seconds
                    setTimeout(() => setModalGrammarResult(''), 3000);
                } catch (error) {
                    console.error('Grammar check error:', error);
                    clearTimeout(waveTimeout);
                    setModalGrammarWaveActive(false);
                    setIsModalGrammarChecking(false);
                    setModalGrammarResult('Failed to check grammar');
                    setTimeout(() => setModalGrammarResult(''), 3000);
                }
            };

            // Handle suggestion click - fill prompt and remove from list
            const handleSuggestionClick = (suggestion, index) => {
                // Fill the followup prompt with the suggestion
                setAiFollowupPrompt(suggestion);

                // Animate removal
                setRemovingSuggestionIndex(index);

                // After animation, remove from list
                setTimeout(() => {
                    setAiSuggestions(prev => prev.filter((_, i) => i !== index));
                    setRemovedSuggestions(prev => [...prev, { suggestion, index }]);
                    setRemovingSuggestionIndex(null);
                }, 400);
            };

            // Handle suggestion removal (X button)
            const handleRemoveSuggestion = (e, suggestion, index) => {
                e.stopPropagation(); // Prevent suggestion click

                setRemovingSuggestionIndex(index);

                setTimeout(() => {
                    setAiSuggestions(prev => prev.filter((_, i) => i !== index));
                    setRemovedSuggestions(prev => [...prev, { suggestion, index }]);
                    setRemovingSuggestionIndex(null);
                }, 400);
            };

            // Restore removed suggestion
            const handleRestoreSuggestion = () => {
                if (removedSuggestions.length === 0) return;

                const lastRemoved = removedSuggestions[removedSuggestions.length - 1];

                // Add back to suggestions at original position
                setAiSuggestions(prev => {
                    const newList = [...prev];
                    newList.splice(lastRemoved.index, 0, lastRemoved.suggestion);
                    return newList;
                });

                // Remove from removed list
                setRemovedSuggestions(prev => prev.slice(0, -1));
            };

            // Handle View Full Email
            const handleViewFullEmail = (email) => {
                setViewEmailPopupData(email);
                setShowViewEmailPopup(true);
            };

            const handleDeleteEmail = (emailId, type = 'inbox') => {
                playNotificationSound();

                // Find the email being deleted
                let emailToDelete;
                if (type === 'inbox') {
                    emailToDelete = activeProvider === 'outlook'
                        ? outlookEmails.find(e => e.id === emailId)
                        : gmailEmails.find(e => e.id === emailId);
                } else {
                    emailToDelete = activeProvider === 'outlook'
                        ? outlookSentEmails.find(e => e.id === emailId)
                        : sentEmails.find(e => e.id === emailId);
                }

                // Store deleted email for undo
                setDeletedEmail({ email: emailToDelete, type });
                setShowUndoDelete(true);

                // Add to permanent deleted list
                setDeletedEmails(prev => {
                    const updated = [...prev, emailId];
                    // Persist deleted sent emails to localStorage
                    if (type === 'sent') {
                        const deletedSentIds = sentEmails
                            .filter(e => updated.includes(e.id))
                            .map(e => e.id);
                        localStorage.setItem('deletedSentEmails', JSON.stringify(deletedSentIds));
                    }
                    return updated;
                });

                // Set deleting animation
                setDeletingEmailId(emailId);

                // Delete with animation
                setTimeout(() => {
                    if (type === 'inbox') {
                        if (activeProvider === 'outlook') {
                            setOutlookEmails(prev => prev.filter(e => e.id !== emailId));
                        } else {
                            setGmailEmails(prev => prev.filter(e => e.id !== emailId));
                        }
                    } else {
                        if (activeProvider === 'outlook') {
                            setOutlookSentEmails(prev => prev.filter(e => e.id !== emailId));
                        } else {
                            setSentEmails(prev => prev.filter(e => e.id !== emailId));
                        }
                    }
                    setDeletingEmailId(null);
                    console.log(` Deleted ${type} email:`, emailId);
                }, 400); // Match animation duration
            };

            const handleUndoDelete = () => {
                if (deletedEmail) {
                    playNotificationSound();

                    // Remove from deleted emails list
                    setDeletedEmails(prev => {
                        const updated = prev.filter(id => id !== deletedEmail.email.id);
                        // Update localStorage for sent emails
                        if (deletedEmail.type === 'sent') {
                            localStorage.setItem('deletedSentEmails', JSON.stringify(updated.filter(id =>
                                sentEmails.some(e => e.id === id)
                            )));
                        }
                        return updated;
                    });

                    if (deletedEmail.type === 'inbox') {
                        setGmailEmails(prev => [deletedEmail.email, ...prev]);
                    } else {
                        setSentEmails(prev => [deletedEmail.email, ...prev]);
                    }
                    setShowUndoDelete(false);
                    setDeletedEmail(null);
                    console.log(' Undid delete');
                }
            };

            // Helper function to get first N words from text
            const getFirstWords = (text, wordCount = 10) => {
                if (!text) return '';
                const words = text.trim().split(/\s+/);
                if (words.length <= wordCount) return text;
                return words.slice(0, wordCount).join(' ') + '...';
            };

            const handleRefreshEmails = async () => {
                if (isRefreshing) return;

                setIsRefreshing(true);
                playNotificationSound();

                try {
                    const savedTokens = localStorage.getItem('gmailTokens');
                    if (savedTokens) {
                        const tokens = JSON.parse(savedTokens);
                        console.log(' Refreshing emails...');
                        await fetchGmailEmails(tokens.access_token);
                        await fetchSentEmails(tokens.access_token);
                        console.log(' Emails refreshed!');
                    }
                } catch (error) {
                    console.error(' Error refreshing emails:', error);
                } finally {
                    setTimeout(() => setIsRefreshing(false), 1000); // Keep spinning for smooth UX
                }
            };

            const handleDeleteSelected = (type = 'inbox') => {
                if (selectedEmails.length === 0) return;
                playNotificationSound();

                if (type === 'inbox') {
                    // Track deleted email IDs
                    setLocallyDeletedEmailIds(prev => {
                        const updated = new Set(prev);
                        selectedEmails.forEach(id => updated.add(id));
                        return updated;
                    });
                    setGmailEmails(prev => prev.filter(e => !selectedEmails.includes(e.id)));
                } else {
                    setSentEmails(prev => prev.filter(e => !selectedEmails.includes(e.id)));
                }
                setSelectedEmails([]);
                console.log(` Deleted ${selectedEmails.length} emails`);
            };

            const handleDeleteAll = (type = 'inbox') => {
                playNotificationSound();
                const confirmDelete = confirm(`Are you sure you want to delete all ${type} emails?`);
                if (confirmDelete) {
                    if (type === 'inbox') {
                        // Track all deleted email IDs
                        setLocallyDeletedEmailIds(prev => {
                            const updated = new Set(prev);
                            gmailEmails.forEach(e => updated.add(e.id));
                            return updated;
                        });
                        setGmailEmails([]);
                    } else {
                        setSentEmails([]);
                    }
                    console.log(` Deleted all ${type} emails`);
                }
            };

            const toggleEmailSelection = (emailId) => {
                setSelectedEmails(prev => {
                    if (prev.includes(emailId)) {
                        return prev.filter(id => id !== emailId);
                    } else {
                        return [...prev, emailId];
                    }
                });
            };

            const handlePrioritizeEmails = async () => {
                const currentEmails = activeProvider === 'outlook' ? outlookEmails : gmailEmails;
                if (currentEmails.length === 0) return;

                playNotificationSound();
                setIsPrioritizing(true);
                setEmailsPrioritized(false);

                try {
                    // Simple AI-based priority detection using keywords and patterns
                    const analyzePriority = (email) => {
                        let score = 0;
                        const subjectLower = email.subject.toLowerCase();
                        const snippetLower = email.snippet.toLowerCase();

                        // Urgent keywords
                        if (subjectLower.match(/urgent|asap|important|critical|emergency|priority/)) score += 10;
                        if (snippetLower.match(/urgent|asap|important|critical|emergency|priority/)) score += 5;

                        // Action required
                        if (subjectLower.match(/action required|respond|reply|feedback|review/)) score += 7;
                        if (snippetLower.match(/action required|respond|reply|feedback|review/)) score += 3;

                        // Time-sensitive
                        if (subjectLower.match(/today|tomorrow|deadline|due|meeting/)) score += 8;
                        if (snippetLower.match(/today|tomorrow|deadline|due|meeting/)) score += 4;

                        // Question marks (usually need response)
                        if (subjectLower.includes('?')) score += 5;

                        // Sender patterns
                        if (email.from.match(/boss|ceo|manager|director/i)) score += 6;

                        // Boost recent emails slightly
                        const emailDate = new Date(email.internalDate);
                        const hoursSinceReceived = (Date.now() - emailDate) / (1000 * 60 * 60);
                        if (hoursSinceReceived < 24) score += 2;

                        return score;
                    };

                    // Wait for wave animation
                    setTimeout(() => {
                        // Analyze and score all emails
                        const scoredEmails = currentEmails.map(email => ({
                            ...email,
                            priorityScore: analyzePriority(email)
                        }));

                        // Sort by priority score
                        scoredEmails.sort((a, b) => b.priorityScore - a.priorityScore);

                        // Determine how many emails to prioritize
                        let numToPrioritize;
                        if (currentEmails.length <= 2) {
                            numToPrioritize = 0;
                        } else if (currentEmails.length <= 5) {
                            numToPrioritize = Math.min(3, Math.floor(currentEmails.length * 0.6));
                        } else {
                            const priorityThreshold = 5;
                            const highScoreEmails = scoredEmails.filter(e => e.priorityScore >= priorityThreshold);
                            numToPrioritize = Math.min(5, Math.max(highScoreEmails.length, 3));
                        }

                        const priority = scoredEmails.slice(0, numToPrioritize);
                        const regular = scoredEmails.slice(numToPrioritize);

                        setPriorityEmails(priority);
                        
                        // Update the appropriate email list
                        if (activeProvider === 'outlook') {
                            setOutlookEmails([...priority, ...regular]);
                        } else {
                            setGmailEmails([...priority, ...regular]);
                        }

                        setIsPrioritizing(false);
                        setEmailsPrioritized(true);

                        // Trigger priority glow effect
                        if (priority.length > 0) {
                            setShowPriorityGlow(true);
                            setTimeout(() => setShowPriorityGlow(false), 2000);
                        }

                        // Reset prioritized flag after animation
                        setTimeout(() => setEmailsPrioritized(false), 2000);
                    }, 2000);

                } catch (error) {
                    console.error('Error prioritizing emails:', error);
                    setIsPrioritizing(false);
                }
            };

            // Generate AI draft for email reply
const generateAiDraft = async (email) => {
    // Check if email is from a noreply address
    const isNoReply = email.from.toLowerCase().includes('noreply') ||
                     email.from.toLowerCase().includes('no-reply') ||
                     email.from.toLowerCase().includes('no_reply');

    if (isNoReply) {
        console.log(' Email is from a noreply address, skipping AI draft generation');
        setHasDraft(false);
        return;
    }

    setIsGeneratingDraft(true);
    setHasDraft(false);
    playNotificationSound();

    try {
        // Extract sender name and user's name
        const senderName = extractSenderName(email.from);
        const userFirstName = userData?.name?.split(' ')[0] || userName || 'there';

        // Create the email context as text to transform
        const contextText = `I received an email from ${email.from} with subject "${email.subject}". The email says: ${email.snippet}`;

        // Use signature preference
        const greeting = useSignature ? `Hi ${senderName},` : `Hi [Recipient's name],`;
        const closing = useSignature ? `Best regards,\n${userFirstName}` : `Best regards,\n[Your name]`;

        const response = await fetch('/api/transform', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                prompt: `Write a professional and friendly email reply to this. Start with "${greeting}" and end with "${closing}". Address their main points in a warm, helpful tone.`,
                text: contextText,
                temperature: 0.7,
                model: selectedModel
            })
        });

        const data = await response.json();
        console.log(' Draft response:', data);

        if (data.result && data.result.trim().length > 0) {
            setAiDraft(data.result);
            setHasDraft(true);
            console.log(' AI draft generated successfully');
        } else {
            console.error(' No result in response');
            setHasDraft(false);
        }

        setIsGeneratingDraft(false);
    } catch (error) {
        console.error(' Error generating AI draft:', error);
        setIsGeneratingDraft(false);
        setHasDraft(false);
    }
};

            const handleRewriteReply = async () => {
    if (!emailReply || !replyPrompt) return;

    console.log(' Starting AI rewrite...');

    // Check if user wants email structure
    const needsStructure = replyPrompt.toLowerCase().includes('structure') ||
                         replyPrompt.toLowerCase().includes('format') ||
                         emailReply.match(/^(Hi|Hello|Hey|Dear)/i) === null;

    let finalPrompt = replyPrompt;
    if (needsStructure) {
        finalPrompt += ' Make sure to format it as a proper email with greeting, body, and closing.';
    }

    playNotificationSound();

    // IMPORTANT: Set these in correct order
    setIsReplyOnlyMode(true);
    setCenteredWriterPrompt(finalPrompt);
    setShowCenteredWriter(true);
    setIsCenteredGenerating(true);
    setCenteredWriterResult('');
    setAiSuggestions([]);
    setReplyPrompt('');

    console.log(' States set - should show generation UI now');
    console.log('  - showCenteredWriter:', true);
    console.log('  - isCenteredGenerating:', true);

    const statusMessages = [
        ' Analyzing your request',
        ' Writing the email',
        ' Polishing content',
        ' Finalizing'
    ];

    let statusIndex = 0;
    setCenteredGenerationStatus(statusMessages[0]);

    const statusInterval = setInterval(() => {
        statusIndex = (statusIndex + 1) % statusMessages.length;
        setCenteredGenerationStatus(statusMessages[statusIndex]);
        console.log(' Status update:', statusMessages[statusIndex]);
    }, 1000);

    try {
        console.log(' Calling AI API...');
        const response = await fetch('/api/transform', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                prompt: finalPrompt,
                text: emailReply,
                temperature: 0.7,
                model: selectedModel
            })
        });

        console.log(' API response received');
        const data = await response.json();

        // Wait at least 2 seconds for nice animation
        await new Promise(resolve => setTimeout(resolve, Math.max(0, 2000 - (statusIndex * 1000))));

        clearInterval(statusInterval);
        
        console.log(' Setting results...');
        setIsCenteredGenerating(false);

        if (data.result) {
            console.log(' Result length:', data.result.length);
            setCenteredWriterResult(data.result);
            // Generate suggestions based on the result
            generateAiSuggestions(data.result, finalPrompt);
            console.log(' Results and suggestions set');
        } else {
            console.error(' No result in API response');
            setCenteredWriterResult('Failed to generate email. Please try again.');
        }
    } catch (error) {
        clearInterval(statusInterval);
        console.error(' Error rewriting reply:', error);
        setIsCenteredGenerating(false);
        setCenteredWriterResult('Failed to generate email. Error: ' + error.message);
    }
};

            // Manual Grammar Check function
            const handleManualGrammarCheck = async (text, setText) => {
                if (!text || text.trim().length < 3) return;

                setIsManualGrammarChecking(true);
                setGrammarCheckResult(null);
                setShowGrammarNotification(false);

                try {
                    const response = await fetch('/api/transform', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            prompt: 'Check the grammar and spelling of this text. If there are errors, correct them and return ONLY the corrected text. If the text is already correct, return exactly "NO_ERRORS_FOUND". Do not add any explanations or extra text.',
                            text: text,
                            temperature: 0.3
                        })
                    });

                    const data = await response.json();

                    if (data.result) {
                        if (data.result.trim() === 'NO_ERRORS_FOUND' || data.result.trim().toLowerCase().includes('no errors') || data.result.trim() === text.trim()) {
                            // No grammar issues found
                            setGrammarCheckResult('success');
                            setShowGrammarNotification(true);
                        } else {
                            // Grammar was corrected
                            setGrammarCorrectedText(data.result);
                            setText(data.result);
                            setGrammarCheckResult('corrected');
                            setShowGrammarNotification(true);
                        }
                    }

                    // Hide notification after 3 seconds
                    setTimeout(() => {
                        setShowGrammarNotification(false);
                        setGrammarCheckResult(null);
                    }, 3000);

                } catch (error) {
                    console.error('Grammar check error:', error);
                }

                setIsManualGrammarChecking(false);
            };

            // Open AI Writing Mode (centered layout)
            const openAiWritingMode = () => {
                setAiWritingMode(true);
                setAiWritingModeClosing(false);
            };

            // Close AI Writing Mode with animation
            const closeAiWritingMode = () => {
                setAiWritingModeClosing(true);
                setTimeout(() => {
                    setAiWritingMode(false);
                    setAiWritingModeClosing(false);
                }, 600); // Match animation duration
            };

            const renderSettings = () => {
                return (
                    <div className="settings-panel space-y-8">
                        <div className="glass-effect rounded-3xl p-8 ai-glow">
                            <h2 className="text-3xl font-bold text-gray-800 mb-6"> Settings</h2>

                            {/* Account Details Section - Show when logged in */}
                            {isLoggedIn && userData && (
                                <div className="account-details-section-unified">
                                    {/* User Profile Header */}
                                    <div className="account-header">
                                        <div
                                            className={`account-profile-icon ${selectedProfileIcon ? 'with-texture ' + selectedProfileIcon : ''}`}
                                            style={{
                                                background: selectedProfileIcon ? undefined : selectedProfileColor,
                                                cursor: 'pointer',
                                                transition: 'all 0.3s ease'
                                            }}
                                            onClick={() => {
                                                setTempProfileColor(selectedProfileColor);
                                                setTempProfileIcon(selectedProfileIcon);
                                                setShowProfilePopup(true);
                                            }}
                                            onMouseEnter={(e) => {
                                                e.currentTarget.style.transform = 'scale(1.1)';
                                            }}
                                            onMouseLeave={(e) => {
                                                e.currentTarget.style.transform = 'scale(1)';
                                            }}
                                        >
                                            {userData.name.charAt(0).toUpperCase()}
                                        </div>
                                        <div className="account-info">
                                            <div className="account-name">{userData.name}</div>
                                            <div className="account-email">{userData.email}</div>
                                        </div>
                                        <button
                                            onClick={handleLogout}
                                            className="account-logout-btn"
                                        >
                                            Logout
                                        </button>
                                    </div>

                                    {/* Email Connection Buttons */}
                                    <div className="account-connections-unified">
                                        <div className="connection-label">Connected Email Accounts</div>
                                        <div className="connection-buttons-grid">
                                            {/* Gmail Connection Button */}
                                            {!emailConnected ? (
                                                <button
                                                    onClick={handleGmailConnect}
                                                    className="connection-btn-unified gmail-btn-unified"
                                                >
                                                    <svg className="connection-icon-unified" viewBox="0 0 24 24" fill="currentColor">
                                                        <path d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.73L12 16.64l-6.545-4.91v9.273H1.636A1.636 1.636 0 0 1 0 19.366V5.457c0-2.023 2.309-3.178 3.927-1.964L12 9.545l8.073-6.052C21.69 2.28 24 3.434 24 5.457z"/>
                                                    </svg>
                                                    <span className="connection-text">{pendingConnection === 'gmail' ? 'Finish setting up Gmail account' : 'Connect Gmail'}</span>
                                                </button>
                                            ) : (
                                                <div className="connection-btn-unified connected-unified gmail-connected-unified">
                                                    <div className="connection-status">
                                                        <svg className="connection-icon-unified" viewBox="0 0 24 24" fill="currentColor">
                                                            <path d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.73L12 16.64l-6.545-4.91v9.273H1.636A1.636 1.636 0 0 1 0 19.366V5.457c0-2.023 2.309-3.178 3.927-1.964L12 9.545l8.073-6.052C21.69 2.28 24 3.434 24 5.457z"/>
                                                        </svg>
                                                        <span className="connection-text">Gmail</span>
                                                    </div>
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            setEmailConnected(false);
                                                            localStorage.removeItem('emailConnected');
                                                            localStorage.removeItem('gmailTokens');
                                                            localStorage.removeItem('userEmail');
                                                            setGmailEmails([]);
                                                            setSentEmails([]);
                                                            setUserEmail('');
                                                        }}
                                                        className="disconnect-btn-unified"
                                                    >
                                                        Disconnect
                                                    </button>
                                                </div>
                                            )}

                                            {/* Outlook Connection Button */}
                                            {!outlookConnected ? (
                                                <button
                                                    onClick={handleOutlookConnect}
                                                    className="connection-btn-unified outlook-btn-unified"
                                                >
                                                    <svg className="connection-icon-unified" viewBox="0 0 24 24" fill="currentColor">
                                                        <path d="M23 7.5v9c0 .8-.7 1.5-1.5 1.5h-9L6 12l6.5-6h9c.8 0 1.5.7 1.5 1.5zM11 6L5 11h6l6-5z"/>
                                                        <path d="M1 8.5v7c0 .8.7 1.5 1.5 1.5h8L5 11 10.5 6h-8c-.8 0-1.5.7-1.5 1.5z" fill="currentColor"/>
                                                    </svg>
                                                    <span className="connection-text">{pendingConnection === 'outlook' ? 'Finish setting up Outlook account' : 'Connect Outlook'}</span>
                                                </button>
                                            ) : (
                                                <div className="connection-btn-unified connected-unified outlook-connected-unified">
                                                    <div className="connection-status">
                                                        <svg className="connection-icon-unified" viewBox="0 0 24 24" fill="currentColor">
                                                            <path d="M23 7.5v9c0 .8-.7 1.5-1.5 1.5h-9L6 12l6.5-6h9c.8 0 1.5.7 1.5 1.5zM11 6L5 11h6l6-5z"/>
                                                            <path d="M1 8.5v7c0 .8.7 1.5 1.5 1.5h8L5 11 10.5 6h-8c-.8 0-1.5.7-1.5 1.5z" fill="currentColor"/>
                                                        </svg>
                                                        <span className="connection-text">Outlook</span>
                                                    </div>
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            setOutlookConnected(false);
                                                            localStorage.removeItem('outlookConnected');
                                                            localStorage.removeItem('outlookTokens');
                                                            setOutlookEmails([]);
                                                        }}
                                                        className="disconnect-btn-unified"
                                                    >
                                                        Disconnect
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Authentication Section - Show when not logged in */}
                            {!isLoggedIn && (
                                <div className="space-y-6 mb-6">
                                    <div className="glass-dark px-6 py-5 rounded-2xl border-2 border-indigo-400">
                                        <h3 className="text-lg font-bold text-gray-800 mb-3">
                                            {authMode === 'signup' ? ' Create Account' : ' Log In'}
                                        </h3>
                                        <p className="text-sm text-gray-600 mb-4">
                                            {authMode === 'signup'
                                                ? 'Sign up to unlock premium features like email connections, AI transformations, and more!'
                                                : 'Welcome back! Log in to access your account.'}
                                        </p>

                                        {/* Error Message */}
                                        {authError && (
                                            <div className="mb-4 px-4 py-3 rounded-xl border-2 border-red-400 bg-red-50" style={{
                                                animation: 'shake 0.5s ease-in-out',
                                                background: darkMode ? 'rgba(220, 38, 38, 0.2)' : 'rgba(254, 226, 226, 1)'
                                            }}>
                                                <p className="text-sm font-semibold" style={{
                                                    color: darkMode ? '#fca5a5' : '#dc2626'
                                                }}>
                                                     {authError}
                                                </p>
                                            </div>
                                        )}

                                        {/* Loading State */}
                                        {isLoggingIn ? (
                                            <div className="text-center py-8">
                                                <div className="inline-block animate-spin rounded-full h-12 w-12 border-4 border-indigo-600 border-t-transparent mb-4"></div>
                                                <p className="text-sm font-semibold text-gray-700">Logging in...</p>
                                            </div>
                                        ) : (
                                            <div className="space-y-4">
                                                {/* Name field - only for signup */}
                                                {authMode === 'signup' && (
                                                    <div>
                                                        <input
                                                            type="text"
                                                            id="auth-name"
                                                            placeholder="Your Name"
                                                            className="w-full px-4 py-3 rounded-xl border-2 border-gray-300 text-gray-800 outline-none focus:border-indigo-500 transition-all"
                                                            style={{
                                                                background: darkMode ? 'rgba(40, 40, 40, 0.8)' : 'rgba(255, 255, 255, 0.9)',
                                                                color: darkMode ? '#e5e5e5' : '#374151'
                                                            }}
                                                        />
                                                    </div>
                                                )}

                                                {/* Email field */}
                                                <div>
                                                    <input
                                                        type="email"
                                                        id="auth-email"
                                                        placeholder="Email"
                                                        className="w-full px-4 py-3 rounded-xl border-2 border-gray-300 text-gray-800 outline-none focus:border-indigo-500 transition-all"
                                                        style={{
                                                            background: darkMode ? 'rgba(40, 40, 40, 0.8)' : 'rgba(255, 255, 255, 0.9)',
                                                            color: darkMode ? '#e5e5e5' : '#374151'
                                                        }}
                                                    />
                                                </div>

                                                {/* Password field */}
                                                <div>
                                                    <input
                                                        type="password"
                                                        id="auth-password"
                                                        placeholder="Password"
                                                        className="w-full px-4 py-3 rounded-xl border-2 border-gray-300 text-gray-800 outline-none focus:border-indigo-500 transition-all"
                                                        style={{
                                                            background: darkMode ? 'rgba(40, 40, 40, 0.8)' : 'rgba(255, 255, 255, 0.9)',
                                                            color: darkMode ? '#e5e5e5' : '#374151'
                                                        }}
                                                    />
                                                </div>

                                                {/* Submit Button */}
                                                <button
                                                    onClick={() => {
                                                        const name = document.getElementById('auth-name')?.value || '';
                                                        const email = document.getElementById('auth-email').value;
                                                        const password = document.getElementById('auth-password').value;

                                                        if (authMode === 'signup') {
                                                            if (name && email && password) {
                                                                handleSignUp(name, email, password);
                                                            } else {
                                                                setAuthError('Please fill in all fields');
                                                            }
                                                        } else {
                                                            if (email && password) {
                                                                handleLogin(email, password);
                                                            } else {
                                                                setAuthError('Please enter email and password');
                                                            }
                                                        }
                                                    }}
                                                    className="w-full px-6 py-3 rounded-xl font-semibold text-white"
                                                    style={{
                                                        background: 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',
                                                        boxShadow: '0 4px 12px rgba(99, 102, 241, 0.3)'
                                                    }}
                                                >
                                                    {authMode === 'signup' ? 'Sign Up' : 'Log In'}
                                                </button>

                                                {/* Toggle between Sign Up and Log In */}
                                                <div className="text-center">
                                                    <button
                                                        onClick={() => {
                                                            setAuthMode(authMode === 'signup' ? 'login' : 'signup');
                                                            setAuthError('');
                                                        }}
                                                        className="text-sm font-semibold transition-colors"
                                                        style={{
                                                            color: darkMode ? '#a78bfa' : '#6366f1'
                                                        }}
                                                    >
                                                        {authMode === 'signup'
                                                            ? 'Already have an account? Log In'
                                                            : "Don't have an account? Sign Up"}
                                                    </button>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}

                            {/* Settings Options - Only show when logged in */}
                            {isLoggedIn ? (
                            <div className="space-y-6">
                                {/* Dark Mode Toggle */}
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                         Dark Mode
                                    </label>
                                    <div className="flex items-center justify-between glass-dark px-4 py-3 rounded-xl">
                                        <span className="text-sm text-gray-700">Enable dark theme</span>
                                        <button
                                            onClick={() => setDarkMode(!darkMode)}
                                            className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${
                                                darkMode ? 'bg-indigo-600' : 'bg-gray-300'
                                            }`}
                                        >
                                            <span
                                                className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${
                                                    darkMode ? 'translate-x-6' : 'translate-x-1'
                                                }`}
                                            />
                                        </button>
                                    </div>
                                </div>

                                {/* Show Suggestions Toggle */}
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                         Show Suggestions
                                    </label>
                                    <div className="flex items-center justify-between glass-dark px-4 py-3 rounded-xl">
                                        <span className="text-sm text-gray-700">Show AI tone suggestions while typing</span>
                                        <button
                                            onClick={() => {
                                                const newValue = !showSuggestionsEnabled;
                                                setShowSuggestionsEnabled(newValue);
                                                localStorage.setItem('showSuggestions', newValue.toString());
                                            }}
                                            className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${
                                                showSuggestionsEnabled ? 'bg-indigo-600' : 'bg-gray-300'
                                            }`}
                                        >
                                            <span
                                                className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${
                                                    showSuggestionsEnabled ? 'translate-x-6' : 'translate-x-1'
                                                }`}
                                            />
                                        </button>
                                    </div>
                                </div>

                                {/* Priority Mode Selection */}
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                         Priority Mode - Choose Your Preference
                                    </label>
                                    <div className="text-xs text-gray-600 mb-4" style={{color: darkMode ? '#aaa' : '#666'}}>
                                        Click a mode below to activate it
                                    </div>

                                    {/* Clickable Mode Buttons */}
                                    <div className="priority-preview-grid">
                                        {/* OFF Button */}
                                        <button
                                            onClick={() => {
                                                setAutoPrioritize(false);
                                                localStorage.setItem('autoPrioritize', 'false');
                                                playNotificationSound();
                                            }}
                                            className={`priority-preview-card priority-preview-off ${!autoPrioritize ? 'priority-mode-active' : 'priority-mode-inactive'}`}
                                            style={{cursor: 'pointer', textAlign: 'left'}}
                                        >
                                            <div className="preview-label preview-label-off">Manual Priority</div>
                                            <div className="text-xs text-gray-600 mb-3" style={{color: darkMode ? '#aaa' : '#666'}}>
                                                Emails show in chronological order. Click "Prioritize" button to analyze.
                                            </div>
                                            <div className="space-y-2">
                                                <div style={{padding: '8px', background: darkMode ? 'rgba(60,60,60,0.5)' : 'rgba(200,200,200,0.3)', borderRadius: '8px', fontSize: '11px'}}>
                                                     Newsletter: Weekly Update
                                                </div>
                                                <div style={{padding: '8px', background: darkMode ? 'rgba(60,60,60,0.5)' : 'rgba(200,200,200,0.3)', borderRadius: '8px', fontSize: '11px'}}>
                                                     Friend: Let's catch up
                                                </div>
                                                <div style={{padding: '8px', background: darkMode ? 'rgba(60,60,60,0.5)' : 'rgba(200,200,200,0.3)', borderRadius: '8px', fontSize: '11px'}}>
                                                     URGENT: Meeting in 1 hour
                                                </div>
                                            </div>
                                            {!autoPrioritize && <div className="mode-checkmark"> Active</div>}
                                        </button>

                                        {/* ON Button */}
                                        <button
                                            onClick={() => {
                                                setAutoPrioritize(true);
                                                localStorage.setItem('autoPrioritize', 'true');
                                                playNotificationSound();
                                            }}
                                            className={`priority-preview-card priority-preview-on ${autoPrioritize ? 'priority-mode-active' : 'priority-mode-inactive'}`}
                                            style={{cursor: 'pointer', textAlign: 'left'}}
                                        >
                                            <div className="preview-label preview-label-on">Auto Priority</div>
                                            <div className="text-xs text-gray-600 mb-3" style={{color: darkMode ? '#a5b4fc' : '#6366f1'}}>
                                                AI automatically stacks urgent emails at the top of your inbox.
                                            </div>
                                            <div className="space-y-2">
                                                <div style={{padding: '8px', background: 'linear-gradient(135deg, rgba(99,102,241,0.2), rgba(139,92,246,0.2))', border: '2px solid rgba(99,102,241,0.4)', borderRadius: '8px', fontSize: '11px', fontWeight: 600}}>
                                                     URGENT: Meeting in 1 hour
                                                </div>
                                                <div style={{padding: '8px', background: darkMode ? 'rgba(60,60,60,0.5)' : 'rgba(200,200,200,0.3)', borderRadius: '8px', fontSize: '11px'}}>
                                                     Friend: Let's catch up
                                                </div>
                                                <div style={{padding: '8px', background: darkMode ? 'rgba(60,60,60,0.5)' : 'rgba(200,200,200,0.3)', borderRadius: '8px', fontSize: '11px'}}>
                                                     Newsletter: Weekly Update
                                                </div>
                                            </div>
                                            {autoPrioritize && <div className="mode-checkmark"> Active</div>}
                                        </button>
                                    </div>
                                </div>

                                {/* AI Preferences Section */}
                                <div style={{
                                    marginTop: '32px',
                                    padding: '24px',
                                    background: darkMode
                                        ? 'linear-gradient(135deg, rgba(40, 40, 50, 0.6), rgba(30, 30, 40, 0.8))'
                                        : 'linear-gradient(135deg, rgba(249, 250, 251, 0.9), rgba(243, 244, 246, 0.95))',
                                    borderRadius: '16px',
                                    border: `2px solid ${darkMode ? 'rgba(99, 102, 241, 0.2)' : 'rgba(209, 213, 219, 0.5)'}`,
                                    boxShadow: darkMode
                                        ? '0 8px 32px rgba(0, 0, 0, 0.3)'
                                        : '0 4px 16px rgba(0, 0, 0, 0.08)',
                                    backdropFilter: 'blur(10px)'
                                }}>
                                    <label className="block text-lg font-bold text-gray-700 mb-6" style={{
                                        color: darkMode ? '#fff' : '#1f2937',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '8px'
                                    }}>
                                        <span style={{fontSize: '24px'}}></span>
                                        AI Preferences
                                    </label>

                                    {/* Signature Toggle */}
                                    <div className="mb-6">
                                        <div className="flex items-center justify-between mb-2">
                                            <div>
                                                <div className="text-sm font-medium" style={{color: darkMode ? '#fff' : '#1f2937'}}>
                                                     Use Signature
                                                </div>
                                                <div className="text-xs" style={{color: darkMode ? '#aaa' : '#666', marginTop: '4px'}}>
                                                    {useSignature ? `AI will use your name "${userName || 'your name'}" in emails` : 'AI will use placeholders like "Your name" and "Hi [Recipient\'s name]"'}
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => {
                                                    const newValue = !useSignature;
                                                    setUseSignature(newValue);
                                                    localStorage.setItem('useSignature', newValue.toString());
                                                    playNotificationSound();
                                                }}
                                                className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${useSignature ? 'bg-indigo-600' : 'bg-gray-300'}`}
                                                style={{cursor: 'pointer'}}
                                            >
                                                <span className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${useSignature ? 'translate-x-6' : 'translate-x-1'}`} />
                                            </button>
                                        </div>
                                    </div>

                                    {/* Show Quick Reply Suggestions Toggle */}
                                    <div className="mb-6">
                                        <div className="flex items-center justify-between mb-2">
                                            <div>
                                                <div className="text-sm font-medium" style={{color: darkMode ? '#fff' : '#1f2937'}}>
                                                     Show Quick Reply Suggestions
                                                </div>
                                                <div className="text-xs" style={{color: darkMode ? '#aaa' : '#666', marginTop: '4px'}}>
                                                    Display AI-powered quick replies when viewing emails
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => {
                                                    const newValue = !showQuickReplies;
                                                    setShowQuickReplies(newValue);
                                                    localStorage.setItem('showQuickReplies', newValue.toString());
                                                    playNotificationSound();
                                                }}
                                                className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${showQuickReplies ? 'bg-indigo-600' : 'bg-gray-300'}`}
                                                style={{cursor: 'pointer'}}
                                            >
                                                <span className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${showQuickReplies ? 'translate-x-6' : 'translate-x-1'}`} />
                                            </button>
                                        </div>
                                        {/* Preview of quick replies when enabled */}
                                        {showQuickReplies && (
                                            <div style={{
                                                marginTop: '12px',
                                                padding: '12px',
                                                background: darkMode ? 'rgba(99,102,241,0.1)' : 'rgba(99,102,241,0.05)',
                                                borderRadius: '8px',
                                                border: `1px solid ${darkMode ? 'rgba(99,102,241,0.3)' : 'rgba(99,102,241,0.2)'}`,
                                                animation: 'fadeIn 0.3s ease-out',
                                                transformOrigin: 'top',
                                                overflow: 'hidden'
                                            }}>
                                                <div className="text-xs font-semibold mb-2" style={{color: darkMode ? '#a5b4fc' : '#6366f1'}}>
                                                    Preview:
                                                </div>
                                                <div className="flex flex-wrap gap-2">
                                                    <div style={{padding: '6px 12px', background: darkMode ? 'rgba(99,102,241,0.2)' : 'rgba(99,102,241,0.15)', borderRadius: '20px', fontSize: '11px', color: darkMode ? '#c7d2fe' : '#4f46e5', border: `1px solid ${darkMode ? 'rgba(99,102,241,0.4)' : 'rgba(99,102,241,0.3)'}`}}>
                                                         Sounds good!
                                                    </div>
                                                    <div style={{padding: '6px 12px', background: darkMode ? 'rgba(99,102,241,0.2)' : 'rgba(99,102,241,0.15)', borderRadius: '20px', fontSize: '11px', color: darkMode ? '#c7d2fe' : '#4f46e5', border: `1px solid ${darkMode ? 'rgba(99,102,241,0.4)' : 'rgba(99,102,241,0.3)'}`}}>
                                                         Let me check my calendar
                                                    </div>
                                                    <div style={{padding: '6px 12px', background: darkMode ? 'rgba(99,102,241,0.2)' : 'rgba(99,102,241,0.15)', borderRadius: '20px', fontSize: '11px', color: darkMode ? '#c7d2fe' : '#4f46e5', border: `1px solid ${darkMode ? 'rgba(99,102,241,0.4)' : 'rgba(99,102,241,0.3)'}`}}>
                                                         Thank you!
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>

                                    {/* Check Grammar Toggle */}
                                    <div className="mb-4">
                                        <div className="flex items-center justify-between mb-2">
                                            <div>
                                                <div className="text-sm font-medium" style={{color: darkMode ? '#fff' : '#1f2937'}}>
                                                     Auto Grammar Check
                                                </div>
                                                <div className="text-xs" style={{color: darkMode ? '#aaa' : '#666', marginTop: '4px'}}>
                                                    Automatically detect and correct grammar after you finish typing (10 sec delay)
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => {
                                                    const newValue = !checkGrammar;
                                                    setCheckGrammar(newValue);
                                                    localStorage.setItem('checkGrammar', newValue.toString());
                                                    playNotificationSound();
                                                }}
                                                className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${checkGrammar ? 'bg-indigo-600' : 'bg-gray-300'}`}
                                                style={{cursor: 'pointer'}}
                                            >
                                                <span className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${checkGrammar ? 'translate-x-6' : 'translate-x-1'}`} />
                                            </button>
                                        </div>
                                        {/* Preview when enabled */}
                                        {checkGrammar && (
                                            <div style={{
                                                marginTop: '12px',
                                                padding: '12px',
                                                background: darkMode ? 'rgba(34,197,94,0.1)' : 'rgba(34,197,94,0.05)',
                                                borderRadius: '8px',
                                                border: `1px solid ${darkMode ? 'rgba(34,197,94,0.3)' : 'rgba(34,197,94,0.2)'}`,
                                                animation: 'fadeIn 0.3s ease-out',
                                                transformOrigin: 'top',
                                                overflow: 'hidden'
                                            }}>
                                                <div className="text-xs font-semibold mb-2" style={{color: darkMode ? '#86efac' : '#16a34a'}}>
                                                    Example:
                                                </div>
                                                <div className="text-xs" style={{color: darkMode ? '#d1d5db' : '#374151'}}>
                                                    I <span style={{background: darkMode ? 'rgba(239,68,68,0.3)' : 'rgba(239,68,68,0.2)', padding: '2px 4px', borderRadius: '4px', textDecoration: 'line-through'}}>goed</span> <span style={{background: darkMode ? 'rgba(34,197,94,0.3)' : 'rgba(34,197,94,0.2)', padding: '2px 4px', borderRadius: '4px', fontWeight: 600}}>went</span> to the store yesterday.
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                            ) : (
                                <div className="text-center py-8">
                                    <p className="text-gray-600 text-sm">
                                        Please sign up or log in above to access settings options.
                                    </p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            const renderWriterContent = () => {
                switch(activeTab) {
                    case 'email':
                        return (
                            <div className="space-y-6 fade-in">
                                {/* Mobile Model Switcher - Top Left */}
                                <div className="mobile-model-switcher" style={{display: 'none'}}>
                                    <button
                                        onClick={() => setShowModelDropdown(!showModelDropdown)}
                                        style={{
                                            padding: '8px 16px',
                                            fontSize: '12px',
                                            fontWeight: '600',
                                            background: darkMode
                                                ? 'linear-gradient(135deg, rgba(40, 40, 45, 0.95) 0%, rgba(35, 35, 40, 0.9) 100%)'
                                                : 'linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(249, 250, 251, 0.9) 100%)',
                                            border: darkMode ? '2px solid rgba(99, 102, 241, 0.5)' : '2px solid white',
                                            borderRadius: '50px',
                                            cursor: 'pointer',
                                            transition: 'all 0.3s ease',
                                            boxShadow: '0 2px 8px rgba(99, 102, 241, 0.15)',
                                            color: darkMode ? '#c7d2fe' : '#374151',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '6px',
                                            whiteSpace: 'nowrap'
                                        }}
                                        className="unified-button"
                                    >
                                        <span style={{fontSize: '14px'}}></span>
                                        <span>{selectedModel}</span>
                                        <span style={{
                                            transition: 'transform 0.3s',
                                            transform: showModelDropdown ? 'rotate(180deg)' : 'rotate(0)',
                                            fontSize: '8px'
                                        }}></span>
                                    </button>

                                    {showModelDropdown && (
                                        <div style={{
                                            position: 'absolute',
                                            top: '100%',
                                            left: 0,
                                            marginTop: '8px',
                                            background: darkMode
                                                ? 'rgba(20, 20, 25, 0.98)'
                                                : 'rgba(255, 255, 255, 0.98)',
                                            backdropFilter: 'blur(30px)',
                                            border: darkMode ? '2px solid rgba(99, 102, 241, 0.5)' : '2px solid white',
                                            borderRadius: '16px',
                                            boxShadow: '0 12px 32px rgba(99, 102, 241, 0.25)',
                                            zIndex: 1000,
                                            overflow: 'hidden',
                                            animation: 'slideDownFade 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                                            minWidth: '280px'
                                        }}>
                                            {[
                                                { name: 'Ink 2.0', description: 'Fast & efficient - Mistral AI Small Latest' },
                                                { name: 'Ink 2.5', description: 'More powerful & detailed - Mistral AI Medium' }
                                            ].map((model) => (
                                                <button
                                                    key={model.name}
                                                    onClick={() => {
                                                        setSelectedModel(model.name);
                                                        setShowModelDropdown(false);
                                                    }}
                                                    style={{
                                                        width: '100%',
                                                        padding: '12px 16px',
                                                        fontSize: '13px',
                                                        background: selectedModel === model.name
                                                            ? (darkMode ? 'rgba(99, 102, 241, 0.2)' : 'rgba(99, 102, 241, 0.1)')
                                                            : 'transparent',
                                                        border: 'none',
                                                        cursor: 'pointer',
                                                        transition: 'all 0.2s ease',
                                                        color: darkMode ? '#c7d2fe' : '#374151',
                                                        textAlign: 'left',
                                                        display: 'flex',
                                                        flexDirection: 'column',
                                                        gap: '4px'
                                                    }}
                                                    onMouseEnter={(e) => {
                                                        if (selectedModel !== model.name) {
                                                            e.currentTarget.style.background = darkMode
                                                                ? 'rgba(99, 102, 241, 0.1)'
                                                                : 'rgba(99, 102, 241, 0.05)';
                                                        }
                                                    }}
                                                    onMouseLeave={(e) => {
                                                        if (selectedModel !== model.name) {
                                                            e.currentTarget.style.background = 'transparent';
                                                        }
                                                    }}
                                                >
                                                    <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', fontWeight: '600'}}>
                                                        <span>{model.name}</span>
                                                        {selectedModel === model.name && <span></span>}
                                                    </div>
                                                    <span style={{fontSize: '11px', opacity: 0.7, fontWeight: '400'}}>{model.description}</span>
                                                </button>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                {/* Current Tool Indicator */}
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-3">

                                        {/* AI Model Switcher - Moved to inline prompt container */}
                                        <div style={{position: 'relative', display: 'none'}}>
                                            <button
                                                onClick={() => setShowModelDropdown(!showModelDropdown)}
                                                style={{
                                                    padding: '8px 16px',
                                                    fontSize: '12px',
                                                    fontWeight: '600',
                                                    background: darkMode
                                                        ? 'linear-gradient(135deg, rgba(30, 30, 35, 0.95) 0%, rgba(25, 25, 30, 0.9) 100%)'
                                                        : 'linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(249, 250, 251, 0.9) 100%)',
                                                    border: darkMode ? '2px solid rgba(99, 102, 241, 0.5)' : '2px solid white',
                                                    borderRadius: '50px',
                                                    cursor: 'pointer',
                                                    transition: 'all 0.3s ease',
                                                    boxShadow: darkMode
                                                        ? '0 2px 8px rgba(0, 0, 0, 0.3)'
                                                        : '0 2px 8px rgba(99, 102, 241, 0.15)',
                                                    color: darkMode ? '#c7d2fe' : '#374151',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    gap: '8px',
                                                    whiteSpace: 'nowrap'
                                                }}
                                                className="unified-button"
                                            >
                                                <span> {selectedModel}</span>
                                                <span style={{transition: 'transform 0.3s ease', transform: showModelDropdown ? 'rotate(180deg)' : 'rotate(0deg)', fontSize: '10px'}}></span>
                                            </button>

                                            {showModelDropdown && (
                                                <div
                                                    style={{
                                                        position: 'absolute',
                                                        top: '100%',
                                                        left: 0,
                                                        marginTop: '8px',
                                                        background: darkMode
                                                            ? 'rgba(20, 20, 25, 0.95)'
                                                            : 'rgba(255, 255, 255, 0.95)',
                                                        backdropFilter: 'blur(25px)',
                                                        WebkitBackdropFilter: 'blur(25px)',
                                                        border: darkMode ? '2px solid rgba(99, 102, 241, 0.5)' : '2px solid rgba(99, 102, 241, 0.3)',
                                                        borderRadius: '12px',
                                                        boxShadow: darkMode
                                                            ? '0 12px 32px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(99, 102, 241, 0.2) inset'
                                                            : '0 12px 32px rgba(99, 102, 241, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.8) inset',
                                                        zIndex: 1000,
                                                        overflow: 'hidden',
                                                        animation: 'slideDownFade 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                                                        minWidth: '280px'
                                                    }}
                                                >
                                                    {[
                                                        { name: 'Ink 2.0', description: 'Fast & efficient - best for small email tasks' },
                                                        { name: 'Ink 2.5', description: 'More powerful & detailed - best for more complex email tasks' }
                                                    ].map((model) => (
                                                        <button
                                                            key={model.name}
                                                            onClick={() => {
                                                                console.log(` Switched to model: ${model.name} (${model.description})`);
                                                                setSelectedModel(model.name);
                                                                setShowModelDropdown(false);
                                                            }}
                                                            style={{
                                                                width: '100%',
                                                                padding: '12px 16px',
                                                                fontSize: '13px',
                                                                background: selectedModel === model.name
                                                                    ? (darkMode ? 'rgba(99, 102, 241, 0.2)' : 'rgba(99, 102, 241, 0.1)')
                                                                    : 'transparent',
                                                                border: 'none',
                                                                cursor: 'pointer',
                                                                transition: 'all 0.2s ease',
                                                                color: darkMode ? '#c7d2fe' : '#374151',
                                                                textAlign: 'left',
                                                                display: 'flex',
                                                                flexDirection: 'column',
                                                                gap: '4px'
                                                            }}
                                                            onMouseEnter={(e) => {
                                                                if (selectedModel !== model.name) {
                                                                    e.currentTarget.style.background = darkMode
                                                                        ? 'rgba(99, 102, 241, 0.1)'
                                                                        : 'rgba(99, 102, 241, 0.05)';
                                                                }
                                                            }}
                                                            onMouseLeave={(e) => {
                                                                if (selectedModel !== model.name) {
                                                                    e.currentTarget.style.background = 'transparent';
                                                                }
                                                            }}
                                                        >
                                                            <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', fontWeight: '600'}}>
                                                                <span>{model.name}</span>
                                                                {selectedModel === model.name && <span></span>}
                                                            </div>
                                                            <span style={{fontSize: '11px', opacity: 0.7, fontWeight: '400'}}>{model.description}</span>
                                                        </button>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>

                                {/* Email Writing Area */}
                                <div className="relative email-writing-area-wrapper">
                                    <div className="flex items-center justify-end mb-3 language-selector-mobile">
                                        {/* Language Selector - Always visible, oval with white outline */}
                                        <div className="custom-dropdown-wrapper" style={{width: 'auto', minWidth: '140px'}}>
                                            <select
                                                value={selectedLanguage}
                                                onChange={(e) => {
                                                    setSelectedLanguage(e.target.value);
                                                    localStorage.setItem('selectedLanguage', e.target.value);
                                                }}
                                                className="custom-language-select oval-button unified-button"
                                                style={{
                                                    padding: '10px 32px 10px 14px',
                                                    fontSize: '12px',
                                                    fontWeight: '600',
                                                    borderRadius: '50px'
                                                }}
                                            >
                                                <option value="english"> English</option>
                                                <option value="german"> German</option>
                                                <option value="french"> French</option>
                                                <option value="georgian"> Georgian</option>
                                                <option value="spanish"> Spanish</option>
                                            </select>
                                            <div className="custom-dropdown-arrow" style={{right: '12px', fontSize: '8px'}}></div>
                                        </div>
                                    </div>

                                    {uploadedFile ? (
                                        <div className="glass-dark rounded-2xl p-4 mb-4">
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center gap-3">
                                                    <span className="text-3xl"></span>
                                                    <div>
                                                        <div className="text-sm font-semibold text-gray-800">{uploadedFile.name}</div>
                                                        <div className="text-xs text-gray-600">{(uploadedFile.size / 1024).toFixed(2)} KB</div>
                                                    </div>
                                                </div>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => setViewingFile(uploadedFile)}
                                                        className="px-3 py-1 glass-effect rounded-full text-xs text-gray-700 hover:bg-white/90"
                                                    >
                                                         View
                                                    </button>
                                                    <button
                                                        onClick={() => setUploadedFile(null)}
                                                        className="px-3 py-1 glass-effect rounded-full text-xs text-red-600 hover:bg-white/90"
                                                    >
                                                         Remove
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="email-writing-container">
                                            {/* Email Textarea */}
                                            <div className="relative">
                                                <textarea
                                                    value={emailText}
                                                    onChange={(e) => setEmailText(e.target.value)}
                                                    className="w-full px-6 py-4 custom-textarea text-gray-800 placeholder-gray-500 resize-none border-2 border-white unified-button"
                                                    style={{borderRadius: '16px', height: '450px', maxWidth: '100%'}}
                                                    placeholder="Type or paste your email content here and watch the magic happen..."
                                                />
                                                {/* Grammar Check Indicator */}
                                                {checkGrammar && isCheckingGrammar && (
                                                    <div
                                                        className="absolute bottom-4 left-4 text-xs font-medium"
                                                        style={{
                                                            background: darkMode ? 'rgba(99, 102, 241, 0.2)' : 'rgba(99, 102, 241, 0.1)',
                                                            color: darkMode ? '#a5b4fc' : '#6366f1',
                                                            padding: '6px 12px',
                                                            borderRadius: '20px',
                                                            border: `1px solid ${darkMode ? 'rgba(99, 102, 241, 0.4)' : 'rgba(99, 102, 241, 0.3)'}`,
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            gap: '6px'
                                                        }}
                                                    >
                                                        <span className="animate-pulse"></span>
                                                        Checking grammar...
                                                    </div>
                                                )}
                                                {/* Language Indicator */}
                                                <div
                                                    className="absolute top-3 right-4 text-xs font-medium pointer-events-none"
                                                    style={{
                                                        color: darkMode ? '#888' : '#999',
                                                        opacity: 0.8
                                                    }}
                                                >
                                                    Responses in {selectedLanguage.charAt(0).toUpperCase() + selectedLanguage.slice(1)}
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* Custom Transformation + Suggestions */}
                                <div className="pt-4 border-t border-gray-300 space-y-4 custom-transformation-section">
                                    {/* Rewrite with AI button - shows when user has written content */}
                                    {emailText.trim().length > 50 && !customPrompt.trim() && (
                                        <div style={{marginBottom: '16px', textAlign: 'center'}}>
                                            <button
                                                onClick={() => {
                                                    const rewritePrompt = 'Rewrite and improve this email';
                                                    setIsReplyOnlyMode(false);
                                                    setCenteredWriterPrompt(rewritePrompt);
                                                    setShowCenteredWriter(true);
                                                    setIsCenteredGenerating(true);
                                                    setCenteredWriterResult('');
                                                    setAiSuggestions([]);

                                                    const statusMessages = [
                                                        ' Analyzing your request',
                                                        ' Writing the email',
                                                        ' Polishing content',
                                                        ' Finalizing'
                                                    ];

                                                    let statusIndex = 0;
                                                    setCenteredGenerationStatus(statusMessages[0]);

                                                    const statusInterval = setInterval(() => {
                                                        statusIndex = (statusIndex + 1) % statusMessages.length;
                                                        setCenteredGenerationStatus(statusMessages[statusIndex]);
                                                    }, 2000);

                                                    generateEmail(rewritePrompt).then(result => {
                                                        clearInterval(statusInterval);
                                                        setIsCenteredGenerating(false);
                                                        setCenteredWriterResult(result);
                                                        generateAiSuggestions(result, rewritePrompt);
                                                    }).catch(error => {
                                                        clearInterval(statusInterval);
                                                        console.error('AI Generation error:', error);
                                                        setIsCenteredGenerating(false);
                                                        setCenteredWriterResult('Failed to generate email. Please try again.');
                                                    });
                                                }}
                                                style={{
                                                    padding: '14px 32px',
                                                    background: 'linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%)',
                                                    color: 'white',
                                                    border: 'none',
                                                    borderRadius: '50px',
                                                    cursor: 'pointer',
                                                    fontSize: '15px',
                                                    fontWeight: '600',
                                                    display: 'inline-flex',
                                                    alignItems: 'center',
                                                    gap: '10px',
                                                    transition: 'all 0.3s ease',
                                                    boxShadow: '0 4px 12px rgba(139, 92, 246, 0.3)',
                                                    animation: 'pulse-glow 2s ease-in-out infinite'
                                                }}
                                                className="unified-button"
                                            >
                                                <span></span>
                                                <span>Rewrite with AI</span>
                                            </button>
                                        </div>
                                    )}
                                     {/* Custom Prompt Input */}
{/* Custom Prompt Input */}
<div style={{position: 'relative'}}>
    {/* Prompt Suggestions Container - Shows dynamically as user types */}
    {showPromptSuggestions && filteredSuggestions.length > 0 && (
        <div className="prompt-suggestions-container">
            <div className="suggestion-title">
                {emailText.trim() ? 'Smart suggestions' : 'Quick suggestions'}
            </div>
            <div className="suggestion-pills">
                {filteredSuggestions.map((suggestion, idx) => (
                    <button
                        key={idx}
                        className="suggestion-pill"
                        style={{
                            animationDelay: `${idx * 0.05}s`
                        }}
                        onClick={() => {
                            setCustomPrompt(suggestion);
                            setShowPromptSuggestions(false);
                        }}
                    >
                        {/* Mark AI-generated suggestions with a subtle indicator */}
                        {idx < 2 && emailText.trim().length > 20 && (
                            <span style={{marginRight: '4px', opacity: 0.7}}></span>
                        )}
                        {suggestion}
                    </button>
                ))}
            </div>
        </div>
    )}
    <div className="ai-prompt-container" style={{position: 'relative', paddingLeft: '140px'}}>
        {/* Model Switcher - Bottom Left */}
        <div style={{
            position: 'absolute',
            left: '8px',
            bottom: '8px',
            zIndex: 10
        }}>
            <button
                onClick={() => setShowModelDropdown(!showModelDropdown)}
                style={{
                    padding: '8px 16px',
                    fontSize: '12px',
                    fontWeight: '600',
                    background: darkMode
                        ? 'linear-gradient(135deg, rgba(40, 40, 45, 0.95) 0%, rgba(35, 35, 40, 0.9) 100%)'
                        : 'linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(249, 250, 251, 0.9) 100%)',
                    border: darkMode ? '2px solid rgba(99, 102, 241, 0.5)' : '2px solid white',
                    borderRadius: '50px',
                    cursor: 'pointer',
                    transition: 'all 0.3s ease',
                    boxShadow: '0 2px 8px rgba(99, 102, 241, 0.15)',
                    color: darkMode ? '#c7d2fe' : '#374151',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '6px',
                    whiteSpace: 'nowrap'
                }}
                className="unified-button"
            >
                <span style={{fontSize: '14px'}}></span>
                <span>{selectedModel}</span>
                <span style={{
                    transition: 'transform 0.3s',
                    transform: showModelDropdown ? 'rotate(180deg)' : 'rotate(0)',
                    fontSize: '8px'
                }}></span>
            </button>

            {showModelDropdown && (
                <div style={{
                    position: 'absolute',
                    bottom: '100%',
                    left: 0,
                    marginBottom: '8px',
                    background: darkMode
                        ? 'rgba(20, 20, 25, 0.98)'
                        : 'rgba(255, 255, 255, 0.98)',
                    backdropFilter: 'blur(30px)',
                    border: darkMode ? '2px solid rgba(99, 102, 241, 0.5)' : '2px solid white',
                    borderRadius: '16px',
                    boxShadow: '0 -12px 32px rgba(99, 102, 241, 0.25)',
                    zIndex: 1000,
                    overflow: 'hidden',
                    animation: 'slideUpFade 0.35s cubic-bezier(0.34, 1.56, 0.64, 1)',
                    minWidth: '280px'
                }}>
                    {[
                        { name: 'Ink 2.0', description: 'Fast & efficient - Mistral AI Small Latest' },
                        { name: 'Ink 2.5', description: 'More powerful & detailed - Mistral AI Medium' }
                    ].map((model) => (
                        <button
                            key={model.name}
                            onClick={() => {
                                setSelectedModel(model.name);
                                setShowModelDropdown(false);
                            }}
                            style={{
                                width: '100%',
                                padding: '12px 16px',
                                fontSize: '13px',
                                background: selectedModel === model.name
                                    ? (darkMode ? 'rgba(99, 102, 241, 0.2)' : 'rgba(99, 102, 241, 0.1)')
                                    : 'transparent',
                                border: 'none',
                                cursor: 'pointer',
                                transition: 'all 0.2s ease',
                                color: darkMode ? '#c7d2fe' : '#374151',
                                textAlign: 'left',
                                display: 'flex',
                                flexDirection: 'column',
                                gap: '4px'
                            }}
                            onMouseEnter={(e) => {
                                if (selectedModel !== model.name) {
                                    e.currentTarget.style.background = darkMode
                                        ? 'rgba(99, 102, 241, 0.1)'
                                        : 'rgba(99, 102, 241, 0.05)';
                                }
                            }}
                            onMouseLeave={(e) => {
                                if (selectedModel !== model.name) {
                                    e.currentTarget.style.background = 'transparent';
                                }
                            }}
                        >
                            <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', fontWeight: '600'}}>
                                <span>{model.name}</span>
                                {selectedModel === model.name && <span></span>}
                            </div>
                            <span style={{fontSize: '11px', opacity: 0.7}}>{model.description}</span>
                        </button>
                    ))}
                </div>
            )}
        </div>

        <input
            type="text"
            value={customPrompt}
            onChange={(e) => {
                setCustomPrompt(e.target.value);
                // Generate suggestions dynamically as user types
                generatePromptSuggestions(emailText, e.target.value);
            }}
            className="ai-prompt-input"
            placeholder="e.g., 'Write a professional email' or 'Make it more casual'"
            onKeyPress={(e) => e.key === 'Enter' && customPrompt && handleGenerate()}
            onFocus={() => {
                setPromptInputFocused(true);
                generatePromptSuggestions(emailText, customPrompt);
            }}
            onBlur={() => {
                setTimeout(() => {
                    setPromptInputFocused(false);
                    setShowPromptSuggestions(false);
                }, 200);
            }}
        />
        {customPrompt && customPrompt.trim().length > 0 ? (
            <button
                onClick={handleGenerate}
                disabled={(!emailText && !uploadedFile)}
                className={`ai-send-button ${customPrompt ? 'visible' : ''}`}
            >
                
            </button>
        ) : null}
    </div>
</div>

                                </div>

                                {/* Mobile Send Button - Shows when typing */}
                                <button
                                    onClick={handleGenerate}
                                    className={`mobile-send-button ${(emailText.trim().length > 0 || customPrompt.trim().length > 0) && window.innerWidth <= 768 ? 'show' : ''}`}
                                    disabled={!emailText && !uploadedFile}
                                    style={{display: window.innerWidth <= 768 ? 'flex' : 'none'}}
                                >
                                    
                                </button>
                            </div>
                        );

                    default:
                        return (
                            <div className="space-y-6 fade-in">
                                <div className="relative">
                                    <div className="flex items-start justify-between mb-3">
                                        <label className="text-sm font-medium text-gray-700 flex items-center">
                                            <span className="text-lg mr-2"></span>
                                            Enter your text
                                        </label>
                                    </div>
                                    <textarea
                                        value={emailText}
                                        onChange={(e) => setEmailText(e.target.value)}
                                        className="w-full h-64 px-6 py-4 custom-textarea rounded-2xl text-gray-800 placeholder-gray-500 resize-none border-2 border-white unified-button"
                                        placeholder="Type or paste your content here..."
                                    />
                                </div>
                                <button
                                    onClick={handleToolProcess}
                                    className="w-full px-8 py-4 glass-effect rounded-full text-gray-800 font-semibold text-lg hover:bg-white/90 transition-all oval-button border-2 border-white unified-button"
                                >
                                     Process with AI
                                </button>
                            </div>
                        );
                }
            };

            const renderResultsContent = () => {
                if (isProcessing) {
                    return (
                        <div className="flex flex-col justify-center items-start h-96 space-y-8 px-6">
                            <div className="w-full space-y-4">
                                <div className="text-left mb-6">
                                    <p className="text-gray-700 text-xl font-semibold mb-2"> Generating with AI</p>
                                    <p className="text-gray-500 text-sm">Transforming your content...</p>
                                </div>
                                <div className="loading-lines">
                                    <div className="loading-line"></div>
                                    <div className="loading-line"></div>
                                    <div className="loading-line"></div>
                                    <div className="loading-line"></div>
                                    <div className="loading-line"></div>
                                    <div className="loading-line"></div>
                                </div>
                            </div>
                        </div>
                    );
                }

                // Show result
                if (result) {
                    return (
                        <div className="result-container px-6 py-4 relative">
                            <div className="relative">
                                {/* Action buttons at top-right */}
                                <div className="action-buttons">
                                    <button
                                        onClick={() => navigator.clipboard.writeText(result)}
                                        className="action-btn text-gray-700 hover:text-indigo-700"
                                    >
                                        Copy
                                    </button>
                                    <button
                                        onClick={handleRetry}
                                        className="action-btn text-gray-700 hover:text-purple-700"
                                    >
                                        Retry
                                    </button>
                                </div>
                                <div className="glass-dark rounded-2xl p-8" style={{minHeight: '200px'}}>
                                    <pre id="result-text" className="text-gray-800 whitespace-pre-wrap font-sans leading-loose text-left text-base" style={{fontSize: '16px', lineHeight: '1.8'}}></pre>
                                </div>
                                {/* View Email Button */}
                                <button
                                    onClick={() => {
                                        setFullscreenEmailText(result);
                                        setShowFullscreenEmail(true);
                                    }}
                                    className="view-email-btn"
                                >
                                    <span></span>
                                    <span>View Email</span>
                                </button>
                            </div>
                        </div>
                    );
                }

                return (
                    <div className="flex flex-col items-center justify-center h-96 text-gray-500">
                        <div className="text-7xl mb-4 opacity-40"></div>
                        <p className="text-lg text-gray-700">Your AI-generated content will appear here</p>
                        <p className="text-sm mt-2">Use the Writer tab to create something amazing!</p>
                    </div>
                );
            };

           return (
    <div className="min-h-screen relative">
        {/* Mobile Inbox Button */}
        {(emailConnected || outlookConnected) && currentPage === 'home' && (
            <button
                className={`mobile-inbox-button ${newEmailCount > 0 ? 'has-new' : ''}`}
                onClick={() => setMobileInboxOpen(true)}
            >
                <span></span>
                <span>Inbox</span>
                {newEmailCount > 0 && (
                    <span style={{
                        background: 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)',
                        color: 'white',
                        padding: '2px 8px',
                        borderRadius: '10px',
                        fontSize: '11px',
                        fontWeight: '700'
                    }}>
                        {newEmailCount}
                    </span>
                )}
            </button>
        )}

        {/* Mobile Inbox Fullscreen */}
        {(emailConnected || outlookConnected) && currentPage === 'home' && (
            <div className={`mobile-inbox-fullscreen ${mobileInboxOpen ? 'active' : ''}`}>
                {/* Header with Close Button */}
                <div className="mobile-inbox-header">
                    <h2 className="text-xl font-bold text-gray-800">
                         Inbox
                    </h2>
                    <button
                        className="mobile-close-btn"
                        onClick={() => setMobileInboxOpen(false)}
                    >
                        
                    </button>
                </div>

                {/* Content Area */}
                <div style={{flex: 1, overflow: 'hidden', display: 'flex', flexDirection: 'column', padding: '0 20px'}}>
                    {/* Provider/View Tabs */}
                    <div style={{marginBottom: '16px'}}>
                        {inboxViewMode === 'tabs' ? (
                            <div className="provider-tabs-container" style={{width: '100%'}}>
                                {emailConnected && (
                                    <div
                                        className={`provider-tab unified-button ${activeProvider === 'gmail' ? 'active' : ''}`}
                                        onClick={() => {
                                            setActiveProvider('gmail');
                                            setInboxViewMode('received');
                                            setPriorityEmails([]);
                                            setViewingEmail(null);
                                        }}
                                    >
                                         Gmail
                                    </div>
                                )}
                                {outlookConnected && (
                                    <div
                                        className={`provider-tab unified-button ${activeProvider === 'outlook' ? 'active' : ''}`}
                                        onClick={() => {
                                            setActiveProvider('outlook');
                                            setInboxViewMode('received');
                                            setPriorityEmails([]);
                                            setViewingEmail(null);
                                        }}
                                    >
                                         Outlook
                                    </div>
                                )}
                            </div>
                        ) : (
                            <div style={{display: 'flex', gap: '8px', alignItems: 'center'}}>
                                <button
                                    className="inbox-back-btn-tab"
                                    onClick={() => {
                                        setInboxViewMode('tabs');
                                        setPriorityEmails([]);
                                        setViewingEmail(null);
                                    }}
                                >
                                    
                                </button>
                                <div className="inbox-view-toggle" style={{flex: 1}}>
                                    <button
                                        className={`inbox-view-toggle-btn ${inboxViewMode === 'received' ? 'active' : ''}`}
                                        onClick={() => {
                                            setInboxViewMode('received');
                                            setViewingEmail(null);
                                        }}
                                    >
                                         Received
                                    </button>
                                    <button
                                        className={`inbox-view-toggle-btn ${inboxViewMode === 'sent' ? 'active' : ''}`}
                                        onClick={() => {
                                            setInboxViewMode('sent');
                                            setPriorityEmails([]);
                                            setViewingEmail(null);
                                        }}
                                    >
                                         Sent
                                    </button>
                                    {drafts.length > 0 && (
                                        <button
                                            className={`inbox-view-toggle-btn ${inboxViewMode === 'drafts' ? 'active' : ''}`}
                                            onClick={() => {
                                                setInboxViewMode('drafts');
                                                setPriorityEmails([]);
                                                setViewingEmail(null);
                                            }}
                                        >
                                             Drafts
                                        </button>
                                    )}
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Email List Area */}
                    <div style={{flex: 1, overflow: 'auto', marginRight: '-20px', paddingRight: '20px'}}>
                        {inboxViewMode === 'tabs' ? (
                            <div className="text-center py-12 fade-in">
                                <div className="text-6xl mb-6"></div>
                                <h3 className="text-xl font-bold text-gray-800 mb-3">Select Email Provider</h3>
                                <p className="text-sm text-gray-600 mb-8">Choose a provider to view your emails</p>
                            </div>
                        ) : (
                            <div className="space-y-2">
                                {inboxViewMode === 'received' ? (
                                    activeProvider === 'gmail' ? (
                                        gmailEmails.length > 0 ? (
                                            gmailEmails.map((email, index) => (
                                                <div
                                                    key={email.id}
                                                    onClick={() => {
                                                        setViewingEmail(email);
                                                        setMobileInboxOpen(false);
                                                        setMobileEmailViewerOpen(true);
                                                        // Transition navigation to email mode
                                                        setNavTransitioning(true);
                                                        setTimeout(() => {
                                                            setNavEmailMode(true);
                                                            setShowNavGlow(true);
                                                            setNavTransitioning(false);
                                                            // Remove glow after animation
                                                            setTimeout(() => setShowNavGlow(false), 1000);
                                                        }, 400);
                                                    }}
                                                    className="modern-email-item"
                                                    style={{animationDelay: `${index * 0.05}s`}}
                                                >
                                                    <div className="text-xs font-bold text-gray-800 mb-1 truncate">{email.from}</div>
                                                    <div className="text-sm font-semibold text-gray-700 mb-1 truncate">{email.subject}</div>
                                                    <div className="text-xs text-gray-600 truncate">{email.snippet.substring(0, 80)}...</div>
                                                    <div className="text-xs text-gray-400 mt-1">{email.date}</div>
                                                </div>
                                            ))
                                        ) : (
                                            <div className="text-center py-12 text-gray-500">
                                                <div className="text-6xl mb-4"></div>
                                                <p>No Gmail emails</p>
                                            </div>
                                        )
                                    ) : (
                                        outlookEmails.length > 0 ? (
                                            outlookEmails.map((email, index) => (
                                                <div
                                                    key={email.id}
                                                    onClick={() => {
                                                        setViewingEmail(email);
                                                        setMobileInboxOpen(false);
                                                        setMobileEmailViewerOpen(true);
                                                        // Transition navigation to email mode
                                                        setNavTransitioning(true);
                                                        setTimeout(() => {
                                                            setNavEmailMode(true);
                                                            setShowNavGlow(true);
                                                            setNavTransitioning(false);
                                                            // Remove glow after animation
                                                            setTimeout(() => setShowNavGlow(false), 1000);
                                                        }, 400);
                                                    }}
                                                    className="modern-email-item"
                                                    style={{animationDelay: `${index * 0.05}s`}}
                                                >
                                                    <div className="text-xs font-bold text-gray-800 mb-1 truncate">{email.from}</div>
                                                    <div className="text-sm font-semibold text-gray-700 mb-1 truncate">{email.subject}</div>
                                                    <div className="text-xs text-gray-600 truncate">{email.snippet.substring(0, 80)}...</div>
                                                    <div className="text-xs text-gray-400 mt-1">{email.date}</div>
                                                </div>
                                            ))
                                        ) : (
                                            <div className="text-center py-12 text-gray-500">
                                                <div className="text-6xl mb-4"></div>
                                                <p>No Outlook emails</p>
                                            </div>
                                        )
                                    )
                                ) : inboxViewMode === 'sent' ? (
                                    sentEmails.length > 0 ? (
                                        sentEmails.map((email, index) => (
                                            <div
                                                key={email.id}
                                                onClick={() => {
                                                    setViewingEmail(email);
                                                    setMobileInboxOpen(false);
                                                    setMobileEmailViewerOpen(true);
                                                    // Transition navigation to email mode
                                                    setNavTransitioning(true);
                                                    setTimeout(() => {
                                                        setNavEmailMode(true);
                                                        setShowNavGlow(true);
                                                        setNavTransitioning(false);
                                                        // Remove glow after animation
                                                        setTimeout(() => setShowNavGlow(false), 1000);
                                                    }, 400);
                                                }}
                                                className="modern-email-item"
                                                style={{animationDelay: `${index * 0.05}s`}}
                                            >
                                                <div className="text-xs font-bold text-gray-800 mb-1 truncate">To: {email.to}</div>
                                                <div className="text-sm font-semibold text-gray-700 mb-1 truncate">{email.subject}</div>
                                                <div className="text-xs text-gray-600 truncate">{email.snippet.substring(0, 80)}...</div>
                                                <div className="text-xs text-gray-400 mt-1">{email.date}</div>
                                            </div>
                                        ))
                                    ) : (
                                        <div className="text-center py-12 text-gray-500">
                                            <div className="text-6xl mb-4"></div>
                                            <p>No sent emails</p>
                                        </div>
                                    )
                                ) : inboxViewMode === 'drafts' ? (
                                    drafts.length > 0 ? (
                                        drafts.map((draft, index) => (
                                            <div
                                                key={draft.id}
                                                className="modern-email-item"
                                                style={{animationDelay: `${index * 0.05}s`, position: 'relative'}}
                                            >
                                                <div className="text-xs font-bold text-gray-800 mb-1 truncate"> Draft</div>
                                                <div className="text-sm font-semibold text-gray-700 mb-1 truncate">{draft.prompt}</div>
                                                <div className="text-xs text-gray-600 truncate">{draft.content.substring(0, 80)}...</div>
                                                <div className="text-xs text-gray-400 mt-1">{new Date(draft.timestamp).toLocaleString()}</div>
                                                <div style={{display: 'flex', gap: '8px', marginTop: '8px'}}>
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            setEmailText(draft.content);
                                                            showNotification('Draft loaded to editor!');
                                                        }}
                                                        style={{
                                                            padding: '6px 12px',
                                                            background: 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '50px',
                                                            fontSize: '11px',
                                                            fontWeight: '600',
                                                            cursor: 'pointer'
                                                        }}
                                                    >
                                                        Use
                                                    </button>
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            deleteDraft(draft.id);
                                                        }}
                                                        style={{
                                                            padding: '6px 12px',
                                                            background: 'rgba(239, 68, 68, 0.1)',
                                                            color: '#ef4444',
                                                            border: '1px solid rgba(239, 68, 68, 0.2)',
                                                            borderRadius: '50px',
                                                            fontSize: '11px',
                                                            fontWeight: '600',
                                                            cursor: 'pointer'
                                                        }}
                                                    >
                                                        Delete
                                                    </button>
                                                </div>
                                            </div>
                                        ))
                                    ) : (
                                        <div className="text-center py-12 text-gray-500">
                                            <div className="text-6xl mb-4"></div>
                                            <p>No drafts saved</p>
                                        </div>
                                    )
                                ) : null}
                            </div>
                        )}
                    </div>
                </div>
            </div>
        )}

                    {/* Mobile Email Viewer Fullscreen */}
                    {(emailConnected || outlookConnected) && viewingEmail && (
                        <div
                            className={`mobile-email-viewer ${mobileEmailViewerOpen ? 'active' : ''}`}
                            onTouchStart={(e) => {
                                const header = e.target.closest('.mobile-email-header');
                                if (header) {
                                    setMobileViewerStartY(e.touches[0].clientY);
                                }
                            }}
                            onTouchMove={(e) => {
                                const header = e.target.closest('.mobile-email-header');
                                if (header && mobileViewerStartY > 0) {
                                    const deltaY = e.touches[0].clientY - mobileViewerStartY;
                                    if (deltaY > 0) {
                                        setMobileViewerCurrentY(deltaY);
                                        e.currentTarget.style.transform = `translateY(${deltaY}px)`;
                                    }
                                }
                            }}
                            onTouchEnd={(e) => {
                                const header = e.target.closest('.mobile-email-header');
                                if (header && mobileViewerCurrentY > 100) {
                                    setMobileEmailViewerOpen(false);
                                    setTimeout(() => {
                                        setViewingEmail(null);
                                        e.currentTarget.style.transform = '';
                                    }, 400);
                                } else {
                                    e.currentTarget.style.transform = '';
                                }
                                setMobileViewerStartY(0);
                                setMobileViewerCurrentY(0);
                            }}
                        >
                            {/* Header with Close Indicator */}
                            <div className="mobile-email-header">
                                <div
                                    className="mobile-email-close-bar"
                                    onClick={() => {
                                        setNavTransitioning(true);
                                        setTimeout(() => {
                                            setNavEmailMode(false);
                                            setMobileEmailViewerOpen(false);
                                            setTimeout(() => setViewingEmail(null), 400);
                                            setNavTransitioning(false);
                                        }, 400);
                                    }}
                                >
                                    <div className="mobile-email-close-indicator"></div>
                                </div>
                            </div>

                            {/* Email Content */}
                            <div className="mobile-email-content">
                                {/* Subject and Metadata */}
                                <div className="mobile-email-subject">{viewingEmail.subject}</div>
                                <div className="mobile-email-from">From: {viewingEmail.from}</div>
                                <div className="mobile-email-date">{viewingEmail.date}</div>

                                {/* Email Body */}
                                <div className="mobile-email-body" style={{
                                    maxHeight: '250px',
                                    overflow: 'hidden'
                                }}>{viewingEmail.body || viewingEmail.snippet}</div>
                                {(viewingEmail.body || viewingEmail.snippet) && (viewingEmail.body || viewingEmail.snippet).length > 300 && (
                                    <button
                                        className="view-full-email-btn"
                                        onClick={() => handleViewFullEmail(viewingEmail)}
                                        style={{marginTop: '12px'}}
                                    >
                                        <span></span>
                                        <span>View Full Email</span>
                                    </button>
                                )}

                                {/* Summary Section */}
                                {summarizingEmail === viewingEmail.id && (
                                    <div className="mobile-email-section">
                                        {isSummarizing ? (
                                            <div style={{textAlign: 'center', padding: '20px'}}>
                                                <div className="animate-spin rounded-full h-8 w-8 border-3 border-indigo-600 border-t-transparent" style={{margin: '0 auto 12px'}}></div>
                                                <span style={{fontSize: '14px', color: darkMode ? '#e5e5e5' : '#374151', fontWeight: '600'}}>Summarizing...</span>
                                            </div>
                                        ) : (
                                            <div>
                                                <div className="mobile-email-section-title">
                                                    <span> Summary</span>
                                                    <button
                                                        onClick={() => setSummaryHidden(!summaryHidden)}
                                                        style={{
                                                            marginLeft: 'auto',
                                                            padding: '4px 12px',
                                                            background: 'rgba(99, 102, 241, 0.1)',
                                                            border: '2px solid rgba(99, 102, 241, 0.3)',
                                                            borderRadius: '12px',
                                                            color: '#6366f1',
                                                            fontSize: '12px',
                                                            fontWeight: '600',
                                                            cursor: 'pointer'
                                                        }}
                                                    >
                                                        {summaryHidden ? 'Show' : 'Hide'}
                                                    </button>
                                                </div>
                                                {!summaryHidden && (
                                                    <p style={{fontSize: '14px', lineHeight: '1.6', color: darkMode ? '#d1d5db' : '#374151'}}>
                                                        {summaryText}
                                                    </p>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                )}

                                {/* AI Draft Section */}
                                {hasDraft && (
                                    <div className="mobile-email-section">
                                        <div className="mobile-email-section-title">
                                             AI-Generated Draft
                                        </div>
                                        <div className="mobile-ai-draft-container">
                                            <p style={{fontSize: '14px', lineHeight: '1.6', color: darkMode ? '#d1d5db' : '#374151', marginBottom: '12px'}}>
                                                {aiDraft}
                                            </p>
                                            <button
                                                onClick={() => {
                                                    setEmailReply(aiDraft);
                                                    playNotificationSound();
                                                }}
                                                style={{
                                                    width: '100%',
                                                    padding: '12px',
                                                    background: 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',
                                                    color: 'white',
                                                    border: 'none',
                                                    borderRadius: '12px',
                                                    fontSize: '14px',
                                                    fontWeight: '600',
                                                    cursor: 'pointer'
                                                }}
                                            >
                                                Use This Draft
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {/* Reply Section */}
                                <div className="mobile-email-section">
                                    <div className="mobile-email-section-title">
                                         Write Reply
                                    </div>

                                    {/* Quick Reply Suggestions */}
                                    {showQuickReplies && (
                                        <div className="mobile-quick-replies">
                                            <button
                                                className="mobile-quick-reply-btn"
                                                onClick={() => {
                                                    const greeting = useSignature ? `Hi ${viewingEmail.from.split(' ')[0]},\n\n` : 'Hi,\n\n';
                                                    const closing = useSignature ? `\n\nBest regards,\n${userData?.name?.split(' ')[0] || 'there'}` : '\n\nBest regards,\n[Your name]';
                                                    setEmailReply(greeting + 'Thank you for your email. I appreciate you reaching out!' + closing);
                                                    playNotificationSound();
                                                }}
                                            >
                                                 Thank You
                                            </button>
                                            <button
                                                className="mobile-quick-reply-btn"
                                                onClick={() => {
                                                    const greeting = useSignature ? `Hi ${viewingEmail.from.split(' ')[0]},\n\n` : 'Hi,\n\n';
                                                    const closing = useSignature ? `\n\nBest regards,\n${userData?.name?.split(' ')[0] || 'there'}` : '\n\nBest regards,\n[Your name]';
                                                    setEmailReply(greeting + 'That sounds great! I\'m happy to help with this.' + closing);
                                                    playNotificationSound();
                                                }}
                                            >
                                                 Sounds Good
                                            </button>
                                            <button
                                                className="mobile-quick-reply-btn"
                                                onClick={() => {
                                                    const greeting = useSignature ? `Hi ${viewingEmail.from.split(' ')[0]},\n\n` : 'Hi,\n\n';
                                                    const closing = useSignature ? `\n\nBest regards,\n${userData?.name?.split(' ')[0] || 'there'}` : '\n\nBest regards,\n[Your name]';
                                                    setEmailReply(greeting + 'Let me check my calendar and get back to you shortly.' + closing);
                                                    playNotificationSound();
                                                }}
                                            >
                                                 Check Calendar
                                            </button>
                                        </div>
                                    )}

                                    {/* Reply Textarea */}
                                    <textarea
                                        className="mobile-reply-textarea"
                                        value={emailReply}
                                        onChange={(e) => setEmailReply(e.target.value)}
                                        placeholder="Type your reply here..."
                                    />

                                    {/* Send Button */}
                                    <button
                                        onClick={async () => {
                                            if (emailReply.trim()) {
                                                // Send reply logic here
                                                alert('Reply sent! (Demo mode)');
                                                setEmailReply('');
                                            }
                                        }}
                                        style={{
                                            width: '100%',
                                            padding: '14px',
                                            marginTop: '12px',
                                            background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '12px',
                                            fontSize: '15px',
                                            fontWeight: '700',
                                            cursor: 'pointer',
                                            boxShadow: '0 4px 12px rgba(16, 185, 129, 0.3)'
                                        }}
                                    >
                                         Send Reply
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Mobile Inbox components and modals would go here - keeping code length manageable */}

                    {/* AI Floating Particles */}
                    <div className="ai-particle" style={{top: '20%', left: '10%', animationDelay: '0s'}}></div>
                    <div className="ai-particle" style={{top: '40%', right: '15%', animationDelay: '3s'}}></div>
                    <div className="ai-particle" style={{bottom: '30%', left: '20%', animationDelay: '6s'}}></div>
                    <div className="ai-particle" style={{top: '60%', right: '25%', animationDelay: '9s'}}></div>
                    <div className="ai-particle" style={{bottom: '20%', right: '10%', animationDelay: '12s'}}></div>

                    {/* Sticky Header */}
                    <header className={`sticky-header ${aiWritingMode ? 'ai-mode-hidden' : ''} ${aiWritingModeClosing ? 'ai-mode-visible' : ''}`}>
                        <div className="container mx-auto px-4 py-4">
                            <div className="flex justify-center items-center" style={{position: 'relative'}}>
                                {/* Navigation Bar - Dynamic based on email viewing mode */}
                                {!navEmailMode ? (
                                    <div
                                        className={`nav-container ${showSearchBar ? 'opacity-0 pointer-events-none' : 'opacity-100'} ${navTransitioning ? 'nav-blur-out' : 'nav-blur-in'}`}
                                        style={{transition: 'opacity 0.3s ease'}}
                                        ref={navRef}
                                    >
                                        <button
                                            onClick={() => {
                                                // Block navigation from settings to home if animation is showing
                                                if (currentPage === 'settings' && showConnectionAnimation) {
                                                    showNotification(' Just a sec, setting up final bits...');
                                                    return;
                                                }
                                                setCurrentPage('home');
                                            }}
                                            className={`px-6 py-2 rounded-full font-medium transition-all oval-button nav-tab unified-button border-2 border-white ${
                                                currentPage === 'home'
                                                    ? 'active text-gray-800'
                                                    : 'nav-tab-inactive text-gray-700 hover:bg-white/70'
                                            }`}
                                        >
                                            Home
                                        </button>
                                        <button
                                            onClick={() => setCurrentPage('settings')}
                                            className={`px-6 py-2 rounded-full font-medium transition-all oval-button nav-tab unified-button border-2 border-white ${
                                                currentPage === 'settings'
                                                    ? 'active text-gray-800'
                                                    : 'nav-tab-inactive text-gray-700 hover:bg-white/70'
                                            }`}
                                        >
                                            Settings
                                        </button>
                                    </div>
                                ) : (
                                    <div
                                        className={`nav-container ${navTransitioning ? 'nav-blur-out' : 'nav-blur-in'}`}
                                        style={{display: 'flex', gap: '12px', alignItems: 'center'}}
                                    >
                                        {/* Back Button */}
                                        <button
                                            onClick={() => {
                                                setNavTransitioning(true);
                                                setTimeout(() => {
                                                    setNavEmailMode(false);
                                                    setMobileEmailViewerOpen(false);
                                                    setTimeout(() => setViewingEmail(null), 400);
                                                    setNavTransitioning(false);
                                                }, 400);
                                            }}
                                            className="px-5 py-2 rounded-full font-medium transition-all oval-button nav-tab unified-button border-2 border-white active text-gray-800"
                                            style={{marginRight: 'auto'}}
                                        >
                                             Back
                                        </button>

                                        {/* Summarize Button */}
                                        <button
                                            onClick={() => handleSummarizeEmail(viewingEmail)}
                                            className={`px-6 py-2 rounded-full font-medium transition-all oval-button nav-tab unified-button border-2 border-white active text-gray-800 ${showNavGlow ? 'nav-button-glow-once' : ''}`}
                                        >
                                             Summarize
                                        </button>

                                        {/* Reply Button */}
                                        <button
                                            onClick={() => {
                                                // Scroll to reply section
                                                const replySection = document.querySelector('.mobile-email-section');
                                                if (replySection) {
                                                    replySection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                                }
                                            }}
                                            className={`px-6 py-2 rounded-full font-medium transition-all oval-button nav-tab unified-button border-2 border-white active text-gray-800 ${showNavGlow ? 'nav-button-glow-once' : ''}`}
                                        >
                                             Reply
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    </header>

                    <div className="page-container relative z-10 container mx-auto px-4 py-8 max-w-8xl">
                        {currentPage === 'settings' ? renderSettings() : (
                            <>
                               {/* Animated Welcome Text */}
                                {showWelcomeAnimation && currentPage === 'home' && !emailConnected && (
                                    <div className={`welcome-text-container ${!showWelcomeAnimation ? 'fade-out' : ''}`}>
                                        <div className="welcome-text" key={currentWelcomeMessage}>
                                            {welcomeMessages[currentWelcomeMessage].split(' ').map((word, i) => (
                                                <span key={`${currentWelcomeMessage}-${i}`} style={{animationDelay: `${i * 0.08}s`}}>
                                                    {word}
                                                </span>
                                            ))}
                                            {userName && (
                                                <>
                                                    <span style={{animationDelay: `${welcomeMessages[currentWelcomeMessage].split(' ').length * 0.08}s`}}>
                                                        ,
                                                    </span>
                                                    <span style={{animationDelay: `${(welcomeMessages[currentWelcomeMessage].split(' ').length + 1) * 0.08}s`}}>
                                                        {userName}!
                                                    </span>
                                                </>
                                            )}
                                            <span className="typing-cursor" style={{animationDelay: `${(welcomeMessages[currentWelcomeMessage].split(' ').length + (userName ? 2 : 0)) * 0.08}s`}}></span>
                                        </div>
                                    </div>
                                )}

                              {/* Desktop Layout: Inbox Sidebar + Content Area */}
                                {(emailConnected || outlookConnected) && currentPage === 'home' && (
                                    <>
                                    <div className={`desktop-inbox-layout ${(showCenteredWriter && !isReplyOnlyMode) ? 'generating-mode' : ''}`}>
                                        {/* Left Sidebar - Inbox */}
                                        {/* Left Sidebar - Inbox */}
                                         <div className={`inbox-sidebar ${aiWritingMode ? 'ai-mode-hidden' : ''} ${aiWritingModeClosing ? 'ai-mode-visible' : ''} ${(showCenteredWriter && !isReplyOnlyMode) ? 'generating-hidden' : ''}`}>
                                            {/* Header with Title and Buttons */}
                                            <div className="inbox-header">
                                                <div className="inbox-header-left">
                                                    <h2 className="text-2xl font-bold text-gray-800">
                                                        {inboxViewMode === 'tabs' ? ' Inbox' :
                                                         inboxViewMode === 'received' ? (activeProvider === 'gmail' ? ' Gmail - Received' : ' Outlook - Received') :
                                                         inboxViewMode === 'sent' ? (activeProvider === 'gmail' ? ' Gmail - Sent' : ' Outlook - Sent') :
                                                         inboxViewMode === 'drafts' ? ' Drafts' : ' Inbox'}
                                                    </h2>
                                                </div>
                                                <div className="inbox-header-right">
                                                    {inboxViewMode === 'received' && (
                                                        autoPrioritize ? (
                                                            <div className="px-3 py-1.5 glass-effect rounded-full text-xs font-semibold text-green-600 border-2 border-green-400 flex items-center gap-2">
                                                                <span className="animate-pulse"></span>
                                                                <span>Auto Priority</span>
                                                            </div>
                                                        ) : (
                                                            (activeProvider === 'gmail' ? (emailConnected && gmailEmails.length > 0) : (outlookConnected && outlookEmails.length > 0)) && (
                                                                <button
                                                                    onClick={() => handlePrioritizeEmails()}
                                                                    disabled={isPrioritizing}
                                                                    className={`oval-button px-4 py-2 text-sm font-semibold glass-effect border-2 border-white unified-button text-gray-800 ${isPrioritizing ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                                >
                                                                    {isPrioritizing ? ' Prioritizing...' : ' Prioritize'}
                                                                </button>
                                                            )
                                                        )
                                                    )}
                                                </div>
                                            </div>

                                            {/* Search Bar - Only show when not in tabs view */}
                                            {inboxViewMode !== 'tabs' && (
                                                <div className={`inbox-search-container ${showInboxSearchSuggestions && inboxSearchResults.length > 0 ? 'expanded' : ''}`}>
                                                    <input
                                                        type="text"
                                                        value={inboxSearchQuery}
                                                        onChange={(e) => {
                                                            setInboxSearchQuery(e.target.value);
                                                            if (e.target.value) {
                                                                const currentEmails = activeProvider === 'outlook' ? outlookEmails : gmailEmails;
                                                                const results = currentEmails.filter(email =>
                                                                    email.subject.toLowerCase().includes(e.target.value.toLowerCase()) ||
                                                                    email.from.toLowerCase().includes(e.target.value.toLowerCase()) ||
                                                                    email.snippet.toLowerCase().includes(e.target.value.toLowerCase())
                                                                ).slice(0, 5);
                                                                setInboxSearchResults(results);
                                                                setShowInboxSearchSuggestions(true);
                                                            } else {
                                                                setShowInboxSearchSuggestions(false);
                                                            }
                                                        }}
                                                        onFocus={() => setShowInboxSearchSuggestions(inboxSearchQuery.length > 0)}
                                                        placeholder=" Search emails..."
                                                        className="inbox-search-bar unified-button border-2 border-white"
                                                    />
                                                    {showInboxSearchSuggestions && inboxSearchResults.length > 0 && (
                                                        <>
                                                            {/* Search Suggestions */}
                                                            <div className={`inbox-search-suggestions ${showInboxSearchSuggestions && inboxSearchResults.length > 0 ? 'show' : ''}`} style={{
                                                                zIndex: 100
                                                            }}>
                                                                {inboxSearchResults.map(email => (
                                                                    <div
                                                                        key={email.id}
                                                                        className="inbox-search-suggestion-item"
                                                                        onClick={() => {
                                                                            setViewingEmail(email);
                                                                            setInboxSearchQuery('');
                                                                            setShowInboxSearchSuggestions(false);
                                                                        }}
                                                                    >
                                                                        <div className="text-xs font-bold text-gray-800">{email.from || email.to}</div>
                                                                        <div className="text-sm font-semibold text-gray-700">{email.subject}</div>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        </>
                                                    )}
                                                </div>
                                            )}

                                            {/* Prioritizing Glow Notification - Smaller */}
                                            {isPrioritizing && inboxViewMode !== 'tabs' && !showCenteredWriter && !isCenteredGenerating && (
                                                <div style={{marginBottom: '12px', animation: 'fadeInScale 0.3s ease-out'}}>
                                                    <div style={{
                                                        padding: '8px 16px',
                                                        background: 'linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.3) 50%, rgba(167, 139, 250, 0.2) 100%)',
                                                        backgroundSize: '200% 200%',
                                                        animation: 'prioritize-glow 2s ease-in-out infinite',
                                                        borderRadius: '50px',
                                                        display: 'flex',
                                                        alignItems: 'center',
                                                        justifyContent: 'center',
                                                        gap: '8px',
                                                        fontSize: '0.85rem',
                                                        fontWeight: 600,
                                                        color: '#6366f1',
                                                        backdropFilter: 'blur(10px)',
                                                        border: '2px solid rgba(99, 102, 241, 0.3)',
                                                        boxShadow: '0 4px 12px rgba(99, 102, 241, 0.2)'
                                                    }}>
                                                        <span style={{animation: 'pulse-icon 1.5s ease-in-out infinite'}}></span>
                                                        <span>Analyzing...</span>
                                                    </div>
                                                </div>
                                            )}

                                            {/* Email List Area */}
                                            <div className={`inbox-scroll-area ${showInboxSearchSuggestions && inboxSearchResults.length > 0 ? 'inbox-content-blur' : 'inbox-content-normal'}`}>
                                                {inboxViewMode === 'tabs' ? (
    /* Provider Selection View with Animated Showcase Carousel */
    <div className="text-center py-8 splash-container" style={{maxWidth: '100%', margin: '0 auto', overflow: 'hidden'}}>
        <div className="text-5xl mb-4" style={{animation: 'float 3s ease-in-out infinite'}}></div>
        <h3 className="text-xl font-bold text-gray-800 mb-2" style={{
            background: 'linear-gradient(135deg, #4f46e5, #9333ea)',
            WebkitBackgroundClip: 'text',
            WebkitTextFillColor: 'transparent'
        }}>
            Select Email Provider
        </h3>
        <p className="text-xs text-gray-600 mb-6">Connect to unlock AI-powered email management</p>

        {/* Animated Showcase Carousel */}
        <div className="showcase-carousel-container" style={{height: '280px'}}>
            <div className="showcase-track">
                {/* First set of cards */}
                <div className="showcase-card">
                    <div className="showcase-card-icon"></div>
                    <div className="showcase-card-title">Thanks for reaching out!</div>
                    <div className="showcase-card-example">"Thank you for your interest in our product..."</div>
                    <div className="showcase-card-response"> AI generates professional responses instantly</div>
                </div>
                <div className="showcase-card">
                    <div className="showcase-card-icon"></div>
                    <div className="showcase-card-title">Meeting Request</div>
                    <div className="showcase-card-example">"Can we schedule a call this week?"</div>
                    <div className="showcase-card-response"> Smart scheduling suggestions included</div>
                </div>
                <div className="showcase-card">
                    <div className="showcase-card-icon"></div>
                    <div className="showcase-card-title">I appreciate your help</div>
                    <div className="showcase-card-example">"Thank you so much for your assistance..."</div>
                    <div className="showcase-card-response"> Warm, personalized thank you notes</div>
                </div>
                <div className="showcase-card">
                    <div className="showcase-card-icon"></div>
                    <div className="showcase-card-title">Quick Update</div>
                    <div className="showcase-card-example">"Just a quick note to update you on..."</div>
                    <div className="showcase-card-response"> Concise status updates in seconds</div>
                </div>
                <div className="showcase-card">
                    <div className="showcase-card-icon"></div>
                    <div className="showcase-card-title">Looking forward to connecting</div>
                    <div className="showcase-card-example">"I'd love to learn more about..."</div>
                    <div className="showcase-card-response"> Professional networking responses</div>
                </div>
                <div className="showcase-card">
                    <div className="showcase-card-icon"></div>
                    <div className="showcase-card-title">Acknowledged</div>
                    <div className="showcase-card-example">"I've received your message and..."</div>
                    <div className="showcase-card-response"> Quick confirmations with context</div>
                </div>
                {/* Duplicate for infinite scroll */}
                <div className="showcase-card">
                    <div className="showcase-card-icon"></div>
                    <div className="showcase-card-title">Thanks for reaching out!</div>
                    <div className="showcase-card-example">"Thank you for your interest in our product..."</div>
                    <div className="showcase-card-response"> AI generates professional responses instantly</div>
                </div>
                <div className="showcase-card">
                    <div className="showcase-card-icon"></div>
                    <div className="showcase-card-title">Meeting Request</div>
                    <div className="showcase-card-example">"Can we schedule a call this week?"</div>
                    <div className="showcase-card-response"> Smart scheduling suggestions included</div>
                </div>
                <div className="showcase-card">
                    <div className="showcase-card-icon"></div>
                    <div className="showcase-card-title">I appreciate your help</div>
                    <div className="showcase-card-example">"Thank you so much for your assistance..."</div>
                    <div className="showcase-card-response"> Warm, personalized thank you notes</div>
                </div>
                <div className="showcase-card">
                    <div className="showcase-card-icon"></div>
                    <div className="showcase-card-title">Quick Update</div>
                    <div className="showcase-card-example">"Just a quick note to update you on..."</div>
                    <div className="showcase-card-response"> Concise status updates in seconds</div>
                </div>
                <div className="showcase-card">
                    <div className="showcase-card-icon"></div>
                    <div className="showcase-card-title">Looking forward to connecting</div>
                    <div className="showcase-card-example">"I'd love to learn more about..."</div>
                    <div className="showcase-card-response"> Professional networking responses</div>
                </div>
                <div className="showcase-card">
                    <div className="showcase-card-icon"></div>
                    <div className="showcase-card-title">Acknowledged</div>
                    <div className="showcase-card-example">"I've received your message and..."</div>
                    <div className="showcase-card-response"> Quick confirmations with context</div>
                </div>
            </div>
        </div>
    </div>
) : (
                                                    /* Email List View */
                                                    <div className={`${activeProvider === 'outlook' ? 'outlook-slide-enter' : 'gmail-slide-enter'}`} style={{
                                                        animation: 'fadeIn 0.4s ease-out'
                                                    }}>
                                                        {activeProvider === 'outlook' && !outlookConnected ? (
                                                            /* Not Connected Message */
                                                            <div className="text-center py-12 text-gray-500 fade-in">
                                                                <div className="text-6xl mb-4"></div>
                                                                <h3 className="text-lg font-bold text-gray-800 mb-2">Outlook Not Connected</h3>
                                                                <p className="text-sm text-gray-600 mb-4">Connect your Outlook account to view emails</p>
                                                                <button
                                                                    onClick={() => setCurrentPage('settings')}
                                                                    className="px-6 py-3 glass-effect rounded-full font-semibold transition-all hover:scale-105 border-2 border-white unified-button text-gray-800"
                                                                >
                                                                    Go to Settings
                                                                </button>
                                                            </div>
                                                        ) : (
                                                            <>
                                                                {/* Prioritized Emails Section */}
                                                                {priorityEmails.length > 0 && inboxViewMode === 'received' && (
                                                                    <>
                                                                        <div className="priority-stack-container" style={{
                                                                            animation: 'fadeInScale 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)'
                                                                        }}>
                                                                            {/* Collapsible Header */}
                                                                            <div
                                                                                className="prioritized-section-header"
                                                                                onClick={() => setPriorityStackExpanded(!priorityStackExpanded)}
                                                                                style={{cursor: 'pointer'}}
                                                                            >
                                                                                <div className="prioritized-section-title">
                                                                                    <span></span>
                                                                                    <span>Prioritized</span>
                                                                                    <span className="text-xs">({priorityEmails.length})</span>
                                                                                </div>
                                                                                <div style={{
                                                                                    transition: 'transform 0.3s ease',
                                                                                    transform: priorityStackExpanded ? 'rotate(180deg)' : 'rotate(0deg)',
                                                                                    fontSize: '20px'
                                                                                }}>
                                                                                    
                                                                                </div>
                                                                            </div>

                                                                            {/* Priority Stack */}
                                                                            <div style={{
                                                                                maxHeight: priorityStackExpanded ? '2000px' : '100px',
                                                                                overflow: 'hidden',
                                                                                transition: 'max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1)',
                                                                                position: 'relative'
                                                                            }}>
                                                                                {priorityStackExpanded ? (
                                                                                    /* Expanded - Show all priority emails */
                                                                                    <div className="space-y-2" style={{marginTop: '8px'}}>
                                                                                        {priorityEmails.map((email, index) => (
                                                                                            <div
                                                                                                key={email.id}
                                                                                                onClick={() => {
                                                                                                    setViewingEmail(email);
                                                                                                    if (unreadEmails.has(email.id)) {
                                                                                                        setUnreadEmails(prev => {
                                                                                                            const updated = new Set(prev);
                                                                                                            updated.delete(email.id);
                                                                                                            return updated;
                                                                                                        });
                                                                                                    }
                                                                                                }}
                                                                                                className={`sidebar-email-item ${viewingEmail?.id === email.id ? 'active' : ''}`}
                                                                                                style={{
                                                                                                    animation: 'priority-expand 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) backwards',
                                                                                                    animationDelay: `${index * 0.05}s`
                                                                                                }}
                                                                                            >
                                                                                                <button
                                                                                                    className="email-delete-btn"
                                                                                                    onClick={(e) => {
                                                                                                        e.stopPropagation();
                                                                                                        handleDeleteEmail(email.id, 'inbox');
                                                                                                    }}
                                                                                                >
                                                                                                    Delete
                                                                                                </button>
                                                                                                <div className="flex items-center gap-2 mb-1">
                                                                                                    <span className="text-xs"></span>
                                                                                                    <div className="text-xs font-bold text-gray-800 truncate flex-1">{email.from}</div>
                                                                                                </div>
                                                                                                <div className="text-sm font-semibold text-gray-700 mb-1 truncate">{email.subject}</div>
                                                                                                <div className="text-xs text-gray-600 truncate">{getFirstWords(email.snippet)}</div>
                                                                                                <div className="text-xs text-gray-400 mt-1">{email.date}</div>
                                                                                            </div>
                                                                                        ))}
                                                                                    </div>
                                                                                ) : (
                                                                                    /* Collapsed - Show stacked preview */
                                                                                    <div style={{position: 'relative', height: '80px', marginTop: '8px'}}>
                                                                                        {priorityEmails.slice(0, 3).map((email, index) => (
                                                                                            <div
                                                                                                key={email.id}
                                                                                                className="priority-stack-item"
                                                                                                style={{
                                                                                                    position: 'absolute',
                                                                                                    width: '100%',
                                                                                                    top: `${index * 4}px`,
                                                                                                    zIndex: 3 - index,
                                                                                                    transform: `scale(${1 - index * 0.02})`,
                                                                                                    opacity: 1 - index * 0.3,
                                                                                                    transition: 'all 0.3s ease'
                                                                                                }}
                                                                                            >
                                                                                                <div className="flex items-center justify-between">
                                                                                                    <div className="flex-1 pr-2">
                                                                                                        <div className="text-xs font-bold text-gray-800 mb-1 truncate flex items-center gap-2">
                                                                                                            <span></span>
                                                                                                            {email.from}
                                                                                                        </div>
                                                                                                        <div className="text-sm font-semibold text-gray-700 truncate">{email.subject}</div>
                                                                                                    </div>
                                                                                                    {index === 0 && priorityEmails.length > 1 && (
                                                                                                        <div className="text-xs bg-indigo-600 text-white px-2 py-1 rounded-full font-bold">
                                                                                                            +{priorityEmails.length - 1}
                                                                                                        </div>
                                                                                                    )}
                                                                                                </div>
                                                                                            </div>
                                                                                        ))}
                                                                                    </div>
                                                                                )}
                                                                            </div>
                                                                        </div>

                                                                        {/* Inbox Section Title */}
                                                                        <div style={{
                                                                            marginTop: '24px',
                                                                            marginBottom: '12px',
                                                                            paddingBottom: '8px',
                                                                            borderBottom: '2px solid rgba(99, 102, 241, 0.2)',
                                                                            display: 'flex',
                                                                            alignItems: 'center',
                                                                            gap: '8px'
                                                                        }}>
                                                                            <h3 className="text-sm font-bold text-gray-700" style={{color: darkMode ? '#e5e5e5' : '#374151'}}>
                                                                                 Inbox
                                                                            </h3>
                                                                            <span className="text-xs text-gray-500" style={{color: darkMode ? '#a0a0a0' : '#6b7280'}}>
                                                                                {(activeProvider === 'outlook' ? outlookEmails : gmailEmails).filter(email => !priorityEmails.find(p => p.id === email.id)).length} emails
                                                                            </span>
                                                                        </div>
                                                                    </>
                                                                )}

                                                                {/* Regular Email List */}
                                                                <div className="space-y-2">
                                                                    {inboxViewMode === 'received' ? (
                                                                        activeProvider === 'outlook' ? (
                                                                            outlookEmails.length > 0 ? (
                                                                                outlookEmails.filter(email => !priorityEmails.find(p => p.id === email.id)).map((email, index) => (
                                                                                    <div
                                                                                        key={email.id}
                                                                                        onClick={() => {
                                                                                            setViewingEmail(email);
                                                                                            if (unreadEmails.has(email.id)) {
                                                                                                setUnreadEmails(prev => {
                                                                                                    const updated = new Set(prev);
                                                                                                    updated.delete(email.id);
                                                                                                    return updated;
                                                                                                });
                                                                                            }
                                                                                        }}
                                                                                        className={`sidebar-email-item ${viewingEmail?.id === email.id ? 'active' : ''} ${unreadEmails.has(email.id) ? 'unread-email' : ''} ${deletingEmailId === email.id ? 'deleting-email' : ''}`}
                                                                                        style={{animationDelay: `${index * 0.05}s`}}
                                                                                    >
                                                                                        <button
                                                                                            className="email-delete-btn"
                                                                                            onClick={(e) => {
                                                                                                e.stopPropagation();
                                                                                                handleDeleteEmail(email.id, 'inbox');
                                                                                            }}
                                                                                        >
                                                                                            Delete
                                                                                        </button>
                                                                                        {unreadEmails.has(email.id) && (
                                                                                            <div className="unread-label" style={{position: 'absolute', top: '8px', right: '8px', fontSize: '9px', padding: '2px 6px'}}>
                                                                                                NEW
                                                                                            </div>
                                                                                        )}
                                                                                        <div className="text-xs font-bold text-gray-800 mb-1 truncate">{email.from}</div>
                                                                                        <div className="text-sm font-semibold text-gray-700 mb-1 truncate">{email.subject}</div>
                                                                                        <div className="text-xs text-gray-600 truncate">{getFirstWords(email.snippet)}</div>
                                                                                        <div className="text-xs text-gray-400 mt-1">{email.date}</div>
                                                                                    </div>
                                                                                ))
                                                                            ) : (
                                                                                <div className="text-center py-12 text-gray-500">
                                                                                    <div className="text-6xl mb-4"></div>
                                                                                    <p>No Outlook emails</p>
                                                                                </div>
                                                                            )
                                                                        ) : (
                                                                            gmailEmails.filter(email => !priorityEmails.find(p => p.id === email.id)).map((email, index) => (
                                                                                <div
                                                                                    key={email.id}
                                                                                    onClick={() => {
                                                                                        setViewingEmail(email);
                                                                                        if (unreadEmails.has(email.id)) {
                                                                                            setUnreadEmails(prev => {
                                                                                                const updated = new Set(prev);
                                                                                                updated.delete(email.id);
                                                                                                return updated;
                                                                                            });
                                                                                        }
                                                                                    }}
                                                                                    className={`sidebar-email-item inbox-email-draggable ${viewingEmail?.id === email.id ? 'active' : ''} ${unreadEmails.has(email.id) ? 'unread-email' : ''} ${deletingEmailId === email.id ? 'deleting-email' : ''} ${draggedEmail?.id === email.id ? 'dragging' : ''}`}
                                                                                    style={{animationDelay: `${index * 0.05}s`}}
                                                                                    draggable="true"
                                                                                    onDragStart={(e) => {
                                                                                        setDraggedEmail(email);
                                                                                        e.dataTransfer.effectAllowed = 'move';
                                                                                    }}
                                                                                    onDragEnd={() => setDraggedEmail(null)}
                                                                                >
                                                                                    <button
                                                                                        className="email-delete-btn"
                                                                                        onClick={(e) => {
                                                                                            e.stopPropagation();
                                                                                            handleDeleteEmail(email.id, 'inbox');
                                                                                        }}
                                                                                    >
                                                                                        Delete
                                                                                    </button>
                                                                                    {unreadEmails.has(email.id) && (
                                                                                        <div className="unread-label" style={{position: 'absolute', top: '8px', right: '8px', fontSize: '9px', padding: '2px 6px'}}>
                                                                                            NEW
                                                                                        </div>
                                                                                    )}
                                                                                    <div className="text-xs font-bold text-gray-800 mb-1 truncate">{email.from}</div>
                                                                                    <div className="text-sm font-semibold text-gray-700 mb-1 truncate">{email.subject}</div>
                                                                                    <div className="text-xs text-gray-600 truncate">{getFirstWords(email.snippet)}</div>
                                                                                    <div className="text-xs text-gray-400 mt-1">{email.date}</div>
                                                                                </div>
                                                                            ))
                                                                        )
                                                                    ) : inboxViewMode === 'sent' ? (
                                                                        /* Sent Emails */
                                                                        activeProvider === 'outlook' ? (
                                                                            outlookSentEmails.filter(email => !deletedEmails.includes(email.id)).length > 0 ? (
                                                                                outlookSentEmails.filter(email => !deletedEmails.includes(email.id)).map((email, index) => (
                                                                                    <div
                                                                                        key={email.id}
                                                                                        onClick={() => setViewingEmail(email)}
                                                                                        className={`sidebar-email-item ${viewingEmail?.id === email.id ? 'active' : ''} ${deletingEmailId === email.id ? 'deleting-email' : ''}`}
                                                                                        style={{animationDelay: `${index * 0.05}s`}}
                                                                                    >
                                                                                        <button
                                                                                            className="email-delete-btn"
                                                                                            onClick={(e) => {
                                                                                                e.stopPropagation();
                                                                                                handleDeleteEmail(email.id, 'sent');
                                                                                            }}
                                                                                        >
                                                                                            Delete
                                                                                        </button>
                                                                                        <div className="text-xs font-bold text-gray-800 mb-1 truncate">To: {email.to}</div>
                                                                                        <div className="text-sm font-semibold text-gray-700 mb-1 truncate">{email.subject}</div>
                                                                                        <div className="text-xs text-gray-600 truncate">{getFirstWords(email.snippet)}</div>
                                                                                        <div className="text-xs text-gray-400 mt-1">{email.date}</div>
                                                                                    </div>
                                                                                ))
                                                                            ) : (
                                                                                <div className="text-center py-12 text-gray-500">
                                                                                    <div className="text-6xl mb-4"></div>
                                                                                    <p>No Outlook sent emails</p>
                                                                                </div>
                                                                            )
                                                                        ) : (
                                                                            sentEmails.filter(email => !deletedEmails.includes(email.id)).length > 0 ? (
                                                                                sentEmails.filter(email => !deletedEmails.includes(email.id)).map((email, index) => (
                                                                                    <div
                                                                                        key={email.id}
                                                                                        onClick={() => setViewingEmail(email)}
                                                                                        className={`sidebar-email-item ${viewingEmail?.id === email.id ? 'active' : ''} ${deletingEmailId === email.id ? 'deleting-email' : ''}`}
                                                                                        style={{animationDelay: `${index * 0.05}s`}}
                                                                                    >
                                                                                        <button
                                                                                            className="email-delete-btn"
                                                                                            onClick={(e) => {
                                                                                                e.stopPropagation();
                                                                                                handleDeleteEmail(email.id, 'sent');
                                                                                            }}
                                                                                        >
                                                                                            Delete
                                                                                        </button>
                                                                                        <div className="text-xs font-bold text-gray-800 mb-1 truncate">To: {email.to}</div>
                                                                                        <div className="text-sm font-semibold text-gray-700 mb-1 truncate">{email.subject}</div>
                                                                                        <div className="text-xs text-gray-600 truncate">{getFirstWords(email.snippet)}</div>
                                                                                        <div className="text-xs text-gray-400 mt-1">{email.date}</div>
                                                                                    </div>
                                                                                ))
                                                                            ) : (
                                                                                <div className="text-center py-12 text-gray-500">
                                                                                    <div className="text-6xl mb-4"></div>
                                                                                    <p>No Gmail sent emails</p>
                                                                                </div>
                                                                            )
                                                                        )
                                                                    ) : inboxViewMode === 'drafts' ? (
                                                                        /* Drafts */
                                                                        drafts.length > 0 ? (
                                                                            drafts.map((draft, index) => (
                                                                                <div
                                                                                    key={draft.id}
                                                                                    className="sidebar-email-item"
                                                                                    style={{animationDelay: `${index * 0.05}s`, position: 'relative'}}
                                                                                >
                                                                                    <button
                                                                                        className="email-delete-btn"
                                                                                        onClick={(e) => {
                                                                                            e.stopPropagation();
                                                                                            deleteDraft(draft.id);
                                                                                        }}
                                                                                    >
                                                                                        Delete
                                                                                    </button>
                                                                                    <div className="text-xs font-bold text-gray-800 mb-1 truncate"> Draft</div>
                                                                                    <div className="text-sm font-semibold text-gray-700 mb-1 truncate">{draft.prompt}</div>
                                                                                    <div className="text-xs text-gray-600 truncate">{draft.content.substring(0, 80)}...</div>
                                                                                    <div className="text-xs text-gray-400 mt-1">{new Date(draft.timestamp).toLocaleString()}</div>
                                                                                    <div style={{display: 'flex', gap: '8px', marginTop: '8px'}}>
                                                                                        <button
                                                                                            onClick={(e) => {
                                                                                                e.stopPropagation();
                                                                                                setEmailText(draft.content);
                                                                                                showNotification('Draft loaded to editor!');
                                                                                            }}
                                                                                            className="oval-button px-3 py-1.5 text-xs font-semibold glass-effect border-2 border-white unified-button text-gray-800"
                                                                                        >
                                                                                            Load to Editor
                                                                                        </button>
                                                                                    </div>
                                                                                </div>
                                                                            ))
                                                                        ) : (
                                                                            <div className="text-center py-12 text-gray-500">
                                                                                <div className="text-6xl mb-4"></div>
                                                                                <p>No drafts saved</p>
                                                                            </div>
                                                                        )
                                                                    ) : null}
                                                                </div>
                                                            </>
                                                        )}
                                                    </div>
                                                )}
                                            </div>

                                            {/* Bottom Tabs - Single Location with Smooth Transitions */}
                                            <div style={{marginTop: 'auto', paddingTop: '16px'}}>
                                                {inboxViewMode === 'tabs' ? (
                                                    /* Provider Selection */
                                                    <div className="provider-tabs-container" style={{
                                                        animation: 'fadeIn 0.3s ease-out'
                                                    }}>
                                                        {emailConnected && (
                                                            <div
                                                                className={`provider-tab unified-button ${activeProvider === 'gmail' ? 'active' : ''}`}
                                                                onClick={() => {
                                                                    setActiveProvider('gmail');
                                                                    setInboxViewMode('received');
                                                                    setPriorityEmails([]);
                                                                    setViewingEmail(null);
                                                                }}
                                                            >
                                                                 Gmail
                                                            </div>
                                                        )}
                                                        <div
                                                            className={`provider-tab unified-button ${activeProvider === 'outlook' ? 'active' : ''}`}
                                                            onClick={() => {
                                                                setActiveProvider('outlook');
                                                                setInboxViewMode('received');
                                                                setPriorityEmails([]);
                                                                setViewingEmail(null);
                                                            }}
                                                        >
                                                             Outlook
                                                        </div>
                                                    </div>
                                                ) : (
                                                    /* Received/Sent Toggle with Back Button */
                                                    <div style={{
                                                        display: 'flex',
                                                        gap: '8px',
                                                        alignItems: 'center',
                                                        animation: 'fadeIn 0.3s ease-out'
                                                    }}>
                                                        <button
                                                            className="inbox-back-btn-tab"
                                                            onClick={() => {
                                                                setInboxViewMode('tabs');
                                                                setPriorityEmails([]);
                                                                setViewingEmail(null);
                                                            }}
                                                            title="Back to providers"
                                                        >
                                                            
                                                        </button>
                                                        <div className="inbox-view-toggle" style={{flex: 1}}>
                                                            <button
                                                                className={`inbox-view-toggle-btn ${inboxViewMode === 'received' ? 'active' : ''}`}
                                                                onClick={() => {
                                                                    setInboxViewMode('received');
                                                                    setViewingEmail(null);
                                                                }}
                                                            >
                                                                 Received
                                                            </button>
                                                            <button
                                                                className={`inbox-view-toggle-btn ${inboxViewMode === 'sent' ? 'active' : ''}`}
                                                                onClick={() => {
                                                                    setInboxViewMode('sent');
                                                                    setPriorityEmails([]);
                                                                    setViewingEmail(null);
                                                                }}
                                                            >
                                                                 Sent
                                                            </button>
                                                            {drafts.length > 0 && (
                                                                <button
                                                                    className={`inbox-view-toggle-btn ${inboxViewMode === 'drafts' ? 'active' : ''}`}
                                                                    onClick={() => {
                                                                        setInboxViewMode('drafts');
                                                                        setPriorityEmails([]);
                                                                        setViewingEmail(null);
                                                                    }}
                                                                >
                                                                     Drafts
                                                                </button>
                                                            )}
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        </div>

                                        {/* Right Content Area - Email Viewer or AI Tools */}
                                        <div
                                        className={`email-content-area ${viewingEmail ? 'viewing-email' : 'drop-zone'} ${isDraggingOver ? 'drag-over' : ''} ${aiWritingMode ? 'ai-mode-centered' : ''} ${aiWritingModeClosing ? 'ai-mode-normal' : ''} ${(showCenteredWriter && !isReplyOnlyMode) ? 'generating-centered' : ''}`}
                                            onDragOver={(e) => {
                                                e.preventDefault();
                                                setIsDraggingOver(true);
                                            }}
                                            onDragLeave={(e) => {
                                                e.preventDefault();
                                                setIsDraggingOver(false);
                                            }}
onDrop={(e) => {
                                                e.preventDefault();
                                                setIsDraggingOver(false);

                                                // Helper function to clean and format email content
                                                const cleanEmailContent = (text) => {
                                                    if (!text) return '';

                                                    // Decode HTML entities
                                                    const decodeHTML = (html) => {
                                                        const textarea = document.createElement('textarea');
                                                        textarea.innerHTML = html;
                                                        return textarea.value;
                                                    };

                                                    let cleaned = text;

                                                    // Remove script and style tags with their content
                                                    cleaned = cleaned.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
                                                    cleaned = cleaned.replace(/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi, '');

                                                    // Convert common HTML tags to text equivalents
                                                    cleaned = cleaned.replace(/<br\s*\/?>/gi, '\n');
                                                    cleaned = cleaned.replace(/<\/p>/gi, '\n\n');
                                                    cleaned = cleaned.replace(/<\/div>/gi, '\n');
                                                    cleaned = cleaned.replace(/<\/h[1-6]>/gi, '\n\n');
                                                    cleaned = cleaned.replace(/<li>/gi, ' ');
                                                    cleaned = cleaned.replace(/<\/li>/gi, '\n');

                                                    // Remove all remaining HTML tags
                                                    cleaned = cleaned.replace(/<[^>]+>/g, '');

                                                    // Decode HTML entities
                                                    cleaned = decodeHTML(cleaned);

                                                    // Remove email headers and technical content
                                                    cleaned = cleaned.replace(/^Content-Type:.*$/gm, '');
                                                    cleaned = cleaned.replace(/^Content-Transfer-Encoding:.*$/gm, '');
                                                    cleaned = cleaned.replace(/^MIME-Version:.*$/gm, '');
                                                    cleaned = cleaned.replace(/^--[=_].*$/gm, '');
                                                    cleaned = cleaned.replace(/^boundary=.*$/gm, '');

                                                    // Remove base64 and encoded content markers
                                                    cleaned = cleaned.replace(/^[A-Za-z0-9+/=]{60,}$/gm, '');

                                                    // Clean up excessive whitespace while preserving paragraph breaks
                                                    cleaned = cleaned.replace(/[ \t]+/g, ' '); // Multiple spaces to single space
                                                    cleaned = cleaned.replace(/\n[ \t]+/g, '\n'); // Remove leading spaces on lines
                                                    cleaned = cleaned.replace(/[ \t]+\n/g, '\n'); // Remove trailing spaces on lines
                                                    cleaned = cleaned.replace(/\n{3,}/g, '\n\n'); // Max 2 consecutive newlines

                                                    // Trim and return
                                                    return cleaned.trim();
                                                };

                                                // Handle internal email drag from inbox
                                                if (draggedEmail) {
                                                    let emailContent = '';

                                                    if (draggedEmail.subject) {
                                                        emailContent += 'Subject: ' + draggedEmail.subject + '\n';
                                                    }
                                                    if (draggedEmail.from) {
                                                        emailContent += 'From: ' + draggedEmail.from + '\n';
                                                    }
                                                    if (draggedEmail.date) {
                                                        emailContent += 'Date: ' + draggedEmail.date + '\n';
                                                    }

                                                    emailContent += '\n';

                                                    if (draggedEmail.body) {
                                                        const cleanBody = cleanEmailContent(draggedEmail.body);
                                                        emailContent += cleanBody;
                                                    }

                                                    setEmailText(emailContent);
                                                    setViewingEmail(null);
                                                    setDroppedEmailFile(null);
                                                    showNotification(' Email content pasted successfully!');
                                                    return;
                                                }

                                                // Handle external file drops (email files)
                                                const files = e.dataTransfer.files;
                                                if (files && files.length > 0) {
                                                    const file = files[0];
                                                    const reader = new FileReader();

                                                    reader.onload = (event) => {
                                                        let content = event.target.result;

                                                        // Parse .eml files to extract body text
                                                        if (file.name.endsWith('.eml') || file.type === 'message/rfc822') {
                                                            const lines = content.split('\n');
                                                            let inBody = false;
                                                            let bodyText = '';
                                                            let subject = '';
                                                            let from = '';
                                                            let date = '';
                                                            let isHtml = false;
                                                            let inPlainText = false;

                                                            for (let i = 0; i < lines.length; i++) {
                                                                const line = lines[i];

                                                                // Extract headers
                                                                if (!inBody) {
                                                                    if (line.toLowerCase().startsWith('subject:')) {
                                                                        subject = line.substring(8).trim();
                                                                    } else if (line.toLowerCase().startsWith('from:')) {
                                                                        from = line.substring(5).trim();
                                                                    } else if (line.toLowerCase().startsWith('date:')) {
                                                                        date = line.substring(5).trim();
                                                                    } else if (line.toLowerCase().includes('content-type: text/html')) {
                                                                        isHtml = true;
                                                                    } else if (line.toLowerCase().includes('content-type: text/plain')) {
                                                                        inPlainText = true;
                                                                    } else if (line.trim() === '') {
                                                                        inBody = true;
                                                                    }
                                                                } else {
                                                                    // Collect body content, skip boundaries
                                                                    if (!line.startsWith('--') || !line.match(/^--[=_]/)) {
                                                                        bodyText += line + '\n';
                                                                    }
                                                                }
                                                            }

                                                            // Build readable email content
                                                            let extractedText = '';
                                                            if (subject) extractedText += 'Subject: ' + subject + '\n';
                                                            if (from) extractedText += 'From: ' + from + '\n';
                                                            if (date) extractedText += 'Date: ' + date + '\n';
                                                            extractedText += '\n';

                                                            // Clean the body text
                                                            const cleanBody = cleanEmailContent(bodyText);
                                                            extractedText += cleanBody;

                                                            content = extractedText || content;
                                                        }

                                                        setEmailText(content);
                                                        setViewingEmail(null);
                                                        setDroppedEmailFile(null);
                                                        setUploadedFile(null);
                                                        showNotification(' Email file loaded successfully!');
                                                    };

                                                    reader.readAsText(file);
                                                }
                                            }}
                                        >
                                            

                                            {viewingEmail && !showCenteredWriter ? (
                                                <>
                                                    {/* Email Viewer Header */}
                                                    <div className="email-viewer-header">
                                                        {/* Back button - hidden during generation */}
                                                        {!isCenteredGenerating && (
                                                            <button
                                                                onClick={() => setViewingEmail(null)}
                                                                className="px-4 py-2 glass-effect rounded-full text-gray-700 text-sm font-medium hover:bg-white/90 transition-all unified-button border-2 border-white flex items-center gap-2"
                                                                style={{
                                                                    transition: 'all 0.3s ease'
                                                                }}
                                                            >
                                                                <span></span>
                                                                <span>Back</span>
                                                            </button>
                                                        )}
                                                        <div className="email-action-buttons">
                                                            <button
                                                                onClick={() => handleSummarizeEmail(viewingEmail)}
                                                                className="px-4 py-2 rounded-full text-gray-800 text-sm font-medium hover:opacity-90 transition-all unified-button border-2 border-white glass-effect"
                                                            >
                                                                 Summarize
                                                            </button>
                                                            <button
                                                                onClick={() => {
                                                                    setEmailReply('');
                                                                    setTimeout(() => {
                                                                        document.getElementById('reply-section')?.scrollIntoView({ behavior: 'smooth' });
                                                                    }, 100);
                                                                }}
                                                                className="px-4 py-2 glass-effect rounded-full text-gray-700 text-sm font-medium hover:bg-white/90 transition-all unified-button border-2 border-white"
                                                            >
                                                                 Reply
                                                            </button>
                                                        </div>
                                                    </div>

                                                    {/* Email Content */}
                                                    <div className="mb-4">
                                                        <h2 className="text-2xl font-bold text-gray-800 mb-3">{viewingEmail.subject}</h2>
                                                        <div className="flex justify-between items-center mb-4">
                                                            <div>
                                                                <div className="text-sm font-semibold text-gray-700">From: {viewingEmail.from}</div>
                                                                <div className="text-xs text-gray-500 mt-1">{viewingEmail.date}</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div className="prose max-w-none">
                                                        <p className="text-gray-700 leading-relaxed email-content-formatted" style={{
                                                            maxHeight: '200px',
                                                            overflow: 'hidden',
                                                            position: 'relative'
                                                        }}>
                                                            {viewingEmail.body || viewingEmail.snippet}
                                                        </p>
                                                        {(viewingEmail.body || viewingEmail.snippet) && (viewingEmail.body || viewingEmail.snippet).length > 300 && (
                                                            <button
                                                                className="view-full-email-btn"
                                                                onClick={() => handleViewFullEmail(viewingEmail)}
                                                            >
                                                                <span></span>
                                                                <span>View Full Email</span>
                                                            </button>
                                                        )}
                                                    </div>

                                                    {/* Summarize Popup in Viewer */}
                                                    {summarizingEmail === viewingEmail.id && (
                                                        <div className="summary-popup mt-4" style={{position: 'relative', top: 0, marginTop: '16px'}}>
                                                            {isSummarizing ? (
                                                                <div className="space-y-3">
                                                                    <div className="flex items-center gap-3 mb-3">
                                                                        <div className="animate-spin rounded-full h-5 w-5 border-2 border-indigo-600 border-t-transparent"></div>
                                                                        <span className="text-sm text-gray-700 font-medium">Summarizing...</span>
                                                                    </div>
                                                                    <div className="space-y-2">
                                                                        <div className="loading-line" style={{height: '8px'}}></div>
                                                                        <div className="loading-line" style={{height: '8px'}}></div>
                                                                        <div className="loading-line" style={{height: '8px'}}></div>
                                                                    </div>
                                                                </div>
                                                            ) : (
                                                                <div>
                                                                    <div className="flex justify-between items-center mb-2">
                                                                        <span className="text-sm font-bold text-indigo-600"> Summary</span>
                                                                        <button
                                                                            onClick={() => setSummaryHidden(!summaryHidden)}
                                                                            className="text-xs text-indigo-600 hover:text-indigo-800 font-semibold"
                                                                        >
                                                                            {summaryHidden ? 'Show' : 'Hide'}
                                                                        </button>
                                                                    </div>
                                                                    {!summaryHidden && (
                                                                        <p className="text-sm text-gray-700 leading-relaxed">
                                                                            {summaryText.split(' ').map((word, i) => (
                                                                                <span key={i} style={{
                                                                                    display: 'inline-block',
                                                                                    animation: 'fadeInWord 0.3s ease-out',
                                                                                    animationDelay: `${i * 0.05}s`,
                                                                                    animationFillMode: 'backwards',
                                                                                    marginRight: '0.25em'
                                                                                }}>
                                                                                    {word}
                                                                                </span>
                                                                            ))}
                                                                        </p>
                                                                    )}
                                                                </div>
                                                            )}
                                                        </div>
                                                    )}

                                                    {/* Reply Section */}
                                                    <div id="reply-section" className="mt-8 pt-6 border-t border-gray-300">
                                                        <h3 className="text-lg font-bold text-gray-800 mb-4"> Write Reply</h3>

                                                        {/* Quick Reply Suggestions */}
                                                        {showQuickReplies && (
                                                            <div style={{
                                                                marginBottom: '20px',
                                                                padding: '16px',
                                                                background: darkMode ? 'rgba(40, 40, 45, 0.5)' : 'rgba(249, 250, 251, 0.8)',
                                                                borderRadius: '12px',
                                                                border: `1px solid ${darkMode ? 'rgba(99, 102, 241, 0.3)' : 'rgba(209, 213, 219, 0.5)'}`
                                                            }}>
                                                                <p style={{
                                                                    fontSize: '12px',
                                                                    color: darkMode ? '#a5b4fc' : '#6366f1',
                                                                    fontWeight: '600',
                                                                    marginBottom: '12px'
                                                                }}>
                                                                     Quick Reply Suggestions:
                                                                </p>
                                                                <div style={{
                                                                    display: 'flex',
                                                                    flexWrap: 'wrap',
                                                                    gap: '8px'
                                                                }}>
                                                                    <button
                                                                        onClick={() => {
                                                                            const greeting = useSignature ? `Hi ${extractSenderName(viewingEmail.from)},\n\n` : 'Hi [Recipient\'s name],\n\n';
                                                                            const closing = useSignature ? `\n\nBest regards,\n${userData?.name?.split(' ')[0] || userName || 'there'}` : '\n\nBest regards,\n[Your name]';
                                                                            setEmailReply(greeting + 'Thank you for your email. I appreciate you reaching out!' + closing);
                                                                            playNotificationSound();
                                                                        }}
                                                                        style={{
                                                                            padding: '8px 18px',
                                                                            background: darkMode ? 'rgba(99, 102, 241, 0.2)' : 'rgba(255, 255, 255, 0.9)',
                                                                            border: `2px solid ${darkMode ? 'rgba(99, 102, 241, 0.4)' : 'rgba(99, 102, 241, 0.3)'}`,
                                                                            borderRadius: '25px',
                                                                            color: darkMode ? '#c7d2fe' : '#4f46e5',
                                                                            fontSize: '13px',
                                                                            fontWeight: '500',
                                                                            cursor: 'pointer',
                                                                            transition: 'all 0.2s',
                                                                            whiteSpace: 'nowrap'
                                                                        }}
                                                                        onMouseEnter={(e) => {
                                                                            e.target.style.transform = 'translateY(-2px)';
                                                                            e.target.style.boxShadow = '0 4px 12px rgba(99, 102, 241, 0.3)';
                                                                        }}
                                                                        onMouseLeave={(e) => {
                                                                            e.target.style.transform = 'translateY(0)';
                                                                            e.target.style.boxShadow = 'none';
                                                                        }}
                                                                    >
                                                                         Thank You
                                                                    </button>

                                                                    <button
                                                                        onClick={() => {
                                                                            const greeting = useSignature ? `Hi ${extractSenderName(viewingEmail.from)},\n\n` : 'Hi [Recipient\'s name],\n\n';
                                                                            const closing = useSignature ? `\n\nBest regards,\n${userData?.name?.split(' ')[0] || userName || 'there'}` : '\n\nBest regards,\n[Your name]';
                                                                            setEmailReply(greeting + 'That sounds great! I\'m happy to help with this.' + closing);
                                                                            playNotificationSound();
                                                                        }}
                                                                        style={{
                                                                            padding: '8px 18px',
                                                                            background: darkMode ? 'rgba(99, 102, 241, 0.2)' : 'rgba(255, 255, 255, 0.9)',
                                                                            border: `2px solid ${darkMode ? 'rgba(99, 102, 241, 0.4)' : 'rgba(99, 102, 241, 0.3)'}`,
                                                                            borderRadius: '25px',
                                                                            color: darkMode ? '#c7d2fe' : '#4f46e5',
                                                                            fontSize: '13px',
                                                                            fontWeight: '500',
                                                                            cursor: 'pointer',
                                                                            transition: 'all 0.2s',
                                                                            whiteSpace: 'nowrap'
                                                                        }}
                                                                        onMouseEnter={(e) => {
                                                                            e.target.style.transform = 'translateY(-2px)';
                                                                            e.target.style.boxShadow = '0 4px 12px rgba(99, 102, 241, 0.3)';
                                                                        }}
                                                                        onMouseLeave={(e) => {
                                                                            e.target.style.transform = 'translateY(0)';
                                                                            e.target.style.boxShadow = 'none';
                                                                        }}
                                                                    >
                                                                         Sounds Good
                                                                    </button>

                                                                    <button
                                                                        onClick={() => {
                                                                            const greeting = useSignature ? `Hi ${extractSenderName(viewingEmail.from)},\n\n` : 'Hi [Recipient\'s name],\n\n';
                                                                            const closing = useSignature ? `\n\nBest regards,\n${userData?.name?.split(' ')[0] || userName || 'there'}` : '\n\nBest regards,\n[Your name]';
                                                                            setEmailReply(greeting + 'Let me check my calendar and get back to you shortly.' + closing);
                                                                            playNotificationSound();
                                                                        }}
                                                                        style={{
                                                                            padding: '8px 18px',
                                                                            background: darkMode ? 'rgba(99, 102, 241, 0.2)' : 'rgba(255, 255, 255, 0.9)',
                                                                            border: `2px solid ${darkMode ? 'rgba(99, 102, 241, 0.4)' : 'rgba(99, 102, 241, 0.3)'}`,
                                                                            borderRadius: '25px',
                                                                            color: darkMode ? '#c7d2fe' : '#4f46e5',
                                                                            fontSize: '13px',
                                                                            fontWeight: '500',
                                                                            cursor: 'pointer',
                                                                            transition: 'all 0.2s',
                                                                            whiteSpace: 'nowrap'
                                                                        }}
                                                                        onMouseEnter={(e) => {
                                                                            e.target.style.transform = 'translateY(-2px)';
                                                                            e.target.style.boxShadow = '0 4px 12px rgba(99, 102, 241, 0.3)';
                                                                        }}
                                                                        onMouseLeave={(e) => {
                                                                            e.target.style.transform = 'translateY(0)';
                                                                            e.target.style.boxShadow = 'none';
                                                                        }}
                                                                    >
                                                                         Check Calendar
                                                                    </button>

                                                                    <button
                                                                        onClick={() => {
                                                                            const greeting = useSignature ? `Hi ${extractSenderName(viewingEmail.from)},\n\n` : 'Hi [Recipient\'s name],\n\n';
                                                                            const closing = useSignature ? `\n\nBest regards,\n${userData?.name?.split(' ')[0] || userName || 'there'}` : '\n\nBest regards,\n[Your name]';
                                                                            setEmailReply(greeting + 'I need a bit more time to review this. I\'ll get back to you soon.' + closing);
                                                                            playNotificationSound();
                                                                        }}
                                                                        style={{
                                                                            padding: '8px 18px',
                                                                            background: darkMode ? 'rgba(99, 102, 241, 0.2)' : 'rgba(255, 255, 255, 0.9)',
                                                                            border: `2px solid ${darkMode ? 'rgba(99, 102, 241, 0.4)' : 'rgba(99, 102, 241, 0.3)'}`,
                                                                            borderRadius: '25px',
                                                                            color: darkMode ? '#c7d2fe' : '#4f46e5',
                                                                            fontSize: '13px',
                                                                            fontWeight: '500',
                                                                            cursor: 'pointer',
                                                                            transition: 'all 0.2s',
                                                                            whiteSpace: 'nowrap'
                                                                        }}
                                                                        onMouseEnter={(e) => {
                                                                            e.target.style.transform = 'translateY(-2px)';
                                                                            e.target.style.boxShadow = '0 4px 12px rgba(99, 102, 241, 0.3)';
                                                                        }}
                                                                        onMouseLeave={(e) => {
                                                                            e.target.style.transform = 'translateY(0)';
                                                                            e.target.style.boxShadow = 'none';
                                                                        }}
                                                                    >
                                                                         Need Time
                                                                    </button>

                                                                    <button
                                                                        onClick={() => {
                                                                            const greeting = useSignature ? `Hi ${extractSenderName(viewingEmail.from)},\n\n` : 'Hi [Recipient\'s name],\n\n';
                                                                            const closing = useSignature ? `\n\nBest regards,\n${userData?.name?.split(' ')[0] || userName || 'there'}` : '\n\nBest regards,\n[Your name]';
                                                                            setEmailReply(greeting + 'I\'ve received your message and will respond in detail soon.' + closing);
                                                                            playNotificationSound();
                                                                        }}
                                                                        style={{
                                                                            padding: '8px 18px',
                                                                            background: darkMode ? 'rgba(99, 102, 241, 0.2)' : 'rgba(255, 255, 255, 0.9)',
                                                                            border: `2px solid ${darkMode ? 'rgba(99, 102, 241, 0.4)' : 'rgba(99, 102, 241, 0.3)'}`,
                                                                            borderRadius: '25px',
                                                                            color: darkMode ? '#c7d2fe' : '#4f46e5',
                                                                            fontSize: '13px',
                                                                            fontWeight: '500',
                                                                            cursor: 'pointer',
                                                                            transition: 'all 0.2s',
                                                                            whiteSpace: 'nowrap'
                                                                        }}
                                                                        onMouseEnter={(e) => {
                                                                            e.target.style.transform = 'translateY(-2px)';
                                                                            e.target.style.boxShadow = '0 4px 12px rgba(99, 102, 241, 0.3)';
                                                                        }}
                                                                        onMouseLeave={(e) => {
                                                                            e.target.style.transform = 'translateY(0)';
                                                                            e.target.style.boxShadow = 'none';
                                                                        }}
                                                                    >
                                                                         Acknowledged
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        )}

                                                        <div className="relative mb-4">
                                                            <textarea
                                                                value={emailReply}
                                                                onChange={(e) => setEmailReply(e.target.value)}
                                                                className="w-full h-64 px-6 py-4 pr-24 custom-textarea rounded-2xl text-gray-800 placeholder-gray-500 resize-none"
                                                                placeholder="Type your reply here..."
                                                            />

                                                            {/* Grammar Check Button - Manual trigger */}
                                                            {emailReply && emailReply.trim().length > 2 && !showGrammarNotification && (
                                                                <button
                                                                    className={`grammar-check-btn ${isManualGrammarChecking ? 'checking' : ''}`}
                                                                    onClick={() => handleManualGrammarCheck(emailReply, setEmailReply)}
                                                                    disabled={isManualGrammarChecking}
                                                                >
                                                                    {isManualGrammarChecking ? (
                                                                        <>
                                                                            <span className="animate-spin"></span>
                                                                            <span>Checking...</span>
                                                                        </>
                                                                    ) : (
                                                                        <>
                                                                            <span></span>
                                                                            <span>Check Grammar</span>
                                                                        </>
                                                                    )}
                                                                </button>
                                                            )}

                                                            {/* Grammar scanning overlay effect */}
                                                            {isManualGrammarChecking && (
                                                                <div className="grammar-highlight-overlay">
                                                                    <div className="grammar-checking-effect"></div>
                                                                </div>
                                                            )}

                                                            {/* Grammar result notification */}
                                                            {showGrammarNotification && grammarCheckResult && (
                                                                <div className={`grammar-result-notification ${grammarCheckResult}`}>
                                                                    {grammarCheckResult === 'success' ? (
                                                                        <> No grammar issues found!</>
                                                                    ) : (
                                                                        <> Grammar corrected!</>
                                                                    )}
                                                                </div>
                                                            )}

                                                            {/* AI Draft UI - Inside textarea container, centered at bottom */}
                                                            <div style={{
                                                                position: 'absolute',
                                                                bottom: '16px',
                                                                left: '50%',
                                                                transform: 'translateX(-50%)',
                                                                zIndex: 10
                                                            }}>
                                                                {isGeneratingDraft ? (
                                                                    <div style={{
                                                                        padding: '8px 20px',
                                                                        background: darkMode
                                                                            ? 'linear-gradient(135deg, rgba(40, 40, 45, 0.95) 0%, rgba(35, 35, 40, 0.9) 100%)'
                                                                            : 'linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(249, 250, 251, 0.9) 100%)',
                                                                        border: darkMode ? '2px solid rgba(99, 102, 241, 0.5)' : '2px solid white',
                                                                        borderRadius: '50px',
                                                                        display: 'flex',
                                                                        alignItems: 'center',
                                                                        gap: '8px',
                                                                        boxShadow: '0 4px 16px rgba(99, 102, 241, 0.25)',
                                                                        backdropFilter: 'blur(10px)',
                                                                        animation: 'fadeIn 0.3s ease-out'
                                                                    }}>
                                                                        <div className="animate-spin rounded-full h-3 w-3 border-2 border-indigo-600 border-t-transparent"></div>
                                                                        <span style={{fontSize: '12px', fontWeight: '600', color: darkMode ? '#c7d2fe' : '#6366f1', whiteSpace: 'nowrap'}}>Generating AI draft...</span>
                                                                    </div>
                                                                ) : hasDraft && (
                                                                    <button
                                                                        onClick={() => setShowDraftModal(true)}
                                                                        style={{
                                                                            padding: '8px 20px',
                                                                            background: darkMode
                                                                                ? 'linear-gradient(135deg, rgba(40, 40, 45, 0.95) 0%, rgba(35, 35, 40, 0.9) 100%)'
                                                                                : 'linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(249, 250, 251, 0.9) 100%)',
                                                                            border: darkMode ? '2px solid rgba(99, 102, 241, 0.5)' : '2px solid white',
                                                                            borderRadius: '50px',
                                                                            cursor: 'pointer',
                                                                            transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                                                                            fontSize: '12px',
                                                                            fontWeight: '600',
                                                                            color: darkMode ? '#c7d2fe' : '#4f46e5',
                                                                            boxShadow: '0 4px 16px rgba(99, 102, 241, 0.25)',
                                                                            backdropFilter: 'blur(10px)',
                                                                            animation: 'slideIn 0.4s ease-out',
                                                                            whiteSpace: 'nowrap'
                                                                        }}
                                                                        onMouseEnter={(e) => {
                                                                            e.currentTarget.style.transform = 'translateY(-2px) scale(1.05)';
                                                                            e.currentTarget.style.boxShadow = '0 6px 20px rgba(99, 102, 241, 0.35)';
                                                                        }}
                                                                        onMouseLeave={(e) => {
                                                                            e.currentTarget.style.transform = 'translateY(0) scale(1)';
                                                                            e.currentTarget.style.boxShadow = '0 4px 16px rgba(99, 102, 241, 0.25)';
                                                                        }}
                                                                    >
                                                                         View AI Draft
                                                                    </button>
                                                                )}
                                                            </div>

                                                            {emailReply && emailReply.trim().length > 0 && (
                                                                <button
                                                                    onClick={handleSendEmail}
                                                                    disabled={isSending}
                                                                    className={isSending ? 'send-button-float send-button-sending' : 'send-button-float'}
                                                                >
                                                                    {isSending ? (
                                                                        <>
                                                                            <div className="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"></div>
                                                                            <span>Sending...</span>
                                                                        </>
                                                                    ) : (
                                                                        <>
                                                                            <span></span>
                                                                            <span>Send</span>
                                                                        </>
                                                                    )}
                                                                </button>
                                                            )}
                                                        </div>
                                                        <div className="ai-transform-container">
                                                            <input
                                                                type="text"
                                                                value={replyPrompt}
                                                                onChange={(e) => setReplyPrompt(e.target.value)}
                                                                className="ai-transform-input"
                                                                placeholder=" Rewrite with AI (e.g., 'Make it more professional', 'Add email structure')"
                                                                onKeyPress={(e) => {
                                                                    if (e.key === 'Enter' && replyPrompt && emailReply) {
                                                                        handleRewriteReply();
                                                                    }
                                                                }}
                                                            />
                                                            <button
                                                                onClick={handleRewriteReply}
                                                                disabled={!replyPrompt || !emailReply || isRewritingReply}
                                                                className="ai-transform-button"
                                                            >
                                                                {isRewritingReply ? ' Rewriting...' : 'Rewrite'}
                                                            </button>
                                                        </div>

                                                        {/* AI Draft Modal */}
                                                        {showDraftModal && (
                                                            <div
                                                                style={{
                                                                    position: 'fixed',
                                                                    top: 0,
                                                                    left: 0,
                                                                    width: '100%',
                                                                    height: '100%',
                                                                    background: 'rgba(0, 0, 0, 0.6)',
                                                                    backdropFilter: 'blur(8px)',
                                                                    zIndex: 10000,
                                                                    display: 'flex',
                                                                    alignItems: 'center',
                                                                    justifyContent: 'center',
                                                                    animation: 'fadeIn 0.3s ease-out',
                                                                    padding: '20px'
                                                                }}
                                                                onClick={() => setShowDraftModal(false)}
                                                            >
                                                                <div
                                                                    onClick={(e) => e.stopPropagation()}
                                                                    style={{
                                                                        width: '90%',
                                                                        maxWidth: '700px',
                                                                        maxHeight: '80vh',
                                                                        background: darkMode
                                                                            ? 'linear-gradient(135deg, rgba(30, 30, 35, 0.98) 0%, rgba(25, 25, 30, 0.95) 100%)'
                                                                            : 'linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(249, 250, 251, 0.95) 100%)',
                                                                        borderRadius: '24px',
                                                                        border: darkMode ? '2px solid rgba(99, 102, 241, 0.5)' : '2px solid white',
                                                                        boxShadow: darkMode
                                                                            ? '0 20px 60px rgba(0, 0, 0, 0.8), inset 0 1px 0 rgba(99, 102, 241, 0.3)'
                                                                            : '0 20px 60px rgba(99, 102, 241, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.9)',
                                                                        backdropFilter: 'blur(30px)',
                                                                        overflow: 'hidden',
                                                                        display: 'flex',
                                                                        flexDirection: 'column',
                                                                        animation: 'popup-appear 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)'
                                                                    }}
                                                                >
                                                                    {/* Modal Header */}
                                                                    <div style={{
                                                                        padding: '24px 28px',
                                                                        borderBottom: darkMode ? '2px solid rgba(99, 102, 241, 0.3)' : '2px solid rgba(99, 102, 241, 0.15)',
                                                                        display: 'flex',
                                                                        alignItems: 'center',
                                                                        justifyContent: 'space-between',
                                                                        position: 'relative'
                                                                    }}>
                                                                        <div style={{flex: 1}}></div>
                                                                        <button
                                                                            onClick={() => {
                                                                                setEmailReply(aiDraft);
                                                                                setShowDraftModal(false);
                                                                                playNotificationSound();
                                                                            }}
                                                                            style={{
                                                                                padding: '10px 24px',
                                                                                background: 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',
                                                                                color: 'white',
                                                                                border: 'none',
                                                                                borderRadius: '50px',
                                                                                cursor: 'pointer',
                                                                                fontSize: '14px',
                                                                                fontWeight: '600',
                                                                                boxShadow: '0 4px 12px rgba(99, 102, 241, 0.3)',
                                                                                transition: 'all 0.3s ease',
                                                                                position: 'absolute',
                                                                                left: '50%',
                                                                                transform: 'translateX(-50%)'
                                                                            }}
                                                                            onMouseEnter={(e) => {
                                                                                e.currentTarget.style.transform = 'translateX(-50%) translateY(-2px)';
                                                                                e.currentTarget.style.boxShadow = '0 6px 16px rgba(99, 102, 241, 0.4)';
                                                                            }}
                                                                            onMouseLeave={(e) => {
                                                                                e.currentTarget.style.transform = 'translateX(-50%) translateY(0)';
                                                                                e.currentTarget.style.boxShadow = '0 4px 12px rgba(99, 102, 241, 0.3)';
                                                                            }}
                                                                        >
                                                                             Use Draft
                                                                        </button>
                                                                        <button
                                                                            onClick={() => setShowDraftModal(false)}
                                                                            style={{
                                                                                width: '36px',
                                                                                height: '36px',
                                                                                borderRadius: '50%',
                                                                                background: 'rgba(239, 68, 68, 0.1)',
                                                                                border: '2px solid rgba(239, 68, 68, 0.3)',
                                                                                color: '#ef4444',
                                                                                cursor: 'pointer',
                                                                                fontSize: '18px',
                                                                                fontWeight: 'bold',
                                                                                display: 'flex',
                                                                                alignItems: 'center',
                                                                                justifyContent: 'center',
                                                                                transition: 'all 0.3s ease'
                                                                            }}
                                                                            onMouseEnter={(e) => {
                                                                                e.currentTarget.style.background = 'rgba(239, 68, 68, 0.2)';
                                                                                e.currentTarget.style.transform = 'rotate(90deg) scale(1.1)';
                                                                            }}
                                                                            onMouseLeave={(e) => {
                                                                                e.currentTarget.style.background = 'rgba(239, 68, 68, 0.1)';
                                                                                e.currentTarget.style.transform = 'rotate(0deg) scale(1)';
                                                                            }}
                                                                        >
                                                                            
                                                                        </button>
                                                                    </div>

                                                                    {/* Modal Content */}
                                                                    <div style={{
                                                                        padding: '28px',
                                                                        overflowY: 'auto',
                                                                        flex: 1
                                                                    }}>
                                                                        <h3 style={{
                                                                            fontSize: '18px',
                                                                            fontWeight: '700',
                                                                            marginBottom: '16px',
                                                                            color: darkMode ? '#c7d2fe' : '#374151',
                                                                            display: 'flex',
                                                                            alignItems: 'center',
                                                                            gap: '8px'
                                                                        }}>
                                                                             AI-Generated Draft
                                                                        </h3>
                                                                        <div style={{
                                                                            padding: '20px',
                                                                            background: darkMode
                                                                                ? 'rgba(40, 40, 45, 0.6)'
                                                                                : 'rgba(255, 255, 255, 0.6)',
                                                                            borderRadius: '16px',
                                                                            border: darkMode
                                                                                ? '2px solid rgba(99, 102, 241, 0.3)'
                                                                                : '2px solid rgba(99, 102, 241, 0.2)',
                                                                            fontSize: '15px',
                                                                            lineHeight: '1.7',
                                                                            color: darkMode ? '#e5e5e5' : '#374151',
                                                                            whiteSpace: 'pre-wrap'
                                                                        }}>
                                                                            {aiDraft}
                                                                        </div>
                                                                        <p style={{
                                                                            marginTop: '16px',
                                                                            fontSize: '12px',
                                                                            color: darkMode ? '#9ca3af' : '#6b7280',
                                                                            fontStyle: 'italic'
                                                                        }}>
                                                                             You can edit this draft after using it in the reply field
                                                                        </p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                </>
                                            ) : (
                                                <>
                                                    {/* AI Writer as Default */}
                                                    <div className="rounded-3xl p-4 relative">
                                                        {/* Tab Switches */}
                                                        <div className="flex justify-center mb-8">
                                                            <div className="tab-container tab-button-container">
                                                                <div
                                                                    className="tab-slider"
                                                                    style={{
                                                                        width: '50%',
                                                                        height: 'calc(100% - 12px)',
                                                                        top: '6px',
                                                                        left: activeView === 'writer' ? '6px' : 'calc(50% - 6px)',
                                                                    }}
                                                                ></div>
                                                                <button
                                                                    onClick={() => setActiveView('writer')}
                                                                    className={`relative z-10 px-8 py-3 rounded-full font-medium transition-all ${
                                                                        activeView === 'writer' ? (darkMode ? 'text-white' : 'text-gray-900') : 'text-gray-700 hover:text-gray-800'
                                                                    }`}
                                                                >
                                                                     AI Writer
                                                                </button>
                                                                <button
                                                                    onClick={() => setActiveView('results')}
                                                                    className={`relative z-10 px-8 py-3 rounded-full font-medium transition-all ${
                                                                        activeView === 'results' ? (darkMode ? 'text-white' : 'text-gray-900') : 'text-gray-700 hover:text-gray-800'
                                                                    }`}
                                                                >
                                                                     Results
                                                                </button>
                                                            </div>
                                                        </div>

                                                        {/* Dynamic Greeting with Blur Reveal Effect */}
                                                        {activeView === 'writer' && (
                                                            <div className={`greeting-container ${emailText.trim().length > 0 ? 'hidden' : ''}`}>
                                                                {currentGreeting && (
                                                                    <div className="greeting-oval">
                                                                        <span className={greetingAnimationClass} key={greetingIndex} style={{
                                                                            fontSize: '16px',
                                                                            fontWeight: '600',
                                                                            color: darkMode ? '#ffffff' : '#374151',
                                                                            display: 'inline-block'
                                                                        }}>
                                                                            {currentGreeting}
                                                                        </span>
                                                                    </div>
                                                                )}
                                                            </div>
                                                        )}

                                                        {/* Content Area */}
                                                        <div className="min-h-[500px]">
                                                            {activeView === 'writer' ? renderWriterContent() : renderResultsContent()}
                                                        </div>
                                                    </div>
                                                </>
                                            )}
                                        </div>
                                        {/* AI Writing Mode - Centered Writer Display */}
{showCenteredWriter && (
    <div className="ai-writer-centered-mode" style={{
        animation: 'fadeIn 0.4s ease-out'
    }}>
        {/* Header with action buttons */}
        <div className="centered-mode-header" style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: '20px'
        }}>
            <div style={{width: '40px'}}></div>
            {/* Action buttons - only show when result is ready */}
            {!isCenteredGenerating && centeredWriterResult && (
                <div style={{display: 'flex', gap: '12px', flexWrap: 'wrap', justifyContent: 'center'}}>
                    <button
                        onClick={() => {
                            console.log(' Using result...');
                            // If viewing an email, update reply text
                            if (viewingEmail) {
                                setEmailReply(centeredWriterResult);
                            } else {
                                setEmailText(centeredWriterResult);
                            }
                            closeCenteredWriter();
                            showNotification(viewingEmail ? 'Reply updated!' : 'Email added to editor!');
                        }}
                        style={{
                            padding: '10px 20px',
                            background: 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',
                            color: 'white',
                            border: 'none',
                            borderRadius: '50px',
                            cursor: 'pointer',
                            fontSize: '14px',
                            fontWeight: '600',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '8px',
                            transition: 'all 0.3s ease'
                        }}
                    >
                        <span></span>
                        <span>{viewingEmail ? 'Use as Reply' : 'Use Email'}</span>
                    </button>
                    <button
                        onClick={() => {
                            // Save to drafts
                            setCurrentDraftToSave({
                                content: centeredWriterResult,
                                prompt: centeredWriterPrompt,
                                timestamp: Date.now(),
                                provider: activeProvider
                            });
                            setShowSaveDraftModal(true);
                        }}
                        style={{
                            padding: '10px 20px',
                            background: darkMode ? 'rgba(139, 92, 246, 0.2)' : 'rgba(139, 92, 246, 0.1)',
                            color: darkMode ? '#c4b5fd' : '#7c3aed',
                            border: '2px solid rgba(139, 92, 246, 0.3)',
                            borderRadius: '50px',
                            cursor: 'pointer',
                            fontSize: '14px',
                            fontWeight: '600',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '8px',
                            transition: 'all 0.3s ease'
                        }}
                    >
                        <span></span>
                        <span>Save to Drafts</span>
                    </button>
                    <button
                        onClick={() => {
                            navigator.clipboard.writeText(centeredWriterResult);
                            showNotification('Copied to clipboard!');
                        }}
                        style={{
                            padding: '10px 20px',
                            background: darkMode ? 'rgba(99, 102, 241, 0.2)' : 'rgba(99, 102, 241, 0.1)',
                            color: darkMode ? '#a5b4fc' : '#4f46e5',
                            border: '2px solid rgba(99, 102, 241, 0.3)',
                            borderRadius: '50px',
                            cursor: 'pointer',
                            fontSize: '14px',
                            fontWeight: '600',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '8px',
                            transition: 'all 0.3s ease'
                        }}
                    >
                        <span></span>
                        <span>Copy</span>
                    </button>
                </div>
            )}
            {/* Close button - only when not generating */}
            {!isCenteredGenerating && (
                <button
                    onClick={() => {
                        console.log(' Closing centered writer');
                        handleCloseCenteredWriterWithPrompt();
                    }}
                    style={{
                        width: '36px',
                        height: '36px',
                        borderRadius: '50%',
                        background: 'rgba(156, 163, 175, 0.1)',
                        border: '2px solid rgba(156, 163, 175, 0.2)',
                        color: darkMode ? '#9ca3af' : '#6b7280',
                        cursor: 'pointer',
                        fontSize: '16px',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        transition: 'all 0.3s ease'
                    }}
                >
                    
                </button>
            )}
            {isCenteredGenerating && <div style={{width: '40px'}}></div>}
        </div>

        {/* Prompt display */}
        <div style={{
            textAlign: 'center',
            fontSize: '16px',
            fontWeight: '500',
            color: darkMode ? '#9ca3af' : '#6b7280',
            marginBottom: '24px',
            fontStyle: 'italic'
        }}>
            "{centeredWriterPrompt}"
        </div>

        {/* Generation Animation or Result */}
        {isCenteredGenerating ? (
            <div style={{
                display: 'flex',
                flexDirection: 'column',
                alignItems: 'center',
                justifyContent: 'center',
                gap: '24px',
                padding: '60px 40px',
                minHeight: '300px',
                width: '100%',
                maxWidth: '100%',
                boxSizing: 'border-box',
                background: darkMode ? 'rgba(40, 40, 45, 0.5)' : 'rgba(249, 250, 251, 0.8)',
                borderRadius: '16px',
                border: '2px solid rgba(99, 102, 241, 0.2)'
            }}>
                {console.log(' Rendering generation animation')}
                <div style={{
                    fontSize: '20px',
                    fontWeight: '700',
                    color: darkMode ? '#a5b4fc' : '#4f46e5',
                    marginBottom: '12px',
                    textAlign: 'center'
                }}>
                     Generating with AI
                </div>
                {[' Analyzing your request', ' Writing the email', ' Polishing content', ' Finalizing'].map((status, idx) => {
                    const allStatuses = [' Analyzing your request', ' Writing the email', ' Polishing content', ' Finalizing'];
                    const currentIdx = allStatuses.findIndex(s => centeredGenerationStatus.includes(s.slice(2)));
                    const isActive = idx === (currentIdx >= 0 ? currentIdx : 0);
                    return (
                        <div
                            key={idx}
                            style={{
                                fontSize: '18px',
                                fontWeight: isActive ? '700' : '500',
                                color: isActive
                                    ? (darkMode ? '#a5b4fc' : '#4f46e5')
                                    : (darkMode ? '#6b7280' : '#9ca3af'),
                                opacity: isActive ? 1 : 0.4,
                                transition: 'all 0.4s ease',
                                transform: isActive ? 'scale(1.15)' : 'scale(1)',
                                padding: '12px 24px',
                                borderRadius: '50px',
                                background: isActive
                                    ? (darkMode ? 'rgba(99, 102, 241, 0.2)' : 'rgba(99, 102, 241, 0.1)')
                                    : 'transparent',
                                border: isActive ? '2px solid rgba(99, 102, 241, 0.3)' : '2px solid transparent'
                            }}
                        >
                            {status}
                        </div>
                    );
                })}
            </div>
        ) : (
            <>
                {console.log(' Rendering result - length:', centeredWriterResult?.length || 0)}
                {/* Result display with wave animation */}
                <div style={{
                    padding: '20px',
                    background: darkMode ? 'rgba(40, 40, 45, 0.5)' : 'rgba(249, 250, 251, 0.8)',
                    borderRadius: '16px',
                    fontSize: '15px',
                    lineHeight: '1.7',
                    color: darkMode ? '#e5e5e5' : '#374151',
                    minHeight: '100px',
                    whiteSpace: 'pre-wrap'
                }}>
                    {centeredWriterResult ? renderWaveText(centeredWriterResult) : 'No result generated'}
                </div>

                {/* Follow-up suggestions */}
                {aiSuggestions.length > 0 && (
                    <div style={{marginTop: '20px', display: 'flex', flexWrap: 'wrap', gap: '10px', justifyContent: 'center'}}>
                        {aiSuggestions.map((suggestion, idx) => (
                            <button
                                key={idx}
                                onClick={() => handleCenteredFollowup(suggestion)}
                                style={{
                                    padding: '10px 18px',
                                    borderRadius: '50px',
                                    background: darkMode ? 'rgba(99, 102, 241, 0.2)' : 'rgba(99, 102, 241, 0.1)',
                                    border: '1px solid rgba(99, 102, 241, 0.3)',
                                    color: darkMode ? '#a5b4fc' : '#4f46e5',
                                    fontSize: '13px',
                                    fontWeight: '500',
                                    cursor: 'pointer',
                                    transition: 'all 0.3s ease'
                                }}
                            >
                                {suggestion}
                            </button>
                        ))}
                    </div>
                )}

                {/* Follow-up input */}
                <div style={{marginTop: '20px', display: 'flex', gap: '10px'}}>
                    <input
                        type="text"
                        placeholder="Ask for changes or improvements..."
                        value={aiFollowupPrompt}
                        onChange={(e) => setAiFollowupPrompt(e.target.value)}
                        onKeyPress={(e) => {
                            if (e.key === 'Enter' && aiFollowupPrompt.trim()) {
                                handleCenteredFollowup(aiFollowupPrompt);
                            }
                        }}
                        style={{
                            flex: 1,
                            padding: '14px 20px',
                            borderRadius: '50px',
                            background: darkMode ? 'rgba(40, 40, 45, 0.8)' : 'rgba(255, 255, 255, 0.8)',
                            border: '2px solid rgba(99, 102, 241, 0.2)',
                            fontSize: '14px',
                            color: darkMode ? '#e5e5e5' : '#374151',
                            outline: 'none'
                        }}
                    />
                    <button
                        onClick={() => handleCenteredFollowup(aiFollowupPrompt)}
                        disabled={!aiFollowupPrompt.trim()}
                        style={{
                            padding: '14px 24px',
                            borderRadius: '50px',
                            background: aiFollowupPrompt.trim()
                                ? 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)'
                                : 'rgba(156, 163, 175, 0.3)',
                            color: 'white',
                            border: 'none',
                            fontSize: '16px',
                            fontWeight: '600',
                            cursor: aiFollowupPrompt.trim() ? 'pointer' : 'not-allowed'
                        }}
                    >
                        
                    </button>
                </div>
            </>
        )}
    </div>
)}
                                    </div>
                                    </>
                                )}

                                {/* AI Writer Container - Always show (CSS handles visibility based on screen size and connection) */}
                                <div className="ai-writer-container rounded-3xl p-8 relative" style={{marginTop: showWelcomeAnimation ? '0' : '2rem'}}>
                                        {/* Tab Switches */}
                                        <div className="flex justify-center mb-8">
                                            <div className="tab-container tab-button-container">
                                                <div
                                                    className="tab-slider"
                                                    style={{
                                                        width: '50%',
                                                        height: 'calc(100% - 12px)',
                                                        top: '6px',
                                                        left: activeView === 'writer' ? '6px' : 'calc(50% - 6px)',
                                                    }}
                                                ></div>
                                                <button
                                                    onClick={() => setActiveView('writer')}
                                                    className={`relative z-10 px-8 py-3 rounded-full font-medium transition-all ${
                                                        activeView === 'writer' ? (darkMode ? 'text-white' : 'text-gray-900') : 'text-gray-700 hover:text-gray-800'
                                                    }`}
                                                >
                                                     AI Writer
                                                </button>
                                                <button
                                                    onClick={() => setActiveView('results')}
                                                    className={`relative z-10 px-8 py-3 rounded-full font-medium transition-all ${
                                                        activeView === 'results' ? (darkMode ? 'text-white' : 'text-gray-900') : 'text-gray-700 hover:text-gray-800'
                                                    }`}
                                                >
                                                     Results
                                                </button>
                                            </div>
                                        </div>

                                        {/* Dynamic Greeting with Word-by-Word Blur Reveal Effect */}
                                        {activeView === 'writer' && (
                                            <div className={`greeting-container ${emailText.trim().length > 0 ? 'hidden' : ''}`}>
                                                {currentGreeting && (
                                                    <div className="greeting-oval" key={greetingIndex}>
                                                        {currentGreeting.split(' ').map((word, index) => (
                                                            <span
                                                                key={`${greetingIndex}-${index}`}
                                                                className={`greeting-word ${greetingAnimationClass === 'out' ? 'greeting-word-out' : ''}`}
                                                                style={{
                                                                    fontSize: '16px',
                                                                    fontWeight: '600',
                                                                    color: darkMode ? '#ffffff' : '#374151',
                                                                    animationDelay: greetingAnimationClass === 'out' ? `${index * 0.05}s` : `${index * 0.1}s`,
                                                                    marginRight: '6px'
                                                                }}
                                                            >
                                                                {word}
                                                            </span>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        )}

                                        {/* Content Area */}
                                        <div className="min-h-[500px]">
                                            {activeView === 'writer' ? renderWriterContent() : renderResultsContent()}
                                        </div>
                                    </div>
                            </>
                        )}
                    </div>

                    {/* Undo Delete Button */}
                    {showUndoDelete && (
                        <button
                            onClick={handleUndoDelete}
                            className="undo-delete-button"
                        >
                            <span></span>
                            <span>Undo Delete</span>
                        </button>
                    )}

                    {/* Envelope Flying Animation */}
                    {showEnvelope && (
                        <>
                            <div className="envelope-blur-overlay"></div>
                            <div className="envelope-animation">
                                
                            </div>
                        </>
                    )}

                    {/* Bottom Success Notification - ADD IT HERE */}
        {showSuccessNotification && (
            <div className="bottom-notification">
                <div className="bottom-notification-icon"></div>
                <span>{notificationMessage}</span>
            </div>
        )}

                    {/* Fullscreen Email Viewer */}
                    {showFullscreenEmail && (
                        <div className="fullscreen-email-viewer">
                            <div className="fullscreen-email-container">
                                {/* Header */}
                                <div className="fullscreen-email-header">
                                    <h2 style={{fontSize: '20px', fontWeight: '700', color: darkMode ? '#e5e5e5' : '#374151'}}>
                                         Email Preview
                                    </h2>
                                    <button
                                        onClick={() => {
                                            setShowFullscreenEmail(false);
                                            setFullscreenPrompt('');
                                            setShowDynamicSuggestions(false);
                                        }}
                                        className="fullscreen-close-btn"
                                    >
                                        
                                    </button>
                                </div>

                                {/* Quick Action Suggestions - Left Side - Only show when typing */}
                                {fullscreenPrompt && fullscreenPrompt.length >= 1 && (
                                <div style={{
                                    position: 'absolute',
                                    left: '20px',
                                    bottom: '120px',
                                    display: 'flex',
                                    flexDirection: 'column',
                                    gap: '10px',
                                    zIndex: 100,
                                    animation: 'slideInFromLeft 0.4s cubic-bezier(0.4, 0, 0.2, 1)'
                                }}>
                                    {[
                                        { emoji: '', text: 'Shorten', prompt: 'Make this email shorter and more concise' },
                                        { emoji: '', text: 'Rewrite', prompt: 'Rewrite this email professionally' },
                                        { emoji: '', text: 'Focus', prompt: 'Make the main point clearer' },
                                        { emoji: '', text: 'Polish', prompt: 'Improve grammar and tone' },
                                        { emoji: '', text: 'Formalize', prompt: 'Make this more formal and professional' },
                                        { emoji: '', text: 'Casual', prompt: 'Make this more casual and friendly' }
                                    ].map((action, idx) => (
                                        <button
                                            key={idx}
                                            onClick={() => {
                                                setFullscreenPrompt(action.prompt);
                                            }}
                                            style={{
                                                padding: '10px 14px',
                                                fontSize: '13px',
                                                fontWeight: '600',
                                                background: darkMode
                                                    ? 'linear-gradient(135deg, rgba(30, 30, 35, 0.95) 0%, rgba(25, 25, 30, 0.9) 100%)'
                                                    : 'linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(249, 250, 251, 0.9) 100%)',
                                                border: darkMode ? '2px solid rgba(99, 102, 241, 0.5)' : '2px solid white',
                                                borderRadius: '12px',
                                                cursor: 'pointer',
                                                transition: 'all 0.3s ease',
                                                boxShadow: darkMode
                                                    ? '0 2px 8px rgba(0, 0, 0, 0.3)'
                                                    : '0 2px 8px rgba(99, 102, 241, 0.15)',
                                                color: darkMode ? '#c7d2fe' : '#374151',
                                                whiteSpace: 'nowrap',
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '8px',
                                                animationDelay: `${idx * 0.05}s`
                                            }}
                                            onMouseEnter={(e) => {
                                                e.currentTarget.style.transform = 'translateX(5px) scale(1.05)';
                                                e.currentTarget.style.boxShadow = darkMode
                                                    ? '0 4px 12px rgba(99, 102, 241, 0.35)'
                                                    : '0 4px 12px rgba(99, 102, 241, 0.25)';
                                            }}
                                            onMouseLeave={(e) => {
                                                e.currentTarget.style.transform = 'translateX(0) scale(1)';
                                                e.currentTarget.style.boxShadow = darkMode
                                                    ? '0 2px 8px rgba(0, 0, 0, 0.3)'
                                                    : '0 2px 8px rgba(99, 102, 241, 0.15)';
                                            }}
                                        >
                                            <span>{action.emoji}</span>
                                            <span>{action.text}</span>
                                        </button>
                                    ))}
                                </div>
                                )}

                                {/* Email Content */}
                                <div className="fullscreen-email-content" style={{paddingLeft: fullscreenPrompt && fullscreenPrompt.length >= 1 ? '140px' : '24px'}}>
                                    <div className="fullscreen-email-text">
                                        {fullscreenEmailText}
                                    </div>
                                </div>

                                {/* Prompt Container */}
                                <div className="fullscreen-prompt-container">
                                    <div style={{position: 'relative'}}>
                                        {/* Prompt Input */}
                                        <div className="ai-prompt-container">
                                            {/* Inline Model Switcher */}
                                            <div className="inline-model-switcher">
                                                <button
                                                    onClick={() => setShowModelDropdown(!showModelDropdown)}
                                                    className="inline-model-button"
                                                >
                                                    <span>{selectedModel}</span>
                                                    <span style={{fontSize: '8px', transition: 'transform 0.3s', transform: showModelDropdown ? 'rotate(180deg)' : 'rotate(0)'}}></span>
                                                </button>
                                                {showModelDropdown && (
                                                    <div className="inline-model-dropdown">
                                                        {[
                                                            { name: 'Ink 2.0', description: 'Fast & efficient - Mistral AI Small Latest' },
                                                            { name: 'Ink 2.5', description: 'More powerful & detailed - Mistral AI Medium' }
                                                        ].map((model) => (
                                                            <button
                                                                key={model.name}
                                                                onClick={() => {
                                                                    console.log(` Switched to model: ${model.name} (${model.description})`);
                                                                    setSelectedModel(model.name);
                                                                    setShowModelDropdown(false);
                                                                }}
                                                                style={{
                                                                    width: '100%',
                                                                    padding: '10px 14px',
                                                                    fontSize: '12px',
                                                                    background: selectedModel === model.name
                                                                        ? (darkMode ? 'rgba(99, 102, 241, 0.2)' : 'rgba(99, 102, 241, 0.1)')
                                                                        : 'transparent',
                                                                    border: 'none',
                                                                    cursor: 'pointer',
                                                                    transition: 'all 0.2s ease',
                                                                    color: darkMode ? '#c7d2fe' : '#374151',
                                                                    textAlign: 'left',
                                                                    display: 'flex',
                                                                    flexDirection: 'column',
                                                                    gap: '2px'
                                                                }}
                                                                onMouseEnter={(e) => {
                                                                    if (selectedModel !== model.name) {
                                                                        e.currentTarget.style.background = darkMode ? 'rgba(99, 102, 241, 0.1)' : 'rgba(99, 102, 241, 0.05)';
                                                                    }
                                                                }}
                                                                onMouseLeave={(e) => {
                                                                    if (selectedModel !== model.name) {
                                                                        e.currentTarget.style.background = 'transparent';
                                                                    }
                                                                }}
                                                            >
                                                                <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', fontWeight: '600'}}>
                                                                    <span>{model.name}</span>
                                                                    {selectedModel === model.name && <span></span>}
                                                                </div>
                                                                <span style={{fontSize: '10px', opacity: 0.7, fontWeight: '400'}}>{model.description}</span>
                                                            </button>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>

                                            <input
                                                type="text"
                                                value={fullscreenPrompt}
                                                onChange={(e) => setFullscreenPrompt(e.target.value)}
                                                className="ai-prompt-input"
                                                placeholder="Ask AI to modify the email..."
                                                onKeyPress={async (e) => {
                                                    if (e.key === 'Enter' && fullscreenPrompt) {
                                                        setIsEditingFullscreen(true);

                                                        try {
                                                            const updatedEmail = await callAIAPI(fullscreenPrompt, fullscreenEmailText);

                                                            // Animate line by line
                                                            setFullscreenEmailText('');
                                                            const lines = updatedEmail.split('\n');
                                                            for (let i = 0; i < lines.length; i++) {
                                                                await new Promise(resolve => setTimeout(resolve, 100));
                                                                setFullscreenEmailText(prev => prev + (i > 0 ? '\n' : '') + lines[i]);
                                                            }

                                                            setFullscreenPrompt('');
                                                        } catch (error) {
                                                            console.error('Error updating email:', error);
                                                        } finally {
                                                            setIsEditingFullscreen(false);
                                                        }
                                                    }
                                                }}
                                            />
                                            {fullscreenPrompt && fullscreenPrompt.trim().length > 0 && !isEditingFullscreen && (
                                                <button
                                                    onClick={async () => {
                                                        setIsEditingFullscreen(true);
                                                        setShowDynamicSuggestions(false);

                                                        try {
                                                            const updatedEmail = await callAIAPI(fullscreenPrompt, fullscreenEmailText);

                                                            // Animate line by line
                                                            setFullscreenEmailText('');
                                                            const lines = updatedEmail.split('\n');
                                                            for (let i = 0; i < lines.length; i++) {
                                                                await new Promise(resolve => setTimeout(resolve, 100));
                                                                setFullscreenEmailText(prev => prev + (i > 0 ? '\n' : '') + lines[i]);
                                                            }

                                                            setFullscreenPrompt('');
                                                        } catch (error) {
                                                            console.error('Error updating email:', error);
                                                        } finally {
                                                            setIsEditingFullscreen(false);
                                                        }
                                                    }}
                                                    className="ai-send-button"
                                                    disabled={isEditingFullscreen}
                                                >
                                                    {isEditingFullscreen ? '...' : ''}
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Version Update Modal */}
                    {showVersionModal && (
                        <div className="version-modal-overlay" onClick={handleCloseVersionModal}>
                            <div className="version-modal-container" onClick={(e) => e.stopPropagation()}>
                                {/* Header */}
                                <div className="version-modal-header">
                                    <div className="version-badge">
                                        <span className="version-icon"></span>
                                        <span className="version-number">Version {CURRENT_VERSION}</span>
                                    </div>
                                    <button onClick={handleCloseVersionModal} className="version-close-btn">
                                        
                                    </button>
                                </div>

                                {/* Content */}
                                <div className="version-modal-content">
                                    <h2 className="version-modal-title">What's New</h2>
                                    
                                    {/* Major Updates */}
                                    <div className="version-section major-update">
                                        <div className="version-section-header">
                                            <span className="version-section-icon"></span>
                                            <h3 className="version-section-title">New Features</h3>
                                        </div>
                                        <div className="version-update-item">
                                            <div className="update-icon"></div>
                                            <div className="update-content">
                                                <div className="update-title">AI Preferences</div>
                                                <div className="update-description">
                                                    New AI preferences for users to toggle on how AI behaves - customize your experience!
                                                </div>
                                            </div>
                                        </div>
                                        <div className="version-update-item">
                                            <div className="update-icon"></div>
                                            <div className="update-content">
                                                <div className="update-title">AI Email Drafts</div>
                                                <div className="update-description">
                                                    Get AI-generated drafts for your received emails automatically.
                                                </div>
                                            </div>
                                        </div>
                                        <div className="version-update-item">
                                            <div className="update-icon"></div>
                                            <div className="update-content">
                                                <div className="update-title">Grammar Check</div>
                                                <div className="update-description">
                                                    Real-time grammar checking with 4-second delay for better accuracy.
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Minor Updates */}
                                    <div className="version-section minor-updates">
                                        <div className="version-section-header">
                                            <span className="version-section-icon"></span>
                                            <h3 className="version-section-title">Improvements & Refinements</h3>
                                        </div>
                                        <div className="version-update-list">
                                            <div className="version-update-item-small">
                                                <span className="update-bullet"></span>
                                                <span>UI tweaks and visual improvements</span>
                                            </div>
                                            <div className="version-update-item-small">
                                                <span className="update-bullet"></span>
                                                <span>Bug fixes and stability improvements</span>
                                            </div>
                                            <div className="version-update-item-small">
                                                <span className="update-bullet"></span>
                                                <span>Mobile optimizations for better responsiveness</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Footer */}
                                <div className="version-modal-footer">
                                    <button onClick={handleCloseVersionModal} className="version-cta-btn">
                                        Got it! Let's go 
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Connection Animation Popup - NEW MORPHING VERSION */}
{showConnectionAnimation && (
    <div className="connection-animation-overlay-v2">
        <div className={`connection-animation-box-v2 ${showConnectionAnimation ? 'active' : ''}`}>
            {/* User Logo - Slides from left */}
            <div className="connection-user-logo-v2">
                <div 
                    className={`connection-user-avatar-v2 ${selectedProfileIcon ? 'with-texture ' + selectedProfileIcon : ''}`}
                    style={{
                        background: selectedProfileIcon ? undefined : selectedProfileColor
                    }}
                >
                    {userData && userData.name.charAt(0).toUpperCase()}
                </div>
            </div>

            {/* Provider Logo - Static on right */}
            <div className="connection-provider-logo-v2">
                {connectionProvider === 'gmail' ? (
                    <div className="connection-provider-avatar-v2 gmail-avatar-v2">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.73L12 16.64l-6.545-4.91v9.273H1.636A1.636 1.636 0 0 1 0 19.366V5.457c0-2.023 2.309-3.178 3.927-1.964L12 9.545l8.073-6.052C21.69 2.28 24 3.434 24 5.457z"/>
                        </svg>
                    </div>
                ) : (
                    <div className="connection-provider-avatar-v2 outlook-avatar-v2">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M23 7.5v9c0 .8-.7 1.5-1.5 1.5h-9L6 12l6.5-6h9c.8 0 1.5.7 1.5 1.5zM11 6L5 11h6l6-5z"/>
                            <path d="M1 8.5v7c0 .8.7 1.5 1.5 1.5h8L5 11 10.5 6h-8c-.8 0-1.5.7-1.5 1.5z"/>
                        </svg>
                    </div>
                )}
            </div>

            {/* Final Merged Logo - Shows after animation */}
            <div className="connection-merged-logo-v2">
                <div 
                    className={`connection-merged-avatar-v2 ${selectedProfileIcon ? 'with-texture ' + selectedProfileIcon : ''}`}
                    style={{
                        background: selectedProfileIcon ? undefined : selectedProfileColor
                    }}
                >
                    {userData && userData.name.charAt(0).toUpperCase()}
                    
                    {/* Connected Badge */}
                    <div className="connection-badge-v2">
                        <span className="badge-icon"></span>
                        <span className="badge-text">
                            {connectionProvider === 'gmail' ? 'Gmail' : 'Outlook'}
                        </span>
                    </div>
                </div>
            </div>

            {/* Status Text */}
            <div className="connection-status-text-v2">
                Connecting to {connectionProvider === 'gmail' ? 'Gmail' : 'Outlook'}...
            </div>
        </div>
    </div>
)}

                    {/* Authentication Popup */}
                    {showAuthPopup && (
                        <div className="auth-popup-overlay" onClick={() => {
                            setShowAuthPopup(false);
                            setPendingConnection(null);
                        }}>
                            <div className="auth-popup-container" onClick={(e) => e.stopPropagation()}>
                                <div className="auth-popup-icon"></div>
                                <h2 className="auth-popup-title">Account Required</h2>
                                <p className="auth-popup-message">
                                    To access premium features like email connections and AI transformations, please create an account or log in.
                                    <br /><br />
                                    Visit <strong>Settings</strong> to sign up or log in to unlock all features!
                                </p>
                                <div className="auth-popup-buttons">
                                    <button
                                        className="auth-popup-button auth-popup-button-secondary"
                                        onClick={() => {
                                            setShowAuthPopup(false);
                                            // Keep pendingConnection so button shows "Finish Connecting"
                                        }}
                                    >
                                        Later
                                    </button>
                                    <button
                                        className="auth-popup-button auth-popup-button-primary"
                                        onClick={() => {
                                            setShowAuthPopup(false);
                                            setCurrentPage('settings');
                                            setShowAuthInSettings(true);
                                            // Keep pendingConnection so button shows "Finish Connecting" after login
                                        }}
                                    >
                                        Go to Settings
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Profile Customization Popup */}
                    {showProfilePopup && (
                        <div className="profile-popup-overlay" onClick={() => setShowProfilePopup(false)}>
                            <div className="profile-popup" onClick={(e) => e.stopPropagation()}>
                                <h2 style={{
                                    fontSize: '24px',
                                    fontWeight: '700',
                                    marginBottom: '8px',
                                    color: darkMode ? '#e5e5e5' : '#374151',
                                    textAlign: 'center'
                                }}>
                                    Customize Profile
                                </h2>
                                <p style={{
                                    fontSize: '14px',
                                    color: darkMode ? '#a0a0a0' : '#6b7280',
                                    marginBottom: '24px',
                                    textAlign: 'center'
                                }}>
                                    Choose a color and icon for your profile
                                </p>

                                {/* Color Selection */}
                                <div style={{marginBottom: '24px'}}>
                                    <h3 style={{
                                        fontSize: '16px',
                                        fontWeight: '600',
                                        marginBottom: '12px',
                                        color: darkMode ? '#c7d2fe' : '#374151'
                                    }}>
                                        Profile Color
                                    </h3>
                                    <div className="profile-color-grid">
                                        {[
                                            'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',
                                            'linear-gradient(135deg, #ec4899 0%, #f43f5e 100%)',
                                            'linear-gradient(135deg, #10b981 0%, #059669 100%)',
                                            'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',
                                            'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',
                                            'linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%)',
                                            'linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)',
                                            'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)',
                                            'linear-gradient(135deg, #84cc16 0%, #65a30d 100%)',
                                            'linear-gradient(135deg, #a855f7 0%, #9333ea 100%)'
                                        ].map((color, index) => (
                                            <div
                                                key={index}
                                                className={`profile-color-option ${tempProfileColor === color ? 'selected' : ''}`}
                                                style={{background: color}}
                                                onClick={() => setTempProfileColor(color)}
                                            />
                                        ))}
                                    </div>
                                </div>

                                {/* Texture Selection */}
                                <div style={{marginBottom: '24px'}}>
                                    <h3 style={{
                                        fontSize: '16px',
                                        fontWeight: '600',
                                        marginBottom: '12px',
                                        color: darkMode ? '#c7d2fe' : '#374151'
                                    }}>
                                        Animated Textures
                                    </h3>
                                    <div className="profile-image-grid">
                                        {[
                                            { name: 'None', class: '' },
                                            { name: 'Wave', class: 'texture-gradient-wave' },
                                            { name: 'Ocean', class: 'texture-ocean' },
                                            { name: 'Sunset', class: 'texture-sunset' },
                                            { name: 'Forest', class: 'texture-forest' },
                                            { name: 'Cosmic', class: 'texture-cosmic' },
                                            { name: 'Aurora', class: 'texture-aurora' },
                                            { name: 'Fire', class: 'texture-fire' },
                                            { name: 'Neon', class: 'texture-neon' }
                                        ].map((texture, index) => (
                                            <div
                                                key={index}
                                                className={`profile-texture-option ${texture.class} ${tempProfileIcon === texture.class ? 'selected' : ''}`}
                                                onClick={() => setTempProfileIcon(texture.class)}
                                                style={{
                                                    fontSize: '10px',
                                                    fontWeight: '600',
                                                    color: texture.class ? '#ffffff' : (darkMode ? '#e5e5e5' : '#374151'),
                                                    textShadow: texture.class ? '0 1px 2px rgba(0,0,0,0.5)' : 'none'
                                                }}
                                            >
                                                {texture.class === '' ? (userData ? userData.name.charAt(0).toUpperCase() : 'A') : texture.name}
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Buttons */}
                                <div className="profile-popup-buttons">
                                    <button
                                        className="profile-popup-btn unified-button"
                                        style={{
                                            background: darkMode ? 'rgba(20, 20, 20, 0.8)' : 'rgba(239, 68, 68, 0.1)',
                                            color: '#ef4444',
                                            border: darkMode ? '2px solid rgba(239, 68, 68, 0.3)' : '2px solid white'
                                        }}
                                        onClick={() => setShowProfilePopup(false)}
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        className="profile-popup-btn unified-button"
                                        style={{
                                            background: darkMode ? 'rgba(0, 0, 0, 0.9)' : 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',
                                            color: darkMode ? '#10b981' : 'white',
                                            border: darkMode ? '2px solid rgba(16, 185, 129, 0.3)' : '2px solid white'
                                        }}
                                        onClick={() => {
                                            setSelectedProfileColor(tempProfileColor);
                                            setSelectedProfileIcon(tempProfileIcon);
                                            localStorage.setItem('profileColor', tempProfileColor);
                                            localStorage.setItem('profileIcon', tempProfileIcon);
                                            setShowProfilePopup(false);
                                        }}
                                    >
                                        Save
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* AI Generation Modal */}
                    {showAiGenerationModal && (
                        <div className="ai-generation-overlay" onClick={(e) => {
                            if (e.target === e.currentTarget && !isAiGenerating) {
                                setShowAiGenerationModal(false);
                                setRemovedSuggestions([]);
                            }
                        }}>
                            <div className="ai-generation-container">
                                {/* Close Button - Top Right */}
                                {!isAiGenerating && (
                                    <button
                                        className="ai-generation-close-btn"
                                        onClick={() => {
                                            setShowAiGenerationModal(false);
                                            setRemovedSuggestions([]);
                                        }}
                                    >
                                        
                                    </button>
                                )}

                                {/* Grammar Button - Above Container */}
                                {!isAiGenerating && aiGenerationResult && (
                                    <div className="grammar-button-container">
                                        <button
                                            className={`grammar-check-btn ${isModalGrammarChecking ? 'checking' : ''}`}
                                            onClick={handleModalGrammarCheck}
                                            disabled={isModalGrammarChecking}
                                        >
                                            {isModalGrammarChecking ? (
                                                <>
                                                    <span style={{animation: 'spin 1s linear infinite', display: 'inline-block'}}></span>
                                                    <span>Checking grammar...</span>
                                                </>
                                            ) : modalGrammarResult ? (
                                                <>
                                                    <span></span>
                                                    <span>{modalGrammarResult}</span>
                                                </>
                                            ) : (
                                                <>
                                                    <span></span>
                                                    <span>Check Grammar</span>
                                                </>
                                            )}
                                        </button>
                                    </div>
                                )}

                                {/* Prompt Display */}
                                <div className="ai-generation-prompt" style={{marginTop: !isAiGenerating ? '0' : '0'}}>
                                    "{aiGenerationPrompt}"
                                </div>

                                {/* Generation Animation or Result */}
                                {isAiGenerating ? (
                                    <div className="ai-generation-animation">
                                        <div className="ai-generation-status-list">
                                            {(() => {
                                                const allStatuses = [
                                                    ' Analyzing your request',
                                                    ' Writing the email',
                                                    ' Polishing content',
                                                    ' Finalizing'
                                                ];
                                                const currentIdx = allStatuses.findIndex(s => aiGenerationStatus.includes(s.slice(2)));
                                                return allStatuses.map((status, idx) => {
                                                    let className = 'ai-generation-status-item';
                                                    const diff = idx - (currentIdx >= 0 ? currentIdx : 0);
                                                    if (diff === 0) className += ' active';
                                                    else if (diff === 1) className += ' behind-1';
                                                    else if (diff === 2) className += ' behind-2';
                                                    else if (diff >= 3) className += ' behind-3';
                                                    else className += ' hidden';
                                                    return (
                                                        <div key={idx} className={className}>
                                                            {status}
                                                        </div>
                                                    );
                                                });
                                            })()}
                                        </div>
                                    </div>
                                ) : (
                                    <div className="ai-generation-result">
                                        {/* Result Text with Wave Animation - Pure oval container */}
                                        <div style={{
                                            padding: '20px 0',
                                            marginBottom: '20px',
                                            maxHeight: '350px',
                                            overflowY: 'auto',
                                            fontSize: '15px',
                                            lineHeight: '1.8',
                                            color: darkMode ? '#e5e5e5' : '#374151',
                                            whiteSpace: 'pre-wrap',
                                            position: 'relative',
                                            scrollbarWidth: 'none',
                                            msOverflowStyle: 'none'
                                        }} className="grammar-wave-container">
                                            {/* Wave animation overlay */}
                                            {modalGrammarWaveActive && (
                                                <div className="grammar-checking-overlay"></div>
                                            )}
                                            {/* Text content with word-by-word wave animation */}
                                            <div className={modalGrammarWaveActive ? 'ai-wave-text' : ''}>
                                                {modalGrammarWaveActive ? (
                                                    (() => {
                                                        const words = aiGenerationResult.split(/(\s+)/);
                                                        let wordIndex = 0;
                                                        return words.map((word, idx) => {
                                                            if (word.match(/^\s+$/)) {
                                                                return <span key={idx}>{word}</span>;
                                                            }
                                                            const currentWordIdx = wordIndex++;
                                                            return (
                                                                <span
                                                                    key={idx}
                                                                    className="grammar-word"
                                                                    style={{
                                                                        animationDelay: `${currentWordIdx * 0.05}s`,
                                                                        animation: `word-wave 3s ease-in-out ${currentWordIdx * 0.05}s infinite`
                                                                    }}
                                                                >
                                                                    {word}
                                                                </span>
                                                            );
                                                        });
                                                    })()
                                                ) : aiGenerationResult}
                                            </div>
                                        </div>

                                        {/* Action Buttons */}
                                        <div style={{display: 'flex', gap: '10px', marginBottom: '20px', flexWrap: 'wrap'}}>
                                            <button
                                                onClick={() => {
                                                    setEmailText(aiGenerationResult);
                                                    setShowAiGenerationModal(false);
                                                    setRemovedSuggestions([]);
                                                }}
                                                style={{
                                                    padding: '12px 24px',
                                                    borderRadius: '50px',
                                                    background: 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',
                                                    color: 'white',
                                                    border: '2px solid white',
                                                    fontWeight: '600',
                                                    fontSize: '14px',
                                                    cursor: 'pointer',
                                                    transition: 'all 0.3s ease'
                                                }}
                                            >
                                                 Use This Email
                                            </button>
                                            <button
                                                onClick={() => {
                                                    navigator.clipboard.writeText(aiGenerationResult);
                                                    showNotification('Copied to clipboard!');
                                                }}
                                                style={{
                                                    padding: '12px 24px',
                                                    borderRadius: '50px',
                                                    background: darkMode ? 'rgba(40, 40, 45, 0.9)' : 'rgba(255, 255, 255, 0.9)',
                                                    color: darkMode ? '#a5b4fc' : '#4f46e5',
                                                    border: '2px solid rgba(99, 102, 241, 0.3)',
                                                    fontWeight: '600',
                                                    fontSize: '14px',
                                                    cursor: 'pointer',
                                                    transition: 'all 0.3s ease'
                                                }}
                                            >
                                                 Copy
                                            </button>
                                        </div>

                                        {/* Follow-up Section */}
                                        <div className="ai-followup-container">
                                            {/* Suggestion Chips with Remove Button */}
                                            {aiSuggestions.length > 0 && (
                                                <div style={{display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '16px'}}>
                                                    <div className="ai-suggestion-chips" style={{flex: 1}}>
                                                        {aiSuggestions.map((suggestion, idx) => (
                                                            <button
                                                                key={`${suggestion}-${idx}`}
                                                                className={`ai-suggestion-chip ${removingSuggestionIndex === idx ? 'removing' : ''} ${idx > 0 && removingSuggestionIndex === idx - 1 ? 'shifting' : ''}`}
                                                                onClick={() => handleSuggestionClick(suggestion, idx)}
                                                            >
                                                                <span>{suggestion}</span>
                                                                <span
                                                                    className="chip-remove-btn"
                                                                    onClick={(e) => handleRemoveSuggestion(e, suggestion, idx)}
                                                                >
                                                                    
                                                                </span>
                                                            </button>
                                                        ))}
                                                    </div>
                                                    {/* Restore Suggestion Button */}
                                                    {removedSuggestions.length > 0 && (
                                                        <button
                                                            onClick={handleRestoreSuggestion}
                                                            style={{
                                                                padding: '8px 14px',
                                                                borderRadius: '50px',
                                                                background: darkMode ? 'rgba(40, 40, 45, 0.9)' : 'rgba(255, 255, 255, 0.9)',
                                                                color: darkMode ? '#a5b4fc' : '#4f46e5',
                                                                border: '2px solid rgba(99, 102, 241, 0.3)',
                                                                fontWeight: '600',
                                                                fontSize: '12px',
                                                                cursor: 'pointer',
                                                                transition: 'all 0.3s ease',
                                                                whiteSpace: 'nowrap',
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                gap: '6px'
                                                            }}
                                                            title="Restore last removed suggestion"
                                                        >
                                                            <span></span>
                                                            <span>Undo</span>
                                                        </button>
                                                    )}
                                                </div>
                                            )}

                                            {/* Follow-up Input */}
                                            <div className="ai-followup-input-container">
                                                <input
                                                    type="text"
                                                    className="ai-followup-input"
                                                    placeholder="Ask for changes or improvements..."
                                                    value={aiFollowupPrompt}
                                                    onChange={(e) => setAiFollowupPrompt(e.target.value)}
                                                    onKeyPress={(e) => {
                                                        if (e.key === 'Enter' && aiFollowupPrompt.trim()) {
                                                            handleAiFollowup(aiFollowupPrompt);
                                                        }
                                                    }}
                                                />
                                                <button
                                                    onClick={() => handleAiFollowup(aiFollowupPrompt)}
                                                    disabled={!aiFollowupPrompt.trim()}
                                                    style={{
                                                        padding: '10px 18px',
                                                        borderRadius: '50px',
                                                        background: aiFollowupPrompt.trim()
                                                            ? 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)'
                                                            : 'rgba(156, 163, 175, 0.3)',
                                                        color: 'white',
                                                        border: 'none',
                                                        fontWeight: '600',
                                                        fontSize: '14px',
                                                        cursor: aiFollowupPrompt.trim() ? 'pointer' : 'not-allowed',
                                                        transition: 'all 0.3s ease'
                                                    }}
                                                >
                                                    
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* AI Writing Mode - Close Button and Prompt Container */}
                    {aiWritingMode && !aiWritingModeClosing && (
                        <>
                            {/* Close button */}
                            <button
                                className="ai-mode-close-btn"
                                onClick={closeAiWritingMode}
                            >
                                
                            </button>

                            {/* Oval Prompt Container at bottom */}
                            <div className="ai-writer-prompt-container">
                                <div className="ai-writer-prompt-input">
                                    <span style={{fontSize: '18px'}}></span>
                                    <input
                                        type="text"
                                        placeholder="Ask AI to modify your email..."
                                        value={replyPrompt}
                                        onChange={(e) => setReplyPrompt(e.target.value)}
                                        onKeyPress={(e) => {
                                            if (e.key === 'Enter' && replyPrompt.trim() && emailReply) {
                                                handleRewriteReply();
                                            }
                                        }}
                                    />
                                    <button
                                        onClick={() => {
                                            if (replyPrompt.trim() && emailReply) {
                                                handleRewriteReply();
                                            }
                                        }}
                                        disabled={!replyPrompt.trim() || !emailReply || isRewritingReply}
                                        style={{
                                            padding: '10px 20px',
                                            borderRadius: '50px',
                                            background: (replyPrompt.trim() && emailReply)
                                                ? 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)'
                                                : 'rgba(156, 163, 175, 0.3)',
                                            color: 'white',
                                            border: 'none',
                                            fontWeight: '600',
                                            cursor: (replyPrompt.trim() && emailReply) ? 'pointer' : 'not-allowed',
                                            transition: 'all 0.3s ease'
                                        }}
                                    >
                                        {isRewritingReply ? '...' : ''}
                                    </button>
                                </div>
                            </div>
                        </>
                    )}

                    {/* View Full Email Popup */}
                    {showViewEmailPopup && viewEmailPopupData && (
                        <div className="view-email-popup-overlay" onClick={(e) => {
                            if (e.target === e.currentTarget) {
                                setShowViewEmailPopup(false);
                                setViewEmailPopupData(null);
                            }
                        }}>
                            <div className="view-email-popup">
                                <div className="view-email-header">
                                    <h2 style={{fontSize: '18px', fontWeight: '700', color: darkMode ? '#e5e5e5' : '#374151'}}>
                                         Full Email
                                    </h2>
                                    <button
                                        className="view-email-close-btn"
                                        onClick={() => {
                                            setShowViewEmailPopup(false);
                                            setViewEmailPopupData(null);
                                        }}
                                    >
                                        
                                    </button>
                                </div>
                                <div className="view-email-content">
                                    <h3 className="view-email-subject">{viewEmailPopupData.subject}</h3>
                                    <div className="view-email-meta">
                                        <span className="view-email-from">From: {viewEmailPopupData.from}</span>
                                        <span className="view-email-date">{viewEmailPopupData.date}</span>
                                    </div>
                                    <div className="view-email-body">
                                        {viewEmailPopupData.body || viewEmailPopupData.snippet || 'No content available'}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Logout Confirmation Dialog */}
                    {showLogoutConfirm && (
                        <div className="logout-confirm-overlay" onClick={cancelLogout}>
                            <div className="logout-confirm-dialog" onClick={(e) => e.stopPropagation()}>
                                <div className="logout-confirm-icon"></div>
                                <div className="logout-confirm-title">Confirm Logout</div>
                                <div className="logout-confirm-message">
                                    Are you sure you want to log out? You'll need to sign in again to access your account.
                                </div>
                                <div className="logout-confirm-buttons">
                                    <button className="logout-confirm-btn cancel" onClick={cancelLogout}>
                                        Cancel
                                    </button>
                                    <button className="logout-confirm-btn confirm" onClick={confirmLogout}>
                                        Logout
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Save Draft Modal */}
                    {showSaveDraftModal && (
                        <div className="logout-confirm-overlay" onClick={closeDraftWithoutSaving}>
                            <div className="logout-confirm-dialog" onClick={(e) => e.stopPropagation()}>
                                <div className="logout-confirm-icon"></div>
                                <div className="logout-confirm-title">Save Email Draft?</div>
                                <div className="logout-confirm-message">
                                    Would you like to save this generated email as a draft? You can access it later from the Drafts tab.
                                </div>
                                <div className="logout-confirm-buttons">
                                    <button className="logout-confirm-btn cancel" onClick={closeDraftWithoutSaving}>
                                        Close Without Saving
                                    </button>
                                    <button className="logout-confirm-btn confirm" onClick={saveDraft} style={{
                                        background: 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',
                                        boxShadow: '0 4px 12px rgba(99, 102, 241, 0.3)'
                                    }}>
                                        Save as Draft
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
