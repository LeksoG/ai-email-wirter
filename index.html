<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Tools Suite - Transform Your Communication</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg,
                #e0e7ff 0%,
                #f3e8ff 25%,
                #ddd6fe 50%,
                #e0e7ff 75%,
                #f0f9ff 100%
            );
            background-size: 400% 400%;
            animation: subtle-shift 20s ease infinite;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            padding-top: 100px; /* Space for sticky header */
        }

        body.dark-mode {
            background: linear-gradient(135deg,
                #000000 0%,
                #0a0a0a 25%,
                #1a1a1a 50%,
                #0a0a0a 75%,
                #000000 100%
            );
        }

        body.dark-mode .glass-effect {
            background: rgba(20, 20, 20, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .glass-dark {
            background: rgba(30, 30, 30, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .text-gray-800,
        body.dark-mode .text-gray-700 {
            color: #e5e5e5 !important;
        }

        body.dark-mode .text-gray-600,
        body.dark-mode .text-gray-500 {
            color: #a0a0a0 !important;
        }

        body.dark-mode .custom-textarea {
            background: rgba(30, 30, 30, 0.8);
            color: #e5e5e5;
        }

        body.dark-mode .sticky-header {
            background: rgba(10, 10, 10, 0.7);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .action-btn {
            background: rgba(40, 40, 40, 0.9);
            border: 1px solid rgba(99, 102, 241, 0.4);
            color: #e5e5e5;
        }

        body.dark-mode .action-btn:hover {
            background: rgba(60, 60, 60, 1);
            border-color: rgba(99, 102, 241, 0.6);
        }

        @keyframes subtle-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* AI Grid Pattern Overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(99, 102, 241, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(99, 102, 241, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        /* Page Load Blur-in Animation */
        .page-container {
            animation: blur-in 1.2s ease-out;
        }

        @keyframes blur-in {
            0% {
                opacity: 0;
                filter: blur(20px);
                transform: scale(0.95);
            }
            100% {
                opacity: 1;
                filter: blur(0);
                transform: scale(1);
            }
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.95);
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.08);
        }

        .glass-dark {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.85);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.05);
        }

        .gradient-text {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .ai-glow {
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.15),
                        0 0 60px rgba(139, 92, 246, 0.1);
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in {
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .oval-button {
            border-radius: 50px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .oval-button:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.2);
        }

        .tool-card {
            transition: all 0.3s ease;
        }

        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(99, 102, 241, 0.15);
        }

        textarea:focus, input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .custom-textarea {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid rgba(99, 102, 241, 0.25);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 15px;
            line-height: 1.6;
        }

        .custom-textarea:focus {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(99, 102, 241, 0.5);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1),
                        0 8px 24px rgba(99, 102, 241, 0.15);
            transform: translateY(-2px);
        }

        .tab-container {
            position: relative;
            display: inline-flex;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50px;
            padding: 6px;
            margin-bottom: 24px;
        }

        .tab-slider {
            position: absolute;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 50px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 0;
        }

        /* Loading Lines Animation - Gemini Style */
        .loading-lines {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 100%;
            padding: 20px 0;
        }

        .loading-line {
            height: 12px;
            background: linear-gradient(90deg,
                rgba(99, 102, 241, 0.1) 0%,
                rgba(139, 92, 246, 0.6) 50%,
                rgba(99, 102, 241, 0.1) 100%
            );
            background-size: 200% 100%;
            border-radius: 20px;
            animation: loading-wave 2s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        .loading-line::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(255, 255, 255, 0.4) 50%,
                transparent 100%
            );
            animation: loading-shine 2s ease-in-out infinite;
        }

        .loading-line:nth-child(1) {
            animation-delay: 0s;
            width: 95%;
        }
        .loading-line:nth-child(2) {
            animation-delay: 0.15s;
            width: 88%;
        }
        .loading-line:nth-child(3) {
            animation-delay: 0.3s;
            width: 92%;
        }
        .loading-line:nth-child(4) {
            animation-delay: 0.45s;
            width: 85%;
        }
        .loading-line:nth-child(5) {
            animation-delay: 0.6s;
            width: 90%;
        }
        .loading-line:nth-child(6) {
            animation-delay: 0.75s;
            width: 80%;
        }

        @keyframes loading-wave {
            0%, 100% {
                background-position: -200% 0;
                transform: scaleX(0.98);
                opacity: 0.7;
            }
            50% {
                background-position: 200% 0;
                transform: scaleX(1);
                opacity: 1;
            }
        }

        @keyframes loading-shine {
            0% {
                left: -100%;
            }
            100% {
                left: 100%;
            }
        }

        /* Fast Wave Animation - Gemini Style */
        .wave-char {
            display: inline-block;
            opacity: 0;
            animation: wave-appear 0.15s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes wave-appear {
            0% {
                opacity: 0;
                transform: translateY(8px) scale(0.95);
                filter: blur(2px);
            }
            60% {
                opacity: 1;
                transform: translateY(-2px) scale(1.02);
                filter: blur(0);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
                filter: blur(0);
            }
        }

        .result-container {
            position: relative;
            min-height: 300px;
        }

        .settings-panel {
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .email-item {
            transition: all 0.2s ease;
            position: relative;
        }

        .email-item:hover {
            background: rgba(99, 102, 241, 0.1);
            transform: translateX(5px);
        }

        .email-hover-buttons {
            position: absolute;
            top: 12px;
            right: 16px;
            display: none;
            gap: 8px;
            z-index: 10;
        }

        .email-item:hover .email-hover-buttons {
            display: flex;
        }

        .email-hover-btn {
            padding: 4px 12px;
            font-size: 11px;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .email-hover-btn:hover {
            background: rgba(99, 102, 241, 0.1);
            border-color: rgba(99, 102, 241, 0.5);
        }

        /* Summarize Popup */
        .summary-popup {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 12px;
            background: white;
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            z-index: 50;
            animation: popup-slide-down 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        body.dark-mode .summary-popup {
            background: rgba(30, 30, 30, 0.95);
            border-color: rgba(99, 102, 241, 0.5);
        }

        @keyframes popup-slide-down {
            from {
                opacity: 0;
                transform: translateY(-10px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Send Button - Floating */
        .send-button-float {
            position: absolute;
            bottom: 16px;
            right: 16px;
            padding: 12px 20px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            transition: all 0.3s ease;
            animation: float-in 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 10;
        }

        .send-button-float:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
        }

        @keyframes float-in {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* AI Transform Container */
        .ai-transform-container {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
        }

        .ai-transform-input {
            width: 100%;
            padding: 12px 140px 12px 20px;
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 50px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s;
        }

        .ai-transform-input:focus {
            outline: none;
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        body.dark-mode .ai-transform-input {
            background: rgba(30, 30, 30, 0.8);
            color: #e5e5e5;
        }

        .ai-transform-button {
            position: absolute;
            right: 6px;
            top: 50%;
            transform: translateY(-50%);
            padding: 8px 20px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ai-transform-button:hover {
            opacity: 0.9;
        }

        .ai-transform-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Wave Animation - Apple Intelligence Style */
        .wave-char {
            display: inline-block;
            opacity: 0;
            animation: wave-splash 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes wave-splash {
            0% {
                opacity: 0;
                transform: translate(-4px, -4px) scale(0.9);
                filter: blur(3px);
            }
            50% {
                opacity: 1;
                filter: blur(0);
            }
            100% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
                filter: blur(0);
            }
        }

        /* Full-page email viewer - iOS style */
        .email-viewer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: overlay-fade-in 0.3s ease-out;
        }

        @keyframes overlay-fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .email-viewer-container {
            width: 90%;
            max-width: 900px;
            height: 90vh;
            background: white;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: viewer-slide-up 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            flex-direction: column;
        }

        body.dark-mode .email-viewer-container {
            background: rgba(20, 20, 20, 0.95);
        }

        @keyframes viewer-slide-up {
            from {
                transform: translateY(100px) scale(0.95);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        /* Filter Dropdown */
        .filter-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            min-width: 200px;
            max-width: 300px;
            z-index: 50;
            animation: dropdown-appear 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes dropdown-appear {
            from {
                opacity: 0;
                transform: translateY(-10px) scale(0.95);
                filter: blur(4px);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
                filter: blur(0);
            }
        }

        /* Suggestions blur animation */
        .suggestions-container {
            animation: blur-slide-in 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes blur-slide-in {
            from {
                opacity: 0;
                transform: translateX(-20px);
                filter: blur(8px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
                filter: blur(0);
            }
        }

        /* Tab container styling */
        .tab-button-container {
            background: rgba(255, 255, 255, 0.6);
            border: 2px solid rgba(99, 102, 241, 0.2);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.1);
        }

        /* File Viewer Modal */
        .file-viewer-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: modal-appear 0.3s ease-out;
        }

        @keyframes modal-appear {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .file-viewer-content {
            background: white;
            border-radius: 24px;
            max-width: 800px;
            max-height: 80vh;
            width: 90%;
            overflow: hidden;
            animation: modal-slide-up 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        @keyframes modal-slide-up {
            from {
                transform: translateY(50px) scale(0.95);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Sticky Header */
        .sticky-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 50;
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.05);
            animation: header-slide-down 0.3s ease-out;
        }

        @keyframes header-slide-down {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Action Buttons (Copy/Retry) */
        .action-buttons {
            display: flex;
            gap: 8px;
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
        }

        .action-btn {
            padding: 6px 16px;
            font-size: 12px;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 1);
            border-color: rgba(99, 102, 241, 0.5);
            transform: translateY(-1px);
        }

        /* Floating AI particles */
        .ai-particle {
            position: fixed;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.4), transparent);
            border-radius: 50%;
            pointer-events: none;
            animation: float-particle 15s infinite ease-in-out;
        }

        @keyframes float-particle {
            0%, 100% { 
                transform: translate(0, 0) scale(1);
                opacity: 0.3;
            }
            25% { 
                transform: translate(30px, -40px) scale(1.5);
                opacity: 0.6;
            }
            50% { 
                transform: translate(-20px, -80px) scale(1);
                opacity: 0.4;
            }
            75% { 
                transform: translate(-50px, -40px) scale(1.2);
                opacity: 0.5;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [currentPage, setCurrentPage] = useState('home');
            const [activeTab, setActiveTab] = useState('email');
            const [activeView, setActiveView] = useState('writer');
            const [emailText, setEmailText] = useState('');
            const [customPrompt, setCustomPrompt] = useState('');
            const [result, setResult] = useState('');
            const [isProcessing, setIsProcessing] = useState(false);
            const [showSuggestions, setShowSuggestions] = useState(false);
            const [emailConnected, setEmailConnected] = useState(false);
            const [showFilterDropdown, setShowFilterDropdown] = useState(false);
            const [selectedTone, setSelectedTone] = useState(null);
            const [uploadedFile, setUploadedFile] = useState(null);
            const [savedResults, setSavedResults] = useState([]);
            const [viewingFile, setViewingFile] = useState(null);
            const [darkMode, setDarkMode] = useState(false);
            const [gmailEmails, setGmailEmails] = useState([]);
            const [sentEmails, setSentEmails] = useState([]);
            const [showSuggestionsEnabled, setShowSuggestionsEnabled] = useState(true);
            const [userEmail, setUserEmail] = useState('');
            const [viewingEmail, setViewingEmail] = useState(null);
            const [emailReply, setEmailReply] = useState('');
            const [replyPrompt, setReplyPrompt] = useState('');
            const [summarizingEmail, setSummarizingEmail] = useState(null);
            const [summaryText, setSummaryText] = useState('');
            const [isSummarizing, setIsSummarizing] = useState(false);
            const [summaryHidden, setSummaryHidden] = useState(false);
            const [userEmails, setUserEmails] = useState([
                { id: 1, from: 'john@example.com', subject: 'Meeting Tomorrow', preview: 'Hey, just wanted to confirm...', date: '2 hours ago' },
                { id: 2, from: 'sarah@company.com', subject: 'Project Update', preview: 'The latest updates on the project...', date: '5 hours ago' },
                { id: 3, from: 'mike@startup.io', subject: 'Quick Question', preview: 'Do you have a moment to discuss...', date: '1 day ago' },
            ]);

            // Initialize app with console logging
            useEffect(() => {
                console.log('üöÄ AI Email Writer initialized');
                console.log('üìä Initial state:', { activeTab, activeView, currentPage });
                console.log('üîå API endpoint:', '/api/transform');

                // Check for OAuth callback with tokens
                const urlParams = new URLSearchParams(window.location.search);
                const tokensParam = urlParams.get('tokens');

                if (tokensParam) {
                    try {
                        const tokens = JSON.parse(decodeURIComponent(tokensParam));
                        console.log('üéâ OAuth tokens received!');

                        // Store tokens in localStorage
                        localStorage.setItem('gmailTokens', JSON.stringify(tokens));
                        localStorage.setItem('emailConnected', 'true');
                        localStorage.removeItem('oauth_in_progress');

                        setEmailConnected(true);

                        // Fetch user info to get email address
                        fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
                            headers: {
                                Authorization: `Bearer ${tokens.access_token}`
                            }
                        })
                        .then(res => res.json())
                        .then(userInfo => {
                            console.log('üë§ User:', userInfo.email);
                            setUserEmail(userInfo.email);
                            localStorage.setItem('userEmail', userInfo.email);
                        })
                        .catch(err => console.error('Error fetching user info:', err));

                        // Fetch emails
                        fetchGmailEmails(tokens.access_token);
                        fetchSentEmails(tokens.access_token);

                        // Clean URL
                        window.history.replaceState({}, '', '/');
                    } catch (error) {
                        console.error('‚ùå Error processing OAuth tokens:', error);
                    }
                }

                // Load email connection from localStorage
                const savedConnection = localStorage.getItem('emailConnected');
                const savedTokens = localStorage.getItem('gmailTokens');
                const savedUserEmail = localStorage.getItem('userEmail');
                const savedShowSuggestions = localStorage.getItem('showSuggestions');

                if (savedUserEmail) {
                    setUserEmail(savedUserEmail);
                }

                if (savedShowSuggestions !== null) {
                    setShowSuggestionsEnabled(savedShowSuggestions === 'true');
                }

                if (savedConnection === 'true' && savedTokens) {
                    setEmailConnected(true);

                    // Fetch emails with saved tokens
                    try {
                        const tokens = JSON.parse(savedTokens);
                        fetchGmailEmails(tokens.access_token);
                        fetchSentEmails(tokens.access_token);
                    } catch (error) {
                        console.error('‚ùå Error loading saved tokens:', error);
                        // Clear invalid tokens
                        localStorage.removeItem('gmailTokens');
                        localStorage.removeItem('emailConnected');
                        localStorage.removeItem('userEmail');
                        setEmailConnected(false);
                        setUserEmail('');
                    }
                }

                // Load dark mode preference
                const savedDarkMode = localStorage.getItem('darkMode');
                if (savedDarkMode === 'true') {
                    setDarkMode(true);
                    document.body.classList.add('dark-mode');
                }
            }, []);

            // Update dark mode
            useEffect(() => {
                if (darkMode) {
                    document.body.classList.add('dark-mode');
                    localStorage.setItem('darkMode', 'true');
                } else {
                    document.body.classList.remove('dark-mode');
                    localStorage.setItem('darkMode', 'false');
                }
            }, [darkMode]);

            // Update suggestions based on custom prompt only
            useEffect(() => {
                if (showSuggestionsEnabled && customPrompt.length > 0) {
                    setShowSuggestions(true);
                } else {
                    setShowSuggestions(false);
                }
            }, [customPrompt, showSuggestionsEnabled]);

            const emailStyles = [
                { id: 'professional', label: 'üíº Professional' },
                { id: 'friendly', label: 'üòä Friendly' },
                { id: 'concise', label: '‚ö° Concise' },
                { id: 'persuasive', label: 'üéØ Persuasive' },
                { id: 'apologetic', label: 'üôè Apologetic' },
                { id: 'enthusiastic', label: 'üöÄ Enthusiastic' }
            ];

            const tools = [
                { id: 'email', icon: '‚úâÔ∏è', name: 'Email Rewriter', desc: 'Transform your emails instantly' },
                { id: 'summary', icon: 'üìù', name: 'Text Summarizer', desc: 'Condense long content' },
                { id: 'grammar', icon: '‚úÖ', name: 'Grammar Check', desc: 'Polish your writing' },
                { id: 'translate', icon: 'üåê', name: 'Translator', desc: 'Translate to any language' },
                { id: 'ideas', icon: 'üí°', name: 'Idea Generator', desc: 'Brainstorm creative ideas' },
                { id: 'tone', icon: 'üé≠', name: 'Tone Analyzer', desc: 'Understand message sentiment' }
            ];

            const handleGmailConnect = async () => {
                try {
                    console.log('üîê Initiating Gmail OAuth...');

                    // Call your auth endpoint to get the OAuth URL
                    const response = await fetch('/api/gmail-auth');

                    if (!response.ok) {
                        throw new Error('Failed to initiate OAuth');
                    }

                    const data = await response.json();
                    console.log('üìß Redirecting to Google OAuth...');

                    // Store that we're in OAuth flow
                    localStorage.setItem('oauth_in_progress', 'true');

                    // Redirect to Google's OAuth consent screen
                    window.location.href = data.authUrl;
                } catch (error) {
                    console.error('‚ùå Gmail OAuth error:', error);
                    console.error('Please check: GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET are set in Vercel');
                }
            };

            const fetchGmailEmails = async (accessToken) => {
                try {
                    console.log('üì¨ Fetching Gmail inbox...');

                    const response = await fetch('/api/gmail-inbox', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ accessToken })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to fetch emails');
                    }

                    const data = await response.json();

                    // Transform Gmail API response to our format
                    const formattedEmails = data.emails.map(email => {
                        const headers = email.payload.headers;
                        const from = headers.find(h => h.name === 'From')?.value || 'Unknown';
                        const subject = headers.find(h => h.name === 'Subject')?.value || 'No Subject';
                        const date = headers.find(h => h.name === 'Date')?.value || '';

                        return {
                            id: email.id,
                            from: from,
                            subject: subject,
                            snippet: email.snippet,
                            date: new Date(parseInt(email.internalDate)).toLocaleString()
                        };
                    });

                    setGmailEmails(formattedEmails);
                    console.log(`‚úÖ Loaded ${formattedEmails.length} emails from inbox`);
                } catch (error) {
                    console.error('‚ùå Error fetching emails:', error);
                }
            };

            const fetchSentEmails = async (accessToken) => {
                try {
                    console.log('üì§ Fetching sent emails...');

                    const response = await fetch('/api/gmail-sent', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ accessToken })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to fetch sent emails');
                    }

                    const data = await response.json();

                    // Transform Gmail API response to our format
                    const formattedEmails = data.emails.map(email => {
                        const headers = email.payload.headers;
                        const to = headers.find(h => h.name === 'To')?.value || 'Unknown';
                        const subject = headers.find(h => h.name === 'Subject')?.value || 'No Subject';
                        const date = headers.find(h => h.name === 'Date')?.value || '';

                        return {
                            id: email.id,
                            to: to,
                            subject: subject,
                            snippet: email.snippet,
                            date: new Date(parseInt(email.internalDate)).toLocaleString()
                        };
                    });

                    setSentEmails(formattedEmails);
                    console.log(`‚úÖ Loaded ${formattedEmails.length} sent emails`);
                } catch (error) {
                    console.error('‚ùå Error fetching sent emails:', error);
                }
            };

            const callAIAPI = async (prompt, text) => {
                console.log('ü§ñ Calling AI API...');
                console.log('üìù Prompt:', prompt);
                console.log('üìÑ Text length:', text.length, 'characters');

                try {
                    const response = await fetch('/api/transform', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            prompt: prompt,
                            text: text
                        })
                    });

                    console.log('üì° API Response status:', response.status);

                    if (!response.ok) {
                        const contentType = response.headers.get('content-type');
                        let errorMessage = 'API request failed';

                        if (contentType && contentType.includes('application/json')) {
                            const errorData = await response.json();
                            errorMessage = errorData.error || errorMessage;
                        } else {
                            const errorText = await response.text();
                            console.error('‚ùå Non-JSON response:', errorText.substring(0, 200));
                            errorMessage = 'Server error: API endpoint not available. Make sure you\'ve deployed to Vercel.';
                        }

                        throw new Error(errorMessage);
                    }

                    const data = await response.json();
                    console.log('‚úÖ AI Response received, length:', data.result?.length || 0);
                    return data.result;
                } catch (error) {
                    console.error('‚ùå API Error:', error.message);
                    throw error;
                }
            };

            const animateText = (text) => {
                const resultElement = document.getElementById('result-text');
                if (!resultElement) return;

                resultElement.innerHTML = '';
                const lines = text.split('\n');

                // Calculate position-based delay for splash effect (top-left to bottom-right)
                lines.forEach((line, lineIndex) => {
                    const words = line.split(' ');
                    words.forEach((word, wordIndex) => {
                        const wordSpan = document.createElement('span');
                        wordSpan.className = 'wave-char';
                        wordSpan.textContent = word;
                        // Diagonal splash: lineIndex + wordIndex for top-left to bottom-right
                        const diagonalDelay = (lineIndex + wordIndex * 0.3) * 0.015;
                        wordSpan.style.animationDelay = `${diagonalDelay}s`;
                        resultElement.appendChild(wordSpan);

                        // Add space after word (except last word)
                        if (wordIndex < words.length - 1) {
                            const space = document.createTextNode(' ');
                            resultElement.appendChild(space);
                        }
                    });

                    // Add line break (except after last line)
                    if (lineIndex < lines.length - 1) {
                        const br = document.createElement('br');
                        resultElement.appendChild(br);
                    }
                });
            };

            const handleStyleClick = (style) => {
                // Just set the selected tone, don't generate yet
                setSelectedTone(style);
                console.log('üé® Tone selected:', style);
            };

            const handleGenerate = async () => {
                if (!selectedTone && !customPrompt) return;

                // Ensure we have text to process
                const textToProcess = uploadedFile?.content || emailText;
                if (!textToProcess || textToProcess.trim().length === 0) {
                    alert('Please enter some text or upload a file before generating!');
                    return;
                }

                setIsProcessing(true);
                setResult('');
                setActiveView('results');

                let prompt = customPrompt;

                if (selectedTone && !customPrompt) {
                    switch(selectedTone) {
                        case 'professional':
                            prompt = 'Rewrite this email in a professional, formal business tone';
                            break;
                        case 'friendly':
                            prompt = 'Rewrite this email in a warm, friendly, and approachable tone';
                            break;
                        case 'concise':
                            prompt = 'Rewrite this email to be brief and to the point';
                            break;
                        case 'persuasive':
                            prompt = 'Rewrite this email to be compelling and convincing';
                            break;
                        case 'apologetic':
                            prompt = 'Rewrite this email with a sincere and apologetic tone';
                            break;
                        case 'enthusiastic':
                            prompt = 'Rewrite this email with an energetic and enthusiastic tone';
                            break;
                    }
                } else if (selectedTone && customPrompt) {
                    // Combine tone with custom prompt
                    const toneLabel = emailStyles.find(s => s.id === selectedTone)?.label || '';
                    prompt = `${customPrompt} in a ${toneLabel} tone`;
                }

                try {
                    const transformedText = await callAIAPI(prompt, uploadedFile?.content || emailText);
                    setResult(transformedText);

                    // Save to history
                    const newResult = {
                        id: Date.now(),
                        content: transformedText,
                        prompt: prompt,
                        originalText: uploadedFile?.content || emailText,
                        timestamp: new Date().toLocaleString(),
                        tone: selectedTone
                    };
                    setSavedResults(prev => [newResult, ...prev]);

                    setIsProcessing(false);
                    setTimeout(() => animateText(transformedText), 100);
                } catch (error) {
                    console.error('API Error:', error);
                    setResult(`Error: ${error.message}\n\nPlease check that:\n1. Your MISTRAL_API_KEY is set in Vercel\n2. Your API key is valid\n3. You have sufficient credits`);
                    setIsProcessing(false);
                }
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    const content = event.target.result;
                    setUploadedFile({
                        name: file.name,
                        content: content,
                        size: file.size
                    });
                    setEmailText(''); // Clear textarea when file is uploaded
                    console.log('üìÅ File uploaded:', file.name);
                };
                reader.readAsText(file);
            };

            const handleDeleteResult = (id) => {
                setSavedResults(prev => prev.filter(r => r.id !== id));
                console.log('üóëÔ∏è Deleted result:', id);
            };

            const handleRetry = async () => {
                if (!savedResults.length) return;

                const lastResult = savedResults[0];
                console.log('üîÑ Retrying with prompt:', lastResult.prompt);

                setIsProcessing(true);
                setResult('');

                try {
                    const transformedText = await callAIAPI(lastResult.prompt, lastResult.originalText);
                    setResult(transformedText);

                    // Save new retry result
                    const newResult = {
                        id: Date.now(),
                        content: transformedText,
                        prompt: lastResult.prompt,
                        originalText: lastResult.originalText,
                        timestamp: new Date().toLocaleString(),
                        tone: lastResult.tone
                    };
                    setSavedResults(prev => [newResult, ...prev]);

                    setIsProcessing(false);
                    setTimeout(() => animateText(transformedText), 100);
                } catch (error) {
                    console.error('Retry Error:', error);
                    setResult(`Error: ${error.message}`);
                    setIsProcessing(false);
                }
            };

            const handleToolProcess = async () => {
                setIsProcessing(true);
                setResult('');
                setActiveView('results');
                
                let prompt = '';
                switch(activeTab) {
                    case 'summary':
                        prompt = 'Summarize this text concisely';
                        break;
                    case 'grammar':
                        prompt = 'Check and correct the grammar in this text';
                        break;
                    case 'translate':
                        prompt = 'Translate this text to Spanish';
                        break;
                    case 'ideas':
                        prompt = 'Generate creative ideas based on this text';
                        break;
                    case 'tone':
                        prompt = 'Analyze the tone and sentiment of this text';
                        break;
                }

                try {
                    const output = await callAIAPI(prompt, emailText);
                    setResult(output);
                    setIsProcessing(false);
                    setTimeout(() => animateText(output), 100);
                } catch (error) {
                    console.error('API Error:', error);
                    setResult(`Error: ${error.message}\n\nPlease check that:\n1. Your MISTRAL_API_KEY is set in Vercel\n2. Your API key is valid\n3. You have sufficient credits`);
                    setIsProcessing(false);
                }
            };

            const renderSettings = () => {
                return (
                    <div className="settings-panel space-y-8">
                        <div className="glass-effect rounded-3xl p-8 ai-glow">
                            <h2 className="text-3xl font-bold text-gray-800 mb-6">‚öôÔ∏è Settings</h2>

                            <div className="space-y-6">
                                {/* Dark Mode Toggle */}
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                        üåô Dark Mode
                                    </label>
                                    <div className="flex items-center justify-between glass-dark px-4 py-3 rounded-xl">
                                        <span className="text-sm text-gray-700">Enable dark theme</span>
                                        <button
                                            onClick={() => setDarkMode(!darkMode)}
                                            className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${
                                                darkMode ? 'bg-indigo-600' : 'bg-gray-300'
                                            }`}
                                        >
                                            <span
                                                className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${
                                                    darkMode ? 'translate-x-6' : 'translate-x-1'
                                                }`}
                                            />
                                        </button>
                                    </div>
                                </div>

                                {/* Show Suggestions Toggle */}
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                        üí° Show Suggestions
                                    </label>
                                    <div className="flex items-center justify-between glass-dark px-4 py-3 rounded-xl">
                                        <span className="text-sm text-gray-700">Show AI tone suggestions while typing</span>
                                        <button
                                            onClick={() => {
                                                const newValue = !showSuggestionsEnabled;
                                                setShowSuggestionsEnabled(newValue);
                                                localStorage.setItem('showSuggestions', newValue.toString());
                                            }}
                                            className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${
                                                showSuggestionsEnabled ? 'bg-indigo-600' : 'bg-gray-300'
                                            }`}
                                        >
                                            <span
                                                className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${
                                                    showSuggestionsEnabled ? 'translate-x-6' : 'translate-x-1'
                                                }`}
                                            />
                                        </button>
                                    </div>
                                </div>

                                {/* Email Connection Section */}
                                <div className="pt-6 border-t border-gray-300">
                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                        üìß Email Connection
                                    </label>
                                    <p className="text-xs text-gray-600 mb-4">
                                        Connect your Gmail to access and transform your messages
                                    </p>

                                    {!emailConnected ? (
                                        <button
                                            onClick={handleGmailConnect}
                                            className="w-full px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-full font-medium hover:from-indigo-600 hover:to-purple-700 transition-all oval-button"
                                        >
                                            Connect Gmail
                                        </button>
                                    ) : (
                                        <div className="flex items-center justify-between glass-dark px-4 py-3 rounded-xl">
                                            <div className="flex flex-col">
                                                <span className="text-sm font-medium text-gray-700">‚úÖ Connected to Gmail</span>
                                                {userEmail && <span className="text-xs text-gray-600 mt-1">{userEmail}</span>}
                                            </div>
                                            <button
                                                onClick={() => {
                                                    setEmailConnected(false);
                                                    localStorage.removeItem('emailConnected');
                                                    localStorage.removeItem('gmailTokens');
                                                    localStorage.removeItem('userEmail');
                                                    setGmailEmails([]);
                                                    setSentEmails([]);
                                                    setUserEmail('');
                                                    console.log('üìß Gmail disconnected');
                                                }}
                                                className="text-xs text-red-600 hover:text-red-700"
                                            >
                                                Disconnect
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const handleSummarizeEmail = async (email) => {
                console.log('‚ú® Summarizing email:', email.subject);
                setSummarizingEmail(email.id);
                setIsSummarizing(true);
                setSummaryText('');
                setSummaryHidden(false);

                try {
                    const summary = await callAIAPI('Summarize this email concisely in 2-3 sentences', email.snippet);
                    setSummaryText(summary);
                    setIsSummarizing(false);

                    // Animate summary text with wave effect
                    setTimeout(() => {
                        const summaryElement = document.getElementById(`summary-text-${email.id}`);
                        if (summaryElement) {
                            summaryElement.innerHTML = '';
                            const words = summary.split(' ');
                            words.forEach((word, index) => {
                                const wordSpan = document.createElement('span');
                                wordSpan.className = 'wave-char';
                                wordSpan.textContent = word;
                                wordSpan.style.animationDelay = `${index * 0.02}s`;
                                summaryElement.appendChild(wordSpan);

                                if (index < words.length - 1) {
                                    const space = document.createTextNode(' ');
                                    summaryElement.appendChild(space);
                                }
                            });
                        }
                    }, 50);
                } catch (error) {
                    console.error('Error summarizing:', error);
                    setSummaryText('Failed to summarize email');
                    setIsSummarizing(false);
                }
            };

            const handleDeleteEmail = (emailId, type = 'inbox') => {
                if (type === 'inbox') {
                    setGmailEmails(prev => prev.filter(e => e.id !== emailId));
                } else {
                    setSentEmails(prev => prev.filter(e => e.id !== emailId));
                }
                console.log(`üóëÔ∏è Deleted ${type} email:`, emailId);
            };

            const renderInbox = () => {
                return (
                    <div className="space-y-6">
                        <div className="glass-effect rounded-3xl p-8 ai-glow">
                            <h2 className="text-3xl font-bold text-gray-800 mb-6">üì• Inbox</h2>
                            <div className="space-y-3">
                                {gmailEmails.length > 0 ? (
                                    gmailEmails.map(email => (
                                        <div
                                            key={email.id}
                                            onClick={() => setViewingEmail(email)}
                                            className="email-item glass-dark px-6 py-4 rounded-2xl cursor-pointer hover:shadow-lg transition-all relative"
                                        >
                                            <div className="email-hover-buttons">
                                                <button
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        handleSummarizeEmail(email);
                                                    }}
                                                    className="email-hover-btn"
                                                    style={{
                                                        background: 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',
                                                        color: 'white',
                                                        border: 'none'
                                                    }}
                                                >
                                                    Summarize
                                                </button>
                                                <button
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        setViewingEmail(email);
                                                        setTimeout(() => {
                                                            setEmailReply('');
                                                        }, 300);
                                                    }}
                                                    className="email-hover-btn"
                                                >
                                                    Reply
                                                </button>
                                                <button
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        handleDeleteEmail(email.id, 'inbox');
                                                    }}
                                                    className="email-hover-btn"
                                                    style={{
                                                        background: 'rgba(239, 68, 68, 0.9)',
                                                        color: 'white',
                                                        border: 'none'
                                                    }}
                                                >
                                                    Delete
                                                </button>
                                            </div>
                                            <div className="flex justify-between items-start mb-2">
                                                <span className="text-sm font-bold text-gray-800">{email.from}</span>
                                                <span className="text-xs text-gray-500">{email.date}</span>
                                            </div>
                                            <div className="text-base font-semibold text-gray-700 mb-2">{email.subject}</div>
                                            <div className="text-sm text-gray-600">{email.snippet}</div>

                                            {/* Summarize Popup */}
                                            {summarizingEmail === email.id && (
                                                <div className="summary-popup" onClick={(e) => e.stopPropagation()}>
                                                    {isSummarizing ? (
                                                        <div className="space-y-3">
                                                            <div className="flex items-center gap-3 mb-3">
                                                                <div className="animate-spin rounded-full h-5 w-5 border-2 border-indigo-600 border-t-transparent"></div>
                                                                <span className="text-sm text-gray-700 font-medium">Summarizing...</span>
                                                            </div>
                                                            {/* Wave loading animation */}
                                                            <div className="space-y-2">
                                                                <div className="loading-line" style={{height: '8px'}}></div>
                                                                <div className="loading-line" style={{height: '8px'}}></div>
                                                                <div className="loading-line" style={{height: '8px'}}></div>
                                                            </div>
                                                        </div>
                                                    ) : (
                                                        <div>
                                                            <div className="flex justify-between items-center mb-2">
                                                                <span className="text-sm font-bold text-indigo-600">‚ú® Summary</span>
                                                                <button
                                                                    onClick={() => {
                                                                        if (summaryHidden) {
                                                                            setSummaryHidden(false);
                                                                        } else {
                                                                            setSummaryHidden(true);
                                                                        }
                                                                    }}
                                                                    className="text-xs text-indigo-600 hover:text-indigo-800 font-semibold"
                                                                >
                                                                    {summaryHidden ? 'Show' : 'Hide'}
                                                                </button>
                                                            </div>
                                                            {!summaryHidden && (
                                                                <p id={`summary-text-${email.id}`} className="text-sm text-gray-700 leading-relaxed">{summaryText}</p>
                                                            )}
                                                        </div>
                                                    )}
                                                </div>
                                            )}
                                        </div>
                                    ))
                                ) : (
                                    <div className="text-center py-12 text-gray-500">
                                        <div className="text-6xl mb-4">üì≠</div>
                                        <p>No emails in inbox</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            const renderSent = () => {
                return (
                    <div className="space-y-6">
                        <div className="glass-effect rounded-3xl p-8 ai-glow">
                            <h2 className="text-3xl font-bold text-gray-800 mb-6">üì§ Sent</h2>
                            <div className="space-y-3">
                                {sentEmails.length > 0 ? (
                                    sentEmails.map(email => (
                                        <div
                                            key={email.id}
                                            className="glass-dark px-6 py-4 rounded-2xl"
                                        >
                                            <div className="flex justify-between items-start mb-2">
                                                <span className="text-sm font-bold text-gray-800">To: {email.to}</span>
                                                <span className="text-xs text-gray-500">{email.date}</span>
                                            </div>
                                            <div className="text-base font-semibold text-gray-700 mb-2">{email.subject}</div>
                                            <div className="text-sm text-gray-600">{email.snippet}</div>
                                        </div>
                                    ))
                                ) : (
                                    <div className="text-center py-12 text-gray-500">
                                        <div className="text-6xl mb-4">üì≠</div>
                                        <p>No sent emails</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            const renderWriterContent = () => {
                switch(activeTab) {
                    case 'email':
                        return (
                            <div className="space-y-6 fade-in">
                                {/* Current Tool Indicator */}
                                <div className="glass-dark rounded-full px-4 py-2 inline-flex items-center gap-2">
                                    <span className="text-xl">‚úâÔ∏è</span>
                                    <span className="text-sm font-semibold text-gray-700">Email Rewriter</span>
                                </div>

                                {/* File Upload or Text Area */}
                                <div className="relative">
                                    <div className="flex items-center justify-between mb-3">
                                        <label className="text-sm font-medium text-gray-700 flex items-center">
                                            <span className="text-lg mr-2">‚úçÔ∏è</span>
                                            Paste your email content
                                        </label>
                                        <label className="px-4 py-2 glass-effect rounded-full text-gray-700 text-xs font-medium hover:bg-white/90 transition-all cursor-pointer border border-indigo-300">
                                            <span>üìé Upload File</span>
                                            <input type="file" accept=".txt,.eml" onChange={handleFileUpload} className="hidden" />
                                        </label>
                                    </div>

                                    {uploadedFile ? (
                                        <div className="glass-dark rounded-2xl p-4 mb-4">
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center gap-3">
                                                    <span className="text-3xl">üìÑ</span>
                                                    <div>
                                                        <div className="text-sm font-semibold text-gray-800">{uploadedFile.name}</div>
                                                        <div className="text-xs text-gray-600">{(uploadedFile.size / 1024).toFixed(2)} KB</div>
                                                    </div>
                                                </div>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => setViewingFile(uploadedFile)}
                                                        className="px-3 py-1 glass-effect rounded-full text-xs text-gray-700 hover:bg-white/90"
                                                    >
                                                        üëÅÔ∏è View
                                                    </button>
                                                    <button
                                                        onClick={() => setUploadedFile(null)}
                                                        className="px-3 py-1 glass-effect rounded-full text-xs text-red-600 hover:bg-white/90"
                                                    >
                                                        ‚úï Remove
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    ) : (
                                        <textarea
                                            value={emailText}
                                            onChange={(e) => setEmailText(e.target.value)}
                                            className="w-full h-80 px-6 py-4 custom-textarea rounded-2xl text-gray-800 placeholder-gray-500 resize-none"
                                            placeholder="Type or paste your email content here and watch the magic happen..."
                                        />
                                    )}
                                </div>

                                {/* Custom Transformation + Suggestions */}
                                <div className="pt-4 border-t border-gray-300 space-y-4">
                                    <div className="flex items-center justify-between">
                                        <label className="text-sm font-medium text-gray-700 flex items-center">
                                            <span className="text-lg mr-2">üé®</span>
                                            Custom Transformation
                                        </label>
                                        {showSuggestions && (
                                            <div className="suggestions-container flex gap-2 overflow-x-auto" style={{marginLeft: '-20px'}}>
                                                {emailStyles.map((style) => (
                                                    <button
                                                        key={style.id}
                                                        onClick={() => handleStyleClick(style.id)}
                                                        className={`suggestion-pill glass-effect font-medium hover:bg-white/90 oval-button px-4 py-1.5 rounded-full text-xs transition-all ${
                                                            selectedTone === style.id
                                                                ? 'bg-gradient-to-r from-indigo-500 to-purple-600 text-white border-2 border-indigo-600'
                                                                : 'text-gray-800 border border-indigo-300'
                                                        }`}
                                                    >
                                                        {style.label}
                                                    </button>
                                                ))}
                                            </div>
                                        )}
                                    </div>

                                    {/* Selected Tone Indicator */}
                                    {selectedTone && (
                                        <div className="suggestions-container glass-dark rounded-xl p-3 flex items-center gap-3">
                                            <span className="text-2xl">{emailStyles.find(s => s.id === selectedTone)?.label}</span>
                                            <div className="flex-1">
                                                <div className="text-xs text-gray-600 mb-1">Selected Tone</div>
                                                <div className="flex items-center gap-2">
                                                    <div className="h-1 flex-1 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full"></div>
                                                    <span className="text-xs text-gray-700">Connected to prompt</span>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => setSelectedTone(null)}
                                                className="text-gray-500 hover:text-red-600"
                                            >
                                                ‚úï
                                            </button>
                                        </div>
                                    )}

                                    <div className="flex gap-3">
                                        <input
                                            type="text"
                                            value={customPrompt}
                                            onChange={(e) => setCustomPrompt(e.target.value)}
                                            className="flex-1 px-5 py-3 glass-effect border border-indigo-300 rounded-full text-gray-800 placeholder-gray-500"
                                            placeholder="e.g., 'Make it more casual' or 'Add urgency'"
                                            onKeyPress={(e) => e.key === 'Enter' && handleGenerate()}
                                        />
                                        <button
                                            onClick={handleGenerate}
                                            disabled={(!emailText && !uploadedFile) || (!selectedTone && !customPrompt)}
                                            className="px-8 py-3 glass-effect rounded-full text-gray-800 font-medium hover:bg-white/90 transition-all oval-button border-2 border-indigo-400 disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            ‚ú® Generate
                                        </button>
                                    </div>
                                </div>
                            </div>
                        );
                    
                    default:
                        return (
                            <div className="space-y-6 fade-in">
                                <div className="relative">
                                    <div className="flex items-start justify-between mb-3">
                                        <label className="text-sm font-medium text-gray-700 flex items-center">
                                            <span className="text-lg mr-2">üìÑ</span>
                                            Enter your text
                                        </label>
                                    </div>
                                    <textarea
                                        value={emailText}
                                        onChange={(e) => setEmailText(e.target.value)}
                                        className="w-full h-64 px-6 py-4 custom-textarea rounded-2xl text-gray-800 placeholder-gray-500 resize-none"
                                        placeholder="Type or paste your content here..."
                                    />
                                </div>
                                <button
                                    onClick={handleToolProcess}
                                    className="w-full px-8 py-4 glass-effect rounded-full text-gray-800 font-semibold text-lg hover:bg-white/90 transition-all oval-button border-2 border-indigo-400"
                                >
                                    üöÄ Process with AI
                                </button>
                            </div>
                        );
                }
            };

            const renderResultsContent = () => {
                if (isProcessing) {
                    return (
                        <div className="flex flex-col justify-center items-start h-96 space-y-8 px-6">
                            <div className="w-full space-y-4">
                                <div className="text-left mb-6">
                                    <p className="text-gray-700 text-xl font-semibold mb-2">‚ú® Generating with AI</p>
                                    <p className="text-gray-500 text-sm">Transforming your content...</p>
                                </div>
                                <div className="loading-lines">
                                    <div className="loading-line"></div>
                                    <div className="loading-line"></div>
                                    <div className="loading-line"></div>
                                    <div className="loading-line"></div>
                                    <div className="loading-line"></div>
                                    <div className="loading-line"></div>
                                </div>
                            </div>
                        </div>
                    );
                }

                // Show result
                if (result) {
                    return (
                        <div className="result-container px-6 py-4 relative">
                            <div className="relative">
                                {/* Action buttons at top-right */}
                                <div className="action-buttons">
                                    <button
                                        onClick={() => navigator.clipboard.writeText(result)}
                                        className="action-btn text-gray-700 hover:text-indigo-700"
                                    >
                                        Copy
                                    </button>
                                    <button
                                        onClick={handleRetry}
                                        className="action-btn text-gray-700 hover:text-purple-700"
                                    >
                                        Retry
                                    </button>
                                </div>
                                <div className="glass-dark rounded-2xl p-6">
                                    <pre id="result-text" className="text-gray-800 whitespace-pre-wrap font-sans leading-relaxed text-left text-base"></pre>
                                </div>
                            </div>
                        </div>
                    );
                }

                return (
                    <div className="flex flex-col items-center justify-center h-96 text-gray-500">
                        <div className="text-7xl mb-4 opacity-40">ü§ñ</div>
                        <p className="text-lg text-gray-700">Your AI-generated content will appear here</p>
                        <p className="text-sm mt-2">Use the Writer tab to create something amazing!</p>
                    </div>
                );
            };

            return (
                <div className="min-h-screen relative">
                    {/* Email Viewer Modal - iOS Style */}
                    {viewingEmail && (
                        <div className="email-viewer-overlay" onClick={() => setViewingEmail(null)}>
                            <div className="email-viewer-container" onClick={(e) => e.stopPropagation()}>
                                {/* Header */}
                                <div className="p-6 border-b border-gray-200 flex items-center justify-between">
                                    <button
                                        onClick={() => setViewingEmail(null)}
                                        className="px-4 py-2 glass-effect rounded-full text-gray-700 text-sm font-medium hover:bg-white/90 transition-all border border-indigo-300 flex items-center gap-2"
                                    >
                                        <span>‚Üê</span>
                                        <span>Back</span>
                                    </button>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => handleSummarizeEmail(viewingEmail)}
                                            className="px-4 py-2 rounded-full text-white text-sm font-medium hover:opacity-90 transition-all"
                                            style={{
                                                background: 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)'
                                            }}
                                        >
                                            Summarize
                                        </button>
                                        <button
                                            onClick={() => {
                                                setEmailReply('');
                                                document.getElementById('reply-section')?.scrollIntoView({ behavior: 'smooth' });
                                            }}
                                            className="px-4 py-2 glass-effect rounded-full text-gray-700 text-sm font-medium hover:bg-white/90 transition-all border border-indigo-300"
                                        >
                                            Reply
                                        </button>
                                    </div>
                                </div>

                                {/* Email Content */}
                                <div className="flex-1 overflow-y-auto p-6">
                                    <div className="mb-4">
                                        <h2 className="text-2xl font-bold text-gray-800 mb-3">{viewingEmail.subject}</h2>
                                        <div className="flex justify-between items-center mb-4">
                                            <div>
                                                <div className="text-sm font-semibold text-gray-700">From: {viewingEmail.from}</div>
                                                <div className="text-xs text-gray-500 mt-1">{viewingEmail.date}</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="prose max-w-none">
                                        <p className="text-gray-700 leading-relaxed whitespace-pre-wrap">{viewingEmail.snippet}</p>
                                    </div>

                                    {/* Summarize Popup in Viewer */}
                                    {summarizingEmail === viewingEmail.id && (
                                        <div className="summary-popup mt-4" style={{position: 'relative', top: 0, marginTop: '16px'}}>
                                            {isSummarizing ? (
                                                <div className="space-y-3">
                                                    <div className="flex items-center gap-3 mb-3">
                                                        <div className="animate-spin rounded-full h-5 w-5 border-2 border-indigo-600 border-t-transparent"></div>
                                                        <span className="text-sm text-gray-700 font-medium">Summarizing...</span>
                                                    </div>
                                                    {/* Wave loading animation */}
                                                    <div className="space-y-2">
                                                        <div className="loading-line" style={{height: '8px'}}></div>
                                                        <div className="loading-line" style={{height: '8px'}}></div>
                                                        <div className="loading-line" style={{height: '8px'}}></div>
                                                    </div>
                                                </div>
                                            ) : (
                                                <div>
                                                    <div className="flex justify-between items-center mb-2">
                                                        <span className="text-sm font-bold text-indigo-600">‚ú® Summary</span>
                                                        <button
                                                            onClick={() => {
                                                                if (summaryHidden) {
                                                                    setSummaryHidden(false);
                                                                } else {
                                                                    setSummaryHidden(true);
                                                                }
                                                            }}
                                                            className="text-xs text-indigo-600 hover:text-indigo-800 font-semibold"
                                                        >
                                                            {summaryHidden ? 'Show' : 'Hide'}
                                                        </button>
                                                    </div>
                                                    {!summaryHidden && (
                                                        <p id={`summary-text-${viewingEmail.id}`} className="text-sm text-gray-700 leading-relaxed">{summaryText}</p>
                                                    )}
                                                </div>
                                            )}
                                        </div>
                                    )}

                                    {/* Reply Section */}
                                    <div id="reply-section" className="mt-8 pt-6 border-t border-gray-300">
                                        <h3 className="text-lg font-bold text-gray-800 mb-4">‚úçÔ∏è Write Reply</h3>

                                        {/* Textarea Container with Floating Send Button */}
                                        <div className="relative mb-4">
                                            <textarea
                                                value={emailReply}
                                                onChange={(e) => setEmailReply(e.target.value)}
                                                className="w-full h-48 px-6 py-4 pr-24 custom-textarea rounded-2xl text-gray-800 placeholder-gray-500 resize-none"
                                                placeholder="Type your reply here..."
                                            />

                                            {/* Floating Send Button */}
                                            {emailReply && emailReply.trim().length > 0 && (
                                                <button
                                                    onClick={() => {
                                                        if (emailReply) {
                                                            // Try to play send sound with better audio source
                                                            try {
                                                                const audio = new Audio();
                                                                audio.src = 'https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3';
                                                                audio.play().catch(e => console.log('Sound play failed:', e));
                                                            } catch (e) {
                                                                console.log('Audio not available:', e);
                                                            }

                                                            console.log('üì§ Sending reply:', emailReply.substring(0, 50) + '...');
                                                            alert('Reply sent successfully! ‚úâÔ∏è');
                                                            setEmailReply('');
                                                            setReplyPrompt('');
                                                        }
                                                    }}
                                                    className="send-button-float"
                                                >
                                                    <span>‚Üí</span>
                                                    <span>Send</span>
                                                </button>
                                            )}
                                        </div>

                                        {/* AI Transformation Container */}
                                        <div className="ai-transform-container">
                                            <input
                                                type="text"
                                                value={replyPrompt}
                                                onChange={(e) => setReplyPrompt(e.target.value)}
                                                className="ai-transform-input"
                                                placeholder="‚ú® Transform with AI (e.g., 'Make it more professional')"
                                                onKeyPress={(e) => {
                                                    if (e.key === 'Enter' && replyPrompt && emailReply) {
                                                        callAIAPI(replyPrompt, emailReply).then(transformed => {
                                                            setEmailReply(transformed);
                                                            setReplyPrompt('');
                                                        });
                                                    }
                                                }}
                                            />
                                            <button
                                                onClick={() => {
                                                    if (replyPrompt && emailReply) {
                                                        callAIAPI(replyPrompt, emailReply).then(transformed => {
                                                            setEmailReply(transformed);
                                                            setReplyPrompt('');
                                                        });
                                                    }
                                                }}
                                                disabled={!replyPrompt || !emailReply}
                                                className="ai-transform-button"
                                            >
                                                Transform
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* File Viewer Modal */}
                    {viewingFile && (
                        <div className="file-viewer-modal" onClick={() => setViewingFile(null)}>
                            <div className="file-viewer-content" onClick={(e) => e.stopPropagation()}>
                                <div className="p-6 border-b border-gray-200">
                                    <div className="flex items-center justify-between">
                                        <h2 className="text-xl font-bold text-gray-800">
                                            {viewingFile.name || 'Viewing Content'}
                                        </h2>
                                        <button
                                            onClick={() => setViewingFile(null)}
                                            className="text-gray-500 hover:text-gray-700 text-2xl"
                                        >
                                            ‚úï
                                        </button>
                                    </div>
                                    {viewingFile.timestamp && (
                                        <p className="text-sm text-gray-500 mt-1">{viewingFile.timestamp}</p>
                                    )}
                                </div>
                                <div className="p-6 overflow-y-auto max-h-[60vh]">
                                    <pre className="text-gray-800 whitespace-pre-wrap font-sans leading-relaxed text-base">
                                        {viewingFile.content}
                                    </pre>
                                </div>
                                <div className="p-6 border-t border-gray-200 flex gap-3">
                                    <button
                                        onClick={() => {
                                            navigator.clipboard.writeText(viewingFile.content);
                                            alert('Copied to clipboard!');
                                        }}
                                        className="flex-1 px-6 py-3 glass-effect rounded-full text-gray-800 font-semibold hover:bg-white/90 transition-all oval-button border-2 border-indigo-400"
                                    >
                                        üìã Copy
                                    </button>
                                    <button
                                        onClick={() => setViewingFile(null)}
                                        className="px-6 py-3 glass-effect rounded-full text-gray-800 font-semibold hover:bg-white/90 transition-all oval-button border-2 border-gray-300"
                                    >
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* AI Floating Particles */}
                    <div className="ai-particle" style={{top: '20%', left: '10%', animationDelay: '0s'}}></div>
                    <div className="ai-particle" style={{top: '40%', right: '15%', animationDelay: '3s'}}></div>
                    <div className="ai-particle" style={{bottom: '30%', left: '20%', animationDelay: '6s'}}></div>
                    <div className="ai-particle" style={{top: '60%', right: '25%', animationDelay: '9s'}}></div>
                    <div className="ai-particle" style={{bottom: '20%', right: '10%', animationDelay: '12s'}}></div>

                    {/* Sticky Header */}
                    <header className="sticky-header">
                        <div className="container mx-auto px-4 py-4">
                            <div className="flex justify-center items-center gap-4">
                                <button
                                    onClick={() => setCurrentPage('home')}
                                    className={`px-6 py-2 rounded-full font-medium transition-all oval-button ${
                                        currentPage === 'home'
                                            ? 'bg-gradient-to-r from-indigo-500 to-purple-600 text-white border-2 border-indigo-600'
                                            : 'glass-dark text-gray-700 hover:bg-white/70'
                                    }`}
                                >
                                    Home
                                </button>
                                {emailConnected && (
                                    <>
                                        <button
                                            onClick={() => setCurrentPage('inbox')}
                                            className={`px-6 py-2 rounded-full font-medium transition-all oval-button ${
                                                currentPage === 'inbox'
                                                    ? 'bg-gradient-to-r from-indigo-500 to-purple-600 text-white border-2 border-indigo-600'
                                                    : 'glass-dark text-gray-700 hover:bg-white/70'
                                            }`}
                                        >
                                            Inbox
                                        </button>
                                        <button
                                            onClick={() => setCurrentPage('sent')}
                                            className={`px-6 py-2 rounded-full font-medium transition-all oval-button ${
                                                currentPage === 'sent'
                                                    ? 'bg-gradient-to-r from-indigo-500 to-purple-600 text-white border-2 border-indigo-600'
                                                    : 'glass-dark text-gray-700 hover:bg-white/70'
                                            }`}
                                        >
                                            Sent
                                        </button>
                                    </>
                                )}
                                <button
                                    onClick={() => setCurrentPage('settings')}
                                    className={`px-6 py-2 rounded-full font-medium transition-all oval-button ${
                                        currentPage === 'settings'
                                            ? 'bg-gradient-to-r from-indigo-500 to-purple-600 text-white border-2 border-indigo-600'
                                            : 'glass-dark text-gray-700 hover:bg-white/70'
                                    }`}
                                >
                                    Settings
                                </button>
                            </div>
                        </div>
                    </header>

                    <div className="page-container relative z-10 container mx-auto px-4 py-8 max-w-8xl">

                        {currentPage === 'settings' ? renderSettings() :
                         currentPage === 'inbox' ? renderInbox() :
                         currentPage === 'sent' ? renderSent() : (
                            <>
                                {/* Main Center Container with Tabs */}
                                <div className="rounded-3xl p-8 relative">
                                    {/* Filter Dropdown Button */}
                                    <div className="absolute top-6 right-6">
                                        <button
                                            onClick={() => setShowFilterDropdown(!showFilterDropdown)}
                                            className="px-4 py-2 glass-effect rounded-full text-gray-700 font-medium hover:bg-white/90 transition-all oval-button border border-indigo-300 flex items-center gap-2"
                                        >
                                            <span>üîß</span>
                                            <span className="text-sm">Tools</span>
                                            <span className={`text-xs transform transition-transform ${showFilterDropdown ? 'rotate-180' : ''}`}>‚ñº</span>
                                        </button>
                                        {showFilterDropdown && (
                                            <div className="filter-dropdown glass-effect rounded-2xl p-3 shadow-xl">
                                                {tools.map((tool) => (
                                                    <button
                                                        key={tool.id}
                                                        onClick={() => {
                                                            setActiveTab(tool.id);
                                                            setResult('');
                                                            setEmailText('');
                                                            setCustomPrompt('');
                                                            setActiveView('writer');
                                                            setShowFilterDropdown(false);
                                                            console.log('üîß Switched to tool:', tool.name);
                                                        }}
                                                        className={`w-full text-left px-4 py-3 rounded-xl mb-2 transition-all ${
                                                            activeTab === tool.id
                                                                ? 'bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-md'
                                                                : 'hover:bg-white/80 text-gray-700'
                                                        }`}
                                                    >
                                                        <div className="flex items-center gap-3">
                                                            <span className="text-2xl">{tool.icon}</span>
                                                            <div>
                                                                <div className="text-sm font-semibold">{tool.name}</div>
                                                                <div className="text-xs opacity-80">{tool.desc}</div>
                                                            </div>
                                                        </div>
                                                    </button>
                                                ))}
                                            </div>
                                        )}
                                    </div>

                                    {/* Tab Switches */}
                                    <div className="flex justify-center mb-8">
                                        <div className="tab-container tab-button-container">
                                            <div 
                                                className="tab-slider"
                                                style={{
                                                    width: '50%',
                                                    height: 'calc(100% - 12px)',
                                                    top: '6px',
                                                    left: activeView === 'writer' ? '6px' : 'calc(50% - 6px)',
                                                }}
                                            ></div>
                                            <button
                                                onClick={() => setActiveView('writer')}
                                                className={`relative z-10 px-8 py-3 rounded-full font-medium transition-all ${
                                                    activeView === 'writer' ? 'text-white' : 'text-gray-700 hover:text-gray-800'
                                                }`}
                                            >
                                                ‚úçÔ∏è AI Writer
                                            </button>
                                            <button
                                                onClick={() => setActiveView('results')}
                                                className={`relative z-10 px-8 py-3 rounded-full font-medium transition-all ${
                                                    activeView === 'results' ? 'text-white' : 'text-gray-700 hover:text-gray-800'
                                                }`}
                                            >
                                                ‚ú® Results
                                            </button>
                                        </div>
                                    </div>

                                    {/* Content Area */}
                                    <div className="min-h-[500px]">
                                        {activeView === 'writer' ? renderWriterContent() : renderResultsContent()}
                                    </div>
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
