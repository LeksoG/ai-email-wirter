<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Tools Suite - Transform Your Communication</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg,
                #e0e7ff 0%,
                #f3e8ff 25%,
                #ddd6fe 50%,
                #e0e7ff 75%,
                #f0f9ff 100%
            );
            background-size: 400% 400%;
            animation: subtle-shift 20s ease infinite;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            padding-top: 100px; /* Space for sticky header */
        }

        body.dark-mode {
            background: linear-gradient(135deg,
                #000000 0%,
                #0a0a0a 25%,
                #1a1a1a 50%,
                #0a0a0a 75%,
                #000000 100%
            );
        }

        body.dark-mode .glass-effect {
            background: rgba(20, 20, 20, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .glass-dark {
            background: rgba(30, 30, 30, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .text-gray-800,
        body.dark-mode .text-gray-700 {
            color: #e5e5e5 !important;
        }

        body.dark-mode .text-gray-600,
        body.dark-mode .text-gray-500 {
            color: #a0a0a0 !important;
        }

        body.dark-mode .custom-textarea {
            background: rgba(30, 30, 30, 0.8);
            color: #e5e5e5;
        }

        body.dark-mode .sticky-header {
            background: transparent;
        }

        body.dark-mode .action-btn {
            background: rgba(40, 40, 40, 0.9);
            border: 1px solid rgba(99, 102, 241, 0.4);
            color: #e5e5e5;
        }

        body.dark-mode .action-btn:hover {
            background: rgba(60, 60, 60, 1);
            border-color: rgba(99, 102, 241, 0.6);
        }

        @keyframes subtle-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* AI Grid Pattern Overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(99, 102, 241, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(99, 102, 241, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        /* Page Load Blur-in Animation */
        .page-container {
            animation: blur-in 1.2s ease-out;
        }

        @keyframes blur-in {
            0% {
                opacity: 0;
                filter: blur(20px);
                transform: scale(0.95);
            }
            100% {
                opacity: 1;
                filter: blur(0);
                transform: scale(1);
            }
        }

        .glass-effect {
            background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.9) 0%,
                rgba(249, 250, 251, 0.85) 100%
            );
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.12),
                        0 2px 8px rgba(99, 102, 241, 0.08),
                        inset 0 1px 0 rgba(255, 255, 255, 0.8);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-effect:hover {
            box-shadow: 0 12px 48px rgba(99, 102, 241, 0.15),
                        0 4px 12px rgba(99, 102, 241, 0.1),
                        inset 0 1px 0 rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
        }

        .glass-dark {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.85);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.05);
        }

        .gradient-text {
            background: #3B82F6;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .ai-glow {
            box-shadow: 0 0 40px rgba(99, 102, 241, 0.2),
                        0 0 80px rgba(139, 92, 246, 0.15),
                        0 0 120px rgba(167, 139, 250, 0.1);
            animation: ai-pulse 4s ease-in-out infinite;
        }

        @keyframes ai-pulse {
            0%, 100% {
                box-shadow: 0 0 40px rgba(99, 102, 241, 0.2),
                           0 0 80px rgba(139, 92, 246, 0.15),
                           0 0 120px rgba(167, 139, 250, 0.1);
            }
            50% {
                box-shadow: 0 0 60px rgba(99, 102, 241, 0.3),
                           0 0 100px rgba(139, 92, 246, 0.2),
                           0 0 140px rgba(167, 139, 250, 0.15);
            }
        }

        .fade-in {
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .slide-in {
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .oval-button {
            border-radius: 50px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .oval-button:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.2);
        }

        /* Animated white outline for buttons */
        .unified-button {
            position: relative;
            border: 2px solid white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
            overflow: visible;
        }

        .unified-button::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: inherit;
            padding: 2px;
            background: linear-gradient(90deg,
                white,
                rgba(255, 255, 255, 0.3),
                rgba(255, 255, 255, 0.1),
                rgba(255, 255, 255, 0.3),
                white
            );
            background-size: 200% 100%;
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .unified-button:hover::before {
            opacity: 1;
            animation: outline-sweep 0.6s ease-in-out;
        }

        @keyframes outline-sweep {
            0% {
                background-position: 200% 0;
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                background-position: -200% 0;
                opacity: 0;
            }
        }

        /* Navigation tab with underline glow */
        .nav-tab {
            position: relative;
            padding-bottom: 8px;
        }

        .nav-tab::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 3px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 2px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.6),
                        0 0 40px rgba(0, 0, 0, 0.4),
                        0 0 60px rgba(0, 0, 0, 0.2);
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body.dark-mode .nav-tab::after {
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.8),
                        0 0 40px rgba(255, 255, 255, 0.5),
                        0 0 60px rgba(255, 255, 255, 0.3);
        }

        .nav-tab.active::after {
            width: 80%;
            animation: glow-pulse 2s ease-in-out infinite;
        }

        @keyframes glow-pulse {
            0%, 100% {
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.6),
                           0 0 40px rgba(0, 0, 0, 0.4),
                           0 0 60px rgba(0, 0, 0, 0.2);
            }
            50% {
                box-shadow: 0 0 30px rgba(0, 0, 0, 0.8),
                           0 0 60px rgba(0, 0, 0, 0.6),
                           0 0 90px rgba(0, 0, 0, 0.4);
            }
        }

        body.dark-mode .nav-tab.active::after {
            animation: glow-pulse-dark 2s ease-in-out infinite;
        }

        @keyframes glow-pulse-dark {
            0%, 100% {
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.8),
                           0 0 40px rgba(255, 255, 255, 0.5),
                           0 0 60px rgba(255, 255, 255, 0.3);
            }
            50% {
                box-shadow: 0 0 30px rgba(255, 255, 255, 1),
                           0 0 60px rgba(255, 255, 255, 0.7),
                           0 0 90px rgba(255, 255, 255, 0.5);
            }
        }

        /* Glassy Nav Container */
        .nav-container {
            background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.7) 0%,
                rgba(249, 250, 251, 0.6) 100%
            );
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.8);
            border-radius: 50px;
            padding: 8px 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1),
                        inset 0 1px 0 rgba(255, 255, 255, 0.9);
            display: inline-flex;
            gap: 8px;
        }

        body.dark-mode .nav-container {
            background: linear-gradient(135deg,
                rgba(20, 20, 20, 0.7) 0%,
                rgba(30, 30, 30, 0.6) 100%
            );
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5),
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        /* Search Bar Transform */
        .nav-search-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 8px 16px;
            opacity: 0;
            transform: translateX(-100%);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }

        .nav-search-bar.active {
            opacity: 1;
            transform: translateX(0);
            pointer-events: all;
        }

        .nav-search-input {
            width: 100%;
            padding: 10px 20px;
            border: 2px solid white;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        body.dark-mode .nav-search-input {
            background: rgba(40, 40, 40, 0.9);
            color: #e5e5e5;
        }

        .nav-search-suggestions {
            position: absolute;
            top: 100%;
            left: 16px;
            right: 16px;
            margin-top: 8px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid white;
            border-radius: 16px;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        }

        body.dark-mode .nav-search-suggestions {
            background: rgba(30, 30, 30, 0.95);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .search-suggestion-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .search-suggestion-item:last-child {
            border-bottom: none;
        }

        .search-suggestion-item:hover {
            background: rgba(59, 130, 246, 0.1);
            padding-left: 20px;
        }

        body.dark-mode .search-suggestion-item {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .search-suggestion-item:hover {
            background: rgba(100, 100, 100, 0.3);
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .sticky-header {
                padding-top: 8px;
            }

            .nav-container {
                padding: 6px 12px;
                gap: 6px;
                max-width: 95%;
                margin: 0 auto;
            }

            .nav-tab {
                font-size: 13px;
                padding: 6px 12px;
            }

            .modern-email-item,
            .priority-email-stacked {
                margin: 8px 12px;
                padding: 12px;
            }

            .email-hover-buttons {
                position: static;
                display: flex;
                margin-top: 8px;
                justify-content: flex-end;
            }

            .glass-effect,
            .glass-dark {
                margin: 8px 12px;
                padding: 16px;
            }

            .custom-textarea {
                font-size: 14px;
                padding: 12px 16px;
            }

            /* Settings toggles */
            .settings-panel {
                padding: 12px;
            }

            .setting-preview-container {
                padding: 12px;
            }

            /* Make toggles fit perfectly */
            input[type="checkbox"] {
                transform: scale(1.2);
            }

            /* Mobile search bar */
            .nav-search-bar {
                padding: 6px 12px;
            }

            .nav-search-input {
                font-size: 13px;
                padding: 8px 16px;
            }

            /* Welcome text smaller on mobile */
            .welcome-text {
                font-size: 1.3rem;
            }

            /* Smaller buttons on mobile */
            .oval-button {
                font-size: 13px;
                padding: 8px 16px !important;
            }

            /* Email content */
            .email-content-formatted {
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            .nav-tab {
                font-size: 11px;
                padding: 5px 10px;
            }

            .sticky-header {
                padding-top: 6px;
            }

            .welcome-text {
                font-size: 1.1rem;
            }

            .page-container {
                padding: 12px 8px;
            }
        }

        .tool-card {
            transition: all 0.3s ease;
        }

        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(99, 102, 241, 0.15);
        }

        /* Email delete animation */
        .email-deleting {
            animation: slide-fade-out 0.4s ease-out forwards;
        }

        @keyframes slide-fade-out {
            0% {
                opacity: 1;
                transform: translateX(0);
                max-height: 200px;
            }
            50% {
                opacity: 0.5;
                transform: translateX(-30px);
            }
            100% {
                opacity: 0;
                transform: translateX(-100%);
                max-height: 0;
                padding-top: 0;
                padding-bottom: 0;
                margin-top: 0;
                margin-bottom: 0;
            }
        }

        /* Refresh button animation */
        .refresh-spinning {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        textarea:focus, input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .custom-textarea {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid rgba(99, 102, 241, 0.25);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 15px;
            line-height: 1.6;
        }

        .custom-textarea:focus {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(99, 102, 241, 0.5);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1),
                        0 8px 24px rgba(99, 102, 241, 0.15);
            transform: translateY(-2px);
        }

        .tab-container {
            position: relative;
            display: inline-flex;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50px;
            padding: 6px;
            margin-bottom: 24px;
        }

        .tab-slider {
            position: absolute;
            background: transparent;
            border-radius: 50px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 0;
            border-bottom: 3px solid rgba(0, 0, 0, 0.8);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.6),
                        0 8px 40px rgba(0, 0, 0, 0.4);
        }

        body.dark-mode .tab-slider {
            border-bottom: 3px solid rgba(255, 255, 255, 0.9);
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.8),
                        0 8px 40px rgba(255, 255, 255, 0.5);
        }

        /* Loading Lines Animation - Gemini Style */
        .loading-lines {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 100%;
            padding: 20px 0;
        }

        .loading-line {
            height: 12px;
            background: linear-gradient(90deg,
                rgba(99, 102, 241, 0.1) 0%,
                rgba(139, 92, 246, 0.6) 50%,
                rgba(99, 102, 241, 0.1) 100%
            );
            background-size: 200% 100%;
            border-radius: 20px;
            animation: loading-wave 2s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        .loading-line::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(255, 255, 255, 0.4) 50%,
                transparent 100%
            );
            animation: loading-shine 2s ease-in-out infinite;
        }

        .loading-line:nth-child(1) {
            animation-delay: 0s;
            width: 95%;
        }
        .loading-line:nth-child(2) {
            animation-delay: 0.15s;
            width: 88%;
        }
        .loading-line:nth-child(3) {
            animation-delay: 0.3s;
            width: 92%;
        }
        .loading-line:nth-child(4) {
            animation-delay: 0.45s;
            width: 85%;
        }
        .loading-line:nth-child(5) {
            animation-delay: 0.6s;
            width: 90%;
        }
        .loading-line:nth-child(6) {
            animation-delay: 0.75s;
            width: 80%;
        }

        @keyframes loading-wave {
            0%, 100% {
                background-position: -200% 0;
                transform: scaleX(0.98);
                opacity: 0.7;
            }
            50% {
                background-position: 200% 0;
                transform: scaleX(1);
                opacity: 1;
            }
        }

        @keyframes loading-shine {
            0% {
                left: -100%;
            }
            100% {
                left: 100%;
            }
        }

        /* Fast Wave Animation - Gemini Style */
        .wave-char {
            display: inline-block;
            opacity: 0;
            animation: wave-appear 0.15s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes wave-appear {
            0% {
                opacity: 0;
                transform: translateY(8px) scale(0.95);
                filter: blur(2px);
            }
            60% {
                opacity: 1;
                transform: translateY(-2px) scale(1.02);
                filter: blur(0);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
                filter: blur(0);
            }
        }

        .result-container {
            position: relative;
            min-height: 300px;
        }

        .settings-panel {
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .email-item {
            transition: all 0.2s ease;
            position: relative;
        }

        .email-item:hover {
            background: rgba(99, 102, 241, 0.1);
            transform: translateX(5px);
        }

        .email-hover-buttons {
            position: absolute;
            top: 12px;
            right: 16px;
            display: none;
            gap: 8px;
            z-index: 10;
        }

        .email-item:hover .email-hover-buttons {
            display: flex;
        }

        .modern-email-item:hover .email-hover-buttons {
            display: flex;
        }

        .priority-email-stacked:hover .email-hover-buttons {
            display: flex;
        }

        .email-hover-btn {
            padding: 4px 12px;
            font-size: 11px;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .email-hover-btn:hover {
            background: rgba(99, 102, 241, 0.1);
            border-color: rgba(99, 102, 241, 0.5);
        }

        /* Summarize Popup */
        .summary-popup {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 12px;
            background: white;
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            z-index: 50;
            animation: popup-slide-down 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        body.dark-mode .summary-popup {
            background: rgba(30, 30, 30, 0.95);
            border-color: rgba(99, 102, 241, 0.5);
        }

        @keyframes popup-slide-down {
            from {
                opacity: 0;
                transform: translateY(-10px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Send Button - Floating */
        .send-button-float {
            position: absolute;
            bottom: 16px;
            right: 16px;
            padding: 12px 20px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            transition: all 0.3s ease;
            animation: float-in 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 10;
        }

        .send-button-float:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
        }

        @keyframes float-in {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* AI Transform Container */
        .ai-transform-container {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
        }

        .ai-transform-input {
            width: 100%;
            padding: 12px 140px 12px 20px;
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 50px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s;
        }

        .ai-transform-input:focus {
            outline: none;
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        body.dark-mode .ai-transform-input {
            background: rgba(30, 30, 30, 0.8);
            color: #e5e5e5;
        }

        .ai-transform-button {
            position: absolute;
            right: 6px;
            top: 50%;
            transform: translateY(-50%);
            padding: 8px 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(249, 250, 251, 0.85) 100%);
            color: #1f2937;
            border: 2px solid white;
            border-radius: 50px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .ai-transform-button {
            background: linear-gradient(135deg, rgba(60, 60, 60, 0.9) 0%, rgba(50, 50, 50, 0.85) 100%);
            color: #e5e5e5;
        }

        .ai-transform-button:hover {
            opacity: 0.9;
        }

        .ai-transform-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Wave Animation - Apple Intelligence Style */
        .wave-char {
            display: inline-block;
            opacity: 0;
            animation: wave-splash 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes wave-splash {
            0% {
                opacity: 0;
                transform: translate(-4px, -4px) scale(0.9);
                filter: blur(3px);
            }
            50% {
                opacity: 1;
                filter: blur(0);
            }
            100% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
                filter: blur(0);
            }
        }

        /* Full-page email viewer - iOS style */
        .email-viewer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: overlay-fade-in 0.3s ease-out;
        }

        @keyframes overlay-fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .email-viewer-container {
            width: 90%;
            max-width: 900px;
            height: 90vh;
            background: white;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: viewer-slide-up 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            flex-direction: column;
        }

        body.dark-mode .email-viewer-container {
            background: rgba(20, 20, 20, 0.95);
        }

        @keyframes viewer-slide-up {
            from {
                transform: translateY(100px) scale(0.95);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        /* Filter Dropdown */
        .filter-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            min-width: 200px;
            max-width: 300px;
            z-index: 50;
            animation: dropdown-appear 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes dropdown-appear {
            from {
                opacity: 0;
                transform: translateY(-10px) scale(0.95);
                filter: blur(4px);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
                filter: blur(0);
            }
        }

        /* Suggestions blur animation */
        .suggestions-container {
            animation: blur-slide-in 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes blur-slide-in {
            from {
                opacity: 0;
                transform: translateX(-20px);
                filter: blur(8px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
                filter: blur(0);
            }
        }

        /* New Suggestion Carousel Design */
        .suggestion-carousel-container {
            position: relative;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
        }

        .suggestion-carousel {
            flex: 1;
            overflow: hidden;
            position: relative;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.5);
            padding: 8px 16px;
        }

        .suggestion-carousel-track {
            display: flex;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .suggestion-carousel-item {
            min-width: 100%;
            padding: 8px 16px;
            text-align: center;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            color: #1f2937;
            transition: all 0.3s ease;
            white-space: nowrap;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(249, 250, 251, 0.85) 100%);
            border-radius: 50px;
            border: 2px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
        }

        .suggestion-carousel-item:hover {
            border-color: rgba(59, 130, 246, 0.5);
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }

        body.dark-mode .suggestion-carousel {
            background: rgba(40, 40, 40, 0.7);
        }

        body.dark-mode .suggestion-carousel-item {
            background: linear-gradient(135deg, rgba(60, 60, 60, 0.9) 0%, rgba(50, 50, 50, 0.85) 100%);
            color: #e5e5e5;
        }

        /* Suggestion Indicator */
        .suggestion-indicator {
            position: absolute;
            top: -32px;
            right: 0;
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
            animation: indicator-bounce 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), indicator-fade-out 0.5s ease-in-out 4.5s forwards;
            border: 2px solid white;
        }

        @keyframes indicator-bounce {
            0% {
                opacity: 0;
                transform: translateY(-10px) scale(0.9);
            }
            60% {
                transform: translateY(2px) scale(1.05);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes indicator-fade-out {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-10px);
            }
        }

        .suggestion-indicator-icon {
            animation: indicator-pulse 1.5s ease-in-out infinite;
        }

        @keyframes indicator-pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
        }

        /* Tab container styling */
        .tab-button-container {
            background: rgba(255, 255, 255, 0.6);
            border: 2px solid rgba(99, 102, 241, 0.2);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.1);
        }

        /* File Viewer Modal */
        .file-viewer-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: modal-appear 0.3s ease-out;
        }

        @keyframes modal-appear {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .file-viewer-content {
            background: white;
            border-radius: 24px;
            max-width: 800px;
            max-height: 80vh;
            width: 90%;
            overflow: hidden;
            animation: modal-slide-up 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .file-viewer-content {
            background: rgba(30, 30, 30, 0.98);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
        }

        @keyframes modal-slide-up {
            from {
                transform: translateY(50px) scale(0.95);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Sticky Header */
        .sticky-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 50;
            background: transparent;
            animation: header-slide-down 0.3s ease-out;
            padding-top: 12px;
        }

        @keyframes header-slide-down {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Action Buttons (Copy/Retry) */
        .action-buttons {
            display: flex;
            gap: 8px;
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
        }

        .action-btn {
            padding: 6px 16px;
            font-size: 12px;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 1);
            border-color: rgba(99, 102, 241, 0.5);
            transform: translateY(-1px);
        }

        /* Floating AI particles */
        .ai-particle {
            position: fixed;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.4), transparent);
            border-radius: 50%;
            pointer-events: none;
            animation: float-particle 15s infinite ease-in-out;
        }

        @keyframes float-particle {
            0%, 100% {
                transform: translate(0, 0) scale(1);
                opacity: 0.3;
            }
            25% {
                transform: translate(30px, -40px) scale(1.5);
                opacity: 0.6;
            }
            50% {
                transform: translate(-20px, -80px) scale(1);
                opacity: 0.4;
            }
            75% {
                transform: translate(-50px, -40px) scale(1.2);
                opacity: 0.5;
            }
        }

        /* Delete Animation */
        .email-delete-fade {
            animation: delete-slide-out 0.5s cubic-bezier(0.4, 0, 1, 1) forwards;
        }

        @keyframes delete-slide-out {
            0% {
                opacity: 1;
                transform: translateX(0) scale(1);
                max-height: 200px;
            }
            30% {
                opacity: 0.7;
                transform: translateX(-30px) scale(0.98);
            }
            60% {
                opacity: 0.3;
                transform: translateX(-80px) scale(0.95);
            }
            100% {
                opacity: 0;
                transform: translateX(-120px) scale(0.9);
                max-height: 0;
                padding-top: 0;
                padding-bottom: 0;
                margin-top: 0;
                margin-bottom: 0;
                overflow: hidden;
            }
        }

        /* Undo Delete Button */
        .undo-delete-button {
            position: fixed;
            bottom: 32px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            background: rgba(20, 20, 20, 0.95);
            color: white;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            animation: undo-slide-up 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .undo-delete-button:hover {
            background: rgba(40, 40, 40, 0.95);
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }

        @keyframes undo-slide-up {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(60px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* Prioritize Email Animation */
        .prioritize-wave {
            max-width: 400px;
            margin: 0 auto;
            padding: 16px 32px;
            background: linear-gradient(135deg,
                rgba(99, 102, 241, 0.15) 0%,
                rgba(139, 92, 246, 0.25) 50%,
                rgba(167, 139, 250, 0.15) 100%
            );
            background-size: 200% 200%;
            animation: prioritize-glow 2s ease-in-out infinite;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-weight: 600;
            font-size: 0.95rem;
            color: #6366f1;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(99, 102, 241, 0.2);
            box-shadow: 0 4px 24px rgba(99, 102, 241, 0.1),
                        inset 0 1px 0 rgba(255, 255, 255, 0.5);
            transform: translateY(0);
            transition: all 0.3s ease;
        }

        body.dark-mode .prioritize-wave {
            background: linear-gradient(135deg,
                rgba(99, 102, 241, 0.2) 0%,
                rgba(139, 92, 246, 0.3) 50%,
                rgba(167, 139, 250, 0.2) 100%
            );
            border-color: rgba(99, 102, 241, 0.4);
            color: #a5b4fc;
        }

        @keyframes prioritize-glow {
            0%, 100% {
                background-position: 0% 50%;
                box-shadow: 0 4px 24px rgba(99, 102, 241, 0.1),
                           inset 0 1px 0 rgba(255, 255, 255, 0.5);
            }
            50% {
                background-position: 100% 50%;
                box-shadow: 0 8px 32px rgba(99, 102, 241, 0.25),
                           inset 0 1px 0 rgba(255, 255, 255, 0.6);
            }
        }

        .email-slide-up {
            animation: email-priority-slide 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes email-priority-slide {
            0% {
                opacity: 0.5;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Gmail Icon Styles */
        .gmail-icon {
            width: 20px;
            height: 20px;
            display: inline-block;
        }

        .gmail-connecting {
            animation: gmail-pulse 1.5s ease-in-out infinite;
        }

        @keyframes gmail-pulse {
            0%, 100% {
                opacity: 0.6;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.1);
            }
        }

        .gmail-connected {
            position: relative;
        }

        .gmail-connected::after {
            content: 'âœ“';
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 10px;
            height: 10px;
            background: #10b981;
            border-radius: 50%;
            color: white;
            font-size: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
        }

        /* Email Selection Checkbox */
        .email-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(99, 102, 241, 0.5);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .email-checkbox.checked {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(249, 250, 251, 0.85) 100%);
            border-color: #10b981;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }

        body.dark-mode .email-checkbox.checked {
            background: linear-gradient(135deg, rgba(60, 60, 60, 0.9) 0%, rgba(50, 50, 50, 0.85) 100%);
        }

        .email-checkbox:hover {
            border-color: #6366f1;
            transform: scale(1.1);
        }

        /* Improved Email Content Display */
        .email-content-formatted {
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.6;
            font-size: 14px;
        }

        .email-content-formatted p {
            margin-bottom: 12px;
        }

        /* Priority Email Stacking */
        .priority-container {
            position: relative;
            margin-bottom: 24px;
        }

        .priority-header {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(249, 250, 251, 0.85) 100%);
            color: #1f2937;
            padding: 16px 24px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            position: relative;
            z-index: 10;
            border: 2px solid white;
        }

        body.dark-mode .priority-header {
            background: linear-gradient(135deg, rgba(40, 40, 40, 0.9) 0%, rgba(30, 30, 30, 0.85) 100%);
            color: #e5e5e5;
        }

        .priority-header:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);
        }

        .priority-stack {
            position: relative;
            margin-top: -12px;
        }

        .priority-email-stacked {
            position: absolute;
            width: calc(100% - 16px);
            left: 8px;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 16px;
            padding: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            animation: stack-appear 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        body.dark-mode .priority-email-stacked {
            background: rgba(40, 40, 40, 0.95);
            border-color: rgba(99, 102, 241, 0.5);
            color: #e5e5e5;
        }

        @keyframes stack-appear {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .priority-email-stacked:nth-child(1) {
            top: 8px;
            z-index: 3;
            transform: scale(0.98);
            animation: stack-glow 2s ease-in-out infinite;
        }

        .priority-email-stacked:nth-child(2) {
            top: 12px;
            z-index: 2;
            transform: scale(0.96);
            opacity: 0.7;
            animation-delay: 0.1s;
        }

        .priority-email-stacked:nth-child(3) {
            top: 16px;
            z-index: 1;
            transform: scale(0.94);
            opacity: 0.5;
            animation-delay: 0.2s;
        }

        .priority-email-stacked:nth-child(n+4) {
            display: none;
        }

        @keyframes stack-glow {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1), 0 0 0 rgba(99, 102, 241, 0);
            }
            50% {
                box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3), 0 0 20px rgba(99, 102, 241, 0.2);
            }
        }

        .priority-stack {
            position: relative;
            margin-top: -12px;
            min-height: 80px;
            transition: min-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .priority-stack-expanded {
            position: relative;
            margin-top: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .priority-stack-expanded .priority-email-stacked {
            position: relative;
            width: 100%;
            left: 0;
            margin-bottom: 12px;
            opacity: 1;
            transform: scale(1);
            animation: priority-expand 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        .priority-stack-expanded .priority-email-stacked:nth-child(n+4) {
            display: block;
        }

        @keyframes priority-expand {
            from {
                opacity: 0;
                transform: translateY(-10px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Collapse animation */
        .priority-stack .priority-email-stacked {
            animation: priority-collapse 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes priority-collapse {
            from {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            to {
                opacity: 0.5;
                transform: translateY(-5px) scale(0.94);
            }
        }

        .priority-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        /* Auto-Prioritize Setting */
        .setting-preview-container {
            margin-top: 12px;
            padding: 16px;
            background: rgba(99, 102, 241, 0.05);
            border: 2px solid rgba(99, 102, 241, 0.2);
            border-radius: 16px;
            animation: setting-preview-appear 0.3s ease-out;
        }

        @keyframes setting-preview-appear {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .preview-animation {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 12px;
        }

        .preview-email-item {
            padding: 12px;
            background: white;
            border-radius: 12px;
            border: 2px solid rgba(99, 102, 241, 0.2);
            font-size: 12px;
            animation: preview-slide 2s ease-in-out infinite;
        }

        .preview-email-item:nth-child(1) {
            animation-delay: 0s;
        }

        .preview-email-item:nth-child(2) {
            animation-delay: 0.3s;
        }

        .preview-email-item:nth-child(3) {
            animation-delay: 0.6s;
        }

        @keyframes preview-slide {
            0%, 100% {
                transform: translateX(0);
                opacity: 0.7;
            }
            50% {
                transform: translateX(10px);
                opacity: 1;
            }
        }

        /* Dark mode support for preview */
        body.dark-mode .setting-preview-container {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.4);
        }

        body.dark-mode .preview-email-item {
            background: rgba(40, 40, 40, 0.9);
            border-color: rgba(99, 102, 241, 0.4);
            color: #e5e5e5;
        }

        /* Send Button States */
        .send-button-sending {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            opacity: 0.7;
            cursor: not-allowed;
        }

        .send-button-sending:hover {
            transform: translateY(0);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        /* Envelope Flying Animation */
        .envelope-animation {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-size: 48px;
            z-index: 10000;
            animation: envelope-fly 1.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes envelope-fly {
            0% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
            30% {
                transform: scale(0.8) rotate(-10deg);
            }
            60% {
                transform: scale(1.2) rotate(5deg) translateY(-20px);
            }
            100% {
                transform: scale(0.5) rotate(45deg) translate(300px, -300px);
                opacity: 0;
            }
        }

        /* Priority Fade Glow */
        .priority-fade-glow {
            animation: priority-glow-fade 2s ease-out forwards;
        }

        @keyframes priority-glow-fade {
            0% {
                box-shadow: 0 0 0 rgba(99, 102, 241, 0.6);
            }
            50% {
                box-shadow: 0 0 40px rgba(99, 102, 241, 0.8), 0 0 80px rgba(139, 92, 246, 0.6);
            }
            100% {
                box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            }
        }

        /* Improved Email Container Design */
        .modern-email-item {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%);
            border: 2px solid rgba(99, 102, 241, 0.15);
            border-radius: 20px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .modern-email-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);
            transition: left 0.5s;
        }

        .modern-email-item:hover::before {
            left: 100%;
        }

        .modern-email-item:hover {
            transform: translateY(-5px) translateX(5px);
            box-shadow: 0 12px 35px rgba(99, 102, 241, 0.2);
            border-color: rgba(99, 102, 241, 0.4);
        }

        body.dark-mode .modern-email-item {
            background: linear-gradient(135deg, rgba(40, 40, 40, 0.95) 0%, rgba(30, 30, 30, 0.85) 100%);
            border-color: rgba(99, 102, 241, 0.3);
        }

        /* Priority Preview Containers */
        .priority-preview-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 16px;
        }

        .priority-preview-card {
            padding: 16px;
            border-radius: 16px;
            border: 2px solid white;
            transition: all 0.3s;
            position: relative;
            cursor: pointer;
        }

        .priority-preview-card::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: inherit;
            padding: 2px;
            background: linear-gradient(90deg,
                white,
                rgba(255, 255, 255, 0.3),
                rgba(255, 255, 255, 0.1),
                rgba(255, 255, 255, 0.3),
                white
            );
            background-size: 200% 100%;
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .priority-preview-card:hover::before {
            opacity: 1;
            animation: outline-sweep 0.6s ease-in-out;
        }

        .priority-preview-off {
            background: rgba(200, 200, 200, 0.1);
            border-color: rgba(150, 150, 150, 0.3);
        }

        .priority-preview-on {
            background: rgba(99, 102, 241, 0.05);
            border-color: rgba(99, 102, 241, 0.3);
        }

        .priority-mode-active {
            border-width: 3px;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.3);
            transform: scale(1.02);
        }

        .priority-mode-inactive {
            opacity: 0.7;
        }

        .priority-mode-inactive:hover {
            opacity: 1;
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .mode-checkmark {
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            animation: checkmark-appear 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes checkmark-appear {
            from {
                opacity: 0;
                transform: scale(0.5) rotate(-10deg);
            }
            to {
                opacity: 1;
                transform: scale(1) rotate(0);
            }
        }

        body.dark-mode .priority-preview-off {
            background: rgba(60, 60, 60, 0.3);
            border-color: rgba(120, 120, 120, 0.4);
        }

        body.dark-mode .priority-preview-on {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.5);
        }

        .preview-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            padding: 4px 10px;
            border-radius: 8px;
            display: inline-block;
        }

        .preview-label-off {
            background: rgba(150, 150, 150, 0.2);
            color: #666;
        }

        .preview-label-on {
            background: rgba(99, 102, 241, 0.2);
            color: #6366f1;
        }

        body.dark-mode .preview-label-off {
            background: rgba(120, 120, 120, 0.3);
            color: #aaa;
        }

        body.dark-mode .preview-label-on {
            background: rgba(99, 102, 241, 0.3);
            color: #a5b4fc;
        }

        /* New Email Indicator */
        .new-email-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            font-size: 11px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 20px;
            text-align: center;
            animation: badge-pulse 1.5s ease-in-out infinite;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.5);
        }

        @keyframes badge-pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 2px 8px rgba(239, 68, 68, 0.5);
            }
            50% {
                transform: scale(1.1);
                box-shadow: 0 4px 12px rgba(239, 68, 68, 0.7);
            }
        }

        /* Unread Email Label */
        .unread-label {
            position: absolute;
            top: 12px;
            right: 16px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            font-size: 11px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 12px;
            animation: unread-appear 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 5;
        }

        @keyframes unread-appear {
            from {
                opacity: 0;
                transform: scale(0.5) translateY(-10px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .unread-email {
            border-left: 4px solid #ef4444;
        }

        /* Inbox Button Expansion Animation */
        .inbox-button-expanded {
            min-width: 180px !important;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important;
            border-color: #ef4444 !important;
            animation: inbox-expand-glow 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
        }

        /* Welcome Text Animation */
        .welcome-text-container {
            text-align: center;
            margin-bottom: 2rem;
            margin-top: 1rem;
            opacity: 1;
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .welcome-text-container.fade-out {
            opacity: 0;
            transform: translateY(-10px);
            pointer-events: none;
        }

        .welcome-text {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #4f46e5, #9333ea, #db2777);
            background-size: 200% 200%;
            animation: gradient-shift 3s ease infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: #4f46e5; /* Fallback color for browsers without gradient support */
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 0.4rem;
        }

        body.dark-mode .welcome-text {
            background: linear-gradient(135deg, #a5b4fc, #d8b4fe, #fbcfe8);
            background-size: 200% 200%;
            animation: gradient-shift 3s ease infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: #a5b4fc; /* Fallback color */
        }

        @keyframes gradient-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .welcome-text span {
            display: inline-block;
            animation: typing-fade 0.5s ease forwards;
            opacity: 0;
            transform: translateY(10px);
        }

        @keyframes typing-fade {
            0% {
                opacity: 0;
                transform: translateY(10px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Typing cursor effect */
        .typing-cursor {
            display: inline-block;
            width: 3px;
            height: 1.8rem;
            background: linear-gradient(135deg, #4f46e5, #9333ea);
            margin-left: 4px;
            animation: blink 0.8s infinite;
        }

        body.dark-mode .typing-cursor {
            background: linear-gradient(135deg, #a5b4fc, #d8b4fe);
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        @keyframes inbox-expand-glow {
            0% {
                min-width: 100px;
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
            50% {
                box-shadow: 0 0 30px 10px rgba(239, 68, 68, 0.6);
            }
            100% {
                min-width: 180px;
                box-shadow: 0 0 20px 5px rgba(239, 68, 68, 0.4);
            }
        }

        .inbox-text-transition {
            display: inline-block;
            animation: text-fade-switch 3s ease-in-out forwards;
        }

        @keyframes text-fade-switch {
            0%, 100% {
                opacity: 1;
            }
            45%, 55% {
                opacity: 0;
            }
        }

        /* Email List Ladder Animation */
        .email-ladder-animation {
            animation: ladder-slide-in 0.4s ease-out backwards;
        }

        @keyframes ladder-slide-in {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* New Sidebar Layout */
        .desktop-inbox-layout {
            display: flex;
            gap: 20px;
            height: calc(100vh - 100px);
            position: relative;
            margin-left: -80px;
        }

        .inbox-sidebar {
            width: 480px;
            flex-shrink: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.9) 0%,
                rgba(249, 250, 251, 0.85) 100%
            );
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.12),
                        0 2px 8px rgba(99, 102, 241, 0.08),
                        inset 0 1px 0 rgba(255, 255, 255, 0.8);
            border-radius: 24px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        body.dark-mode .inbox-sidebar {
            background: rgba(20, 20, 20, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .inbox-scroll-area {
            flex: 1;
            overflow-y: auto;
            margin: 0 -10px;
            padding: 0 10px;
            mask-image: linear-gradient(to bottom, black calc(100% - 60px), transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black calc(100% - 60px), transparent 100%);
        }

        .inbox-scroll-area::-webkit-scrollbar {
            width: 8px;
        }

        .inbox-scroll-area::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }

        .inbox-scroll-area::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.3);
            border-radius: 10px;
        }

        .inbox-scroll-area::-webkit-scrollbar-thumb:hover {
            background: rgba(99, 102, 241, 0.5);
        }

        .email-content-area {
            flex: 1;
            overflow-y: auto;
            background: linear-gradient(135deg,
                rgba(255, 255, 255, 0.9) 0%,
                rgba(249, 250, 251, 0.85) 100%
            );
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.12),
                        0 2px 8px rgba(99, 102, 241, 0.08),
                        inset 0 1px 0 rgba(255, 255, 255, 0.8);
            border-radius: 24px;
            padding: 24px;
            opacity: 1;
            transform: translateX(0);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        body.dark-mode .email-content-area {
            background: rgba(20, 20, 20, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .email-content-area.viewing-email {
            opacity: 1;
            transform: translateX(0);
        }

        .email-content-area::-webkit-scrollbar {
            width: 8px;
        }

        .email-content-area::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }

        .email-content-area::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.3);
            border-radius: 10px;
        }

        .email-content-area::-webkit-scrollbar-thumb:hover {
            background: rgba(99, 102, 241, 0.5);
        }

        .email-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            color: #9ca3af;
        }

        .email-placeholder-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .email-placeholder-text {
            font-size: 18px;
            font-weight: 500;
        }

        /* Compact email item for sidebar */
        .sidebar-email-item {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            border-radius: 16px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        body.dark-mode .sidebar-email-item {
            background: rgba(30, 30, 30, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-email-item:hover {
            background: rgba(99, 102, 241, 0.1);
            transform: translateX(5px);
        }

        .sidebar-email-item.active {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.4);
        }

        body.dark-mode .sidebar-email-item.active {
            background: rgba(99, 102, 241, 0.2);
            border-color: rgba(99, 102, 241, 0.5);
        }

        /* Mobile: Stack layout */
        @media (max-width: 1024px) {
            .desktop-inbox-layout {
                flex-direction: column;
                height: auto;
            }

            .inbox-sidebar {
                width: 100%;
                max-height: 50vh;
            }

            .email-content-area {
                width: 100%;
                min-height: 50vh;
            }

            .email-content-area.active {
                transform: translateY(0);
            }
        }

        /* Email viewer header in sidebar layout */
        .email-viewer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 16px;
            border-bottom: 2px solid rgba(99, 102, 241, 0.2);
            margin-bottom: 20px;
        }

        .email-action-buttons {
            display: flex;
            gap: 8px;
        }

        /* iOS-style Priority Email Stacking */
        .priority-stack-container {
            margin-bottom: 16px;
            position: relative;
        }

        .priority-stack {
            position: relative;
            cursor: pointer;
        }

        .priority-stack-item {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 16px;
            padding: 12px;
            position: absolute;
            width: 100%;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .priority-stack-item:nth-child(1) {
            position: relative;
            z-index: 3;
            top: 0;
        }

        .priority-stack-item:nth-child(2) {
            z-index: 2;
            top: 4px;
            transform: scale(0.98);
            opacity: 0.7;
        }

        .priority-stack-item:nth-child(3) {
            z-index: 1;
            top: 8px;
            transform: scale(0.96);
            opacity: 0.5;
        }

        .priority-stack.expanded .priority-stack-item {
            position: relative;
            top: 0 !important;
            transform: scale(1) !important;
            opacity: 1 !important;
            margin-bottom: 8px;
        }

        /* Provider Tabs at Bottom */
        .provider-tabs-container {
            margin-top: auto;
            padding-top: 16px;
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .provider-tab {
            flex: 1;
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.5);
            border: 2px solid rgba(99, 102, 241, 0.2);
        }

        .provider-tab.active {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.4);
        }

        .provider-tab:hover {
            background: rgba(99, 102, 241, 0.1);
        }

        /* Inbox Search Bar */
        .inbox-search-bar {
            width: 100%;
            padding: 10px 16px;
            border-radius: 50px;
            border: 2px solid rgba(99, 102, 241, 0.3);
            background: rgba(255, 255, 255, 0.7);
            font-size: 13px;
            transition: all 0.3s ease;
            margin-bottom: 12px;
        }

        .inbox-search-bar:focus {
            outline: none;
            border-color: rgba(99, 102, 241, 0.5);
            background: rgba(255, 255, 255, 0.9);
        }

        .inbox-search-suggestions {
            position: absolute;
            left: 20px;
            right: 20px;
            top: 100%;
            margin-top: 8px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 16px;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            z-index: 10;
        }

        body.dark-mode .inbox-search-suggestions {
            background: rgba(30, 30, 30, 0.95);
            border: 2px solid rgba(99, 102, 241, 0.5);
        }

        .inbox-search-suggestion-item {
            padding: 10px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .inbox-search-suggestion-item {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .inbox-search-suggestion-item:last-child {
            border-bottom: none;
        }

        .inbox-search-suggestion-item:hover {
            background: rgba(99, 102, 241, 0.1);
        }

        /* Delete Button on Hover */
        .email-delete-btn {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            padding: 6px 16px;
            border-radius: 50px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            font-size: 12px;
            font-weight: 600;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .sidebar-email-item:hover .email-delete-btn {
            opacity: 1;
            pointer-events: all;
        }

        .email-delete-btn:hover {
            background: rgba(220, 38, 38, 1);
            transform: translateY(-50%) scale(1.05);
        }

        /* Email Deleting Animation */
        .email-deleting {
            animation: slideOutLeft 0.4s cubic-bezier(0.4, 0, 1, 1) forwards;
        }

        @keyframes slideOutLeft {
            0% {
                transform: translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateX(-120%);
                opacity: 0;
            }
        }

        /* Drag and Drop Styles */
        .dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .drag-over {
            border: 2px dashed rgba(99, 102, 241, 0.5) !important;
            background: rgba(99, 102, 241, 0.05) !important;
        }

        .email-content-area.drop-zone {
            position: relative;
        }

        .email-content-area.drop-zone::after {
            content: 'ðŸ“§ Drop email here to use with AI Writer';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            font-weight: 600;
            color: rgba(99, 102, 241, 0.7);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .email-content-area.drag-over::after {
            opacity: 1;
        }

        /* Inbox Header Layout */
        .inbox-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .inbox-header-left {
            flex: 1;
        }

        .inbox-header-right {
            display: flex;
            gap: 8px;
        }

        /* Priority Stack Positioning Fix */
        .priority-stack-container {
            margin-top: 12px;
            margin-bottom: 16px;
        }

        body.dark-mode .priority-stack-item {
            background: rgba(40, 40, 40, 0.95);
            border: 1px solid rgba(99, 102, 241, 0.4);
        }

        /* Email File Attachment Display */
        .email-file-attachment {
            background: rgba(99, 102, 241, 0.1);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        body.dark-mode .email-file-attachment {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.5);
        }

        .email-file-attachment:hover {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.5);
            transform: translateY(-2px);
        }

        .email-file-icon {
            font-size: 32px;
        }

        .email-file-info {
            flex: 1;
        }

        .email-file-title {
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
        }

        body.dark-mode .email-file-title {
            color: #e5e5e5;
        }

        .email-file-subtitle {
            font-size: 13px;
            color: #6b7280;
        }

        body.dark-mode .email-file-subtitle {
            color: #9ca3af;
        }

        /* Bottom Notification */
        .bottom-notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(99, 102, 241, 0.95);
            color: white;
            padding: 16px 32px;
            border-radius: 50px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            animation: slideUpNotification 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        @keyframes slideUpNotification {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(100px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* Outlook Slide Transition */
        .outlook-slide-enter {
            animation: slideInFromRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .gmail-slide-enter {
            animation: slideInFromLeft 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideInFromRight {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInFromLeft {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .outlook-coming-soon {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            color: #9ca3af;
        }

        .outlook-coming-soon-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .outlook-coming-soon-text {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        body.dark-mode .outlook-coming-soon-text {
            color: #e5e5e5;
        }

        .outlook-coming-soon-subtitle {
            font-size: 16px;
            color: #6b7280;
        }

        body.dark-mode .outlook-coming-soon-subtitle {
            color: #9ca3af;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [currentPage, setCurrentPage] = useState('home');
            const [activeTab, setActiveTab] = useState('email');
            const [activeView, setActiveView] = useState('writer');
            const [emailText, setEmailText] = useState('');
            const [customPrompt, setCustomPrompt] = useState('');
            const [result, setResult] = useState('');
            const [isProcessing, setIsProcessing] = useState(false);
            const [showSuggestions, setShowSuggestions] = useState(false);
            const [emailConnected, setEmailConnected] = useState(false);
            const [showFilterDropdown, setShowFilterDropdown] = useState(false);
            const [selectedTone, setSelectedTone] = useState(null);
            const [uploadedFile, setUploadedFile] = useState(null);
            const [savedResults, setSavedResults] = useState([]);
            const [viewingFile, setViewingFile] = useState(null);
            const [darkMode, setDarkMode] = useState(false);
            const [gmailEmails, setGmailEmails] = useState([]);
            const [sentEmails, setSentEmails] = useState([]);
            const [showSuggestionsEnabled, setShowSuggestionsEnabled] = useState(true);
            const [userEmail, setUserEmail] = useState('');
            const [viewingEmail, setViewingEmail] = useState(null);
            const [emailReply, setEmailReply] = useState('');
            const [replyPrompt, setReplyPrompt] = useState('');
            const [summarizingEmail, setSummarizingEmail] = useState(null);
            const [summaryText, setSummaryText] = useState('');
            const [isSummarizing, setIsSummarizing] = useState(false);
            const [summaryHidden, setSummaryHidden] = useState(false);
            const [userEmails, setUserEmails] = useState([
                { id: 1, from: 'john@example.com', subject: 'Meeting Tomorrow', preview: 'Hey, just wanted to confirm...', date: '2 hours ago' },
                { id: 2, from: 'sarah@company.com', subject: 'Project Update', preview: 'The latest updates on the project...', date: '5 hours ago' },
                { id: 3, from: 'mike@startup.io', subject: 'Quick Question', preview: 'Do you have a moment to discuss...', date: '1 day ago' },
            ]);

            // New state variables for enhanced features
            const [selectedEmails, setSelectedEmails] = useState([]);
            const [deletedEmail, setDeletedEmail] = useState(null);
            const [showUndoDelete, setShowUndoDelete] = useState(false);
            const [isPrioritizing, setIsPrioritizing] = useState(false);
            const [emailsPrioritized, setEmailsPrioritized] = useState(false);
            const [locallyDeletedEmailIds, setLocallyDeletedEmailIds] = useState(new Set());
            const [isRewritingReply, setIsRewritingReply] = useState(false);
            const [autoPrioritize, setAutoPrioritize] = useState(false);
            const [priorityEmails, setPriorityEmails] = useState([]);
            const [isPriorityExpanded, setIsPriorityExpanded] = useState(false);
            const [isSending, setIsSending] = useState(false);
            const [showEnvelope, setShowEnvelope] = useState(false);
            const [showPriorityGlow, setShowPriorityGlow] = useState(false);
            const [newEmailCount, setNewEmailCount] = useState(0);
            const [unreadEmails, setUnreadEmails] = useState(new Set());
            const [lastEmailCheck, setLastEmailCheck] = useState(Date.now());
            const [showInboxExpand, setShowInboxExpand] = useState(false);
            const [userName, setUserName] = useState('');
            const [showWelcomeAnimation, setShowWelcomeAnimation] = useState(true);
            const [aiLoadingState, setAiLoadingState] = useState('');
            const [currentWelcomeMessage, setCurrentWelcomeMessage] = useState(0);
            const [currentSuggestionIndex, setCurrentSuggestionIndex] = useState(0);
            const [showIndicator, setShowIndicator] = useState(false);
            const [showSearchBar, setShowSearchBar] = useState(false);
            const [searchQuery, setSearchQuery] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const [touchStartX, setTouchStartX] = useState(0);
            const [touchEndX, setTouchEndX] = useState(0);
            const [isRefreshing, setIsRefreshing] = useState(false);
            const [deletedEmails, setDeletedEmails] = useState([]);
            const [deletingEmailId, setDeletingEmailId] = useState(null);

            // New state variables for enhanced features
            const [activeProvider, setActiveProvider] = useState('gmail');
            const [outlookConnected, setOutlookConnected] = useState(false);
            const [outlookEmails, setOutlookEmails] = useState([]);
            const [inboxSearchQuery, setInboxSearchQuery] = useState('');
            const [inboxSearchResults, setInboxSearchResults] = useState([]);
            const [showInboxSearchSuggestions, setShowInboxSearchSuggestions] = useState(false);
            const [priorityStackExpanded, setPriorityStackExpanded] = useState(false);
            const [draggedEmail, setDraggedEmail] = useState(null);
            const [isDraggingOver, setIsDraggingOver] = useState(false);
            const [droppedEmailFile, setDroppedEmailFile] = useState(null);
            const [showBottomNotification, setShowBottomNotification] = useState(false);
            const [bottomNotificationText, setBottomNotificationText] = useState('');

            // Audio references for notifications
            const audioRef = useRef(null);
            const sendAudioRef = useRef(null);
            const carouselRef = useRef(null);
            const navRef = useRef(null);

            // Initialize app with console logging
            useEffect(() => {
                console.log('ðŸš€ AI Email Writer initialized');
                console.log('ðŸ“Š Initial state:', { activeTab, activeView, currentPage });
                console.log('ðŸ”Œ API endpoint:', '/api/transform');

                // Check for OAuth callback with tokens
                const urlParams = new URLSearchParams(window.location.search);
                const tokensParam = urlParams.get('tokens');

                if (tokensParam) {
                    try {
                        const tokens = JSON.parse(decodeURIComponent(tokensParam));
                        console.log('ðŸŽ‰ OAuth tokens received!');

                        // Store tokens in localStorage
                        localStorage.setItem('gmailTokens', JSON.stringify(tokens));
                        localStorage.setItem('emailConnected', 'true');
                        localStorage.removeItem('oauth_in_progress');

                        setEmailConnected(true);

                        // Fetch user info to get email address and name
                        fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
                            headers: {
                                Authorization: `Bearer ${tokens.access_token}`
                            }
                        })
                        .then(res => res.json())
                        .then(userInfo => {
                            console.log('ðŸ‘¤ User:', userInfo.email);
                            setUserEmail(userInfo.email);
                            localStorage.setItem('userEmail', userInfo.email);

                            // Extract user's first name
                            const name = userInfo.given_name || userInfo.name?.split(' ')[0] || 'there';
                            setUserName(name);
                            localStorage.setItem('userName', name);
                            console.log('ðŸ‘‹ Welcome', name);
                        })
                        .catch(err => console.error('Error fetching user info:', err));

                        // Fetch emails
                        fetchGmailEmails(tokens.access_token);
                        fetchSentEmails(tokens.access_token);

                        // Clean URL
                        window.history.replaceState({}, '', '/');
                    } catch (error) {
                        console.error('âŒ Error processing OAuth tokens:', error);
                    }
                }

                // Load email connection from localStorage
                const savedConnection = localStorage.getItem('emailConnected');
                const savedTokens = localStorage.getItem('gmailTokens');
                const savedUserEmail = localStorage.getItem('userEmail');
                const savedUserName = localStorage.getItem('userName');
                const savedShowSuggestions = localStorage.getItem('showSuggestions');

                if (savedUserEmail) {
                    setUserEmail(savedUserEmail);
                }

                if (savedUserName) {
                    setUserName(savedUserName);
                }

                if (savedShowSuggestions !== null) {
                    setShowSuggestionsEnabled(savedShowSuggestions === 'true');
                }

                if (savedConnection === 'true' && savedTokens) {
                    setEmailConnected(true);

                    // Fetch emails with saved tokens
                    try {
                        const tokens = JSON.parse(savedTokens);
                        fetchGmailEmails(tokens.access_token);
                        fetchSentEmails(tokens.access_token);
                    } catch (error) {
                        console.error('âŒ Error loading saved tokens:', error);
                        // Clear invalid tokens
                        localStorage.removeItem('gmailTokens');
                        localStorage.removeItem('emailConnected');
                        localStorage.removeItem('userEmail');
                        setEmailConnected(false);
                        setUserEmail('');
                    }
                }

                // Load dark mode preference
                const savedDarkMode = localStorage.getItem('darkMode');
                if (savedDarkMode === 'true') {
                    setDarkMode(true);
                    document.body.classList.add('dark-mode');
                }
            }, []);

            // Update dark mode
            useEffect(() => {
                if (darkMode) {
                    document.body.classList.add('dark-mode');
                    localStorage.setItem('darkMode', 'true');
                } else {
                    document.body.classList.remove('dark-mode');
                    localStorage.setItem('darkMode', 'false');
                }
            }, [darkMode]);

            // Update suggestions based on custom prompt only
            useEffect(() => {
                if (showSuggestionsEnabled && customPrompt.length > 0) {
                    setShowSuggestions(true);
                } else {
                    setShowSuggestions(false);
                }
            }, [customPrompt, showSuggestionsEnabled]);

            // Initialize audio with local files
            useEffect(() => {
                audioRef.current = new Audio('/notification.mp3');
                audioRef.current.load();

                sendAudioRef.current = new Audio('/send.mp3');
                sendAudioRef.current.load();

                // Load auto-prioritize setting
                const savedAutoPrioritize = localStorage.getItem('autoPrioritize');
                if (savedAutoPrioritize === 'true') {
                    setAutoPrioritize(true);
                }
            }, []);

            // Auto-hide undo delete button after 5 seconds
            useEffect(() => {
                if (showUndoDelete) {
                    const timer = setTimeout(() => {
                        setShowUndoDelete(false);
                        setDeletedEmail(null);
                    }, 5000);
                    return () => clearTimeout(timer);
                }
            }, [showUndoDelete]);

            // Auto-prioritize emails when inbox loads
            useEffect(() => {
                if (autoPrioritize && gmailEmails.length > 0 && currentPage === 'inbox' && priorityEmails.length === 0) {
                    handlePrioritizeEmails();
                }
            }, [autoPrioritize, gmailEmails.length, currentPage]);

            // Reset new email count when user views inbox
            useEffect(() => {
                if (currentPage === 'inbox' && newEmailCount > 0) {
                    const timer = setTimeout(() => {
                        setNewEmailCount(0);
                    }, 2000);
                    return () => clearTimeout(timer);
                }
            }, [currentPage, newEmailCount]);

            // Rotate welcome messages
            useEffect(() => {
                if (!showWelcomeAnimation) return;

                const interval = setInterval(() => {
                    setCurrentWelcomeMessage(prev => (prev + 1) % welcomeMessages.length);
                }, 3000);

                return () => clearInterval(interval);
            }, [showWelcomeAnimation]);

            // Hide welcome text when user starts typing
            useEffect(() => {
                if ((emailText.length > 0 || customPrompt.length > 0) && showWelcomeAnimation) {
                    setShowWelcomeAnimation(false);
                }
            }, [emailText, customPrompt]);

            // Play notification sound
            const playNotificationSound = () => {
                if (audioRef.current) {
                    audioRef.current.currentTime = 0;
                    audioRef.current.play().catch(e => console.log('Sound play failed:', e));
                }
            };

            // Play send sound
            const playSendSound = () => {
                if (sendAudioRef.current) {
                    sendAudioRef.current.currentTime = 0;
                    sendAudioRef.current.play().catch(e => console.log('Send sound failed:', e));
                }
            };

            // Handle send email with animation
            const handleSendEmail = async () => {
                if (!emailReply || !viewingEmail) return;

                setIsSending(true);

                try {
                    // Get access token
                    const savedTokens = localStorage.getItem('gmailTokens');
                    if (!savedTokens) {
                        alert('âš ï¸ Not connected to Gmail. Please connect your account in Settings.');
                        setIsSending(false);
                        return;
                    }

                    const tokens = JSON.parse(savedTokens);

                    // Extract email address from "Name <email@domain.com>" format
                    const extractEmail = (fromString) => {
                        const match = fromString.match(/<(.+?)>/);
                        return match ? match[1] : fromString;
                    };

                    const recipientEmail = extractEmail(viewingEmail.from);
                    const originalSubject = viewingEmail.subject;
                    const replySubject = originalSubject.startsWith('Re:') ? originalSubject : `Re: ${originalSubject}`;

                    console.log('ðŸ“¤ Sending reply to:', recipientEmail);
                    console.log('Subject:', replySubject);

                    // Send the email via Gmail API
                    const response = await fetch('/api/gmail-send', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            accessToken: tokens.access_token,
                            to: recipientEmail,
                            subject: replySubject,
                            body: emailReply,
                            threadId: viewingEmail.threadId,
                            messageId: viewingEmail.id
                        })
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.message || 'Failed to send email');
                    }

                    // Success! Show animations
                    setShowEnvelope(true);
                    playSendSound();

                    console.log('âœ… Email sent successfully!');
                    console.log('Message ID:', data.messageId);

                    // Show success message
                    setTimeout(() => {
                        alert('âœ‰ï¸ Reply sent successfully!');

                        // Clear fields and close modal
                        setEmailReply('');
                        setReplyPrompt('');
                        setViewingEmail(null);
                        setIsSending(false);

                        // Remove envelope after animation
                        setTimeout(() => {
                            setShowEnvelope(false);
                        }, 1500);
                    }, 1000);

                } catch (error) {
                    console.error('âŒ Error sending email:', error);
                    alert(`âŒ Failed to send email: ${error.message}`);
                    setIsSending(false);
                }
            };

            const emailStyles = [
                { id: 'professional', label: 'ðŸ’¼ Professional' },
                { id: 'friendly', label: 'ðŸ˜Š Friendly' },
                { id: 'concise', label: 'âš¡ Concise' },
                { id: 'persuasive', label: 'ðŸŽ¯ Persuasive' },
                { id: 'apologetic', label: 'ðŸ™ Apologetic' },
                { id: 'enthusiastic', label: 'ðŸš€ Enthusiastic' }
            ];

            const generalSuggestions = [
                { id: 'longer', label: 'ðŸ“ Make Longer', prompt: 'Expand this email with more details and context' },
                { id: 'clearer', label: 'ðŸ’¡ More Clear', prompt: 'Rewrite this email to be more clear and understandable' },
                { id: 'simpler', label: 'ðŸ”¤ Simplify', prompt: 'Simplify this email to be easier to understand' },
                { id: 'formal', label: 'ðŸŽ© More Formal', prompt: 'Make this email more formal and professional' },
                { id: 'action', label: 'âš¡ Add Action Items', prompt: 'Add clear action items and next steps to this email' },
                { id: 'polite', label: 'ðŸŒŸ More Polite', prompt: 'Make this email more polite and courteous' }
            ];

            const welcomeMessages = [
                "Turn hours of emails into seconds",
                "Transform your inbox with AI",
                "Write better emails faster",
                "Your AI email assistant"
            ];

            const tools = [
                { id: 'email', icon: 'âœ‰ï¸', name: 'Email Rewriter', desc: 'Transform your emails instantly' },
                { id: 'summary', icon: 'ðŸ“', name: 'Text Summarizer', desc: 'Condense long content' },
                { id: 'grammar', icon: 'âœ…', name: 'Grammar Check', desc: 'Polish your writing' },
                { id: 'translate', icon: 'ðŸŒ', name: 'Translator', desc: 'Translate to any language' },
                { id: 'ideas', icon: 'ðŸ’¡', name: 'Idea Generator', desc: 'Brainstorm creative ideas' },
                { id: 'tone', icon: 'ðŸŽ­', name: 'Tone Analyzer', desc: 'Understand message sentiment' }
            ];

            // Show indicator when suggestions appear
            useEffect(() => {
                if (showSuggestions && currentPage === 'home') {
                    setShowIndicator(true);
                    const timer = setTimeout(() => {
                        setShowIndicator(false);
                    }, 5000); // 5 seconds
                    return () => clearTimeout(timer);
                }
            }, [showSuggestions, currentPage]);

            // Add mouse wheel scroll for carousel
            useEffect(() => {
                const carousel = carouselRef.current;
                if (!carousel || !showSuggestions) return;

                const handleWheel = (e) => {
                    if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
                        e.preventDefault();
                        if (e.deltaY > 0) {
                            // Scroll down = next suggestion
                            setCurrentSuggestionIndex((prev) =>
                                prev < generalSuggestions.length - 1 ? prev + 1 : 0
                            );
                        } else {
                            // Scroll up = previous suggestion
                            setCurrentSuggestionIndex((prev) =>
                                prev > 0 ? prev - 1 : generalSuggestions.length - 1
                            );
                        }
                    }
                };

                carousel.addEventListener('wheel', handleWheel, { passive: false });
                return () => carousel.removeEventListener('wheel', handleWheel);
            }, [showSuggestions]);

            // Swipe gesture for search on mobile
            useEffect(() => {
                const nav = navRef.current;
                if (!nav || currentPage !== 'inbox') return;

                const handleTouchStart = (e) => {
                    setTouchStartX(e.touches[0].clientX);
                };

                const handleTouchMove = (e) => {
                    setTouchEndX(e.touches[0].clientX);
                };

                const handleTouchEnd = () => {
                    const swipeDistance = touchStartX - touchEndX;
                    const threshold = 50;

                    if (Math.abs(swipeDistance) > threshold) {
                        if (swipeDistance > 0) {
                            // Swipe left - show search
                            setShowSearchBar(true);
                        } else {
                            // Swipe right - hide search
                            setShowSearchBar(false);
                            setSearchQuery('');
                            setSearchResults([]);
                        }
                    }
                };

                nav.addEventListener('touchstart', handleTouchStart);
                nav.addEventListener('touchmove', handleTouchMove);
                nav.addEventListener('touchend', handleTouchEnd);

                return () => {
                    nav.removeEventListener('touchstart', handleTouchStart);
                    nav.removeEventListener('touchmove', handleTouchMove);
                    nav.removeEventListener('touchend', handleTouchEnd);
                };
            }, [touchStartX, touchEndX, currentPage]);

            // Search emails
            useEffect(() => {
                if (searchQuery.length === 0) {
                    setSearchResults([]);
                    return;
                }

                const results = gmailEmails.filter(email =>
                    email.subject.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    email.from.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    email.snippet.toLowerCase().includes(searchQuery.toLowerCase())
                );

                setSearchResults(results.slice(0, 5)); // Show top 5 results
            }, [searchQuery, gmailEmails]);

            const handleGmailConnect = async () => {
                try {
                    console.log('ðŸ” Initiating Gmail OAuth...');

                    // Call your auth endpoint to get the OAuth URL
                    const response = await fetch('/api/gmail-auth');

                    if (!response.ok) {
                        throw new Error('Failed to initiate OAuth');
                    }

                    const data = await response.json();
                    console.log('ðŸ“§ Redirecting to Google OAuth...');

                    // Store that we're in OAuth flow
                    localStorage.setItem('oauth_in_progress', 'true');

                    // Redirect to Google's OAuth consent screen
                    window.location.href = data.authUrl;
                } catch (error) {
                    console.error('âŒ Gmail OAuth error:', error);
                    console.error('Please check: GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET are set in Vercel');
                }
            };

            const isTokenExpired = (expiryDate) => {
                if (!expiryDate) return true;
                // Add 5 minute buffer before actual expiry
                return Date.now() >= (expiryDate - 300000);
            };

            const refreshAccessToken = async () => {
                try {
                    const savedTokens = localStorage.getItem('gmailTokens');
                    if (!savedTokens) {
                        throw new Error('No tokens found');
                    }

                    const tokens = JSON.parse(savedTokens);
                    if (!tokens.refresh_token) {
                        throw new Error('No refresh token available');
                    }

                    console.log('ðŸ”„ Refreshing access token...');

                    const response = await fetch('/api/gmail-refresh', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ refreshToken: tokens.refresh_token })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'Failed to refresh token');
                    }

                    const data = await response.json();
                    console.log('âœ… Access token refreshed successfully');

                    // Update tokens in localStorage (keep refresh_token)
                    const updatedTokens = {
                        ...tokens,
                        access_token: data.access_token,
                        expiry_date: data.expiry_date
                    };
                    localStorage.setItem('gmailTokens', JSON.stringify(updatedTokens));

                    return data.access_token;
                } catch (error) {
                    console.error('âŒ Token refresh failed:', error);
                    // Clear tokens and force re-authentication
                    localStorage.removeItem('gmailTokens');
                    localStorage.removeItem('emailConnected');
                    localStorage.removeItem('userEmail');
                    setEmailConnected(false);
                    setUserEmail('');
                    alert('Your session has expired. Please reconnect your Gmail account.');
                    throw error;
                }
            };

            const fetchGmailEmails = async (accessToken, isRetry = false) => {
                try {
                    console.log('ðŸ“¬ Fetching Gmail inbox...');

                    // Check if token is expired before making request
                    const savedTokens = localStorage.getItem('gmailTokens');
                    if (savedTokens && !isRetry) {
                        const tokens = JSON.parse(savedTokens);
                        if (isTokenExpired(tokens.expiry_date)) {
                            console.log('âš ï¸ Token expired, refreshing...');
                            const newAccessToken = await refreshAccessToken();
                            return fetchGmailEmails(newAccessToken, true);
                        }
                    }

                    const response = await fetch('/api/gmail-inbox', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ accessToken })
                    });

                    const data = await response.json();

                    // Handle authentication errors by refreshing token
                    if (!response.ok) {
                        if ((response.status === 401 || response.status === 403) && !isRetry) {
                            console.log('ðŸ”„ Authentication failed, refreshing token...');
                            const newAccessToken = await refreshAccessToken();
                            return fetchGmailEmails(newAccessToken, true);
                        }

                        console.error('âŒ API Error Response:', data);
                        console.error('Error message:', data.message);
                        console.error('Error details:', data.details);
                        throw new Error(data.message || 'Failed to fetch emails');
                    }

                    // Transform Gmail API response to our format
                    const formattedEmails = data.emails.map(email => {
                        const headers = email.payload.headers;
                        const from = headers.find(h => h.name === 'From')?.value || 'Unknown';
                        const subject = headers.find(h => h.name === 'Subject')?.value || 'No Subject';
                        const date = headers.find(h => h.name === 'Date')?.value || '';
                        const messageId = headers.find(h => h.name === 'Message-ID')?.value || '';

                        return {
                            id: email.id,
                            from: from,
                            subject: subject,
                            snippet: email.snippet,
                            date: new Date(parseInt(email.internalDate)).toLocaleString(),
                            internalDate: email.internalDate,
                            threadId: email.threadId,
                            messageId: messageId
                        };
                    });

                    // Detect new emails and filter out deleted ones
                    setGmailEmails(prevEmails => {
                        // Filter out deleted emails (permanently deleted unless undone)
                        const filteredEmails = formattedEmails.filter(e => !deletedEmails.includes(e.id));

                        const prevEmailIds = new Set(prevEmails.map(e => e.id));
                        const newEmails = filteredEmails.filter(e => !prevEmailIds.has(e.id));

                        if (newEmails.length > 0 && prevEmails.length > 0) {
                            console.log(`ðŸ”” ${newEmails.length} new email(s) detected!`);
                            setNewEmailCount(prev => prev + newEmails.length);
                            setUnreadEmails(prev => {
                                const updated = new Set(prev);
                                newEmails.forEach(e => updated.add(e.id));
                                return updated;
                            });

                            // Trigger inbox button expansion animation
                            setShowInboxExpand(true);
                            setTimeout(() => {
                                setShowInboxExpand(false);
                            }, 3000);

                            // Play notification sound
                            playNotificationSound();
                        }

                        return filteredEmails;
                    });
                    console.log(`âœ… Loaded ${formattedEmails.length} emails from inbox`);
                } catch (error) {
                    console.error('âŒ Error fetching emails:', error);
                    console.error('Full error object:', error);
                }
            };

            const fetchSentEmails = async (accessToken, isRetry = false) => {
                try {
                    console.log('ðŸ“¤ Fetching sent emails...');

                    // Check if token is expired before making request
                    const savedTokens = localStorage.getItem('gmailTokens');
                    if (savedTokens && !isRetry) {
                        const tokens = JSON.parse(savedTokens);
                        if (isTokenExpired(tokens.expiry_date)) {
                            console.log('âš ï¸ Token expired, refreshing...');
                            const newAccessToken = await refreshAccessToken();
                            return fetchSentEmails(newAccessToken, true);
                        }
                    }

                    const response = await fetch('/api/gmail-sent', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ accessToken })
                    });

                    const data = await response.json();

                    // Handle authentication errors by refreshing token
                    if (!response.ok) {
                        if ((response.status === 401 || response.status === 403) && !isRetry) {
                            console.log('ðŸ”„ Authentication failed, refreshing token...');
                            const newAccessToken = await refreshAccessToken();
                            return fetchSentEmails(newAccessToken, true);
                        }

                        console.error('âŒ API Error Response:', data);
                        console.error('Error message:', data.message);
                        console.error('Error details:', data.details);
                        throw new Error(data.message || 'Failed to fetch sent emails');
                    }

                    // Transform Gmail API response to our format
                    const formattedEmails = data.emails.map(email => {
                        const headers = email.payload.headers;
                        const to = headers.find(h => h.name === 'To')?.value || 'Unknown';
                        const subject = headers.find(h => h.name === 'Subject')?.value || 'No Subject';
                        const date = headers.find(h => h.name === 'Date')?.value || '';

                        return {
                            id: email.id,
                            to: to,
                            subject: subject,
                            snippet: email.snippet,
                            date: new Date(parseInt(email.internalDate)).toLocaleString()
                        };
                    });

                    setSentEmails(formattedEmails);
                    console.log(`âœ… Loaded ${formattedEmails.length} sent emails`);
                } catch (error) {
                    console.error('âŒ Error fetching sent emails:', error);
                    console.error('Full error object:', error);
                }
            };

            const callAIAPI = async (prompt, text) => {
                console.log('ðŸ¤– Calling AI API...');
                console.log('ðŸ“ Prompt:', prompt);
                console.log('ðŸ“„ Text length:', text.length, 'characters');

                try {
                    const response = await fetch('/api/transform', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            prompt: prompt,
                            text: text
                        })
                    });

                    console.log('ðŸ“¡ API Response status:', response.status);

                    if (!response.ok) {
                        const contentType = response.headers.get('content-type');
                        let errorMessage = 'API request failed';

                        if (contentType && contentType.includes('application/json')) {
                            const errorData = await response.json();
                            errorMessage = errorData.error || errorMessage;
                        } else {
                            const errorText = await response.text();
                            console.error('âŒ Non-JSON response:', errorText.substring(0, 200));
                            errorMessage = 'Server error: API endpoint not available. Make sure you\'ve deployed to Vercel.';
                        }

                        throw new Error(errorMessage);
                    }

                    const data = await response.json();
                    console.log('âœ… AI Response received, length:', data.result?.length || 0);
                    return data.result;
                } catch (error) {
                    console.error('âŒ API Error:', error.message);
                    throw error;
                }
            };

            const animateText = (text) => {
                const resultElement = document.getElementById('result-text');
                if (!resultElement) return;

                resultElement.innerHTML = '';
                const lines = text.split('\n');

                // Calculate position-based delay for splash effect (top-left to bottom-right)
                lines.forEach((line, lineIndex) => {
                    const words = line.split(' ');
                    words.forEach((word, wordIndex) => {
                        const wordSpan = document.createElement('span');
                        wordSpan.className = 'wave-char';
                        wordSpan.textContent = word;
                        // Diagonal splash: lineIndex + wordIndex for top-left to bottom-right
                        const diagonalDelay = (lineIndex + wordIndex * 0.3) * 0.015;
                        wordSpan.style.animationDelay = `${diagonalDelay}s`;
                        resultElement.appendChild(wordSpan);

                        // Add space after word (except last word)
                        if (wordIndex < words.length - 1) {
                            const space = document.createTextNode(' ');
                            resultElement.appendChild(space);
                        }
                    });

                    // Add line break (except after last line)
                    if (lineIndex < lines.length - 1) {
                        const br = document.createElement('br');
                        resultElement.appendChild(br);
                    }
                });
            };

            const handleStyleClick = (style) => {
                // Just set the selected tone, don't generate yet
                setSelectedTone(style);
                console.log('ðŸŽ¨ Tone selected:', style);
            };

            const handleGenerate = async () => {
                if (!selectedTone && !customPrompt) return;

                // Ensure we have text to process
                const textToProcess = uploadedFile?.content || emailText;
                if (!textToProcess || textToProcess.trim().length === 0) {
                    alert('Please enter some text or upload a file before generating!');
                    return;
                }

                setIsProcessing(true);
                setResult('');
                setActiveView('results');

                let prompt = customPrompt;

                if (selectedTone && !customPrompt) {
                    switch(selectedTone) {
                        case 'professional':
                            prompt = 'Rewrite this email in a professional, formal business tone';
                            break;
                        case 'friendly':
                            prompt = 'Rewrite this email in a warm, friendly, and approachable tone';
                            break;
                        case 'concise':
                            prompt = 'Rewrite this email to be brief and to the point';
                            break;
                        case 'persuasive':
                            prompt = 'Rewrite this email to be compelling and convincing';
                            break;
                        case 'apologetic':
                            prompt = 'Rewrite this email with a sincere and apologetic tone';
                            break;
                        case 'enthusiastic':
                            prompt = 'Rewrite this email with an energetic and enthusiastic tone';
                            break;
                    }
                } else if (selectedTone && customPrompt) {
                    // Combine tone with custom prompt
                    const toneLabel = emailStyles.find(s => s.id === selectedTone)?.label || '';
                    prompt = `${customPrompt} in a ${toneLabel} tone`;
                }

                try {
                    const transformedText = await callAIAPI(prompt, uploadedFile?.content || emailText);
                    setResult(transformedText);

                    // Save to history
                    const newResult = {
                        id: Date.now(),
                        content: transformedText,
                        prompt: prompt,
                        originalText: uploadedFile?.content || emailText,
                        timestamp: new Date().toLocaleString(),
                        tone: selectedTone
                    };
                    setSavedResults(prev => [newResult, ...prev]);

                    setIsProcessing(false);
                    setTimeout(() => animateText(transformedText), 100);
                } catch (error) {
                    console.error('API Error:', error);
                    setResult(`Error: ${error.message}\n\nPlease check that:\n1. Your MISTRAL_API_KEY is set in Vercel\n2. Your API key is valid\n3. You have sufficient credits`);
                    setIsProcessing(false);
                }
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    const content = event.target.result;
                    setUploadedFile({
                        name: file.name,
                        content: content,
                        size: file.size
                    });
                    setEmailText(''); // Clear textarea when file is uploaded
                    console.log('ðŸ“ File uploaded:', file.name);
                };
                reader.readAsText(file);
            };

            const handleDeleteResult = (id) => {
                setSavedResults(prev => prev.filter(r => r.id !== id));
                console.log('ðŸ—‘ï¸ Deleted result:', id);
            };

            const handleRetry = async () => {
                if (!savedResults.length) return;

                const lastResult = savedResults[0];
                console.log('ðŸ”„ Retrying with prompt:', lastResult.prompt);

                setIsProcessing(true);
                setResult('');

                try {
                    const transformedText = await callAIAPI(lastResult.prompt, lastResult.originalText);
                    setResult(transformedText);

                    // Save new retry result
                    const newResult = {
                        id: Date.now(),
                        content: transformedText,
                        prompt: lastResult.prompt,
                        originalText: lastResult.originalText,
                        timestamp: new Date().toLocaleString(),
                        tone: lastResult.tone
                    };
                    setSavedResults(prev => [newResult, ...prev]);

                    setIsProcessing(false);
                    setTimeout(() => animateText(transformedText), 100);
                } catch (error) {
                    console.error('Retry Error:', error);
                    setResult(`Error: ${error.message}`);
                    setIsProcessing(false);
                }
            };

            const handleToolProcess = async () => {
                setIsProcessing(true);
                setResult('');
                setActiveView('results');
                
                let prompt = '';
                switch(activeTab) {
                    case 'summary':
                        prompt = 'Summarize this text concisely';
                        break;
                    case 'grammar':
                        prompt = 'Check and correct the grammar in this text';
                        break;
                    case 'translate':
                        prompt = 'Translate this text to Spanish';
                        break;
                    case 'ideas':
                        prompt = 'Generate creative ideas based on this text';
                        break;
                    case 'tone':
                        prompt = 'Analyze the tone and sentiment of this text';
                        break;
                }

                try {
                    const output = await callAIAPI(prompt, emailText);
                    setResult(output);
                    setIsProcessing(false);
                    setTimeout(() => animateText(output), 100);
                } catch (error) {
                    console.error('API Error:', error);
                    setResult(`Error: ${error.message}\n\nPlease check that:\n1. Your MISTRAL_API_KEY is set in Vercel\n2. Your API key is valid\n3. You have sufficient credits`);
                    setIsProcessing(false);
                }
            };

            const renderSettings = () => {
                return (
                    <div className="settings-panel space-y-8">
                        <div className="glass-effect rounded-3xl p-8 ai-glow">
                            <h2 className="text-3xl font-bold text-gray-800 mb-6">âš™ï¸ Settings</h2>

                            <div className="space-y-6">
                                {/* Dark Mode Toggle */}
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                        ðŸŒ™ Dark Mode
                                    </label>
                                    <div className="flex items-center justify-between glass-dark px-4 py-3 rounded-xl">
                                        <span className="text-sm text-gray-700">Enable dark theme</span>
                                        <button
                                            onClick={() => setDarkMode(!darkMode)}
                                            className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${
                                                darkMode ? 'bg-indigo-600' : 'bg-gray-300'
                                            }`}
                                        >
                                            <span
                                                className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${
                                                    darkMode ? 'translate-x-6' : 'translate-x-1'
                                                }`}
                                            />
                                        </button>
                                    </div>
                                </div>

                                {/* Show Suggestions Toggle */}
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                        ðŸ’¡ Show Suggestions
                                    </label>
                                    <div className="flex items-center justify-between glass-dark px-4 py-3 rounded-xl">
                                        <span className="text-sm text-gray-700">Show AI tone suggestions while typing</span>
                                        <button
                                            onClick={() => {
                                                const newValue = !showSuggestionsEnabled;
                                                setShowSuggestionsEnabled(newValue);
                                                localStorage.setItem('showSuggestions', newValue.toString());
                                            }}
                                            className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${
                                                showSuggestionsEnabled ? 'bg-indigo-600' : 'bg-gray-300'
                                            }`}
                                        >
                                            <span
                                                className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${
                                                    showSuggestionsEnabled ? 'translate-x-6' : 'translate-x-1'
                                                }`}
                                            />
                                        </button>
                                    </div>
                                </div>

                                {/* Priority Mode Selection */}
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                        âœ¨ Priority Mode - Choose Your Preference
                                    </label>
                                    <div className="text-xs text-gray-600 mb-4" style={{color: darkMode ? '#aaa' : '#666'}}>
                                        Click a mode below to activate it
                                    </div>

                                    {/* Clickable Mode Buttons */}
                                    <div className="priority-preview-grid">
                                        {/* OFF Button */}
                                        <button
                                            onClick={() => {
                                                setAutoPrioritize(false);
                                                localStorage.setItem('autoPrioritize', 'false');
                                                playNotificationSound();
                                            }}
                                            className={`priority-preview-card priority-preview-off ${!autoPrioritize ? 'priority-mode-active' : 'priority-mode-inactive'}`}
                                            style={{cursor: 'pointer', textAlign: 'left'}}
                                        >
                                            <div className="preview-label preview-label-off">Manual Priority</div>
                                            <div className="text-xs text-gray-600 mb-3" style={{color: darkMode ? '#aaa' : '#666'}}>
                                                Emails show in chronological order. Click "Prioritize" button to analyze.
                                            </div>
                                            <div className="space-y-2">
                                                <div style={{padding: '8px', background: darkMode ? 'rgba(60,60,60,0.5)' : 'rgba(200,200,200,0.3)', borderRadius: '8px', fontSize: '11px'}}>
                                                    ðŸ“§ Newsletter: Weekly Update
                                                </div>
                                                <div style={{padding: '8px', background: darkMode ? 'rgba(60,60,60,0.5)' : 'rgba(200,200,200,0.3)', borderRadius: '8px', fontSize: '11px'}}>
                                                    ðŸ“§ Friend: Let's catch up
                                                </div>
                                                <div style={{padding: '8px', background: darkMode ? 'rgba(60,60,60,0.5)' : 'rgba(200,200,200,0.3)', borderRadius: '8px', fontSize: '11px'}}>
                                                    ðŸ“§ URGENT: Meeting in 1 hour
                                                </div>
                                            </div>
                                            {!autoPrioritize && <div className="mode-checkmark">âœ“ Active</div>}
                                        </button>

                                        {/* ON Button */}
                                        <button
                                            onClick={() => {
                                                setAutoPrioritize(true);
                                                localStorage.setItem('autoPrioritize', 'true');
                                                playNotificationSound();
                                            }}
                                            className={`priority-preview-card priority-preview-on ${autoPrioritize ? 'priority-mode-active' : 'priority-mode-inactive'}`}
                                            style={{cursor: 'pointer', textAlign: 'left'}}
                                        >
                                            <div className="preview-label preview-label-on">Auto Priority</div>
                                            <div className="text-xs text-gray-600 mb-3" style={{color: darkMode ? '#a5b4fc' : '#6366f1'}}>
                                                AI automatically stacks urgent emails at the top of your inbox.
                                            </div>
                                            <div className="space-y-2">
                                                <div style={{padding: '8px', background: 'linear-gradient(135deg, rgba(99,102,241,0.2), rgba(139,92,246,0.2))', border: '2px solid rgba(99,102,241,0.4)', borderRadius: '8px', fontSize: '11px', fontWeight: 600}}>
                                                    âš¡ URGENT: Meeting in 1 hour
                                                </div>
                                                <div style={{padding: '8px', background: darkMode ? 'rgba(60,60,60,0.5)' : 'rgba(200,200,200,0.3)', borderRadius: '8px', fontSize: '11px'}}>
                                                    ðŸ“§ Friend: Let's catch up
                                                </div>
                                                <div style={{padding: '8px', background: darkMode ? 'rgba(60,60,60,0.5)' : 'rgba(200,200,200,0.3)', borderRadius: '8px', fontSize: '11px'}}>
                                                    ðŸ“§ Newsletter: Weekly Update
                                                </div>
                                            </div>
                                            {autoPrioritize && <div className="mode-checkmark">âœ“ Active</div>}
                                        </button>
                                    </div>
                                </div>

                                {/* Email Connection Section */}
                                <div className="pt-6 border-t border-gray-300">
                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                        ðŸ“§ Email Connection
                                    </label>
                                    <p className="text-xs text-gray-600 mb-4">
                                        Connect your Gmail to access and transform your messages
                                    </p>

                                    {!emailConnected ? (
                                        <button
                                            onClick={handleGmailConnect}
                                            className="w-full px-6 py-3 glass-effect rounded-full font-medium transition-all oval-button flex items-center justify-center gap-3 unified-button border-2 border-white text-gray-800"
                                        >
                                            <svg className="gmail-icon gmail-connecting" viewBox="0 0 24 24" fill="#4285F4">
                                                <path d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.73L12 16.64l-6.545-4.91v9.273H1.636A1.636 1.636 0 0 1 0 19.366V5.457c0-2.023 2.309-3.178 3.927-1.964L12 9.545l8.073-6.052C21.69 2.28 24 3.434 24 5.457z"/>
                                            </svg>
                                            Connect Gmail
                                        </button>
                                    ) : (
                                        <div className="flex items-center justify-between glass-dark px-4 py-3 rounded-xl">
                                            <div className="flex items-center gap-3">
                                                <svg className="gmail-icon gmail-connected" viewBox="0 0 24 24" fill="#10b981">
                                                    <path d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.73L12 16.64l-6.545-4.91v9.273H1.636A1.636 1.636 0 0 1 0 19.366V5.457c0-2.023 2.309-3.178 3.927-1.964L12 9.545l8.073-6.052C21.69 2.28 24 3.434 24 5.457z"/>
                                                </svg>
                                                <div className="flex flex-col">
                                                    <span className="text-sm font-medium text-gray-700">Connected to Gmail</span>
                                                    {userEmail && <span className="text-xs text-gray-600 mt-1">{userEmail}</span>}
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => {
                                                    setEmailConnected(false);
                                                    localStorage.removeItem('emailConnected');
                                                    localStorage.removeItem('gmailTokens');
                                                    localStorage.removeItem('userEmail');
                                                    setGmailEmails([]);
                                                    setSentEmails([]);
                                                    setUserEmail('');
                                                    console.log('ðŸ“§ Gmail disconnected');
                                                }}
                                                className="px-4 py-2 glass-effect rounded-full text-red-600 hover:text-red-700 text-xs font-medium transition-all unified-button border-2 border-white"
                                            >
                                                Disconnect
                                            </button>
                                        </div>
                                    )}
                                </div>

                                {/* Outlook Connection */}
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                        ðŸ“® Outlook Connection
                                    </label>
                                    <p className="text-xs text-gray-600 mb-4">
                                        Connect your Outlook to access and transform your messages
                                    </p>

                                    {!outlookConnected ? (
                                        <button
                                            onClick={() => {
                                                // Show bottom notification
                                                setBottomNotificationText('ðŸ“® Outlook connection feature coming soon!');
                                                setShowBottomNotification(true);
                                                setTimeout(() => {
                                                    setShowBottomNotification(false);
                                                }, 3000);
                                            }}
                                            className="w-full px-6 py-3 glass-effect rounded-full font-medium transition-all oval-button flex items-center justify-center gap-3 unified-button border-2 border-white text-gray-800"
                                        >
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="#0078D4">
                                                <path d="M23 7.5v9c0 .8-.7 1.5-1.5 1.5h-9L6 12l6.5-6h9c.8 0 1.5.7 1.5 1.5zM11 6L5 11h6l6-5z"/>
                                                <path d="M1 8.5v7c0 .8.7 1.5 1.5 1.5h8L5 11 10.5 6h-8c-.8 0-1.5.7-1.5 1.5z" fill="#0078D4"/>
                                            </svg>
                                            Connect Outlook
                                        </button>
                                    ) : (
                                        <div className="flex items-center justify-between glass-dark px-4 py-3 rounded-xl">
                                            <div className="flex items-center gap-3">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="#10b981">
                                                    <path d="M23 7.5v9c0 .8-.7 1.5-1.5 1.5h-9L6 12l6.5-6h9c.8 0 1.5.7 1.5 1.5zM11 6L5 11h6l6-5z"/>
                                                    <path d="M1 8.5v7c0 .8.7 1.5 1.5 1.5h8L5 11 10.5 6h-8c-.8 0-1.5.7-1.5 1.5z" fill="#10b981"/>
                                                </svg>
                                                <div className="flex flex-col">
                                                    <span className="text-sm font-medium text-gray-700">Connected to Outlook</span>
                                                    <span className="text-xs text-gray-600 mt-1">outlook@example.com</span>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => {
                                                    setOutlookConnected(false);
                                                    localStorage.removeItem('outlookConnected');
                                                    setOutlookEmails([]);
                                                    console.log('ðŸ“® Outlook disconnected');
                                                }}
                                                className="px-4 py-2 glass-effect rounded-full text-red-600 hover:text-red-700 text-xs font-medium transition-all unified-button border-2 border-white"
                                            >
                                                Disconnect
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const handleSummarizeEmail = async (email) => {
                console.log('âœ¨ Summarizing email:', email.subject);
                setSummarizingEmail(email.id);
                setIsSummarizing(true);
                setSummaryText('');
                setSummaryHidden(false);

                try {
                    const summary = await callAIAPI('Summarize this email concisely in 2-3 sentences', email.snippet);
                    setSummaryText(summary);
                    setIsSummarizing(false);

                    // Animate summary text with wave effect
                    setTimeout(() => {
                        const summaryElement = document.getElementById(`summary-text-${email.id}`);
                        if (summaryElement) {
                            summaryElement.innerHTML = '';
                            const words = summary.split(' ');
                            words.forEach((word, index) => {
                                const wordSpan = document.createElement('span');
                                wordSpan.className = 'wave-char';
                                wordSpan.textContent = word;
                                wordSpan.style.animationDelay = `${index * 0.02}s`;
                                summaryElement.appendChild(wordSpan);

                                if (index < words.length - 1) {
                                    const space = document.createTextNode(' ');
                                    summaryElement.appendChild(space);
                                }
                            });
                        }
                    }, 50);
                } catch (error) {
                    console.error('Error summarizing:', error);
                    setSummaryText('Failed to summarize email');
                    setIsSummarizing(false);
                }
            };

            const handleDeleteEmail = (emailId, type = 'inbox') => {
                playNotificationSound();

                // Find the email being deleted
                const emailToDelete = type === 'inbox'
                    ? gmailEmails.find(e => e.id === emailId)
                    : sentEmails.find(e => e.id === emailId);

                // Store deleted email for undo
                setDeletedEmail({ email: emailToDelete, type });
                setShowUndoDelete(true);

                // Add to permanent deleted list
                setDeletedEmails(prev => [...prev, emailId]);

                // Set deleting animation
                setDeletingEmailId(emailId);

                // Delete with animation
                setTimeout(() => {
                    if (type === 'inbox') {
                        setGmailEmails(prev => prev.filter(e => e.id !== emailId));
                    } else {
                        setSentEmails(prev => prev.filter(e => e.id !== emailId));
                    }
                    setDeletingEmailId(null);
                    console.log(`ðŸ—‘ï¸ Deleted ${type} email:`, emailId);
                }, 400); // Match animation duration
            };

            const handleUndoDelete = () => {
                if (deletedEmail) {
                    playNotificationSound();

                    // Remove from deleted emails list
                    setDeletedEmails(prev => prev.filter(id => id !== deletedEmail.email.id));

                    if (deletedEmail.type === 'inbox') {
                        setGmailEmails(prev => [deletedEmail.email, ...prev]);
                    } else {
                        setSentEmails(prev => [deletedEmail.email, ...prev]);
                    }
                    setShowUndoDelete(false);
                    setDeletedEmail(null);
                    console.log('â†©ï¸ Undid delete');
                }
            };

            const handleRefreshEmails = async () => {
                if (isRefreshing) return;

                setIsRefreshing(true);
                playNotificationSound();

                try {
                    const savedTokens = localStorage.getItem('gmailTokens');
                    if (savedTokens) {
                        const tokens = JSON.parse(savedTokens);
                        console.log('ðŸ”„ Refreshing emails...');
                        await fetchGmailEmails(tokens.access_token);
                        await fetchSentEmails(tokens.access_token);
                        console.log('âœ… Emails refreshed!');
                    }
                } catch (error) {
                    console.error('âŒ Error refreshing emails:', error);
                } finally {
                    setTimeout(() => setIsRefreshing(false), 1000); // Keep spinning for smooth UX
                }
            };

            const handleDeleteSelected = (type = 'inbox') => {
                if (selectedEmails.length === 0) return;
                playNotificationSound();

                if (type === 'inbox') {
                    // Track deleted email IDs
                    setLocallyDeletedEmailIds(prev => {
                        const updated = new Set(prev);
                        selectedEmails.forEach(id => updated.add(id));
                        return updated;
                    });
                    setGmailEmails(prev => prev.filter(e => !selectedEmails.includes(e.id)));
                } else {
                    setSentEmails(prev => prev.filter(e => !selectedEmails.includes(e.id)));
                }
                setSelectedEmails([]);
                console.log(`ðŸ—‘ï¸ Deleted ${selectedEmails.length} emails`);
            };

            const handleDeleteAll = (type = 'inbox') => {
                playNotificationSound();
                const confirmDelete = confirm(`Are you sure you want to delete all ${type} emails?`);
                if (confirmDelete) {
                    if (type === 'inbox') {
                        // Track all deleted email IDs
                        setLocallyDeletedEmailIds(prev => {
                            const updated = new Set(prev);
                            gmailEmails.forEach(e => updated.add(e.id));
                            return updated;
                        });
                        setGmailEmails([]);
                    } else {
                        setSentEmails([]);
                    }
                    console.log(`ðŸ—‘ï¸ Deleted all ${type} emails`);
                }
            };

            const toggleEmailSelection = (emailId) => {
                setSelectedEmails(prev => {
                    if (prev.includes(emailId)) {
                        return prev.filter(id => id !== emailId);
                    } else {
                        return [...prev, emailId];
                    }
                });
            };

            const handlePrioritizeEmails = async () => {
                if (gmailEmails.length === 0) return;

                playNotificationSound();
                setIsPrioritizing(true);
                setEmailsPrioritized(false);

                try {
                    // Simple AI-based priority detection using keywords and patterns
                    const analyzePriority = (email) => {
                        let score = 0;
                        const subjectLower = email.subject.toLowerCase();
                        const snippetLower = email.snippet.toLowerCase();

                        // Urgent keywords
                        if (subjectLower.match(/urgent|asap|important|critical|emergency|priority/)) score += 10;
                        if (snippetLower.match(/urgent|asap|important|critical|emergency|priority/)) score += 5;

                        // Action required
                        if (subjectLower.match(/action required|respond|reply|feedback|review/)) score += 7;
                        if (snippetLower.match(/action required|respond|reply|feedback|review/)) score += 3;

                        // Time-sensitive
                        if (subjectLower.match(/today|tomorrow|deadline|due|meeting/)) score += 8;
                        if (snippetLower.match(/today|tomorrow|deadline|due|meeting/)) score += 4;

                        // Question marks (usually need response)
                        if (subjectLower.includes('?')) score += 5;

                        // Sender patterns (you can enhance this)
                        if (email.from.match(/boss|ceo|manager|director/i)) score += 6;

                        // Boost recent emails slightly
                        const emailDate = new Date(email.internalDate);
                        const hoursSinceReceived = (Date.now() - emailDate) / (1000 * 60 * 60);
                        if (hoursSinceReceived < 24) score += 2;

                        return score;
                    };

                    // Wait for wave animation
                    setTimeout(() => {
                        // Analyze and score all emails
                        const scoredEmails = gmailEmails.map(email => ({
                            ...email,
                            priorityScore: analyzePriority(email)
                        }));

                        // Sort by priority score
                        scoredEmails.sort((a, b) => b.priorityScore - a.priorityScore);

                        // Determine how many emails to prioritize
                        let numToPrioritize;
                        if (gmailEmails.length <= 2) {
                            // If 2 or fewer emails, don't prioritize any (show them normally)
                            numToPrioritize = 0;
                        } else if (gmailEmails.length <= 5) {
                            // If 3-5 emails, prioritize top 2-3
                            numToPrioritize = Math.min(3, Math.floor(gmailEmails.length * 0.6));
                        } else {
                            // For 6+ emails, prioritize top 3-5 with score >= threshold
                            const priorityThreshold = 5;
                            const highScoreEmails = scoredEmails.filter(e => e.priorityScore >= priorityThreshold);
                            numToPrioritize = Math.min(5, Math.max(highScoreEmails.length, 3));
                        }

                        const priority = scoredEmails.slice(0, numToPrioritize);
                        const regular = scoredEmails.slice(numToPrioritize);

                        setPriorityEmails(priority);
                        setGmailEmails([...priority, ...regular]);

                        setIsPrioritizing(false);
                        setEmailsPrioritized(true);

                        // Trigger priority glow effect (once)
                        if (priority.length > 0) {
                            setShowPriorityGlow(true);
                            setTimeout(() => setShowPriorityGlow(false), 2000);
                        }

                        // Reset prioritized flag after animation
                        setTimeout(() => setEmailsPrioritized(false), 2000);
                    }, 3000);

                } catch (error) {
                    console.error('Error prioritizing emails:', error);
                    setIsPrioritizing(false);
                }
            };

            const handleRewriteReply = async () => {
                if (!emailReply || !replyPrompt) return;

                setIsRewritingReply(true);
                playNotificationSound();

                try {
                    // Check if user wants email structure
                    const needsStructure = replyPrompt.toLowerCase().includes('structure') ||
                                         replyPrompt.toLowerCase().includes('format') ||
                                         emailReply.match(/^(Hi|Hello|Hey|Dear)/i) === null;

                    let finalPrompt = replyPrompt;
                    if (needsStructure) {
                        finalPrompt += ' Make sure to format it as a proper email with greeting, body, and closing.';
                    }

                    const response = await fetch('/api/transform', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            prompt: finalPrompt,
                            text: emailReply,
                            temperature: 0.7
                        })
                    });

                    const data = await response.json();

                    if (data.result) {
                        setEmailReply(data.result);
                        setReplyPrompt('');
                    }

                    setIsRewritingReply(false);
                } catch (error) {
                    console.error('Error rewriting reply:', error);
                    setIsRewritingReply(false);
                }
            };

            const renderInbox = () => {
                return (
                    <div className="space-y-6">
                        <div className="glass-effect rounded-3xl p-8 ai-glow">
                            {/* Header with Actions */}
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-3xl font-bold text-gray-800">ðŸ“¥ Inbox</h2>
                                <div className="flex gap-3">
                                    <button
                                        onClick={handleRefreshEmails}
                                        disabled={isRefreshing}
                                        className={`oval-button px-4 py-2 text-sm font-semibold glass-effect border-2 border-white unified-button text-gray-800 ${isRefreshing ? 'opacity-50 cursor-not-allowed' : ''}`}
                                        title="Refresh emails"
                                    >
                                        <span className={isRefreshing ? 'refresh-spinning' : ''} style={{display: 'inline-block'}}>
                                            ðŸ”„
                                        </span>
                                        {isRefreshing ? ' Refreshing...' : ' Refresh'}
                                    </button>
                                    {gmailEmails.length > 0 && (
                                        <>
                                            {!autoPrioritize && (
                                                <button
                                                    onClick={() => handlePrioritizeEmails()}
                                                    disabled={isPrioritizing}
                                                    className={`oval-button px-4 py-2 text-sm font-semibold glass-effect border-2 border-white unified-button text-gray-800 ${isPrioritizing ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                >
                                                    {isPrioritizing ? 'ðŸ¤– Prioritizing...' : 'âœ¨ Prioritize Emails'}
                                                </button>
                                            )}
                                            {selectedEmails.length > 0 && (
                                                <button
                                                    onClick={() => handleDeleteSelected('inbox')}
                                                    className="oval-button px-4 py-2 text-sm font-semibold text-white bg-red-500 hover:bg-red-600"
                                                >
                                                    ðŸ—‘ï¸ Delete Selected ({selectedEmails.length})
                                                </button>
                                            )}
                                            <button
                                                onClick={() => handleDeleteAll('inbox')}
                                                className="oval-button px-4 py-2 text-sm font-semibold text-white bg-red-500 hover:bg-red-600"
                                            >
                                                ðŸ—‘ï¸ Delete All
                                            </button>
                                        </>
                                    )}
                                </div>
                            </div>

                            {/* Prioritizing Wave Animation */}
                            {isPrioritizing && (
                                <div className="prioritize-wave mb-6">
                                    <span>ðŸ¤– AI is analyzing and prioritizing your emails...</span>
                                </div>
                            )}

                            {/* Priority Emails - Stacked only if more than 2 */}
                            {priorityEmails.length > 2 && !isPrioritizing && autoPrioritize && (
                                <div className={`priority-container ${showPriorityGlow ? 'priority-fade-glow' : ''}`}>
                                    <div
                                        className="priority-header"
                                        onClick={() => setIsPriorityExpanded(!isPriorityExpanded)}
                                    >
                                        <div className="flex items-center gap-3">
                                            <span>âš¡ Priority Emails</span>
                                            <div className="priority-badge">
                                                {priorityEmails.length} emails
                                            </div>
                                        </div>
                                        <span className="text-2xl" style={{transition: 'transform 0.3s', transform: isPriorityExpanded ? 'rotate(180deg)' : 'rotate(0)'}}>
                                            â†“
                                        </span>
                                    </div>

                                    <div className={isPriorityExpanded ? 'priority-stack-expanded' : 'priority-stack'}>
                                        {priorityEmails.map((email, index) => (
                                            <div
                                                key={email.id}
                                                onClick={() => {
                                                    setViewingEmail(email);
                                                    // Mark email as read when clicked
                                                    if (unreadEmails.has(email.id)) {
                                                        setUnreadEmails(prev => {
                                                            const updated = new Set(prev);
                                                            updated.delete(email.id);
                                                            return updated;
                                                        });
                                                    }
                                                }}
                                                className={`priority-email-stacked cursor-pointer ${unreadEmails.has(email.id) ? 'unread-email' : ''} ${deletingEmailId === email.id ? 'email-deleting' : ''}`}
                                            >
                                                {/* Unread Label for Priority Emails */}
                                                {unreadEmails.has(email.id) && isPriorityExpanded && (
                                                    <div className="unread-label">
                                                        UNREAD
                                                    </div>
                                                )}
                                                <div className="flex justify-between items-start">
                                                    <div className="flex-1">
                                                        <div className="text-sm font-bold text-gray-800 mb-1">{email.from}</div>
                                                        <div className="text-base font-semibold text-gray-700 mb-1">{email.subject}</div>
                                                        {isPriorityExpanded && (
                                                            <div className="text-sm text-gray-600 mt-2">{email.snippet.substring(0, 100)}...</div>
                                                        )}
                                                    </div>
                                                    {isPriorityExpanded && (
                                                        <div className="flex gap-2 ml-4">
                                                            <button
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    handleSummarizeEmail(email);
                                                                }}
                                                                className="px-3 py-1 text-xs font-semibold rounded-full unified-button border-2 border-white glass-effect text-gray-800"
                                                            >
                                                                Summarize
                                                            </button>
                                                            <button
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    handleDeleteEmail(email.id, 'inbox');
                                                                }}
                                                                className="px-3 py-1 text-xs font-semibold text-white bg-red-500 rounded-full"
                                                            >
                                                                Delete
                                                            </button>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Inbox Section Title - Only show when emails are stacked */}
                            {priorityEmails.length > 2 && autoPrioritize && (
                                <div className="inbox-section-title" style={{
                                    marginTop: '32px',
                                    marginBottom: '16px',
                                    paddingBottom: '12px',
                                    borderBottom: '2px solid rgba(99, 102, 241, 0.2)',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '12px'
                                }}>
                                    <h3 className="text-xl font-bold text-gray-700" style={{color: darkMode ? '#e5e5e5' : '#374151'}}>
                                        ðŸ“¬ Inbox
                                    </h3>
                                    <span className="text-sm text-gray-500" style={{color: darkMode ? '#a0a0a0' : '#6b7280'}}>
                                        {gmailEmails.filter(email => !priorityEmails.find(p => p.id === email.id)).length} emails
                                    </span>
                                </div>
                            )}

                            <div className="space-y-3" style={{
                                transition: 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)',
                                transform: isPriorityExpanded ? 'translateY(0)' : 'translateY(0)'
                            }}>
                                {gmailEmails.length > 0 ? (
                                    gmailEmails.filter(email => (autoPrioritize && priorityEmails.length > 2) ? !priorityEmails.find(p => p.id === email.id) : true).map((email, index) => (
                                        <div
                                            key={email.id}
                                            data-email-id={email.id}
                                            onClick={() => {
                                                setViewingEmail(email);
                                                // Mark email as read when clicked
                                                if (unreadEmails.has(email.id)) {
                                                    setUnreadEmails(prev => {
                                                        const updated = new Set(prev);
                                                        updated.delete(email.id);
                                                        return updated;
                                                    });
                                                }
                                            }}
                                            className={`modern-email-item email-ladder-animation ${emailsPrioritized && index < 3 ? 'email-slide-up' : ''} ${unreadEmails.has(email.id) ? 'unread-email' : ''} ${deletingEmailId === email.id ? 'email-deleting' : ''}`}
                                            style={{animationDelay: `${index * 0.05}s`}}
                                        >
                                            {/* Unread Label */}
                                            {unreadEmails.has(email.id) && (
                                                <div className="unread-label">
                                                    UNREAD
                                                </div>
                                            )}

                                            {/* Checkbox for Selection */}
                                            <div
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    toggleEmailSelection(email.id);
                                                }}
                                                className={`email-checkbox ${selectedEmails.includes(email.id) ? 'checked' : ''}`}
                                                style={{
                                                    position: 'absolute',
                                                    left: '16px',
                                                    top: '16px'
                                                }}
                                            >
                                                {selectedEmails.includes(email.id) && <span style={{color: 'white', fontSize: '12px'}}>âœ“</span>}
                                            </div>

                                            <div className="email-hover-buttons">
                                                <button
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        handleSummarizeEmail(email);
                                                    }}
                                                    className="email-hover-btn unified-button border-2 border-white glass-effect text-gray-800"
                                                >
                                                    Summarize
                                                </button>
                                                <button
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        setViewingEmail(email);
                                                        setTimeout(() => {
                                                            setEmailReply('');
                                                        }, 300);
                                                    }}
                                                    className="email-hover-btn"
                                                >
                                                    Reply
                                                </button>
                                                <button
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        handleDeleteEmail(email.id, 'inbox');
                                                    }}
                                                    className="email-hover-btn"
                                                    style={{
                                                        background: 'rgba(239, 68, 68, 0.9)',
                                                        color: 'white',
                                                        border: 'none'
                                                    }}
                                                >
                                                    Delete
                                                </button>
                                            </div>

                                            <div style={{marginLeft: '40px'}}>
                                                <div className="flex justify-between items-start mb-2">
                                                    <span className="text-sm font-bold text-gray-800">{email.from}</span>
                                                    <span className="text-xs text-gray-500">{email.date}</span>
                                                </div>
                                                <div className="text-base font-semibold text-gray-700 mb-2">{email.subject}</div>
                                                <div className="text-sm text-gray-600 email-content-formatted">{email.snippet}</div>
                                            </div>

                                            {/* Summarize Popup */}
                                            {summarizingEmail === email.id && (
                                                <div className="summary-popup" onClick={(e) => e.stopPropagation()}>
                                                    {isSummarizing ? (
                                                        <div className="space-y-3">
                                                            <div className="flex items-center gap-3 mb-3">
                                                                <div className="animate-spin rounded-full h-5 w-5 border-2 border-indigo-600 border-t-transparent"></div>
                                                                <span className="text-sm text-gray-700 font-medium">Summarizing...</span>
                                                            </div>
                                                            {/* Wave loading animation */}
                                                            <div className="space-y-2">
                                                                <div className="loading-line" style={{height: '8px'}}></div>
                                                                <div className="loading-line" style={{height: '8px'}}></div>
                                                                <div className="loading-line" style={{height: '8px'}}></div>
                                                            </div>
                                                        </div>
                                                    ) : (
                                                        <div>
                                                            <div className="flex justify-between items-center mb-2">
                                                                <span className="text-sm font-bold text-indigo-600">âœ¨ Summary</span>
                                                                <button
                                                                    onClick={() => {
                                                                        if (summaryHidden) {
                                                                            setSummaryHidden(false);
                                                                        } else {
                                                                            setSummaryHidden(true);
                                                                        }
                                                                    }}
                                                                    className="text-xs text-indigo-600 hover:text-indigo-800 font-semibold"
                                                                >
                                                                    {summaryHidden ? 'Show' : 'Hide'}
                                                                </button>
                                                            </div>
                                                            {!summaryHidden && (
                                                                <p id={`summary-text-${email.id}`} className="text-sm text-gray-700 leading-relaxed">{summaryText}</p>
                                                            )}
                                                        </div>
                                                    )}
                                                </div>
                                            )}
                                        </div>
                                    ))
                                ) : (
                                    <div className="text-center py-12 text-gray-500">
                                        <div className="text-6xl mb-4">ðŸ“­</div>
                                        <p>No emails in inbox</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            const renderSent = () => {
                return (
                    <div className="space-y-6">
                        <div className="glass-effect rounded-3xl p-8 ai-glow">
                            {/* Header with Actions */}
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-3xl font-bold text-gray-800">ðŸ“¤ Sent</h2>
                                <div className="flex gap-3">
                                    {sentEmails.length > 0 && (
                                        <>
                                            {selectedEmails.length > 0 && (
                                                <button
                                                    onClick={() => handleDeleteSelected('sent')}
                                                    className="oval-button px-4 py-2 text-sm font-semibold text-white bg-red-500 hover:bg-red-600"
                                                >
                                                    ðŸ—‘ï¸ Delete Selected ({selectedEmails.length})
                                                </button>
                                            )}
                                            <button
                                                onClick={() => handleDeleteAll('sent')}
                                                className="oval-button px-4 py-2 text-sm font-semibold text-white bg-red-500 hover:bg-red-600"
                                            >
                                                ðŸ—‘ï¸ Delete All
                                            </button>
                                        </>
                                    )}
                                </div>
                            </div>

                            <div className="space-y-3">
                                {sentEmails.length > 0 ? (
                                    sentEmails.map((email, index) => (
                                        <div
                                            key={email.id}
                                            data-email-id={email.id}
                                            className="email-item email-ladder-animation glass-dark px-6 py-4 rounded-2xl relative hover:shadow-lg transition-all"
                                            style={{animationDelay: `${index * 0.05}s`}}
                                        >
                                            {/* Checkbox for Selection */}
                                            <div
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    toggleEmailSelection(email.id);
                                                }}
                                                className={`email-checkbox ${selectedEmails.includes(email.id) ? 'checked' : ''}`}
                                                style={{
                                                    position: 'absolute',
                                                    left: '16px',
                                                    top: '16px'
                                                }}
                                            >
                                                {selectedEmails.includes(email.id) && <span style={{color: 'white', fontSize: '12px'}}>âœ“</span>}
                                            </div>

                                            {/* Delete Button on Hover */}
                                            <div className="email-hover-buttons">
                                                <button
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        handleDeleteEmail(email.id, 'sent');
                                                    }}
                                                    className="email-hover-btn"
                                                    style={{
                                                        background: 'rgba(239, 68, 68, 0.9)',
                                                        color: 'white',
                                                        border: 'none'
                                                    }}
                                                >
                                                    Delete
                                                </button>
                                            </div>

                                            <div style={{marginLeft: '40px'}}>
                                                <div className="flex justify-between items-start mb-2">
                                                    <span className="text-sm font-bold text-gray-800">To: {email.to}</span>
                                                    <span className="text-xs text-gray-500">{email.date}</span>
                                                </div>
                                                <div className="text-base font-semibold text-gray-700 mb-2">{email.subject}</div>
                                                <div className="text-sm text-gray-600 email-content-formatted">{email.snippet}</div>
                                            </div>
                                        </div>
                                    ))
                                ) : (
                                    <div className="text-center py-12 text-gray-500">
                                        <div className="text-6xl mb-4">ðŸ“­</div>
                                        <p>No sent emails</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            const renderWriterContent = () => {
                switch(activeTab) {
                    case 'email':
                        return (
                            <div className="space-y-6 fade-in">
                                {/* Current Tool Indicator */}
                                <div className="glass-dark rounded-full px-4 py-2 inline-flex items-center gap-2">
                                    <span className="text-xl">âœ‰ï¸</span>
                                    <span className="text-sm font-semibold text-gray-700">Email Rewriter</span>
                                </div>

                                {/* File Upload or Text Area */}
                                <div className="relative">
                                    <div className="flex items-center justify-between mb-3">
                                        <label className="text-sm font-medium text-gray-700 flex items-center">
                                            <span className="text-lg mr-2">âœï¸</span>
                                            Paste your email content
                                        </label>
                                        <label className="px-4 py-2 glass-effect rounded-full text-gray-700 text-xs font-medium hover:bg-white/90 transition-all cursor-pointer border-2 border-white unified-button">
                                            <span>ðŸ“Ž Upload File</span>
                                            <input type="file" accept=".txt,.eml" onChange={handleFileUpload} className="hidden" />
                                        </label>
                                    </div>

                                    {droppedEmailFile ? (
                                        <div
                                            className="email-file-attachment"
                                            onClick={() => {
                                                setViewingEmail(droppedEmailFile);
                                                setDroppedEmailFile(null);
                                            }}
                                        >
                                            <div className="email-file-icon">ðŸ“§</div>
                                            <div className="email-file-info">
                                                <div className="email-file-title">{droppedEmailFile.subject}</div>
                                                <div className="email-file-subtitle">From: {droppedEmailFile.from} â€¢ Click to view full email</div>
                                            </div>
                                            <button
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    setDroppedEmailFile(null);
                                                }}
                                                className="px-3 py-1 glass-effect rounded-full text-xs text-red-600 hover:bg-white/90 unified-button border-2 border-white"
                                            >
                                                âœ• Remove
                                            </button>
                                        </div>
                                    ) : uploadedFile ? (
                                        <div className="glass-dark rounded-2xl p-4 mb-4">
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center gap-3">
                                                    <span className="text-3xl">ðŸ“„</span>
                                                    <div>
                                                        <div className="text-sm font-semibold text-gray-800">{uploadedFile.name}</div>
                                                        <div className="text-xs text-gray-600">{(uploadedFile.size / 1024).toFixed(2)} KB</div>
                                                    </div>
                                                </div>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => setViewingFile(uploadedFile)}
                                                        className="px-3 py-1 glass-effect rounded-full text-xs text-gray-700 hover:bg-white/90"
                                                    >
                                                        ðŸ‘ï¸ View
                                                    </button>
                                                    <button
                                                        onClick={() => setUploadedFile(null)}
                                                        className="px-3 py-1 glass-effect rounded-full text-xs text-red-600 hover:bg-white/90"
                                                    >
                                                        âœ• Remove
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    ) : (
                                        <textarea
                                            value={emailText}
                                            onChange={(e) => setEmailText(e.target.value)}
                                            className="w-full h-80 px-6 py-4 custom-textarea rounded-2xl text-gray-800 placeholder-gray-500 resize-none border-2 border-white unified-button"
                                            placeholder="Type or paste your email content here and watch the magic happen..."
                                            disabled={droppedEmailFile !== null}
                                        />
                                    )}
                                </div>

                                {/* Custom Transformation + Suggestions */}
                                <div className="pt-4 border-t border-gray-300 space-y-4">
                                    {/* General Suggestions */}
                                    {showSuggestions && (
                                        <div style={{position: 'relative'}}>
                                            <label className="text-sm font-medium text-gray-700 flex items-center mb-2">
                                                <span className="text-lg mr-2">ðŸ’¡</span>
                                                Quick Actions
                                            </label>
                                            {showIndicator && (
                                                <div className="suggestion-indicator">
                                                    <span className="suggestion-indicator-icon">ðŸ‘†</span>
                                                    Use mouse wheel to scroll
                                                </div>
                                            )}
                                            <div className="suggestion-carousel-container" ref={carouselRef}>
                                                <div className="suggestion-carousel">
                                                    <div
                                                        className="suggestion-carousel-track"
                                                        style={{
                                                            transform: `translateX(-${currentSuggestionIndex * 100}%)`
                                                        }}
                                                    >
                                                        {generalSuggestions.map((suggestion) => (
                                                            <div
                                                                key={suggestion.id}
                                                                className="suggestion-carousel-item"
                                                                onClick={() => setCustomPrompt(suggestion.prompt)}
                                                            >
                                                                {suggestion.label}
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {/* Tone Suggestions */}
                                    <div className="flex items-center justify-between">
                                        <label className="text-sm font-medium text-gray-700 flex items-center">
                                            <span className="text-lg mr-2">ðŸŽ¨</span>
                                            Tone Styles
                                        </label>
                                        {showSuggestions && (
                                            <div className="suggestions-container flex gap-2 overflow-x-auto" style={{marginLeft: '-20px'}}>
                                                {emailStyles.map((style) => (
                                                    <button
                                                        key={style.id}
                                                        onClick={() => handleStyleClick(style.id)}
                                                        className={`suggestion-pill glass-effect font-medium hover:bg-white/90 oval-button px-4 py-1.5 rounded-full text-xs transition-all nav-tab ${
                                                            selectedTone === style.id
                                                                ? 'active text-gray-800 border-2 border-gray-300'
                                                                : 'text-gray-800 border border-indigo-300'
                                                        }`}
                                                    >
                                                        {style.label}
                                                    </button>
                                                ))}
                                            </div>
                                        )}
                                    </div>

                                    {/* Selected Tone Indicator */}
                                    {selectedTone && (
                                        <div className="suggestions-container glass-dark rounded-xl p-3 flex items-center gap-3">
                                            <span className="text-2xl">{emailStyles.find(s => s.id === selectedTone)?.label}</span>
                                            <div className="flex-1">
                                                <div className="text-xs text-gray-600 mb-1">Selected Tone</div>
                                                <div className="flex items-center gap-2">
                                                    <div className="h-1 flex-1 rounded-full" style={{background: '#3B82F6'}}></div>
                                                    <span className="text-xs text-gray-700">Connected to prompt</span>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => setSelectedTone(null)}
                                                className="text-gray-500 hover:text-red-600"
                                            >
                                                âœ•
                                            </button>
                                        </div>
                                    )}

                                    <div className="flex gap-3">
                                        <input
                                            type="text"
                                            value={customPrompt}
                                            onChange={(e) => setCustomPrompt(e.target.value)}
                                            className="flex-1 px-5 py-3 glass-effect border-2 border-white rounded-full text-gray-800 placeholder-gray-500 unified-button"
                                            placeholder="e.g., 'Make it more casual' or 'Add urgency'"
                                            onKeyPress={(e) => e.key === 'Enter' && handleGenerate()}
                                        />
                                        <button
                                            onClick={handleGenerate}
                                            disabled={(!emailText && !uploadedFile) || (!selectedTone && !customPrompt)}
                                            className="px-8 py-3 glass-effect rounded-full text-gray-800 font-medium hover:bg-white/90 transition-all oval-button border-2 border-white unified-button disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            âœ¨ Generate
                                        </button>
                                    </div>
                                </div>
                            </div>
                        );
                    
                    default:
                        return (
                            <div className="space-y-6 fade-in">
                                <div className="relative">
                                    <div className="flex items-start justify-between mb-3">
                                        <label className="text-sm font-medium text-gray-700 flex items-center">
                                            <span className="text-lg mr-2">ðŸ“„</span>
                                            Enter your text
                                        </label>
                                    </div>
                                    <textarea
                                        value={emailText}
                                        onChange={(e) => setEmailText(e.target.value)}
                                        className="w-full h-64 px-6 py-4 custom-textarea rounded-2xl text-gray-800 placeholder-gray-500 resize-none border-2 border-white unified-button"
                                        placeholder="Type or paste your content here..."
                                    />
                                </div>
                                <button
                                    onClick={handleToolProcess}
                                    className="w-full px-8 py-4 glass-effect rounded-full text-gray-800 font-semibold text-lg hover:bg-white/90 transition-all oval-button border-2 border-white unified-button"
                                >
                                    ðŸš€ Process with AI
                                </button>
                            </div>
                        );
                }
            };

            const renderResultsContent = () => {
                if (isProcessing) {
                    return (
                        <div className="flex flex-col justify-center items-start h-96 space-y-8 px-6">
                            <div className="w-full space-y-4">
                                <div className="text-left mb-6">
                                    <p className="text-gray-700 text-xl font-semibold mb-2">âœ¨ Generating with AI</p>
                                    <p className="text-gray-500 text-sm">Transforming your content...</p>
                                </div>
                                <div className="loading-lines">
                                    <div className="loading-line"></div>
                                    <div className="loading-line"></div>
                                    <div className="loading-line"></div>
                                    <div className="loading-line"></div>
                                    <div className="loading-line"></div>
                                    <div className="loading-line"></div>
                                </div>
                            </div>
                        </div>
                    );
                }

                // Show result
                if (result) {
                    return (
                        <div className="result-container px-6 py-4 relative">
                            <div className="relative">
                                {/* Action buttons at top-right */}
                                <div className="action-buttons">
                                    <button
                                        onClick={() => navigator.clipboard.writeText(result)}
                                        className="action-btn text-gray-700 hover:text-indigo-700"
                                    >
                                        Copy
                                    </button>
                                    <button
                                        onClick={handleRetry}
                                        className="action-btn text-gray-700 hover:text-purple-700"
                                    >
                                        Retry
                                    </button>
                                </div>
                                <div className="glass-dark rounded-2xl p-6">
                                    <pre id="result-text" className="text-gray-800 whitespace-pre-wrap font-sans leading-relaxed text-left text-base"></pre>
                                </div>
                            </div>
                        </div>
                    );
                }

                return (
                    <div className="flex flex-col items-center justify-center h-96 text-gray-500">
                        <div className="text-7xl mb-4 opacity-40">ðŸ¤–</div>
                        <p className="text-lg text-gray-700">Your AI-generated content will appear here</p>
                        <p className="text-sm mt-2">Use the Writer tab to create something amazing!</p>
                    </div>
                );
            };

            return (
                <div className="min-h-screen relative">
                    {/* Email Viewer Modal - iOS Style */}
                    {/* Old email viewer overlay - now only used for Sent page */}
                    {viewingEmail && !emailConnected && (
                        <div className="email-viewer-overlay" onClick={() => setViewingEmail(null)}>
                            <div className="email-viewer-container" onClick={(e) => e.stopPropagation()}>
                                {/* Header */}
                                <div className="p-6 border-b border-gray-200 flex items-center justify-between">
                                    <button
                                        onClick={() => setViewingEmail(null)}
                                        className="px-4 py-2 glass-effect rounded-full text-gray-700 text-sm font-medium hover:bg-white/90 transition-all unified-button border-2 border-white flex items-center gap-2"
                                    >
                                        <span>â†</span>
                                        <span>Back</span>
                                    </button>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => handleSummarizeEmail(viewingEmail)}
                                            className="px-4 py-2 rounded-full text-gray-800 text-sm font-medium hover:opacity-90 transition-all unified-button border-2 border-white glass-effect"
                                        >
                                            Summarize
                                        </button>
                                        <button
                                            onClick={() => {
                                                setEmailReply('');
                                                document.getElementById('reply-section')?.scrollIntoView({ behavior: 'smooth' });
                                            }}
                                            className="px-4 py-2 glass-effect rounded-full text-gray-700 text-sm font-medium hover:bg-white/90 transition-all unified-button border-2 border-white"
                                        >
                                            Reply
                                        </button>
                                    </div>
                                </div>

                                {/* Email Content */}
                                <div className="flex-1 overflow-y-auto p-6">
                                    <div className="mb-4">
                                        <h2 className="text-2xl font-bold text-gray-800 mb-3">{viewingEmail.subject}</h2>
                                        <div className="flex justify-between items-center mb-4">
                                            <div>
                                                <div className="text-sm font-semibold text-gray-700">From: {viewingEmail.from}</div>
                                                <div className="text-xs text-gray-500 mt-1">{viewingEmail.date}</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="prose max-w-none">
                                        <p className="text-gray-700 leading-relaxed email-content-formatted">{viewingEmail.snippet}</p>
                                    </div>

                                    {/* Summarize Popup in Viewer */}
                                    {summarizingEmail === viewingEmail.id && (
                                        <div className="summary-popup mt-4" style={{position: 'relative', top: 0, marginTop: '16px'}}>
                                            {isSummarizing ? (
                                                <div className="space-y-3">
                                                    <div className="flex items-center gap-3 mb-3">
                                                        <div className="animate-spin rounded-full h-5 w-5 border-2 border-indigo-600 border-t-transparent"></div>
                                                        <span className="text-sm text-gray-700 font-medium">Summarizing...</span>
                                                    </div>
                                                    {/* Wave loading animation */}
                                                    <div className="space-y-2">
                                                        <div className="loading-line" style={{height: '8px'}}></div>
                                                        <div className="loading-line" style={{height: '8px'}}></div>
                                                        <div className="loading-line" style={{height: '8px'}}></div>
                                                    </div>
                                                </div>
                                            ) : (
                                                <div>
                                                    <div className="flex justify-between items-center mb-2">
                                                        <span className="text-sm font-bold text-indigo-600">âœ¨ Summary</span>
                                                        <button
                                                            onClick={() => {
                                                                if (summaryHidden) {
                                                                    setSummaryHidden(false);
                                                                } else {
                                                                    setSummaryHidden(true);
                                                                }
                                                            }}
                                                            className="text-xs text-indigo-600 hover:text-indigo-800 font-semibold"
                                                        >
                                                            {summaryHidden ? 'Show' : 'Hide'}
                                                        </button>
                                                    </div>
                                                    {!summaryHidden && (
                                                        <p id={`summary-text-${viewingEmail.id}`} className="text-sm text-gray-700 leading-relaxed">{summaryText}</p>
                                                    )}
                                                </div>
                                            )}
                                        </div>
                                    )}

                                    {/* Reply Section */}
                                    <div id="reply-section" className="mt-8 pt-6 border-t border-gray-300">
                                        <h3 className="text-lg font-bold text-gray-800 mb-4">âœï¸ Write Reply</h3>

                                        {/* Textarea Container with Floating Send Button */}
                                        <div className="relative mb-4">
                                            <textarea
                                                value={emailReply}
                                                onChange={(e) => setEmailReply(e.target.value)}
                                                className="w-full h-48 px-6 py-4 pr-24 custom-textarea rounded-2xl text-gray-800 placeholder-gray-500 resize-none"
                                                placeholder="Type your reply here..."
                                            />

                                            {/* Floating Send Button */}
                                            {emailReply && emailReply.trim().length > 0 && (
                                                <button
                                                    onClick={handleSendEmail}
                                                    disabled={isSending}
                                                    className={isSending ? 'send-button-float send-button-sending' : 'send-button-float'}
                                                >
                                                    {isSending ? (
                                                        <>
                                                            <div className="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"></div>
                                                            <span>Sending...</span>
                                                        </>
                                                    ) : (
                                                        <>
                                                            <span>â†’</span>
                                                            <span>Send</span>
                                                        </>
                                                    )}
                                                </button>
                                            )}
                                        </div>

                                        {/* AI Transformation Container */}
                                        <div className="ai-transform-container">
                                            <input
                                                type="text"
                                                value={replyPrompt}
                                                onChange={(e) => setReplyPrompt(e.target.value)}
                                                className="ai-transform-input"
                                                placeholder="âœ¨ Rewrite with AI (e.g., 'Make it more professional', 'Add email structure')"
                                                onKeyPress={(e) => {
                                                    if (e.key === 'Enter' && replyPrompt && emailReply) {
                                                        handleRewriteReply();
                                                    }
                                                }}
                                            />
                                            <button
                                                onClick={handleRewriteReply}
                                                disabled={!replyPrompt || !emailReply || isRewritingReply}
                                                className="ai-transform-button"
                                            >
                                                {isRewritingReply ? 'âœ¨ Rewriting...' : 'Rewrite'}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* File Viewer Modal */}
                    {viewingFile && (
                        <div className="file-viewer-modal" onClick={() => setViewingFile(null)}>
                            <div className="file-viewer-content" onClick={(e) => e.stopPropagation()}>
                                <div className="p-6 border-b border-gray-200">
                                    <div className="flex items-center justify-between">
                                        <h2 className="text-xl font-bold text-gray-800">
                                            {viewingFile.name || 'Viewing Content'}
                                        </h2>
                                        <button
                                            onClick={() => setViewingFile(null)}
                                            className="text-gray-500 hover:text-gray-700 text-2xl"
                                        >
                                            âœ•
                                        </button>
                                    </div>
                                    {viewingFile.timestamp && (
                                        <p className="text-sm text-gray-500 mt-1">{viewingFile.timestamp}</p>
                                    )}
                                </div>
                                <div className="p-6 overflow-y-auto max-h-[60vh]">
                                    <pre className="text-gray-800 whitespace-pre-wrap font-sans leading-relaxed text-base">
                                        {viewingFile.content}
                                    </pre>
                                </div>
                                <div className="p-6 border-t border-gray-200 flex gap-3">
                                    <button
                                        onClick={() => {
                                            navigator.clipboard.writeText(viewingFile.content);
                                            alert('Copied to clipboard!');
                                        }}
                                        className="flex-1 px-6 py-3 glass-effect rounded-full text-gray-800 font-semibold hover:bg-white/90 transition-all oval-button border-2 border-indigo-400"
                                    >
                                        ðŸ“‹ Copy
                                    </button>
                                    <button
                                        onClick={() => setViewingFile(null)}
                                        className="px-6 py-3 glass-effect rounded-full text-gray-800 font-semibold hover:bg-white/90 transition-all oval-button border-2 border-gray-300"
                                    >
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* AI Floating Particles */}
                    <div className="ai-particle" style={{top: '20%', left: '10%', animationDelay: '0s'}}></div>
                    <div className="ai-particle" style={{top: '40%', right: '15%', animationDelay: '3s'}}></div>
                    <div className="ai-particle" style={{bottom: '30%', left: '20%', animationDelay: '6s'}}></div>
                    <div className="ai-particle" style={{top: '60%', right: '25%', animationDelay: '9s'}}></div>
                    <div className="ai-particle" style={{bottom: '20%', right: '10%', animationDelay: '12s'}}></div>

                    {/* Sticky Header */}
                    <header className="sticky-header">
                        <div className="container mx-auto px-4 py-4">
                            <div className="flex justify-center items-center" style={{position: 'relative'}}>
                                {/* Navigation Bar */}
                                <div className={`nav-container ${showSearchBar ? 'opacity-0 pointer-events-none' : 'opacity-100'}`} style={{transition: 'opacity 0.3s ease'}} ref={navRef}>
                                    <button
                                        onClick={() => setCurrentPage('home')}
                                        className={`px-6 py-2 rounded-full font-medium transition-all oval-button nav-tab ${
                                            currentPage === 'home'
                                                ? 'active text-gray-800'
                                                : 'glass-dark text-gray-700 hover:bg-white/70'
                                        }`}
                                    >
                                        Home
                                    </button>
                                {emailConnected && (
                                    <>
                                        <button
                                            onClick={() => setCurrentPage('sent')}
                                            className={`px-6 py-2 rounded-full font-medium transition-all oval-button nav-tab ${
                                                currentPage === 'sent'
                                                    ? 'active text-gray-800'
                                                    : 'glass-dark text-gray-700 hover:bg-white/70'
                                            }`}
                                        >
                                            Sent
                                        </button>
                                    </>
                                )}
                                    <button
                                        onClick={() => setCurrentPage('settings')}
                                        className={`px-6 py-2 rounded-full font-medium transition-all oval-button nav-tab ${
                                            currentPage === 'settings'
                                                ? 'active text-gray-800'
                                                : 'glass-dark text-gray-700 hover:bg-white/70'
                                        }`}
                                    >
                                        Settings
                                    </button>
                                </div>

                                {/* Search Bar (appears on swipe) */}
                                {currentPage === 'inbox' && (
                                    <div className={`nav-search-bar ${showSearchBar ? 'active' : ''}`} style={{position: 'absolute', width: '100%', maxWidth: '600px'}}>
                                        <div className="nav-container" style={{width: '100%'}}>
                                            <input
                                                type="text"
                                                value={searchQuery}
                                                onChange={(e) => setSearchQuery(e.target.value)}
                                                placeholder="ðŸ” Search emails..."
                                                className="nav-search-input unified-button"
                                                autoFocus={showSearchBar}
                                            />
                                            <button
                                                onClick={() => {
                                                    setShowSearchBar(false);
                                                    setSearchQuery('');
                                                    setSearchResults([]);
                                                }}
                                                className="px-4 py-2 glass-effect rounded-full text-gray-700 text-sm font-medium hover:bg-white/90 transition-all unified-button border-2 border-white"
                                                style={{marginLeft: '8px', whiteSpace: 'nowrap'}}
                                            >
                                                âœ•
                                            </button>
                                        </div>
                                        {searchResults.length > 0 && (
                                            <div className="nav-search-suggestions">
                                                {searchResults.map((email) => (
                                                    <div
                                                        key={email.id}
                                                        className="search-suggestion-item"
                                                        onClick={() => {
                                                            setViewingEmail(email);
                                                            setShowSearchBar(false);
                                                            setSearchQuery('');
                                                            setSearchResults([]);
                                                        }}
                                                    >
                                                        <div className="font-semibold text-sm text-gray-800">{email.subject}</div>
                                                        <div className="text-xs text-gray-600 mt-1">From: {email.from}</div>
                                                        <div className="text-xs text-gray-500 mt-1">{email.snippet.substring(0, 80)}...</div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                        </div>
                    </header>

                    <div className="page-container relative z-10 container mx-auto px-4 py-8 max-w-8xl">

                        {currentPage === 'settings' ? renderSettings() :
                         currentPage === 'sent' ? renderSent() : (
                            <>
                                {/* Animated Welcome Text */}
                                {showWelcomeAnimation && currentPage === 'home' && !emailConnected && (
                                    <div className={`welcome-text-container ${!showWelcomeAnimation ? 'fade-out' : ''}`}>
                                        <div className="welcome-text" key={currentWelcomeMessage}>
                                            {welcomeMessages[currentWelcomeMessage].split(' ').map((word, i) => (
                                                <span key={`${currentWelcomeMessage}-${i}`} style={{animationDelay: `${i * 0.08}s`}}>
                                                    {word}
                                                </span>
                                            ))}
                                            {userName && (
                                                <>
                                                    <span style={{animationDelay: `${welcomeMessages[currentWelcomeMessage].split(' ').length * 0.08}s`}}>
                                                        ,
                                                    </span>
                                                    <span style={{animationDelay: `${(welcomeMessages[currentWelcomeMessage].split(' ').length + 1) * 0.08}s`}}>
                                                        {userName}!
                                                    </span>
                                                </>
                                            )}
                                            <span className="typing-cursor" style={{animationDelay: `${(welcomeMessages[currentWelcomeMessage].split(' ').length + (userName ? 2 : 0)) * 0.08}s`}}></span>
                                        </div>
                                    </div>
                                )}

                                {/* Desktop Layout: Inbox Sidebar + Content Area */}
                                {emailConnected ? (
                                    <div className="desktop-inbox-layout">
                                        {/* Left Sidebar - Inbox */}
                                        <div className="inbox-sidebar">
                                            {/* Header with Title and Prioritize Button */}
                                            <div className="inbox-header">
                                                <div className="inbox-header-left">
                                                    <h2 className="text-2xl font-bold text-gray-800">ðŸ“¥ Inbox</h2>
                                                </div>
                                                <div className="inbox-header-right">
                                                    {gmailEmails.length > 0 && (
                                                        <button
                                                            onClick={() => handlePrioritizeEmails()}
                                                            disabled={isPrioritizing}
                                                            className={`oval-button px-4 py-2 text-sm font-semibold glass-effect border-2 border-white unified-button text-gray-800 ${isPrioritizing ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                        >
                                                            {isPrioritizing ? 'ðŸ¤– Prioritizing...' : 'âœ¨ Prioritize'}
                                                        </button>
                                                    )}
                                                </div>
                                            </div>

                                            {/* Search Bar */}
                                            <div style={{position: 'relative'}}>
                                                <input
                                                    type="text"
                                                    value={inboxSearchQuery}
                                                    onChange={(e) => {
                                                        setInboxSearchQuery(e.target.value);
                                                        if (e.target.value) {
                                                            const results = gmailEmails.filter(email =>
                                                                email.subject.toLowerCase().includes(e.target.value.toLowerCase()) ||
                                                                email.from.toLowerCase().includes(e.target.value.toLowerCase()) ||
                                                                email.snippet.toLowerCase().includes(e.target.value.toLowerCase())
                                                            ).slice(0, 5);
                                                            setInboxSearchResults(results);
                                                            setShowInboxSearchSuggestions(true);
                                                        } else {
                                                            setShowInboxSearchSuggestions(false);
                                                        }
                                                    }}
                                                    placeholder="ðŸ” Search emails..."
                                                    className="inbox-search-bar unified-button border-2 border-white"
                                                />
                                                {showInboxSearchSuggestions && inboxSearchResults.length > 0 && (
                                                    <div className="inbox-search-suggestions">
                                                        {inboxSearchResults.map(email => (
                                                            <div
                                                                key={email.id}
                                                                className="inbox-search-suggestion-item"
                                                                onClick={() => {
                                                                    setViewingEmail(email);
                                                                    setInboxSearchQuery('');
                                                                    setShowInboxSearchSuggestions(false);
                                                                }}
                                                            >
                                                                <div className="text-xs font-bold text-gray-800">{email.from}</div>
                                                                <div className="text-sm font-semibold text-gray-700">{email.subject}</div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>

                                            {/* Email List Area with Fade Effect */}
                                            <div className="inbox-scroll-area">
                                                {/* Priority Stack - iOS Style */}
                                                {autoPrioritize && priorityEmails.length > 0 && (
                                                    <div className="priority-stack-container">
                                                        <div
                                                            className={`priority-stack ${priorityStackExpanded ? 'expanded' : ''}`}
                                                            onClick={() => setPriorityStackExpanded(!priorityStackExpanded)}
                                                            style={{height: priorityStackExpanded ? 'auto' : '80px', marginBottom: priorityStackExpanded ? '12px' : '20px'}}
                                                        >
                                                            {priorityEmails.slice(0, 3).map((email, index) => (
                                                                <div
                                                                    key={email.id}
                                                                    className="priority-stack-item"
                                                                    onClick={(e) => {
                                                                        if (priorityStackExpanded) {
                                                                            e.stopPropagation();
                                                                            setViewingEmail(email);
                                                                        }
                                                                    }}
                                                                    style={{cursor: priorityStackExpanded ? 'pointer' : 'default'}}
                                                                >
                                                                    <div className="flex items-center justify-between">
                                                                        <div className="flex-1 pr-2">
                                                                            <div className="text-xs font-bold text-gray-800 mb-1 truncate">âš¡ {email.from}</div>
                                                                            <div className="text-sm font-semibold text-gray-700 truncate">{email.subject}</div>
                                                                        </div>
                                                                        {index === 0 && !priorityStackExpanded && priorityEmails.length > 1 && (
                                                                            <div className="text-xs bg-indigo-600 text-white px-2 py-1 rounded-full font-bold">
                                                                                +{priorityEmails.length - 1}
                                                                            </div>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}

                                                {/* Regular Email List */}
                                                <div className={`space-y-2 ${activeProvider === 'outlook' ? 'outlook-slide-enter' : 'gmail-slide-enter'}`}>
                                                    {activeProvider === 'outlook' ? (
                                                        <div className="outlook-coming-soon">
                                                            <div className="outlook-coming-soon-icon">ðŸ“®</div>
                                                            <div className="outlook-coming-soon-text">Outlook Coming Soon</div>
                                                            <div className="outlook-coming-soon-subtitle">Connect in Settings to display your Outlook emails</div>
                                                        </div>
                                                    ) : gmailEmails.length > 0 ? (
                                                        gmailEmails.filter(email => !priorityEmails.find(p => p.id === email.id)).map((email, index) => (
                                                            <div
                                                                key={email.id}
                                                                draggable
                                                                onDragStart={(e) => {
                                                                    setDraggedEmail(email);
                                                                    e.currentTarget.classList.add('dragging');
                                                                }}
                                                                onDragEnd={(e) => {
                                                                    setDraggedEmail(null);
                                                                    e.currentTarget.classList.remove('dragging');
                                                                }}
                                                                onClick={() => {
                                                                    setViewingEmail(email);
                                                                    if (unreadEmails.has(email.id)) {
                                                                        setUnreadEmails(prev => {
                                                                            const updated = new Set(prev);
                                                                            updated.delete(email.id);
                                                                            return updated;
                                                                        });
                                                                    }
                                                                }}
                                                                className={`sidebar-email-item unified-button border-2 border-white ${deletingEmailId === email.id ? 'email-deleting' : ''} ${viewingEmail && viewingEmail.id === email.id ? 'active' : ''} ${unreadEmails.has(email.id) ? 'unread-email' : ''}`}
                                                                style={{position: 'relative'}}
                                                            >
                                                                <div className="text-xs font-bold text-gray-800 mb-1 truncate">{email.from}</div>
                                                                <div className="text-sm font-semibold text-gray-700 mb-1 truncate">{email.subject}</div>
                                                                <div className="text-xs text-gray-600 truncate">{email.snippet.substring(0, 60)}...</div>
                                                                <div className="text-xs text-gray-400 mt-1">{email.date}</div>

                                                                {/* Delete Button on Hover */}
                                                                <button
                                                                    className="email-delete-btn"
                                                                    onClick={(e) => {
                                                                        e.stopPropagation();
                                                                        setDeletingEmailId(email.id);
                                                                        setTimeout(() => {
                                                                            handleDeleteEmail(email.id, 'inbox');
                                                                            setDeletingEmailId(null);
                                                                        }, 400);
                                                                    }}
                                                                >
                                                                    ðŸ—‘ï¸ Delete
                                                                </button>
                                                            </div>
                                                        ))
                                                    ) : (
                                                        <div className="text-center py-8 text-gray-500">
                                                            <div className="text-4xl mb-2">ðŸ“­</div>
                                                            <p className="text-sm">No emails</p>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>

                                            {/* Provider Tabs at Bottom */}
                                            <div className="provider-tabs-container">
                                                <div
                                                    className={`provider-tab unified-button ${activeProvider === 'gmail' ? 'active' : ''}`}
                                                    onClick={() => setActiveProvider('gmail')}
                                                >
                                                    ðŸ“§ Gmail
                                                </div>
                                                <div
                                                    className={`provider-tab unified-button ${activeProvider === 'outlook' ? 'active' : ''}`}
                                                    onClick={() => setActiveProvider('outlook')}
                                                >
                                                    ðŸ“® Outlook
                                                </div>
                                            </div>
                                        </div>

                                        {/* Right Content Area - Email Viewer or AI Tools */}
                                        <div
                                            className={`email-content-area ${viewingEmail ? 'viewing-email' : 'drop-zone'} ${isDraggingOver ? 'drag-over' : ''}`}
                                            onDragOver={(e) => {
                                                e.preventDefault();
                                                setIsDraggingOver(true);
                                            }}
                                            onDragLeave={(e) => {
                                                e.preventDefault();
                                                setIsDraggingOver(false);
                                            }}
                                            onDrop={(e) => {
                                                e.preventDefault();
                                                setIsDraggingOver(false);
                                                if (draggedEmail) {
                                                    setDroppedEmailFile(draggedEmail);
                                                    setViewingEmail(null);
                                                }
                                            }}
                                        >
                                            {viewingEmail ? (
                                                <>
                                                    {/* Email Viewer Header */}
                                                    <div className="email-viewer-header">
                                                        <button
                                                            onClick={() => setViewingEmail(null)}
                                                            className="px-4 py-2 glass-effect rounded-full text-gray-700 text-sm font-medium hover:bg-white/90 transition-all unified-button border-2 border-white flex items-center gap-2"
                                                        >
                                                            <span>â†</span>
                                                            <span>Back</span>
                                                        </button>
                                                        <div className="email-action-buttons">
                                                            <button
                                                                onClick={() => handleSummarizeEmail(viewingEmail)}
                                                                className="px-4 py-2 rounded-full text-gray-800 text-sm font-medium hover:opacity-90 transition-all unified-button border-2 border-white glass-effect"
                                                            >
                                                                âœ¨ Summarize
                                                            </button>
                                                            <button
                                                                onClick={() => {
                                                                    setEmailReply('');
                                                                    setTimeout(() => {
                                                                        document.getElementById('reply-section')?.scrollIntoView({ behavior: 'smooth' });
                                                                    }, 100);
                                                                }}
                                                                className="px-4 py-2 glass-effect rounded-full text-gray-700 text-sm font-medium hover:bg-white/90 transition-all unified-button border-2 border-white"
                                                            >
                                                                âœï¸ Reply
                                                            </button>
                                                        </div>
                                                    </div>

                                                    {/* Email Content */}
                                                    <div className="mb-4">
                                                        <h2 className="text-2xl font-bold text-gray-800 mb-3">{viewingEmail.subject}</h2>
                                                        <div className="flex justify-between items-center mb-4">
                                                            <div>
                                                                <div className="text-sm font-semibold text-gray-700">From: {viewingEmail.from}</div>
                                                                <div className="text-xs text-gray-500 mt-1">{viewingEmail.date}</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div className="prose max-w-none">
                                                        <p className="text-gray-700 leading-relaxed email-content-formatted">{viewingEmail.snippet}</p>
                                                    </div>

                                                    {/* Summarize Popup in Viewer */}
                                                    {summarizingEmail === viewingEmail.id && (
                                                        <div className="summary-popup mt-4" style={{position: 'relative', top: 0, marginTop: '16px'}}>
                                                            {isSummarizing ? (
                                                                <div className="space-y-3">
                                                                    <div className="flex items-center gap-3 mb-3">
                                                                        <div className="animate-spin rounded-full h-5 w-5 border-2 border-indigo-600 border-t-transparent"></div>
                                                                        <span className="text-sm text-gray-700 font-medium">Summarizing...</span>
                                                                    </div>
                                                                    <div className="space-y-2">
                                                                        <div className="loading-line" style={{height: '8px'}}></div>
                                                                        <div className="loading-line" style={{height: '8px'}}></div>
                                                                        <div className="loading-line" style={{height: '8px'}}></div>
                                                                    </div>
                                                                </div>
                                                            ) : (
                                                                <div>
                                                                    <div className="flex justify-between items-center mb-2">
                                                                        <span className="text-sm font-bold text-indigo-600">âœ¨ Summary</span>
                                                                        <button
                                                                            onClick={() => setSummaryHidden(!summaryHidden)}
                                                                            className="text-xs text-indigo-600 hover:text-indigo-800 font-semibold"
                                                                        >
                                                                            {summaryHidden ? 'Show' : 'Hide'}
                                                                        </button>
                                                                    </div>
                                                                    {!summaryHidden && (
                                                                        <p className="text-sm text-gray-700 leading-relaxed">{summaryText}</p>
                                                                    )}
                                                                </div>
                                                            )}
                                                        </div>
                                                    )}

                                                    {/* Reply Section */}
                                                    <div id="reply-section" className="mt-8 pt-6 border-t border-gray-300">
                                                        <h3 className="text-lg font-bold text-gray-800 mb-4">âœï¸ Write Reply</h3>
                                                        <div className="relative mb-4">
                                                            <textarea
                                                                value={emailReply}
                                                                onChange={(e) => setEmailReply(e.target.value)}
                                                                className="w-full h-48 px-6 py-4 pr-24 custom-textarea rounded-2xl text-gray-800 placeholder-gray-500 resize-none"
                                                                placeholder="Type your reply here..."
                                                            />
                                                            {emailReply && emailReply.trim().length > 0 && (
                                                                <button
                                                                    onClick={handleSendEmail}
                                                                    disabled={isSending}
                                                                    className={isSending ? 'send-button-float send-button-sending' : 'send-button-float'}
                                                                >
                                                                    {isSending ? (
                                                                        <>
                                                                            <div className="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"></div>
                                                                            <span>Sending...</span>
                                                                        </>
                                                                    ) : (
                                                                        <>
                                                                            <span>â†’</span>
                                                                            <span>Send</span>
                                                                        </>
                                                                    )}
                                                                </button>
                                                            )}
                                                        </div>
                                                        <div className="ai-transform-container">
                                                            <input
                                                                type="text"
                                                                value={replyPrompt}
                                                                onChange={(e) => setReplyPrompt(e.target.value)}
                                                                className="ai-transform-input"
                                                                placeholder="âœ¨ Rewrite with AI (e.g., 'Make it more professional', 'Add email structure')"
                                                                onKeyPress={(e) => {
                                                                    if (e.key === 'Enter' && replyPrompt && emailReply) {
                                                                        handleRewriteReply();
                                                                    }
                                                                }}
                                                            />
                                                            <button
                                                                onClick={handleRewriteReply}
                                                                disabled={!replyPrompt || !emailReply || isRewritingReply}
                                                                className="ai-transform-button"
                                                            >
                                                                {isRewritingReply ? 'âœ¨ Rewriting...' : 'Rewrite'}
                                                            </button>
                                                        </div>
                                                    </div>
                                                </>
                                            ) : (
                                                <>
                                                    {/* AI Writer as Default */}
                                                    <div className="rounded-3xl p-4 relative">
                                                        {/* Tab Switches */}
                                                        <div className="flex justify-center mb-8">
                                                            <div className="tab-container tab-button-container">
                                                                <div
                                                                    className="tab-slider"
                                                                    style={{
                                                                        width: '50%',
                                                                        height: 'calc(100% - 12px)',
                                                                        top: '6px',
                                                                        left: activeView === 'writer' ? '6px' : 'calc(50% - 6px)',
                                                                    }}
                                                                ></div>
                                                                <button
                                                                    onClick={() => setActiveView('writer')}
                                                                    className={`relative z-10 px-8 py-3 rounded-full font-medium transition-all ${
                                                                        activeView === 'writer' ? 'text-white' : 'text-gray-700 hover:text-gray-800'
                                                                    }`}
                                                                >
                                                                    âœï¸ AI Writer
                                                                </button>
                                                                <button
                                                                    onClick={() => setActiveView('results')}
                                                                    className={`relative z-10 px-8 py-3 rounded-full font-medium transition-all ${
                                                                        activeView === 'results' ? 'text-white' : 'text-gray-700 hover:text-gray-800'
                                                                    }`}
                                                                >
                                                                    âœ¨ Results
                                                                </button>
                                                            </div>
                                                        </div>

                                                        {/* Content Area */}
                                                        <div className="min-h-[500px]">
                                                            {activeView === 'writer' ? renderWriterContent() : renderResultsContent()}
                                                        </div>
                                                    </div>
                                                </>
                                            )}
                                        </div>
                                    </div>
                                ) : (
                                    /* Original Home Page Layout when not connected */
                                    <div className="rounded-3xl p-8 relative" style={{marginTop: showWelcomeAnimation ? '0' : '2rem'}}>
                                        {/* Tab Switches */}
                                        <div className="flex justify-center mb-8">
                                            <div className="tab-container tab-button-container">
                                                <div
                                                    className="tab-slider"
                                                    style={{
                                                        width: '50%',
                                                        height: 'calc(100% - 12px)',
                                                        top: '6px',
                                                        left: activeView === 'writer' ? '6px' : 'calc(50% - 6px)',
                                                    }}
                                                ></div>
                                                <button
                                                    onClick={() => setActiveView('writer')}
                                                    className={`relative z-10 px-8 py-3 rounded-full font-medium transition-all ${
                                                        activeView === 'writer' ? 'text-white' : 'text-gray-700 hover:text-gray-800'
                                                    }`}
                                                >
                                                    âœï¸ AI Writer
                                                </button>
                                                <button
                                                    onClick={() => setActiveView('results')}
                                                    className={`relative z-10 px-8 py-3 rounded-full font-medium transition-all ${
                                                        activeView === 'results' ? 'text-white' : 'text-gray-700 hover:text-gray-800'
                                                    }`}
                                                >
                                                    âœ¨ Results
                                                </button>
                                            </div>
                                        </div>

                                        {/* Content Area */}
                                        <div className="min-h-[500px]">
                                            {activeView === 'writer' ? renderWriterContent() : renderResultsContent()}
                                        </div>
                                    </div>
                                )}
                            </>
                        )}
                    </div>

                    {/* Undo Delete Button */}
                    {showUndoDelete && (
                        <button
                            onClick={handleUndoDelete}
                            className="undo-delete-button"
                        >
                            <span>â†©ï¸</span>
                            <span>Undo Delete</span>
                        </button>
                    )}

                    {/* Envelope Flying Animation */}
                    {showEnvelope && (
                        <div className="envelope-animation">
                            ðŸ“§
                        </div>
                    )}

                    {/* Bottom Notification */}
                    {showBottomNotification && (
                        <div className="bottom-notification">
                            {bottomNotificationText}
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
